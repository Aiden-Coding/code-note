import{_ as t,r as e,o as p,c,a as n,b as s,d as o,e as l}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"netty案例-netty4-1中级拓展篇四《netty传输文件、分片发送、断点续传》",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#netty案例-netty4-1中级拓展篇四《netty传输文件、分片发送、断点续传》","aria-hidden":"true"},"#"),s(" netty案例，netty4.1中级拓展篇四《Netty传输文件、分片发送、断点续传》")],-1),k=n("br",null,null,-1),r={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=l(`<blockquote><p>沉淀、分享、成长，让自己和他人都能有所收获！😄</p></blockquote><h2 id="前言介绍" tabindex="-1"><a class="header-anchor" href="#前言介绍" aria-hidden="true">#</a> 前言介绍</h2><ol><li>在实际应用中我们经常使用到网盘服务，他们可以高效的上传下载较大文件。那么这些高性能文件传输服务，都需要实现的分片发送、断点续传功能。</li><li>在Java文件操作中有RandomAccessFile类，他可以支持文件的定位读取和写入，这样就满足了我们对文件分片的最基础需求。</li><li>Netty服务端启动后，可以向客户端发送文件传输指令；允许接收文件、控制读取位点、记录传输标记、文件接收完成。</li><li>为了保证传输性能我们采用protostuff二进制流进行传输。</li><li>读取文件的时候需要注意，我们设定byte[1024]为默认读取范围，但当读取到最后的时候可能不足1024个字节，就会出现空字节。这个时候需要去掉空字节，否则我们的文件写入会多额外信息，导致文件不能打开｛zip、war、exe、jar等｝。</li></ol><h2 id="开发环境" tabindex="-1"><a class="header-anchor" href="#开发环境" aria-hidden="true">#</a> 开发环境</h2><p>1、jdk1.8【jdk1.7以下只能部分支持netty】 2、Netty4.1.36.Final【netty3.x 4.x 5每次的变化较大，接口类名也随着变化】</p><h2 id="代码示例" tabindex="-1"><a class="header-anchor" href="#代码示例" aria-hidden="true">#</a> 代码示例</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>netty<span class="token operator">-</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">04</span>
└── src
    ├── main
    │   └── java
    │       └── org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>netty
    │           ├── client
    │           │	├── <span class="token class-name">MyChannelInitializer</span><span class="token punctuation">.</span>java
    │           │	├── <span class="token class-name">MyClientHandler</span><span class="token punctuation">.</span>java
    │           │	└── <span class="token class-name">NettyClient</span><span class="token punctuation">.</span>java
    │           ├── codec
    │           │	├── <span class="token class-name">ObjDecoder</span><span class="token punctuation">.</span>java
    │           │	└── <span class="token class-name">ObjEncoder</span><span class="token punctuation">.</span>java
    │           ├── domain
    │           │	├── <span class="token class-name">Constants</span><span class="token punctuation">.</span>java
    │           │	├── <span class="token class-name">FileBurstData</span><span class="token punctuation">.</span>java
    │           │	├── <span class="token class-name">FileBurstInstruct</span><span class="token punctuation">.</span>java
    │           │	├── <span class="token class-name">FileDescInfo</span><span class="token punctuation">.</span>java
    │           │	└── <span class="token class-name">FileTransferProtocol</span><span class="token punctuation">.</span>java
    │           ├── server
    │           │	├── <span class="token class-name">MyChannelInitializer</span><span class="token punctuation">.</span>java
    │           │	├── <span class="token class-name">MyServerHandler</span><span class="token punctuation">.</span>java
    │           │	└── <span class="token class-name">NettyServer</span><span class="token punctuation">.</span>java
    │           └── util
    │           	├── <span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>java
    │           	├── <span class="token class-name">FileUtil</span><span class="token punctuation">.</span>java
    │           	├── <span class="token class-name">MsgUtil</span><span class="token punctuation">.</span>java
    │           	└── <span class="token class-name">SerializationUtil</span><span class="token punctuation">.</span>java
    │
    └── test
         └── java
             └── org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test
				 ├── <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
				 ├── <span class="token class-name">NettyClientTest</span><span class="token punctuation">.</span>java 
                 └── <span class="token class-name">NettyServerTest</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>演示部分重点代码块，完整代码下载关注公众号；bugstack虫洞栈</strong></p><blockquote><p>client/MyClientHandler.java *文件客户端；channelRead处理文件协议，其中模拟传输过程中断，场景测试可以注释掉</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
	<span class="token comment">//数据格式验证</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">FileTransferProtocol</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token class-name">FileTransferProtocol</span> fileTransferProtocol <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">FileTransferProtocol</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
	<span class="token comment">//0传输文件&#39;请求&#39;、1文件传输&#39;指令&#39;、2文件传输&#39;数据&#39;</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>fileTransferProtocol<span class="token punctuation">.</span><span class="token function">getTransferType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
			<span class="token class-name">FileBurstInstruct</span> fileBurstInstruct <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">FileBurstInstruct</span><span class="token punctuation">)</span> fileTransferProtocol<span class="token punctuation">.</span><span class="token function">getTransferObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//Constants.FileStatus ｛0开始、1中间、2结尾、3完成｝</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">COMPLETE</span> <span class="token operator">==</span> fileBurstInstruct<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				ctx<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token class-name">FileBurstData</span> fileBurstData <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>fileBurstInstruct<span class="token punctuation">.</span><span class="token function">getClientFileUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fileBurstInstruct<span class="token punctuation">.</span><span class="token function">getReadPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">MsgUtil</span><span class="token punctuation">.</span><span class="token function">buildTransferData</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bugstack虫洞栈客户端传输文件信息。 FILE：&quot;</span> <span class="token operator">+</span> fileBurstData<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; SIZE(byte)：&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>fileBurstData<span class="token punctuation">.</span><span class="token function">getEndPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> fileBurstData<span class="token punctuation">.</span><span class="token function">getBeginPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token doc-comment comment">/**模拟传输过程中断，场景测试可以注释掉
	 *
	 */</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bugstack虫洞栈客户端传输文件信息[主动断开链接，模拟断点续传]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ctx<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>domain/FileBurstData.java *文件分片数据块</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 文件分片数据
 * 虫洞栈：https://bugstack.cn
 * 公众号：bugstack虫洞栈  ｛获取学习源码｝
 * 虫洞群：①群5398358 ②群5360692
 * Create by fuzhengwei on 2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileBurstData</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> fileUrl<span class="token punctuation">;</span>     <span class="token comment">//客户端文件地址</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> fileName<span class="token punctuation">;</span>    <span class="token comment">//文件名称</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> beginPos<span class="token punctuation">;</span>   <span class="token comment">//开始位置</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> endPos<span class="token punctuation">;</span>     <span class="token comment">//结束位置</span>
    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">;</span>       <span class="token comment">//文件字节；再实际应用中可以使用非对称加密，以保证传输信息安全</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> status<span class="token punctuation">;</span>     <span class="token comment">//Constants.FileStatus ｛0开始、1中间、2结尾、3完成｝</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> get<span class="token operator">/</span>set
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>domain/FileBurstInstruct.java *文件分片指令</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 文件分片指令
 * 虫洞栈：https://bugstack.cn
 * 公众号：bugstack虫洞栈  ｛获取学习源码｝
 * 虫洞群：①群5398358 ②群5360692
 * Create by fuzhengwei on @2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileBurstInstruct</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> status<span class="token punctuation">;</span>       <span class="token comment">//Constants.FileStatus ｛0开始、1中间、2结尾、3完成｝</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> clientFileUrl<span class="token punctuation">;</span> <span class="token comment">//客户端文件URL</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> readPosition<span class="token punctuation">;</span> <span class="token comment">//读取位置</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> get<span class="token operator">/</span>set
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>domain/FileDescInfo.java *文件传输信息</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 文件描述信息
 * 虫洞栈：https://bugstack.cn
 * 公众号：bugstack虫洞栈  ｛获取学习源码｝
 * 虫洞群：①群5398358 ②群5360692
 * Create by fuzhengwei on @2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileDescInfo</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> fileUrl<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> fileName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> fileSize<span class="token punctuation">;</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> get<span class="token operator">/</span>set
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>domain/FileTransferProtocol.java *文件传输协议</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 文件传输协议
 * 虫洞栈：https://bugstack.cn
 * 公众号：bugstack虫洞栈  ｛获取学习源码｝
 * 虫洞群：5360692
 * Create by fuzhengwei on @2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileTransferProtocol</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> transferType<span class="token punctuation">;</span> <span class="token comment">//0请求传输文件、1文件传输指令、2文件传输数据</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> transferObj<span class="token punctuation">;</span>   <span class="token comment">//数据对象；(0)FileDescInfo、(1)FileBurstInstruct、(2)FileBurstData</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> get<span class="token operator">/</span>set
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>serverMyServerHandler.java *文件服务端；channelRead处理文件协议，并包含了保存续传信息，用于断点续传</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
	<span class="token comment">//数据格式验证</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">FileTransferProtocol</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token class-name">FileTransferProtocol</span> fileTransferProtocol <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">FileTransferProtocol</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
	<span class="token comment">//0传输文件&#39;请求&#39;、1文件传输&#39;指令&#39;、2文件传输&#39;数据&#39;</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>fileTransferProtocol<span class="token punctuation">.</span><span class="token function">getTransferType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
			<span class="token class-name">FileDescInfo</span> fileDescInfo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">FileDescInfo</span><span class="token punctuation">)</span> fileTransferProtocol<span class="token punctuation">.</span><span class="token function">getTransferObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">//断点续传信息，实际应用中需要将断点续传信息保存到数据库中</span>
			<span class="token class-name">FileBurstInstruct</span> fileBurstInstructOld <span class="token operator">=</span> <span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>burstDataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>fileDescInfo<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> fileBurstInstructOld<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>fileBurstInstructOld<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">COMPLETE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>burstDataMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>fileDescInfo<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">//传输完成删除断点信息</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bugstack虫洞栈服务端，接收客户端传输文件请求[断点续传]。&quot;</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>fileBurstInstructOld<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">MsgUtil</span><span class="token punctuation">.</span><span class="token function">buildTransferInstruct</span><span class="token punctuation">(</span>fileBurstInstructOld<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">//发送信息</span>
			<span class="token class-name">FileTransferProtocol</span> sendFileTransferProtocol <span class="token operator">=</span> <span class="token class-name">MsgUtil</span><span class="token punctuation">.</span><span class="token function">buildTransferInstruct</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">BEGIN</span><span class="token punctuation">,</span> fileDescInfo<span class="token punctuation">.</span><span class="token function">getFileUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>sendFileTransferProtocol<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bugstack虫洞栈服务端，接收客户端传输文件请求。&quot;</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>fileDescInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
			<span class="token class-name">FileBurstData</span> fileBurstData <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">FileBurstData</span><span class="token punctuation">)</span> fileTransferProtocol<span class="token punctuation">.</span><span class="token function">getTransferObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">FileBurstInstruct</span> fileBurstInstruct <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">&quot;E://&quot;</span><span class="token punctuation">,</span> fileBurstData<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">//保存断点续传信息</span>
			<span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>burstDataMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fileBurstInstruct<span class="token punctuation">)</span><span class="token punctuation">;</span>

			ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">MsgUtil</span><span class="token punctuation">.</span><span class="token function">buildTransferInstruct</span><span class="token punctuation">(</span>fileBurstInstruct<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bugstack虫洞栈服务端，接收客户端传输文件数据。&quot;</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">//传输完成删除断点信息</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>fileBurstInstruct<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">COMPLETE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>burstDataMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>util/FileUtil.java *文件读写工具，分片读取写入处理类</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 文件读写工具
 * 虫洞栈：https://bugstack.cn
 * 公众号：bugstack虫洞栈  ｛获取学习源码｝
 * 虫洞群：5360692
 * Create by fuzhengwei on @2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUtil</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FileBurstData</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileUrl<span class="token punctuation">,</span> <span class="token class-name">Integer</span> readPosition<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>fileUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RandomAccessFile</span> randomAccessFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//r: 只读模式 rw:读写模式</span>
        randomAccessFile<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>readPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> readSize <span class="token operator">=</span> randomAccessFile<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>readSize <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            randomAccessFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FileBurstData</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">COMPLETE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Constants.FileStatus ｛0开始、1中间、2结尾、3完成｝</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">FileBurstData</span> fileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileBurstData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setFileUrl</span><span class="token punctuation">(</span>fileUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setFileName</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setBeginPos</span><span class="token punctuation">(</span>readPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setEndPos</span><span class="token punctuation">(</span>readPosition <span class="token operator">+</span> readSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//不足1024需要拷贝去掉空字节</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>readSize <span class="token operator">&lt;</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> copy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>readSize<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> copy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> readSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setBytes</span><span class="token punctuation">(</span>copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">END</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setBytes</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">CENTER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        randomAccessFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> fileInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FileBurstInstruct</span> <span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> baseUrl<span class="token punctuation">,</span> <span class="token class-name">FileBurstData</span> fileBurstData<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">COMPLETE</span> <span class="token operator">==</span> fileBurstData<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FileBurstInstruct</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">COMPLETE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Constants.FileStatus ｛0开始、1中间、2结尾、3完成｝</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>baseUrl <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> fileBurstData<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RandomAccessFile</span> randomAccessFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">&quot;rw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//r: 只读模式 rw:读写模式</span>
        randomAccessFile<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">.</span><span class="token function">getBeginPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//移动文件记录指针的位置,</span>
        randomAccessFile<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//调用了seek（start）方法，是指把文件的记录指针定位到start字节的位置。也就是说程序将从start字节开始写数据</span>
        randomAccessFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">END</span> <span class="token operator">==</span> fileBurstData<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FileBurstInstruct</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">COMPLETE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Constants.FileStatus ｛0开始、1中间、2结尾、3完成｝</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//文件分片传输指令</span>
        <span class="token class-name">FileBurstInstruct</span> fileBurstInstruct <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileBurstInstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileBurstInstruct<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">CENTER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//Constants.FileStatus ｛0开始、1中间、2结尾、3完成｝</span>
        fileBurstInstruct<span class="token punctuation">.</span><span class="token function">setClientFileUrl</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">.</span><span class="token function">getFileUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//客户端文件URL</span>
        fileBurstInstruct<span class="token punctuation">.</span><span class="token function">setReadPosition</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">.</span><span class="token function">getEndPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//读取位置</span>

        <span class="token keyword">return</span> fileBurstInstruct<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>util/MsgUtil.java *传输消息体构建工具类</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 消息构建工具
 * 虫洞栈：https://bugstack.cn
 * 公众号：bugstack虫洞栈  ｛获取学习源码｝
 * 虫洞群：5360692
 * Create by fuzhengwei on @2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MsgUtil</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * 构建对象；请求传输文件(客户端)
     *
     * <span class="token keyword">@param</span> <span class="token parameter">fileUrl</span>  客户端文件地址
     * <span class="token keyword">@param</span> <span class="token parameter">fileName</span> 文件名称
     * <span class="token keyword">@param</span> <span class="token parameter">fileSize</span> 文件大小
     * <span class="token keyword">@return</span> 传输协议
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FileTransferProtocol</span> <span class="token function">buildRequestTransferFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileUrl<span class="token punctuation">,</span> <span class="token class-name">String</span> fileName<span class="token punctuation">,</span> <span class="token class-name">Long</span> fileSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">FileDescInfo</span> fileDescInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileDescInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileDescInfo<span class="token punctuation">.</span><span class="token function">setFileUrl</span><span class="token punctuation">(</span>fileUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileDescInfo<span class="token punctuation">.</span><span class="token function">setFileName</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileDescInfo<span class="token punctuation">.</span><span class="token function">setFileSize</span><span class="token punctuation">(</span>fileSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">FileTransferProtocol</span> fileTransferProtocol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileTransferProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileTransferProtocol<span class="token punctuation">.</span><span class="token function">setTransferType</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0请求传输文件、1文件传输指令、2文件传输数据</span>
        fileTransferProtocol<span class="token punctuation">.</span><span class="token function">setTransferObj</span><span class="token punctuation">(</span>fileDescInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> fileTransferProtocol<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 构建对象；文件传输指令(服务端)
     * <span class="token keyword">@param</span> <span class="token parameter">status</span>          0请求传输文件、1文件传输指令、2文件传输数据
     * <span class="token keyword">@param</span> <span class="token parameter">clientFileUrl</span>   客户端文件地址
     * <span class="token keyword">@param</span> <span class="token parameter">readPosition</span>    读取位置
     * <span class="token keyword">@return</span>                传输协议
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FileTransferProtocol</span> <span class="token function">buildTransferInstruct</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> status<span class="token punctuation">,</span> <span class="token class-name">String</span> clientFileUrl<span class="token punctuation">,</span> <span class="token class-name">Integer</span> readPosition<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">FileBurstInstruct</span> fileBurstInstruct <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileBurstInstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileBurstInstruct<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileBurstInstruct<span class="token punctuation">.</span><span class="token function">setClientFileUrl</span><span class="token punctuation">(</span>clientFileUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileBurstInstruct<span class="token punctuation">.</span><span class="token function">setReadPosition</span><span class="token punctuation">(</span>readPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">FileTransferProtocol</span> fileTransferProtocol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileTransferProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileTransferProtocol<span class="token punctuation">.</span><span class="token function">setTransferType</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>TransferType</span><span class="token punctuation">.</span><span class="token constant">INSTRUCT</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0传输文件&#39;请求&#39;、1文件传输&#39;指令&#39;、2文件传输&#39;数据&#39;</span>
        fileTransferProtocol<span class="token punctuation">.</span><span class="token function">setTransferObj</span><span class="token punctuation">(</span>fileBurstInstruct<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> fileTransferProtocol<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 构建对象；文件传输指令(服务端)
     *
     * <span class="token keyword">@return</span> 传输协议
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FileTransferProtocol</span> <span class="token function">buildTransferInstruct</span><span class="token punctuation">(</span><span class="token class-name">FileBurstInstruct</span> fileBurstInstruct<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FileTransferProtocol</span> fileTransferProtocol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileTransferProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileTransferProtocol<span class="token punctuation">.</span><span class="token function">setTransferType</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>TransferType</span><span class="token punctuation">.</span><span class="token constant">INSTRUCT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//0传输文件&#39;请求&#39;、1文件传输&#39;指令&#39;、2文件传输&#39;数据&#39;</span>
        fileTransferProtocol<span class="token punctuation">.</span><span class="token function">setTransferObj</span><span class="token punctuation">(</span>fileBurstInstruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> fileTransferProtocol<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 构建对象；文件传输数据(客户端)
     *
     * <span class="token keyword">@return</span> 传输协议
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FileTransferProtocol</span> <span class="token function">buildTransferData</span><span class="token punctuation">(</span><span class="token class-name">FileBurstData</span> fileBurstData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FileTransferProtocol</span> fileTransferProtocol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileTransferProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileTransferProtocol<span class="token punctuation">.</span><span class="token function">setTransferType</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>TransferType</span><span class="token punctuation">.</span><span class="token constant">DATA</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0传输文件&#39;请求&#39;、1文件传输&#39;指令&#39;、2文件传输&#39;数据&#39;</span>
        fileTransferProtocol<span class="token punctuation">.</span><span class="token function">setTransferObj</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> fileTransferProtocol<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>test/NettyServerTest.java *服务端启动器</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 虫洞栈：https://bugstack.cn
 * 公众号：bugstack虫洞栈  ｛获取学习源码｝
 * 虫洞群：①群5398358 ②群5360692
 * Create by fuzhengwei on 2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyServerTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//启动服务</span>
        <span class="token keyword">new</span> <span class="token class-name">NettyServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bing</span><span class="token punctuation">(</span><span class="token number">7397</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>test/NettyClientTest.java *客户端启动器</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 虫洞栈：https://bugstack.cn
 * 公众号：bugstack虫洞栈  ｛获取学习源码｝
 * 虫洞群：①群5398358 ②群5360692
 * Create by fuzhengwei on 2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyClientTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//启动客户端</span>
        <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NettyClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">7397</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//文件信息{文件大于1024kb方便测试断点续传}</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;C:\\\\Users\\\\fuzhengwei\\\\Desktop\\\\测试传输文件.rar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileTransferProtocol</span> fileTransferProtocol <span class="token operator">=</span> <span class="token class-name">MsgUtil</span><span class="token punctuation">.</span><span class="token function">buildRequestTransferFile</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//发送信息；请求传输文件</span>
        channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>fileTransferProtocol<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="测试结果" tabindex="-1"><a class="header-anchor" href="#测试结果" aria-hidden="true">#</a> 测试结果</h2><blockquote><p>启动NettyServerTest *默认接收地址为E盘根目录</p></blockquote><p><img src="https://bugstack.cn/assets/images/pic-content/2019/08/netty-2-04-1.png" alt=""></p><blockquote><p>启动NettyClientTest *设置传输文件</p></blockquote><p><img src="https://bugstack.cn/assets/images/pic-content/2019/08/netty-2-04-2.png" alt=""></p><blockquote><p>文件传输结果</p></blockquote><p><img src="https://bugstack.cn/assets/images/pic-content/2019/08/netty-2-04-3.png" alt=""></p><blockquote><p>服务端执行结果</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>netty server start done<span class="token punctuation">.</span> <span class="token punctuation">{</span>关注公众号：bugstack虫洞栈，获取源码<span class="token punctuation">}</span>
链接报告开始
链接报告信息：有一客户端链接到本服务端。channelId：<span class="token number">3</span>a1df8c1
链接报告<span class="token constant">IP</span><span class="token operator">:</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
链接报告<span class="token class-name">Port</span><span class="token operator">:</span><span class="token number">7397</span>
链接报告完毕
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">04</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">46</span> bugstack虫洞栈服务端，接收客户端传输文件请求。<span class="token punctuation">{</span><span class="token string">&quot;fileName&quot;</span><span class="token operator">:</span><span class="token string">&quot;测试传输文件.rar&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;fileSize&quot;</span><span class="token operator">:</span><span class="token number">1400</span><span class="token punctuation">,</span><span class="token string">&quot;fileUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;C:\\\\Users\\\\fuzhengwei1\\\\Desktop\\\\测试传输文件.rar&quot;</span><span class="token punctuation">}</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">04</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">46</span> bugstack虫洞栈服务端，接收客户端传输文件数据。<span class="token punctuation">{</span><span class="token string">&quot;beginPos&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;bytes&quot;</span><span class="token operator">:</span><span class="token string">&quot;UmFyIRoHAM+QcwAADQAAAAAAAAC4C3SgkkkAFAUAAIjDEQACJRsHe0WECE8dMyQAIAAAALLiytS0q8rkzsS8/i50eHQAbWpL1YsgT5OPoIdl9k4udAB4dACwS2heCZgVEQzPzUEXfAnhs2R75rhNbCQhNE3uMY4EBkBqQJ45izS4lFGujEk08xLGuhp4sSUSbzEscRICakGyOdARhIE6GEPucySJpY5kQ/Cq28ur4XdfH/j1V8UVoo5X5V+B3dl2f8qvvoxd3t6GPv8HZ7dXs+98XT6uJ0Oj8GZ4c6tvV6vzV865ka375utod+9i+pX/O1Uu1tT76tT38TE+Hq+tzud6Of9Xo9T0/S/xytLm12v4NWztfhnda3lbevs7dnXsWL1vT3Kte91triqYuHW/9bf3WPnjq5r5savbHd67V8Nu6r5+lmZtrP0eO63Ba+upVuWtf7bvByg2/0w+5hz8ru14ND5ex/Odw4F7uRWrYedwU2tXmw5m1u+S7lWdjvTq5e/Kv+1apZxrdjT2dHizdHDrlrH1cvkbrWe5k97u6WRnXdviw6zkvc3cD9TOt7+7W9z2/Ys+Sx9VTPwGeYLmrz+h8fQt5u5v8/3fZ5sXKnc4MOT1+n0upicmOVDT86GfY4bPf5vN7XSxMT5Mnsdry8e84///+quHp9l19fRz8vkds+O7qb+9pWe1WvXdb7NWza3vNO3V3cZZ2rPDr1svHwO3Nq14sBuZu3P1zOvuWP++s8ex9O95e5U/vW9/F7Jtb+p+PGeRtzlg8VfG5t5TyAAAAAAAAAAAAAAAARu1PHU9QX3wAAAAAAAAAAAAAAAiiXyXwAAAAAAAAAAAAAAAiiXyXwAAAAAAAAAAAAAAAiiXyXwAAAAAAAAAAAAAAAiiXyXwAEbDTyAAAAAAAAAAAAAEctTx1PUF98AAAAAAAAAAAAAAAIol8l8AAAAAAAAAAAAAAAIol8l8AAAAAAAAAAAAAAAIol8l8AAAAAAAAAAAAAAAIol8l8AAAABHx08gAAAAAAAAAAj108dT1BffAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAAAAAAgankAAAAAAAEZGnjqeoL74AAAAAAAAAAAAAAARRL5L4AAAAAAAAAAAAAAARRL5L4AAAAAAAAAAAAAAARRL5L4AAAAAAAAAAAAAAARRL5L4AAAAAAAAAAEYinkAAAAEH08dT1BffAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAA==&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;endPos&quot;</span><span class="token operator">:</span><span class="token number">1024</span><span class="token punctuation">,</span><span class="token string">&quot;fileName&quot;</span><span class="token operator">:</span><span class="token string">&quot;测试传输文件.rar&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;fileUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;C:\\\\Users\\\\fuzhengwei1\\\\Desktop\\\\测试传输文件.rar&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">04</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">46</span> bugstack虫洞栈服务端，接收客户端传输文件数据。<span class="token punctuation">{</span><span class="token string">&quot;beginPos&quot;</span><span class="token operator">:</span><span class="token number">1025</span><span class="token punctuation">,</span><span class="token string">&quot;bytes&quot;</span><span class="token operator">:</span><span class="token string">&quot;AAI8VPIAEfZTx1PUF98AAAAAAAAAAAAAAAIol8l8AAAAAAAAAAAAAAAIol8l8AAAAAAAAAAAAAAAIol8l8AAAAAAAAAAAAAAAIol8l8AAAAAAAAAAAAAAAIol8l8R+dPIAAAAAAAAAAAAAAAjt08dT1BffAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAIWp5AAAAAAAAAAAAEYGnjqeoL74AAAAAAAAAAAAAAARRL5L4AAAAAAAAAAAAAAARRL5L4AAAAAAAAAAAAAAARRL5L4AAAAAAAAAAAAAAARRL5L4AAAAABGYp5AAAAAAAAAEc/Tx1PUF98AAAAAAAAIyFPIAAAAAACB6eOp6gvvgAAAAAAAAAARiKeQAAAAQfTx1PUF98AAAAAAAAAAAAAjAU8gACF6eOp6gvvgAAAAAAAAAAAAAABFH9IDEPXsAQAcA&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;endPos&quot;</span><span class="token operator">:</span><span class="token number">1400</span><span class="token punctuation">,</span><span class="token string">&quot;fileName&quot;</span><span class="token operator">:</span><span class="token string">&quot;测试传输文件.rar&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;fileUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;C:\\\\Users\\\\fuzhengwei1\\\\Desktop\\\\测试传输文件.rar&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span>
客户端断开链接<span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">7397</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token operator">-</span><span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>客户端执行结果</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>netty client start done<span class="token punctuation">.</span> <span class="token punctuation">{</span>关注公众号：bugstack虫洞栈，获取源码<span class="token punctuation">}</span>
链接报告开始
链接报告信息：本客户端链接到服务端。channelId：<span class="token number">71399d</span><span class="token number">8</span>c
链接报告<span class="token constant">IP</span><span class="token operator">:</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
链接报告<span class="token class-name">Port</span><span class="token operator">:</span><span class="token number">54974</span>
链接报告完毕
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">04</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">46</span> bugstack虫洞栈客户端传输文件信息。 <span class="token constant">FILE</span>：测试传输文件<span class="token punctuation">.</span>rar <span class="token function">SIZE</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>：<span class="token number">1024</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">04</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">46</span> bugstack虫洞栈客户端传输文件信息。 <span class="token constant">FILE</span>：测试传输文件<span class="token punctuation">.</span>rar <span class="token function">SIZE</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>：<span class="token number">375</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token operator">-</span><span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>微信搜索「<strong>bugstack虫洞栈</strong>」公众号，关注后回复「<strong>Netty专题案例</strong>」获取本文源码&amp;更多原创专题案例！</p>`,40);function v(m,A){const a=e("ExternalLinkIcon");return p(),c("div",null,[u,n("p",null,[s("作者：小傅哥 "),k,s("博客："),n("a",r,[s("https://bugstack.cn"),o(a)])]),d])}const f=t(i,[["render",v],["__file","2019-08-19-nettyanli，netty4.1zhongjituozhanpiansi《Nettychuanshuwenjian、fenpianfasong、duandianxuchuan》.html.vue"]]);export{f as default};
