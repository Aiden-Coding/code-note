import{_ as t,r as e,o as p,c,a as n,b as s,d as o,e as l}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"nettyæ¡ˆä¾‹-netty4-1ä¸­çº§æ‹“å±•ç¯‡å››ã€Šnettyä¼ è¾“æ–‡ä»¶ã€åˆ†ç‰‡å‘é€ã€æ–­ç‚¹ç»­ä¼ ã€‹",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#nettyæ¡ˆä¾‹-netty4-1ä¸­çº§æ‹“å±•ç¯‡å››ã€Šnettyä¼ è¾“æ–‡ä»¶ã€åˆ†ç‰‡å‘é€ã€æ–­ç‚¹ç»­ä¼ ã€‹","aria-hidden":"true"},"#"),s(" nettyæ¡ˆä¾‹ï¼Œnetty4.1ä¸­çº§æ‹“å±•ç¯‡å››ã€ŠNettyä¼ è¾“æ–‡ä»¶ã€åˆ†ç‰‡å‘é€ã€æ–­ç‚¹ç»­ä¼ ã€‹")],-1),k=n("br",null,null,-1),r={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=l(`<blockquote><p>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„</p></blockquote><h2 id="å‰è¨€ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#å‰è¨€ä»‹ç»" aria-hidden="true">#</a> å‰è¨€ä»‹ç»</h2><ol><li>åœ¨å®é™…åº”ç”¨ä¸­æˆ‘ä»¬ç»å¸¸ä½¿ç”¨åˆ°ç½‘ç›˜æœåŠ¡ï¼Œä»–ä»¬å¯ä»¥é«˜æ•ˆçš„ä¸Šä¼ ä¸‹è½½è¾ƒå¤§æ–‡ä»¶ã€‚é‚£ä¹ˆè¿™äº›é«˜æ€§èƒ½æ–‡ä»¶ä¼ è¾“æœåŠ¡ï¼Œéƒ½éœ€è¦å®ç°çš„åˆ†ç‰‡å‘é€ã€æ–­ç‚¹ç»­ä¼ åŠŸèƒ½ã€‚</li><li>åœ¨Javaæ–‡ä»¶æ“ä½œä¸­æœ‰RandomAccessFileç±»ï¼Œä»–å¯ä»¥æ”¯æŒæ–‡ä»¶çš„å®šä½è¯»å–å’Œå†™å…¥ï¼Œè¿™æ ·å°±æ»¡è¶³äº†æˆ‘ä»¬å¯¹æ–‡ä»¶åˆ†ç‰‡çš„æœ€åŸºç¡€éœ€æ±‚ã€‚</li><li>NettyæœåŠ¡ç«¯å¯åŠ¨åï¼Œå¯ä»¥å‘å®¢æˆ·ç«¯å‘é€æ–‡ä»¶ä¼ è¾“æŒ‡ä»¤ï¼›å…è®¸æ¥æ”¶æ–‡ä»¶ã€æ§åˆ¶è¯»å–ä½ç‚¹ã€è®°å½•ä¼ è¾“æ ‡è®°ã€æ–‡ä»¶æ¥æ”¶å®Œæˆã€‚</li><li>ä¸ºäº†ä¿è¯ä¼ è¾“æ€§èƒ½æˆ‘ä»¬é‡‡ç”¨protostuffäºŒè¿›åˆ¶æµè¿›è¡Œä¼ è¾“ã€‚</li><li>è¯»å–æ–‡ä»¶çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬è®¾å®šbyte[1024]ä¸ºé»˜è®¤è¯»å–èŒƒå›´ï¼Œä½†å½“è¯»å–åˆ°æœ€åçš„æ—¶å€™å¯èƒ½ä¸è¶³1024ä¸ªå­—èŠ‚ï¼Œå°±ä¼šå‡ºç°ç©ºå­—èŠ‚ã€‚è¿™ä¸ªæ—¶å€™éœ€è¦å»æ‰ç©ºå­—èŠ‚ï¼Œå¦åˆ™æˆ‘ä»¬çš„æ–‡ä»¶å†™å…¥ä¼šå¤šé¢å¤–ä¿¡æ¯ï¼Œå¯¼è‡´æ–‡ä»¶ä¸èƒ½æ‰“å¼€ï½›zipã€warã€exeã€jarç­‰ï½ã€‚</li></ol><h2 id="å¼€å‘ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#å¼€å‘ç¯å¢ƒ" aria-hidden="true">#</a> å¼€å‘ç¯å¢ƒ</h2><p>1ã€jdk1.8ã€jdk1.7ä»¥ä¸‹åªèƒ½éƒ¨åˆ†æ”¯æŒnettyã€‘ 2ã€Netty4.1.36.Finalã€netty3.x 4.x 5æ¯æ¬¡çš„å˜åŒ–è¾ƒå¤§ï¼Œæ¥å£ç±»åä¹Ÿéšç€å˜åŒ–ã€‘</p><h2 id="ä»£ç ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä»£ç ç¤ºä¾‹" aria-hidden="true">#</a> ä»£ç ç¤ºä¾‹</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>netty<span class="token operator">-</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">04</span>
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>netty
    â”‚           â”œâ”€â”€ client
    â”‚           â”‚	â”œâ”€â”€ <span class="token class-name">MyChannelInitializer</span><span class="token punctuation">.</span>java
    â”‚           â”‚	â”œâ”€â”€ <span class="token class-name">MyClientHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚	â””â”€â”€ <span class="token class-name">NettyClient</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ codec
    â”‚           â”‚	â”œâ”€â”€ <span class="token class-name">ObjDecoder</span><span class="token punctuation">.</span>java
    â”‚           â”‚	â””â”€â”€ <span class="token class-name">ObjEncoder</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ domain
    â”‚           â”‚	â”œâ”€â”€ <span class="token class-name">Constants</span><span class="token punctuation">.</span>java
    â”‚           â”‚	â”œâ”€â”€ <span class="token class-name">FileBurstData</span><span class="token punctuation">.</span>java
    â”‚           â”‚	â”œâ”€â”€ <span class="token class-name">FileBurstInstruct</span><span class="token punctuation">.</span>java
    â”‚           â”‚	â”œâ”€â”€ <span class="token class-name">FileDescInfo</span><span class="token punctuation">.</span>java
    â”‚           â”‚	â””â”€â”€ <span class="token class-name">FileTransferProtocol</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ server
    â”‚           â”‚	â”œâ”€â”€ <span class="token class-name">MyChannelInitializer</span><span class="token punctuation">.</span>java
    â”‚           â”‚	â”œâ”€â”€ <span class="token class-name">MyServerHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚	â””â”€â”€ <span class="token class-name">NettyServer</span><span class="token punctuation">.</span>java
    â”‚           â””â”€â”€ util
    â”‚           	â”œâ”€â”€ <span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>java
    â”‚           	â”œâ”€â”€ <span class="token class-name">FileUtil</span><span class="token punctuation">.</span>java
    â”‚           	â”œâ”€â”€ <span class="token class-name">MsgUtil</span><span class="token punctuation">.</span>java
    â”‚           	â””â”€â”€ <span class="token class-name">SerializationUtil</span><span class="token punctuation">.</span>java
    â”‚
    â””â”€â”€ test
         â””â”€â”€ java
             â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test
				 â”œâ”€â”€ <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
				 â”œâ”€â”€ <span class="token class-name">NettyClientTest</span><span class="token punctuation">.</span>java 
                 â””â”€â”€ <span class="token class-name">NettyServerTest</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ¼”ç¤ºéƒ¨åˆ†é‡ç‚¹ä»£ç å—ï¼Œå®Œæ•´ä»£ç ä¸‹è½½å…³æ³¨å…¬ä¼—å·ï¼›bugstackè™«æ´æ ˆ</strong></p><blockquote><p>client/MyClientHandler.java *æ–‡ä»¶å®¢æˆ·ç«¯ï¼›channelReadå¤„ç†æ–‡ä»¶åè®®ï¼Œå…¶ä¸­æ¨¡æ‹Ÿä¼ è¾“è¿‡ç¨‹ä¸­æ–­ï¼Œåœºæ™¯æµ‹è¯•å¯ä»¥æ³¨é‡Šæ‰</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
	<span class="token comment">//æ•°æ®æ ¼å¼éªŒè¯</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">FileTransferProtocol</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token class-name">FileTransferProtocol</span> fileTransferProtocol <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">FileTransferProtocol</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
	<span class="token comment">//0ä¼ è¾“æ–‡ä»¶&#39;è¯·æ±‚&#39;ã€1æ–‡ä»¶ä¼ è¾“&#39;æŒ‡ä»¤&#39;ã€2æ–‡ä»¶ä¼ è¾“&#39;æ•°æ®&#39;</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>fileTransferProtocol<span class="token punctuation">.</span><span class="token function">getTransferType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
			<span class="token class-name">FileBurstInstruct</span> fileBurstInstruct <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">FileBurstInstruct</span><span class="token punctuation">)</span> fileTransferProtocol<span class="token punctuation">.</span><span class="token function">getTransferObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//Constants.FileStatus ï½›0å¼€å§‹ã€1ä¸­é—´ã€2ç»“å°¾ã€3å®Œæˆï½</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">COMPLETE</span> <span class="token operator">==</span> fileBurstInstruct<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				ctx<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token class-name">FileBurstData</span> fileBurstData <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>fileBurstInstruct<span class="token punctuation">.</span><span class="token function">getClientFileUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fileBurstInstruct<span class="token punctuation">.</span><span class="token function">getReadPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">MsgUtil</span><span class="token punctuation">.</span><span class="token function">buildTransferData</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bugstackè™«æ´æ ˆå®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶ä¿¡æ¯ã€‚ FILEï¼š&quot;</span> <span class="token operator">+</span> fileBurstData<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; SIZE(byte)ï¼š&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>fileBurstData<span class="token punctuation">.</span><span class="token function">getEndPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> fileBurstData<span class="token punctuation">.</span><span class="token function">getBeginPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token doc-comment comment">/**æ¨¡æ‹Ÿä¼ è¾“è¿‡ç¨‹ä¸­æ–­ï¼Œåœºæ™¯æµ‹è¯•å¯ä»¥æ³¨é‡Šæ‰
	 *
	 */</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bugstackè™«æ´æ ˆå®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶ä¿¡æ¯[ä¸»åŠ¨æ–­å¼€é“¾æ¥ï¼Œæ¨¡æ‹Ÿæ–­ç‚¹ç»­ä¼ ]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ctx<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>domain/FileBurstData.java *æ–‡ä»¶åˆ†ç‰‡æ•°æ®å—</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ–‡ä»¶åˆ†ç‰‡æ•°æ®
 * è™«æ´æ ˆï¼šhttps://bugstack.cn
 * å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ  ï½›è·å–å­¦ä¹ æºç ï½
 * è™«æ´ç¾¤ï¼šâ‘ ç¾¤5398358 â‘¡ç¾¤5360692
 * Create by fuzhengwei on 2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileBurstData</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> fileUrl<span class="token punctuation">;</span>     <span class="token comment">//å®¢æˆ·ç«¯æ–‡ä»¶åœ°å€</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> fileName<span class="token punctuation">;</span>    <span class="token comment">//æ–‡ä»¶åç§°</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> beginPos<span class="token punctuation">;</span>   <span class="token comment">//å¼€å§‹ä½ç½®</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> endPos<span class="token punctuation">;</span>     <span class="token comment">//ç»“æŸä½ç½®</span>
    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">;</span>       <span class="token comment">//æ–‡ä»¶å­—èŠ‚ï¼›å†å®é™…åº”ç”¨ä¸­å¯ä»¥ä½¿ç”¨éå¯¹ç§°åŠ å¯†ï¼Œä»¥ä¿è¯ä¼ è¾“ä¿¡æ¯å®‰å…¨</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> status<span class="token punctuation">;</span>     <span class="token comment">//Constants.FileStatus ï½›0å¼€å§‹ã€1ä¸­é—´ã€2ç»“å°¾ã€3å®Œæˆï½</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> get<span class="token operator">/</span>set
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>domain/FileBurstInstruct.java *æ–‡ä»¶åˆ†ç‰‡æŒ‡ä»¤</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ–‡ä»¶åˆ†ç‰‡æŒ‡ä»¤
 * è™«æ´æ ˆï¼šhttps://bugstack.cn
 * å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ  ï½›è·å–å­¦ä¹ æºç ï½
 * è™«æ´ç¾¤ï¼šâ‘ ç¾¤5398358 â‘¡ç¾¤5360692
 * Create by fuzhengwei on @2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileBurstInstruct</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> status<span class="token punctuation">;</span>       <span class="token comment">//Constants.FileStatus ï½›0å¼€å§‹ã€1ä¸­é—´ã€2ç»“å°¾ã€3å®Œæˆï½</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> clientFileUrl<span class="token punctuation">;</span> <span class="token comment">//å®¢æˆ·ç«¯æ–‡ä»¶URL</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> readPosition<span class="token punctuation">;</span> <span class="token comment">//è¯»å–ä½ç½®</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> get<span class="token operator">/</span>set
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>domain/FileDescInfo.java *æ–‡ä»¶ä¼ è¾“ä¿¡æ¯</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ–‡ä»¶æè¿°ä¿¡æ¯
 * è™«æ´æ ˆï¼šhttps://bugstack.cn
 * å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ  ï½›è·å–å­¦ä¹ æºç ï½
 * è™«æ´ç¾¤ï¼šâ‘ ç¾¤5398358 â‘¡ç¾¤5360692
 * Create by fuzhengwei on @2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileDescInfo</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> fileUrl<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> fileName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> fileSize<span class="token punctuation">;</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> get<span class="token operator">/</span>set
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>domain/FileTransferProtocol.java *æ–‡ä»¶ä¼ è¾“åè®®</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ–‡ä»¶ä¼ è¾“åè®®
 * è™«æ´æ ˆï¼šhttps://bugstack.cn
 * å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ  ï½›è·å–å­¦ä¹ æºç ï½
 * è™«æ´ç¾¤ï¼š5360692
 * Create by fuzhengwei on @2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileTransferProtocol</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> transferType<span class="token punctuation">;</span> <span class="token comment">//0è¯·æ±‚ä¼ è¾“æ–‡ä»¶ã€1æ–‡ä»¶ä¼ è¾“æŒ‡ä»¤ã€2æ–‡ä»¶ä¼ è¾“æ•°æ®</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> transferObj<span class="token punctuation">;</span>   <span class="token comment">//æ•°æ®å¯¹è±¡ï¼›(0)FileDescInfoã€(1)FileBurstInstructã€(2)FileBurstData</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> get<span class="token operator">/</span>set
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>serverMyServerHandler.java *æ–‡ä»¶æœåŠ¡ç«¯ï¼›channelReadå¤„ç†æ–‡ä»¶åè®®ï¼Œå¹¶åŒ…å«äº†ä¿å­˜ç»­ä¼ ä¿¡æ¯ï¼Œç”¨äºæ–­ç‚¹ç»­ä¼ </p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
	<span class="token comment">//æ•°æ®æ ¼å¼éªŒè¯</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">FileTransferProtocol</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token class-name">FileTransferProtocol</span> fileTransferProtocol <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">FileTransferProtocol</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
	<span class="token comment">//0ä¼ è¾“æ–‡ä»¶&#39;è¯·æ±‚&#39;ã€1æ–‡ä»¶ä¼ è¾“&#39;æŒ‡ä»¤&#39;ã€2æ–‡ä»¶ä¼ è¾“&#39;æ•°æ®&#39;</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>fileTransferProtocol<span class="token punctuation">.</span><span class="token function">getTransferType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
			<span class="token class-name">FileDescInfo</span> fileDescInfo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">FileDescInfo</span><span class="token punctuation">)</span> fileTransferProtocol<span class="token punctuation">.</span><span class="token function">getTransferObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">//æ–­ç‚¹ç»­ä¼ ä¿¡æ¯ï¼Œå®é™…åº”ç”¨ä¸­éœ€è¦å°†æ–­ç‚¹ç»­ä¼ ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­</span>
			<span class="token class-name">FileBurstInstruct</span> fileBurstInstructOld <span class="token operator">=</span> <span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>burstDataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>fileDescInfo<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> fileBurstInstructOld<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>fileBurstInstructOld<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">COMPLETE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>burstDataMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>fileDescInfo<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">//ä¼ è¾“å®Œæˆåˆ é™¤æ–­ç‚¹ä¿¡æ¯</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bugstackè™«æ´æ ˆæœåŠ¡ç«¯ï¼Œæ¥æ”¶å®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶è¯·æ±‚[æ–­ç‚¹ç»­ä¼ ]ã€‚&quot;</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>fileBurstInstructOld<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">MsgUtil</span><span class="token punctuation">.</span><span class="token function">buildTransferInstruct</span><span class="token punctuation">(</span>fileBurstInstructOld<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">//å‘é€ä¿¡æ¯</span>
			<span class="token class-name">FileTransferProtocol</span> sendFileTransferProtocol <span class="token operator">=</span> <span class="token class-name">MsgUtil</span><span class="token punctuation">.</span><span class="token function">buildTransferInstruct</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">BEGIN</span><span class="token punctuation">,</span> fileDescInfo<span class="token punctuation">.</span><span class="token function">getFileUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>sendFileTransferProtocol<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bugstackè™«æ´æ ˆæœåŠ¡ç«¯ï¼Œæ¥æ”¶å®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶è¯·æ±‚ã€‚&quot;</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>fileDescInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
			<span class="token class-name">FileBurstData</span> fileBurstData <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">FileBurstData</span><span class="token punctuation">)</span> fileTransferProtocol<span class="token punctuation">.</span><span class="token function">getTransferObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">FileBurstInstruct</span> fileBurstInstruct <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">&quot;E://&quot;</span><span class="token punctuation">,</span> fileBurstData<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">//ä¿å­˜æ–­ç‚¹ç»­ä¼ ä¿¡æ¯</span>
			<span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>burstDataMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fileBurstInstruct<span class="token punctuation">)</span><span class="token punctuation">;</span>

			ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">MsgUtil</span><span class="token punctuation">.</span><span class="token function">buildTransferInstruct</span><span class="token punctuation">(</span>fileBurstInstruct<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; bugstackè™«æ´æ ˆæœåŠ¡ç«¯ï¼Œæ¥æ”¶å®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶æ•°æ®ã€‚&quot;</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">//ä¼ è¾“å®Œæˆåˆ é™¤æ–­ç‚¹ä¿¡æ¯</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>fileBurstInstruct<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">COMPLETE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>burstDataMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>util/FileUtil.java *æ–‡ä»¶è¯»å†™å·¥å…·ï¼Œåˆ†ç‰‡è¯»å–å†™å…¥å¤„ç†ç±»</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ–‡ä»¶è¯»å†™å·¥å…·
 * è™«æ´æ ˆï¼šhttps://bugstack.cn
 * å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ  ï½›è·å–å­¦ä¹ æºç ï½
 * è™«æ´ç¾¤ï¼š5360692
 * Create by fuzhengwei on @2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUtil</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FileBurstData</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileUrl<span class="token punctuation">,</span> <span class="token class-name">Integer</span> readPosition<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>fileUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RandomAccessFile</span> randomAccessFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//r: åªè¯»æ¨¡å¼ rw:è¯»å†™æ¨¡å¼</span>
        randomAccessFile<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>readPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> readSize <span class="token operator">=</span> randomAccessFile<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>readSize <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            randomAccessFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FileBurstData</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">COMPLETE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Constants.FileStatus ï½›0å¼€å§‹ã€1ä¸­é—´ã€2ç»“å°¾ã€3å®Œæˆï½</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">FileBurstData</span> fileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileBurstData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setFileUrl</span><span class="token punctuation">(</span>fileUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setFileName</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setBeginPos</span><span class="token punctuation">(</span>readPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo<span class="token punctuation">.</span><span class="token function">setEndPos</span><span class="token punctuation">(</span>readPosition <span class="token operator">+</span> readSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¸è¶³1024éœ€è¦æ‹·è´å»æ‰ç©ºå­—èŠ‚</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>readSize <span class="token operator">&lt;</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> copy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>readSize<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> copy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> readSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setBytes</span><span class="token punctuation">(</span>copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">END</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setBytes</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileInfo<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">CENTER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        randomAccessFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> fileInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FileBurstInstruct</span> <span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> baseUrl<span class="token punctuation">,</span> <span class="token class-name">FileBurstData</span> fileBurstData<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">COMPLETE</span> <span class="token operator">==</span> fileBurstData<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FileBurstInstruct</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">COMPLETE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Constants.FileStatus ï½›0å¼€å§‹ã€1ä¸­é—´ã€2ç»“å°¾ã€3å®Œæˆï½</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>baseUrl <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> fileBurstData<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RandomAccessFile</span> randomAccessFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">&quot;rw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//r: åªè¯»æ¨¡å¼ rw:è¯»å†™æ¨¡å¼</span>
        randomAccessFile<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">.</span><span class="token function">getBeginPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//ç§»åŠ¨æ–‡ä»¶è®°å½•æŒ‡é’ˆçš„ä½ç½®,</span>
        randomAccessFile<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è°ƒç”¨äº†seekï¼ˆstartï¼‰æ–¹æ³•ï¼Œæ˜¯æŒ‡æŠŠæ–‡ä»¶çš„è®°å½•æŒ‡é’ˆå®šä½åˆ°startå­—èŠ‚çš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ç¨‹åºå°†ä»startå­—èŠ‚å¼€å§‹å†™æ•°æ®</span>
        randomAccessFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">END</span> <span class="token operator">==</span> fileBurstData<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FileBurstInstruct</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">COMPLETE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Constants.FileStatus ï½›0å¼€å§‹ã€1ä¸­é—´ã€2ç»“å°¾ã€3å®Œæˆï½</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//æ–‡ä»¶åˆ†ç‰‡ä¼ è¾“æŒ‡ä»¤</span>
        <span class="token class-name">FileBurstInstruct</span> fileBurstInstruct <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileBurstInstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileBurstInstruct<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>FileStatus</span><span class="token punctuation">.</span><span class="token constant">CENTER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//Constants.FileStatus ï½›0å¼€å§‹ã€1ä¸­é—´ã€2ç»“å°¾ã€3å®Œæˆï½</span>
        fileBurstInstruct<span class="token punctuation">.</span><span class="token function">setClientFileUrl</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">.</span><span class="token function">getFileUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//å®¢æˆ·ç«¯æ–‡ä»¶URL</span>
        fileBurstInstruct<span class="token punctuation">.</span><span class="token function">setReadPosition</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">.</span><span class="token function">getEndPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//è¯»å–ä½ç½®</span>

        <span class="token keyword">return</span> fileBurstInstruct<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>util/MsgUtil.java *ä¼ è¾“æ¶ˆæ¯ä½“æ„å»ºå·¥å…·ç±»</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ¶ˆæ¯æ„å»ºå·¥å…·
 * è™«æ´æ ˆï¼šhttps://bugstack.cn
 * å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ  ï½›è·å–å­¦ä¹ æºç ï½
 * è™«æ´ç¾¤ï¼š5360692
 * Create by fuzhengwei on @2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MsgUtil</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * æ„å»ºå¯¹è±¡ï¼›è¯·æ±‚ä¼ è¾“æ–‡ä»¶(å®¢æˆ·ç«¯)
     *
     * <span class="token keyword">@param</span> <span class="token parameter">fileUrl</span>  å®¢æˆ·ç«¯æ–‡ä»¶åœ°å€
     * <span class="token keyword">@param</span> <span class="token parameter">fileName</span> æ–‡ä»¶åç§°
     * <span class="token keyword">@param</span> <span class="token parameter">fileSize</span> æ–‡ä»¶å¤§å°
     * <span class="token keyword">@return</span> ä¼ è¾“åè®®
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FileTransferProtocol</span> <span class="token function">buildRequestTransferFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileUrl<span class="token punctuation">,</span> <span class="token class-name">String</span> fileName<span class="token punctuation">,</span> <span class="token class-name">Long</span> fileSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">FileDescInfo</span> fileDescInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileDescInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileDescInfo<span class="token punctuation">.</span><span class="token function">setFileUrl</span><span class="token punctuation">(</span>fileUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileDescInfo<span class="token punctuation">.</span><span class="token function">setFileName</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileDescInfo<span class="token punctuation">.</span><span class="token function">setFileSize</span><span class="token punctuation">(</span>fileSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">FileTransferProtocol</span> fileTransferProtocol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileTransferProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileTransferProtocol<span class="token punctuation">.</span><span class="token function">setTransferType</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0è¯·æ±‚ä¼ è¾“æ–‡ä»¶ã€1æ–‡ä»¶ä¼ è¾“æŒ‡ä»¤ã€2æ–‡ä»¶ä¼ è¾“æ•°æ®</span>
        fileTransferProtocol<span class="token punctuation">.</span><span class="token function">setTransferObj</span><span class="token punctuation">(</span>fileDescInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> fileTransferProtocol<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * æ„å»ºå¯¹è±¡ï¼›æ–‡ä»¶ä¼ è¾“æŒ‡ä»¤(æœåŠ¡ç«¯)
     * <span class="token keyword">@param</span> <span class="token parameter">status</span>          0è¯·æ±‚ä¼ è¾“æ–‡ä»¶ã€1æ–‡ä»¶ä¼ è¾“æŒ‡ä»¤ã€2æ–‡ä»¶ä¼ è¾“æ•°æ®
     * <span class="token keyword">@param</span> <span class="token parameter">clientFileUrl</span>   å®¢æˆ·ç«¯æ–‡ä»¶åœ°å€
     * <span class="token keyword">@param</span> <span class="token parameter">readPosition</span>    è¯»å–ä½ç½®
     * <span class="token keyword">@return</span>                ä¼ è¾“åè®®
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FileTransferProtocol</span> <span class="token function">buildTransferInstruct</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> status<span class="token punctuation">,</span> <span class="token class-name">String</span> clientFileUrl<span class="token punctuation">,</span> <span class="token class-name">Integer</span> readPosition<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">FileBurstInstruct</span> fileBurstInstruct <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileBurstInstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileBurstInstruct<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileBurstInstruct<span class="token punctuation">.</span><span class="token function">setClientFileUrl</span><span class="token punctuation">(</span>clientFileUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileBurstInstruct<span class="token punctuation">.</span><span class="token function">setReadPosition</span><span class="token punctuation">(</span>readPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">FileTransferProtocol</span> fileTransferProtocol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileTransferProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileTransferProtocol<span class="token punctuation">.</span><span class="token function">setTransferType</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>TransferType</span><span class="token punctuation">.</span><span class="token constant">INSTRUCT</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0ä¼ è¾“æ–‡ä»¶&#39;è¯·æ±‚&#39;ã€1æ–‡ä»¶ä¼ è¾“&#39;æŒ‡ä»¤&#39;ã€2æ–‡ä»¶ä¼ è¾“&#39;æ•°æ®&#39;</span>
        fileTransferProtocol<span class="token punctuation">.</span><span class="token function">setTransferObj</span><span class="token punctuation">(</span>fileBurstInstruct<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> fileTransferProtocol<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * æ„å»ºå¯¹è±¡ï¼›æ–‡ä»¶ä¼ è¾“æŒ‡ä»¤(æœåŠ¡ç«¯)
     *
     * <span class="token keyword">@return</span> ä¼ è¾“åè®®
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FileTransferProtocol</span> <span class="token function">buildTransferInstruct</span><span class="token punctuation">(</span><span class="token class-name">FileBurstInstruct</span> fileBurstInstruct<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FileTransferProtocol</span> fileTransferProtocol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileTransferProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileTransferProtocol<span class="token punctuation">.</span><span class="token function">setTransferType</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>TransferType</span><span class="token punctuation">.</span><span class="token constant">INSTRUCT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//0ä¼ è¾“æ–‡ä»¶&#39;è¯·æ±‚&#39;ã€1æ–‡ä»¶ä¼ è¾“&#39;æŒ‡ä»¤&#39;ã€2æ–‡ä»¶ä¼ è¾“&#39;æ•°æ®&#39;</span>
        fileTransferProtocol<span class="token punctuation">.</span><span class="token function">setTransferObj</span><span class="token punctuation">(</span>fileBurstInstruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> fileTransferProtocol<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * æ„å»ºå¯¹è±¡ï¼›æ–‡ä»¶ä¼ è¾“æ•°æ®(å®¢æˆ·ç«¯)
     *
     * <span class="token keyword">@return</span> ä¼ è¾“åè®®
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FileTransferProtocol</span> <span class="token function">buildTransferData</span><span class="token punctuation">(</span><span class="token class-name">FileBurstData</span> fileBurstData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FileTransferProtocol</span> fileTransferProtocol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileTransferProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileTransferProtocol<span class="token punctuation">.</span><span class="token function">setTransferType</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>TransferType</span><span class="token punctuation">.</span><span class="token constant">DATA</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0ä¼ è¾“æ–‡ä»¶&#39;è¯·æ±‚&#39;ã€1æ–‡ä»¶ä¼ è¾“&#39;æŒ‡ä»¤&#39;ã€2æ–‡ä»¶ä¼ è¾“&#39;æ•°æ®&#39;</span>
        fileTransferProtocol<span class="token punctuation">.</span><span class="token function">setTransferObj</span><span class="token punctuation">(</span>fileBurstData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> fileTransferProtocol<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>test/NettyServerTest.java *æœåŠ¡ç«¯å¯åŠ¨å™¨</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * è™«æ´æ ˆï¼šhttps://bugstack.cn
 * å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ  ï½›è·å–å­¦ä¹ æºç ï½
 * è™«æ´ç¾¤ï¼šâ‘ ç¾¤5398358 â‘¡ç¾¤5360692
 * Create by fuzhengwei on 2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyServerTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//å¯åŠ¨æœåŠ¡</span>
        <span class="token keyword">new</span> <span class="token class-name">NettyServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bing</span><span class="token punctuation">(</span><span class="token number">7397</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>test/NettyClientTest.java *å®¢æˆ·ç«¯å¯åŠ¨å™¨</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * è™«æ´æ ˆï¼šhttps://bugstack.cn
 * å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ  ï½›è·å–å­¦ä¹ æºç ï½
 * è™«æ´ç¾¤ï¼šâ‘ ç¾¤5398358 â‘¡ç¾¤5360692
 * Create by fuzhengwei on 2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyClientTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//å¯åŠ¨å®¢æˆ·ç«¯</span>
        <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NettyClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">7397</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æ–‡ä»¶ä¿¡æ¯{æ–‡ä»¶å¤§äº1024kbæ–¹ä¾¿æµ‹è¯•æ–­ç‚¹ç»­ä¼ }</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;C:\\\\Users\\\\fuzhengwei\\\\Desktop\\\\æµ‹è¯•ä¼ è¾“æ–‡ä»¶.rar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileTransferProtocol</span> fileTransferProtocol <span class="token operator">=</span> <span class="token class-name">MsgUtil</span><span class="token punctuation">.</span><span class="token function">buildRequestTransferFile</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//å‘é€ä¿¡æ¯ï¼›è¯·æ±‚ä¼ è¾“æ–‡ä»¶</span>
        channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>fileTransferProtocol<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æµ‹è¯•ç»“æœ" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•ç»“æœ" aria-hidden="true">#</a> æµ‹è¯•ç»“æœ</h2><blockquote><p>å¯åŠ¨NettyServerTest *é»˜è®¤æ¥æ”¶åœ°å€ä¸ºEç›˜æ ¹ç›®å½•</p></blockquote><p><img src="https://bugstack.cn/assets/images/pic-content/2019/08/netty-2-04-1.png" alt=""></p><blockquote><p>å¯åŠ¨NettyClientTest *è®¾ç½®ä¼ è¾“æ–‡ä»¶</p></blockquote><p><img src="https://bugstack.cn/assets/images/pic-content/2019/08/netty-2-04-2.png" alt=""></p><blockquote><p>æ–‡ä»¶ä¼ è¾“ç»“æœ</p></blockquote><p><img src="https://bugstack.cn/assets/images/pic-content/2019/08/netty-2-04-3.png" alt=""></p><blockquote><p>æœåŠ¡ç«¯æ‰§è¡Œç»“æœ</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>netty server start done<span class="token punctuation">.</span> <span class="token punctuation">{</span>å…³æ³¨å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆï¼Œè·å–æºç <span class="token punctuation">}</span>
é“¾æ¥æŠ¥å‘Šå¼€å§‹
é“¾æ¥æŠ¥å‘Šä¿¡æ¯ï¼šæœ‰ä¸€å®¢æˆ·ç«¯é“¾æ¥åˆ°æœ¬æœåŠ¡ç«¯ã€‚channelIdï¼š<span class="token number">3</span>a1df8c1
é“¾æ¥æŠ¥å‘Š<span class="token constant">IP</span><span class="token operator">:</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
é“¾æ¥æŠ¥å‘Š<span class="token class-name">Port</span><span class="token operator">:</span><span class="token number">7397</span>
é“¾æ¥æŠ¥å‘Šå®Œæ¯•
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">04</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">46</span> bugstackè™«æ´æ ˆæœåŠ¡ç«¯ï¼Œæ¥æ”¶å®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶è¯·æ±‚ã€‚<span class="token punctuation">{</span><span class="token string">&quot;fileName&quot;</span><span class="token operator">:</span><span class="token string">&quot;æµ‹è¯•ä¼ è¾“æ–‡ä»¶.rar&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;fileSize&quot;</span><span class="token operator">:</span><span class="token number">1400</span><span class="token punctuation">,</span><span class="token string">&quot;fileUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;C:\\\\Users\\\\fuzhengwei1\\\\Desktop\\\\æµ‹è¯•ä¼ è¾“æ–‡ä»¶.rar&quot;</span><span class="token punctuation">}</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">04</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">46</span> bugstackè™«æ´æ ˆæœåŠ¡ç«¯ï¼Œæ¥æ”¶å®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶æ•°æ®ã€‚<span class="token punctuation">{</span><span class="token string">&quot;beginPos&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;bytes&quot;</span><span class="token operator">:</span><span class="token string">&quot;UmFyIRoHAM+QcwAADQAAAAAAAAC4C3SgkkkAFAUAAIjDEQACJRsHe0WECE8dMyQAIAAAALLiytS0q8rkzsS8/i50eHQAbWpL1YsgT5OPoIdl9k4udAB4dACwS2heCZgVEQzPzUEXfAnhs2R75rhNbCQhNE3uMY4EBkBqQJ45izS4lFGujEk08xLGuhp4sSUSbzEscRICakGyOdARhIE6GEPucySJpY5kQ/Cq28ur4XdfH/j1V8UVoo5X5V+B3dl2f8qvvoxd3t6GPv8HZ7dXs+98XT6uJ0Oj8GZ4c6tvV6vzV865ka375utod+9i+pX/O1Uu1tT76tT38TE+Hq+tzud6Of9Xo9T0/S/xytLm12v4NWztfhnda3lbevs7dnXsWL1vT3Kte91triqYuHW/9bf3WPnjq5r5savbHd67V8Nu6r5+lmZtrP0eO63Ba+upVuWtf7bvByg2/0w+5hz8ru14ND5ex/Odw4F7uRWrYedwU2tXmw5m1u+S7lWdjvTq5e/Kv+1apZxrdjT2dHizdHDrlrH1cvkbrWe5k97u6WRnXdviw6zkvc3cD9TOt7+7W9z2/Ys+Sx9VTPwGeYLmrz+h8fQt5u5v8/3fZ5sXKnc4MOT1+n0upicmOVDT86GfY4bPf5vN7XSxMT5Mnsdry8e84///+quHp9l19fRz8vkds+O7qb+9pWe1WvXdb7NWza3vNO3V3cZZ2rPDr1svHwO3Nq14sBuZu3P1zOvuWP++s8ex9O95e5U/vW9/F7Jtb+p+PGeRtzlg8VfG5t5TyAAAAAAAAAAAAAAAARu1PHU9QX3wAAAAAAAAAAAAAAAiiXyXwAAAAAAAAAAAAAAAiiXyXwAAAAAAAAAAAAAAAiiXyXwAAAAAAAAAAAAAAAiiXyXwAEbDTyAAAAAAAAAAAAAEctTx1PUF98AAAAAAAAAAAAAAAIol8l8AAAAAAAAAAAAAAAIol8l8AAAAAAAAAAAAAAAIol8l8AAAAAAAAAAAAAAAIol8l8AAAABHx08gAAAAAAAAAAj108dT1BffAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAAAAAAgankAAAAAAAEZGnjqeoL74AAAAAAAAAAAAAAARRL5L4AAAAAAAAAAAAAAARRL5L4AAAAAAAAAAAAAAARRL5L4AAAAAAAAAAAAAAARRL5L4AAAAAAAAAAEYinkAAAAEH08dT1BffAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAA==&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;endPos&quot;</span><span class="token operator">:</span><span class="token number">1024</span><span class="token punctuation">,</span><span class="token string">&quot;fileName&quot;</span><span class="token operator">:</span><span class="token string">&quot;æµ‹è¯•ä¼ è¾“æ–‡ä»¶.rar&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;fileUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;C:\\\\Users\\\\fuzhengwei1\\\\Desktop\\\\æµ‹è¯•ä¼ è¾“æ–‡ä»¶.rar&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">04</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">46</span> bugstackè™«æ´æ ˆæœåŠ¡ç«¯ï¼Œæ¥æ”¶å®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶æ•°æ®ã€‚<span class="token punctuation">{</span><span class="token string">&quot;beginPos&quot;</span><span class="token operator">:</span><span class="token number">1025</span><span class="token punctuation">,</span><span class="token string">&quot;bytes&quot;</span><span class="token operator">:</span><span class="token string">&quot;AAI8VPIAEfZTx1PUF98AAAAAAAAAAAAAAAIol8l8AAAAAAAAAAAAAAAIol8l8AAAAAAAAAAAAAAAIol8l8AAAAAAAAAAAAAAAIol8l8AAAAAAAAAAAAAAAIol8l8R+dPIAAAAAAAAAAAAAAAjt08dT1BffAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAAAAAAAAAAAAACKJfJfAAAIWp5AAAAAAAAAAAAEYGnjqeoL74AAAAAAAAAAAAAAARRL5L4AAAAAAAAAAAAAAARRL5L4AAAAAAAAAAAAAAARRL5L4AAAAAAAAAAAAAAARRL5L4AAAAABGYp5AAAAAAAAAEc/Tx1PUF98AAAAAAAAIyFPIAAAAAACB6eOp6gvvgAAAAAAAAAARiKeQAAAAQfTx1PUF98AAAAAAAAAAAAAjAU8gACF6eOp6gvvgAAAAAAAAAAAAAABFH9IDEPXsAQAcA&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;endPos&quot;</span><span class="token operator">:</span><span class="token number">1400</span><span class="token punctuation">,</span><span class="token string">&quot;fileName&quot;</span><span class="token operator">:</span><span class="token string">&quot;æµ‹è¯•ä¼ è¾“æ–‡ä»¶.rar&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;fileUrl&quot;</span><span class="token operator">:</span><span class="token string">&quot;C:\\\\Users\\\\fuzhengwei1\\\\Desktop\\\\æµ‹è¯•ä¼ è¾“æ–‡ä»¶.rar&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span>
å®¢æˆ·ç«¯æ–­å¼€é“¾æ¥<span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">7397</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token operator">-</span><span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>å®¢æˆ·ç«¯æ‰§è¡Œç»“æœ</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>netty client start done<span class="token punctuation">.</span> <span class="token punctuation">{</span>å…³æ³¨å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆï¼Œè·å–æºç <span class="token punctuation">}</span>
é“¾æ¥æŠ¥å‘Šå¼€å§‹
é“¾æ¥æŠ¥å‘Šä¿¡æ¯ï¼šæœ¬å®¢æˆ·ç«¯é“¾æ¥åˆ°æœåŠ¡ç«¯ã€‚channelIdï¼š<span class="token number">71399d</span><span class="token number">8</span>c
é“¾æ¥æŠ¥å‘Š<span class="token constant">IP</span><span class="token operator">:</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
é“¾æ¥æŠ¥å‘Š<span class="token class-name">Port</span><span class="token operator">:</span><span class="token number">54974</span>
é“¾æ¥æŠ¥å‘Šå®Œæ¯•
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">04</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">46</span> bugstackè™«æ´æ ˆå®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶ä¿¡æ¯ã€‚ <span class="token constant">FILE</span>ï¼šæµ‹è¯•ä¼ è¾“æ–‡ä»¶<span class="token punctuation">.</span>rar <span class="token function">SIZE</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>ï¼š<span class="token number">1024</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">04</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">46</span> bugstackè™«æ´æ ˆå®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶ä¿¡æ¯ã€‚ <span class="token constant">FILE</span>ï¼šæµ‹è¯•ä¼ è¾“æ–‡ä»¶<span class="token punctuation">.</span>rar <span class="token function">SIZE</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>ï¼š<span class="token number">375</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token operator">-</span><span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¾®ä¿¡æœç´¢ã€Œ<strong>bugstackè™«æ´æ ˆ</strong>ã€å…¬ä¼—å·ï¼Œå…³æ³¨åå›å¤ã€Œ<strong>Nettyä¸“é¢˜æ¡ˆä¾‹</strong>ã€è·å–æœ¬æ–‡æºç &amp;æ›´å¤šåŸåˆ›ä¸“é¢˜æ¡ˆä¾‹ï¼</p>`,40);function v(m,A){const a=e("ExternalLinkIcon");return p(),c("div",null,[u,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),k,s("åšå®¢ï¼š"),n("a",r,[s("https://bugstack.cn"),o(a)])]),d])}const f=t(i,[["render",v],["__file","2019-08-19-nettyanliï¼Œnetty4.1zhongjituozhanpiansiã€ŠNettychuanshuwenjianã€fenpianfasongã€duandianxuchuanã€‹.html.vue"]]);export{f as default};
