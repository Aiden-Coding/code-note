import{_ as o,r as l,o as s,c as a,a as e,b as r,d as n}from"./app-3RcBQnkC.js";const i={},h=e("h1",{id:"第19节-扫描库表补偿发货单mq消息",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#第19节-扫描库表补偿发货单mq消息","aria-hidden":"true"},"#"),r(" 第19节：扫描库表补偿发货单MQ消息")],-1),_=e("br",null,null,-1),c={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=e("blockquote",null,[e("p",null,"沉淀、分享、成长，让自己和他人都能有所收获！")],-1),u={href:"https://gitcode.net/KnowledgePlanet/Lottery/-/tree/211120_xfg_redis",target:"_blank",rel:"noopener noreferrer"},p=e("li",null,"描述：引入 Redis 到抽奖系统，设计颗粒度更细的滑动库存编号分布式锁，处理活动秒杀流程",-1),f=e("h2",{id:"零、优秀作业",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#零、优秀作业","aria-hidden":"true"},"#"),r(" 零、优秀作业")],-1),g={href:"https://t.zsxq.com/06qRNBQvz",target:"_blank",rel:"noopener noreferrer"},m={href:"https://t.zsxq.com/062r3rRZb",target:"_blank",rel:"noopener noreferrer"},k={href:"https://t.zsxq.com/06nqJUbEu",target:"_blank",rel:"noopener noreferrer"},b={href:"https://t.zsxq.com/06mMVjAUb",target:"_blank",rel:"noopener noreferrer"},x={href:"https://t.zsxq.com/06u7yzFei",target:"_blank",rel:"noopener noreferrer"},q={href:"https://t.zsxq.com/06a66YBII",target:"_blank",rel:"noopener noreferrer"},z={href:"https://t.zsxq.com/07BUvbE6A",target:"_blank",rel:"noopener noreferrer"},R={href:"https://t.zsxq.com/09guPZDAm",target:"_blank",rel:"noopener noreferrer"},y={href:"https://t.zsxq.com/0ap1a5wRn",target:"_blank",rel:"noopener noreferrer"},L={href:"https://t.zsxq.com/0ao1zuOOY",target:"_blank",rel:"noopener noreferrer"},Q={href:"https://t.zsxq.com/0cDCMPrRA",target:"_blank",rel:"noopener noreferrer"},M={href:"https://t.zsxq.com/0cIVeIzgI",target:"_blank",rel:"noopener noreferrer"},w={href:"https://t.zsxq.com/0ckOJyhdV",target:"_blank",rel:"noopener noreferrer"},E={href:"https://t.zsxq.com/0es2kc7rW",target:"_blank",rel:"noopener noreferrer"},I={href:"https://t.zsxq.com/0fVxp4LAQ",target:"_blank",rel:"noopener noreferrer"},V={href:"https://t.zsxq.com/0ficRjoy4",target:"_blank",rel:"noopener noreferrer"},B={href:"https://t.zsxq.com/11ixEXFK8",target:"_blank",rel:"noopener noreferrer"},P={href:"https://t.zsxq.com/11f8zv46p",target:"_blank",rel:"noopener noreferrer"},j={href:"https://t.zsxq.com/12rQz46Yd",target:"_blank",rel:"noopener noreferrer"},v={href:"https://t.zsxq.com/12OitppQW",target:"_blank",rel:"noopener noreferrer"},A={href:"https://t.zsxq.com/12Qmo4Ylf",target:"_blank",rel:"noopener noreferrer"},C={href:"https://t.zsxq.com/12NgV1EEW",target:"_blank",rel:"noopener noreferrer"},N={href:"https://t.zsxq.com/12plqgJS0",target:"_blank",rel:"noopener noreferrer"},D={href:"https://t.zsxq.com/12ZxZMb4D",target:"_blank",rel:"noopener noreferrer"},O={href:"https://t.zsxq.com/139XngXkm",target:"_blank",rel:"noopener noreferrer"},Y=e("h2",{id:"一、开发日志",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#一、开发日志","aria-hidden":"true"},"#"),r(" 一、开发日志")],-1),Z=e("em",null,"如果你暂时还没有云服务器，那么在本地搭建 Redis 也可以，只是少了一些云环境的配置练习",-1),J={href:"https://www.aliyun.com/minisite/goods?taskPkg=1111ydsrwb&pkgSid=11388&recordId=1033318&userCode=is4kfbdt",target:"_blank",rel:"noopener noreferrer"},K=e("li",null,"在抽奖系统中引入 Redis 模块，优化用户参与抽奖活动。因为只要有大量的用户参与抽奖，那么这个就属于秒杀场景。所以需要使用 Redis 分布式锁的方式来处理集中化库存扣减的问题，否则在 TPS 达到1k-2k，就会把数据库拖垮。",-1),S=e("li",null,"在设计秒杀流程时，优化锁的颗粒度力度，不要把锁直接放到活动编号上，这样在极端临界情况下会出现秒杀解锁失败，导致库存有剩余但不能下单的情况。所以需要增加锁的颗粒度，以滑动库存剩余编号的方式进行加锁，例如 100001_1、100001_2、100001_3，以此类推，具体看代码实现。",-1),T=e("li",null,[r("增加缓存扣减库存后，发送 MQ 消息进行异步更新数据库中活动库存，做最终数据一致性处理。"),e("em",null,"这一部分如果你的系统并发体量较大，还需要把 MQ 的数据不要直接对库更新，而是更新到缓存中，再由任务最阶段同步，以此减少对数据库表的操作")],-1),U=e("h2",{id:"二、扣减流程",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#二、扣减流程","aria-hidden":"true"},"#"),r(" 二、扣减流程")],-1),W=e("p",null,[e("img",{src:"https://gitcode.net/KnowledgePlanet/Lottery/-/raw/master/doc/assets/img/Part-2/19-01.png",alt:""})],-1),X=e("ul",null,[e("li",null,"优化活动领域，活动参与流程中的库存扣减操作，这部分我们原来是使用数据库行级锁🔐 处理的库存扣减，但因为会存在并发问题所以这里优化为 Redis 分布式锁进行处理。"),e("li",null,[r("活动领取完成后，其实这个时候只是把缓存的库存扣掉了，但数据库中的库存并没有扣减，所以我们需要发送一个 MQ 消息，来对数据库中的库存进行处理。因为 MQ 可以消峰因此在降低 MQ 分片的情况下，消费效率有所下降，并不会对数据库造成压力，保证最终数据一致性即可。"),e("em",null,"但也有例外，所以我们提到可以使用定时任务来更新数据库库存")])],-1);function F(G,H){const t=l("ExternalLinkIcon");return s(),a("div",null,[h,e("p",null,[r("作者：小傅哥 "),_,r("博客："),e("a",c,[r("https://bugstack.cn"),n(t)])]),d,e("ul",null,[e("li",null,[r("分支："),e("a",u,[r("211120_xfg_redis"),n(t)])]),p]),f,e("ul",null,[e("li",null,[e("a",g,[r("设计滑动库存分布式锁处理活动秒杀 @一点江南"),n(t)])]),e("li",null,[e("a",m,[r("设计滑动库存分布式锁处理活动秒杀 @BerserkD"),n(t)])]),e("li",null,[e("a",k,[r("设计滑动库存分布式锁处理秒杀流程 @杨杨得亿🙉"),n(t)])]),e("li",null,[e("a",b,[r("设计滑动库存分布式锁处理活动秒杀 @Geroge Liu"),n(t)])]),e("li",null,[e("a",x,[r("弃用数据库行锁的方式删减活动库存，改用redis分布式锁，并用mq去删减库存。@Chin"),n(t)])]),e("li",null,[e("a",q,[r("Redis中的setnx作为分布式锁的使用 @liuc"),n(t)])]),e("li",null,[e("a",z,[r("活动领域Redis分布式滑动库存锁优化 @微风"),n(t)])]),e("li",null,[e("a",R,[r("流程图比较清晰，以抽奖流程编排接口为主线，每个功能点为支线；贯穿多个领域层 @xbhog"),n(t)])]),e("li",null,[e("a",y,[r("把整个抽奖流程 debug 走一遍，记录一下这些章节的核心思想 @爱奋斗的小鲨鱼"),n(t)])]),e("li",null,[e("a",L,[r("1~19 章节总结 目前将组件装在服务器上 后续结合公众号再继续开发 @爱奋斗的小鲨鱼"),n(t)])]),e("li",null,[e("a",Q,[r("考虑某个活动如果在同一时间有大量用户参与 @咖啡苦涩"),n(t)])]),e("li",null,[e("a",M,[r("首先非常感谢小傅哥，该项目确实让我感觉学习到很多优秀的内容，以下是我学习的一个阶段性总结 @神经蛙"),n(t)])]),e("li",null,[e("a",w,[r("抽奖系统四层架构设计梳理 @灵幻新隆"),n(t)])]),e("li",null,[e("a",E,[r("滑动库存分布式锁处理活动秒杀流程梳理 @错否"),n(t)])]),e("li",null,[e("a",I,[r("抽奖系统学习总结整理 @夜空的寂静"),n(t)])]),e("li",null,[e("a",V,[r("使用docker部署了lottery，更新docker-compose部署的方式 @小曹不会emo"),n(t)])]),e("li",null,[e("a",B,[r("这两天完成了第19节内容引入 Redis 到抽奖系统，设计颗粒度更细的滑动库存编号分布式锁，处理活动秒杀流程 @素质男孩"),n(t)])]),e("li",null,[e("a",P,[r("系统功能流程图汇总 @CCAT"),n(t)])]),e("li",null,[e("a",j,[r("回顾整个抽奖系统和这些天考虑的这些系统性的知识 @王磊"),n(t)])]),e("li",null,[e("a",v,[r("系统性整理一下这些天的知识积累，同时展望一下后续的知识补充 @王磊"),n(t)])]),e("li",null,[e("a",A,[r("Lottery-api 抽奖网关集成白名单组件 @俗人"),n(t)])]),e("li",null,[e("a",C,[r("Lottery-api 抽奖网关继承熔断降级组件 @俗人"),n(t)])]),e("li",null,[e("a",N,[r("Lottery-api 抽奖网关集成限流组件 @俗人"),n(t)])]),e("li",null,[e("a",D,[r("Lottery压测 @俗人"),n(t)])]),e("li",null,[e("a",O,[r("Lottery-api 抽奖网关集成自定义方法拦截组件 @俗人"),n(t)])])]),Y,e("ul",null,[e("li",null,[r("由于本章节需要用到 Redis 所以我们在云服务器搭建 Redis 服务，这样可以更加方便的使用。"),Z,r(),e("a",J,[r("云服务器地址"),n(t)])]),K,S,T]),U,W,X])}const ee=o(i,[["render",F],["__file","di19jie：shejihuadongkucunfenbushisuochulihuodongmiaosha.html.vue"]]);export{ee as default};
