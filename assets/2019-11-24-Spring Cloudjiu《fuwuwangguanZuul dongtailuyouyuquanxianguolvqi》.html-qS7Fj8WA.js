import{_ as t,r as p,o,c as l,a as n,b as s,d as e,e as c}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"ç¬¬9ç« -æœåŠ¡ç½‘å…³zuul-åŠ¨æ€è·¯ç”±ä¸æƒé™è¿‡æ»¤å™¨",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ç¬¬9ç« -æœåŠ¡ç½‘å…³zuul-åŠ¨æ€è·¯ç”±ä¸æƒé™è¿‡æ»¤å™¨","aria-hidden":"true"},"#"),s(" ç¬¬9ç« ï¼šæœåŠ¡ç½‘å…³Zuul åŠ¨æ€è·¯ç”±ä¸æƒé™è¿‡æ»¤å™¨")],-1),r=n("br",null,null,-1),d={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},k=c(`<blockquote><p>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„</p></blockquote><h2 id="å‰è¨€ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#å‰è¨€ä»‹ç»" aria-hidden="true">#</a> å‰è¨€ä»‹ç»</h2><p>åœ¨å®é™…çš„ä¸šåŠ¡å¼€å‘ä¸­ä¸åªæ˜¯å°†è·¯ç”±é…ç½®æ”¾åˆ°æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯éœ€è¦è¿›è¡ŒåŠ¨æ€ç®¡ç†å¹¶ä¸”å¯ä»¥åœ¨å˜åŒ–æ—¶ä¸ç”¨é‡å¯ç³»ç»Ÿå°±å¯ä»¥æ›´æ–°ã€‚ä¸æ­¤åŒæ—¶è¿˜éœ€è¦åœ¨æ¥å£è®¿é—®çš„æ—¶å€™ï¼Œå¯ä»¥å¢åŠ ä¸€äº›æƒé™éªŒè¯ä»¥é˜²æ­¢æ¶æ„è®¿é—®ã€‚</p><ol><li>Filterè¿‡æ»¤å™¨ï¼Œé€šè¿‡ç»§æ‰¿å®ç°å¯¹åº”æ–¹æ³•å¯ä»¥è¿›è¡Œæ§åˆ¶è¿‡æ»¤ï¼›</li></ol><ul><li>PREï¼šè¿™ç§è¿‡æ»¤å™¨åœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰è°ƒç”¨ã€‚æˆ‘ä»¬å¯åˆ©ç”¨è¿™ç§è¿‡æ»¤å™¨å®ç°èº«ä»½éªŒè¯ã€åœ¨é›†ç¾¤ä¸­é€‰æ‹©è¯·æ±‚çš„å¾®æœåŠ¡ã€è®°å½•è°ƒè¯•ä¿¡æ¯ç­‰ã€‚</li><li>ROUTINGï¼šè¿™ç§è¿‡æ»¤å™¨å°†è¯·æ±‚è·¯ç”±åˆ°å¾®æœåŠ¡ã€‚è¿™ç§è¿‡æ»¤å™¨ç”¨äºæ„å»ºå‘é€ç»™å¾®æœåŠ¡çš„è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨ Apache HttpClient æˆ– Netfilx Ribbon è¯·æ±‚å¾®æœåŠ¡ã€‚</li><li>POSTï¼šè¿™ç§è¿‡æ»¤å™¨åœ¨è·¯ç”±åˆ°å¾®æœåŠ¡ä»¥åæ‰§è¡Œã€‚è¿™ç§è¿‡æ»¤å™¨å¯ç”¨æ¥ä¸ºå“åº”æ·»åŠ æ ‡å‡†çš„ HTTP Headerã€æ”¶é›†ç»Ÿè®¡ä¿¡æ¯å’ŒæŒ‡æ ‡ã€å°†å“åº”ä»å¾®æœåŠ¡å‘é€ç»™å®¢æˆ·ç«¯ç­‰ã€‚</li><li>ERRORï¼šåœ¨å…¶ä»–é˜¶æ®µå‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œè¯¥è¿‡æ»¤å™¨ã€‚ é™¤äº†é»˜è®¤çš„è¿‡æ»¤å™¨ç±»å‹ï¼ŒZuul è¿˜å…è®¸æˆ‘ä»¬åˆ›å»ºè‡ªå®šä¹‰çš„è¿‡æ»¤å™¨ç±»å‹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶ä¸€ç§ STATIC ç±»å‹çš„è¿‡æ»¤å™¨ï¼Œç›´æ¥åœ¨ Zuul ä¸­ç”Ÿæˆå“åº”ï¼Œè€Œä¸å°†è¯·æ±‚è½¬å‘åˆ°åç«¯çš„å¾®æœåŠ¡ã€‚</li></ul><ol start="2"><li>è‡ªå®šä¹‰è·¯ç”±ï¼ŒåŒæ„å®ç°SimpleRouteLocatorå’ŒRefreshableRouteLocatorè‡ªåŠ¨åˆ·æ–°</li></ol><ul><li>protected Map&lt;String, ZuulRoute&gt; locateRoutes()ï¼šæ­¤æ–¹æ³•æ˜¯åŠ è½½è·¯ç”±é…ç½®çš„ï¼Œçˆ¶ç±»ä¸­æ˜¯è·å–propertiesä¸­çš„è·¯ç”±é…ç½®ï¼Œå¯ä»¥é€šè¿‡æ‰©å±•æ­¤æ–¹æ³•ï¼Œè¾¾åˆ°åŠ¨æ€è·å–é…ç½®çš„ç›®çš„</li><li>public Route getMatchingRoute(String path)ï¼šæ­¤æ–¹æ³•æ˜¯æ ¹æ®è®¿é—®è·¯å¾„ï¼Œè·å–åŒ¹é…çš„è·¯ç”±é…ç½®ï¼Œçˆ¶ç±»ä¸­å·²ç»åŒ¹é…åˆ°è·¯ç”±ï¼Œå¯ä»¥é€šè¿‡è·¯ç”±idæŸ¥æ‰¾è‡ªå®šä¹‰é…ç½®çš„è·¯ç”±è§„åˆ™ï¼Œä»¥è¾¾åˆ°æ ¹æ®è‡ªå®šä¹‰è§„åˆ™åŠ¨æ€åˆ†æµçš„æ•ˆæœ</li></ul><h2 id="ç¯å¢ƒå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#ç¯å¢ƒå‡†å¤‡" aria-hidden="true">#</a> ç¯å¢ƒå‡†å¤‡</h2><ul><li>jdk 1.8ã€idea2018ã€Maven3</li><li>Spring Boot 2.0.6.RELEASE</li><li>Spring Cloud Finchley.SR2</li></ul><h2 id="ä»£ç ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä»£ç ç¤ºä¾‹" aria-hidden="true">#</a> ä»£ç ç¤ºä¾‹</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>springcloud<span class="token operator">-</span><span class="token number">08</span>
â”œâ”€â”€ itstack<span class="token operator">-</span>demo<span class="token operator">-</span>springcloud<span class="token operator">-</span>eureka<span class="token operator">-</span>client
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ main
â”‚           â”œâ”€â”€ java
â”‚           â”‚   â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo
â”‚           â”‚        â”œâ”€â”€ web
â”‚           â”‚        â”‚   â””â”€â”€ <span class="token class-name">EurekaClientController</span><span class="token punctuation">.</span>java
â”‚           â”‚        â””â”€â”€ <span class="token class-name">EurekaClientApplication</span><span class="token punctuation">.</span>java
â”‚           â””â”€â”€ resources   
â”‚               â””â”€â”€ application<span class="token punctuation">.</span>yml
â”œâ”€â”€ itstack<span class="token operator">-</span>demo<span class="token operator">-</span>springcloud<span class="token operator">-</span>eureka<span class="token operator">-</span>server
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ main
â”‚           â”œâ”€â”€ java
â”‚           â”‚   â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo
â”‚           â”‚        â””â”€â”€ <span class="token class-name">EurekaServerApplication</span><span class="token punctuation">.</span>java
â”‚           â””â”€â”€ resources   
â”‚               â””â”€â”€ application<span class="token punctuation">.</span>yml
â”œâ”€â”€ itstack<span class="token operator">-</span>demo<span class="token operator">-</span>springcloud<span class="token operator">-</span>hystrix<span class="token operator">-</span>feign
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ main
â”‚           â”œâ”€â”€ java
â”‚           â”‚   â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo
â”‚           â”‚        â”œâ”€â”€ service
â”‚           â”‚        â”‚   â”œâ”€â”€ hystrix
â”‚           â”‚        â”‚   â”‚   â””â”€â”€ <span class="token class-name">FeignServiceHystrix</span><span class="token punctuation">.</span>java
â”‚           â”‚        â”‚   â””â”€â”€ <span class="token class-name">FeignService</span><span class="token punctuation">.</span>java
â”‚           â”‚        â”œâ”€â”€ web
â”‚           â”‚        â”‚   â””â”€â”€ <span class="token class-name">FeignController</span><span class="token punctuation">.</span>java
â”‚           â”‚        â””â”€â”€ <span class="token class-name">FeignApplication</span><span class="token punctuation">.</span>java
â”‚           â””â”€â”€ resources   
â”‚               â””â”€â”€ application<span class="token punctuation">.</span>yml
â”œâ”€â”€ itstack<span class="token operator">-</span>demo<span class="token operator">-</span>springcloud<span class="token operator">-</span>hystrix<span class="token operator">-</span>ribbon
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ main
â”‚           â”œâ”€â”€ java
â”‚           â”‚   â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo
â”‚           â”‚        â”œâ”€â”€ service
â”‚           â”‚        â”‚   â””â”€â”€ <span class="token class-name">RibbonService</span><span class="token punctuation">.</span>java
â”‚           â”‚        â”œâ”€â”€ web
â”‚           â”‚        â”‚   â””â”€â”€ <span class="token class-name">RibbonController</span><span class="token punctuation">.</span>java      
â”‚           â”‚        â””â”€â”€ <span class="token class-name">RibbonApplication</span><span class="token punctuation">.</span>java
â”‚           â””â”€â”€ resources   
â”‚               â””â”€â”€ application<span class="token punctuation">.</span>yml
â””â”€â”€ itstack<span class="token operator">-</span>demo<span class="token operator">-</span>springcloud<span class="token operator">-</span>zuul
    â””â”€â”€ src
        â””â”€â”€ main
            â”œâ”€â”€ java
            â”‚   â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo   
            â”‚        â”œâ”€â”€ config
            â”‚        â”‚   â””â”€â”€ <span class="token class-name">ZuulConfig</span><span class="token punctuation">.</span>java
            â”‚        â”œâ”€â”€ filter
            â”‚        â”‚   â””â”€â”€ <span class="token class-name">TokenFilter</span><span class="token punctuation">.</span>java
            â”‚        â”œâ”€â”€ router
            â”‚        â”‚   â””â”€â”€ <span class="token class-name">RouteLocator</span><span class="token punctuation">.</span>java
            â”‚        â”œâ”€â”€ service
            â”‚        â”‚   â””â”€â”€ <span class="token class-name">RefreshRouteService</span><span class="token punctuation">.</span>java
            â”‚        â””â”€â”€ <span class="token class-name">ZuulApplication</span><span class="token punctuation">.</span>java
            â””â”€â”€ resources   
                â””â”€â”€ application<span class="token punctuation">.</span>yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å®Œæ•´ä»£ç æ¬¢è¿å…³æ³¨å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ å›å¤â€œSpringCloudä¸“é¢˜â€è¿›è¡Œä¸‹è½½</strong></p><blockquote><p>itstack-demo-springcloud-zuul &amp; åŠ¨æ€è·¯ç”±ä¸æƒé™è¿‡æ»¤</p></blockquote><ol><li><p>é€šè¿‡RouteLocatorå®ç°è‡ªå·±çš„åŠ¨æ€è·¯ç”±é…ç½®ï¼Œå…¶å®å°±æ˜¯æŠŠé…ç½®æ–‡ä»¶å†…å®¹è½¬ç§»åˆ°è¿™é‡Œç”¨ä»£ç ç±»å®ç°ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹ä¸ºä»æ•°æ®åº“é‡Œè·å–ã€‚</p></li><li><p>TokenFilteræä¾›äº†æƒé™éªŒè¯åŠŸèƒ½ï¼Œå½“ç”¨æˆ·è®¿é—®æ—¶å€™ä¼šå¸¦ä¸Štokenå¦åˆ™æ‹¦æˆª</p></li><li><p>æ­¤å¤–è¿˜æä¾›äº†è‡ªåŠ¨åˆ·æ–°çš„æ¥å£ï¼Œç”¨äºå¤–éƒ¨è°ƒç”¨åˆ·æ–°é…ç½®</p></li><li><p>æœ€åæˆ‘ä»¬éœ€è¦ä¿®æ”¹applicationé…ç½®ï¼Œzuulä¸­è¿˜éœ€è¦æ’é™¤ä¸åšè·¯ç”±çš„æ¥å£[åˆ·æ–°æƒé™æ¥å£]</p></li></ol><blockquote><p>config/ZuulConfig.java &amp; è·¯ç”±é…ç½®ç±»</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * è·¯ç”±é…ç½®
 * å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ | ä¸“æ³¨åŸåˆ›æŠ€æœ¯ä¸“é¢˜æ¡ˆä¾‹
 * è®ºå›ï¼šhttp://bugstack.cn
 * Create by ä»˜æ”¿å§” on @2019
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZuulConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ZuulProperties</span> zuulProperties<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ServerProperties</span> server<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">routeLocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RouteLocator</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>server<span class="token punctuation">.</span><span class="token function">getServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zuulProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>filter/TokenFilter.java &amp; æƒé™æ ¡éªŒç±»</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ | ä¸“æ³¨åŸåˆ›æŠ€æœ¯ä¸“é¢˜æ¡ˆä¾‹
 * è®ºå›ï¼šhttp://bugstack.cn
 * Create by ä»˜æ”¿å§” on @2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TokenFilter</span> <span class="token keyword">extends</span> <span class="token class-name">ZuulFilter</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * è¿‡æ»¤å™¨çš„ç±»å‹ï¼Œå®ƒå†³å®šè¿‡æ»¤å™¨åœ¨è¯·æ±‚çš„å“ªä¸ªç”Ÿå‘½å‘¨æœŸä¸­æ‰§è¡Œã€‚
     * FilterConstants.PRE_TYPEï¼šä»£è¡¨ä¼šåœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰æ‰§è¡Œã€‚
     * PREã€ROUTINGã€POSTã€ERROR
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">filterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">FilterConstants</span><span class="token punctuation">.</span><span class="token constant">PRE_TYPE</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * filteræ‰§è¡Œé¡ºåºï¼Œé€šè¿‡æ•°å­—æŒ‡å®šã€‚[æ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šä½]
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">filterOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * åˆ¤æ–­è¯¥è¿‡æ»¤å™¨æ˜¯å¦éœ€è¦è¢«æ‰§è¡Œã€‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥è¿”å›äº†trueï¼Œå› æ­¤è¯¥è¿‡æ»¤å™¨å¯¹æ‰€æœ‰è¯·æ±‚éƒ½ä¼šç”Ÿæ•ˆã€‚
     * å®é™…è¿ç”¨ä¸­æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥å‡½æ•°æ¥æŒ‡å®šè¿‡æ»¤å™¨çš„æœ‰æ•ˆèŒƒå›´ã€‚
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">shouldFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/*
     * å…·ä½“æ‰§è¡Œé€»è¾‘
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RequestContext</span> ctx <span class="token operator">=</span> <span class="token class-name">RequestContext</span><span class="token punctuation">.</span><span class="token function">getCurrentContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>token <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> token<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ctx<span class="token punctuation">.</span><span class="token function">setSendZuulResponse</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">setResponseStatusCode</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">setResponseBody</span><span class="token punctuation">(</span><span class="token string">&quot;refuse! token is empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>router/RouteLocator.java &amp; è·¯ç”±ç±»</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ | ä¸“æ³¨åŸåˆ›æŠ€æœ¯ä¸“é¢˜æ¡ˆä¾‹
 * è®ºå›ï¼šhttp://bugstack.cn
 * Create by ä»˜æ”¿å§” on @2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RouteLocator</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleRouteLocator</span> <span class="token keyword">implements</span> <span class="token class-name">RefreshableRouteLocator</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">ZuulProperties</span> properties<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">RouteLocator</span><span class="token punctuation">(</span><span class="token class-name">String</span> servletPath<span class="token punctuation">,</span> <span class="token class-name">ZuulProperties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>servletPath<span class="token punctuation">,</span> properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>properties <span class="token operator">=</span> properties<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">doRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ZuulRoute</span><span class="token punctuation">&gt;</span></span> <span class="token function">locateRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ZuulRoute</span><span class="token punctuation">&gt;</span></span> routesMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ZuulRoute</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä»application.propertiesä¸­åŠ è½½è·¯ç”±ä¿¡æ¯</span>
        routesMap<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">locateRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä»dbä¸­åŠ è½½è·¯ç”±ä¿¡æ¯</span>
        routesMap<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token function">routesConfigGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¼˜åŒ–ä¸€ä¸‹é…ç½®</span>
        <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ZuulRoute</span><span class="token punctuation">&gt;</span></span> values <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ZuulRoute</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> routesMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> path <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Prepend with slash if not already present.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>path<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                path <span class="token operator">=</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> path<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">getPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                path <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">getPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> path<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>path<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    path <span class="token operator">=</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> path<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> values<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è·¯ç”±é…ç½®ç»„ï¼Œå¯ä»¥ä»æ•°æ®åº“ä¸­è¯»å–
     * åŸºæœ¬é…ç½®ä¸å†™åœ¨æ–‡ä»¶ä¸­é…ç½®ç±»ä¼¼ï¼Œå¦‚ä¸‹ï¼›
     * #  routes:
     * #    api-a:
     * #      path: /route-a/**
     * #      serviceId: itstack-demo-springcloud-feign
     * #    api-b:
     * #      path: /route-b/**
     * #      serviceId: itstack-demo-springcloud-ribbon
     * <span class="token keyword">@return</span> é…ç½®ç»„å†…å®¹
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ZuulRoute</span><span class="token punctuation">&gt;</span></span> <span class="token function">routesConfigGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ZuulRoute</span><span class="token punctuation">&gt;</span></span> routes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ZuulRoute</span> zuulRoute <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZuulRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        zuulRoute<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">&quot;route-a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        zuulRoute<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/route-a/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        zuulRoute<span class="token punctuation">.</span><span class="token function">setServiceId</span><span class="token punctuation">(</span><span class="token string">&quot;itstack-demo-springcloud-feign&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¦‚æœä½¿ç”¨äº†æ³¨å†Œä¸­å¿ƒï¼Œé‚£ä¹ˆå¯ä»¥æ ¹æ®serviceIdè¿›è¡Œè®¿é—®ã€‚</span>
        <span class="token comment">// zuulRoute.setUrl(&quot;http://localhost:9001&quot;);</span>
        zuulRoute<span class="token punctuation">.</span><span class="token function">setRetryable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        zuulRoute<span class="token punctuation">.</span><span class="token function">setStripPrefix</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        zuulRoute<span class="token punctuation">.</span><span class="token function">setSensitiveHeaders</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        routes<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>zuulRoute<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> zuulRoute<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> routes<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>service/RefreshRouteService.java &amp; è·¯ç”±åˆ·æ–°æœåŠ¡</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ | ä¸“æ³¨åŸåˆ›æŠ€æœ¯ä¸“é¢˜æ¡ˆä¾‹
 * è®ºå›ï¼šhttp://bugstack.cn
 * Create by ä»˜æ”¿å§” on @2019
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RefreshRouteService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ApplicationEventPublisher</span> publisher<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RouteLocator</span> routeLocator<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">refreshRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RoutesRefreshedEvent</span> routesRefreshedEvent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoutesRefreshedEvent</span><span class="token punctuation">(</span>routeLocator<span class="token punctuation">)</span><span class="token punctuation">;</span>
        publisher<span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span>routesRefreshedEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ZuulApplication.java &amp; å¯åŠ¨æœåŠ¡æ³¨æ„æ³¨è§£ï¼Œå¦å¤–æä¾›äº†æœåŠ¡æ¥å£</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ | ä¸“æ³¨åŸåˆ›æŠ€æœ¯ä¸“é¢˜æ¡ˆä¾‹
 * è®ºå›ï¼šhttp://bugstack.cn
 * Create by ä»˜æ”¿å§” on @2019
 */</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableZuulProxy</span>
<span class="token annotation punctuation">@EnableEurekaClient</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZuulApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ZuulApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TokenFilter</span> <span class="token function">tokenFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TokenFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RefreshRouteService</span> refreshRouteService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ZuulHandlerMapping</span> zuulHandlerMapping<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;api/refresh&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        refreshRouteService<span class="token punctuation">.</span><span class="token function">refreshRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;api/queryRouteInfo&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryRouteInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> zuulHandlerMapping<span class="token punctuation">.</span><span class="token function">getHandlerMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>application.yml &amp; é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼Œè·¯ç”±è¿‡æ»¤</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>server<span class="token operator">:</span>
  port<span class="token operator">:</span> <span class="token number">10001</span>

spring<span class="token operator">:</span>
  application<span class="token operator">:</span>
    name<span class="token operator">:</span> itstack<span class="token operator">-</span>demo<span class="token operator">-</span>ddd<span class="token operator">-</span>zuul

eureka<span class="token operator">:</span>
  client<span class="token operator">:</span>
    serviceUrl<span class="token operator">:</span>
      defaultZone<span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">7397</span><span class="token operator">/</span>eureka<span class="token operator">/</span>

# åŠ¨æ€è·¯ç”±ï¼Œä»¥ä¸‹é…ç½®æ³¨é‡Šï¼›
# http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">10001</span><span class="token operator">/</span>route<span class="token operator">-</span>a<span class="token operator">/</span>api<span class="token operator">/</span>queryUserInfo<span class="token operator">?</span>userId<span class="token operator">=</span><span class="token number">111</span>
# http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">10001</span><span class="token operator">/</span>route<span class="token operator">-</span>b<span class="token operator">/</span>api<span class="token operator">/</span>queryUserInfo<span class="token operator">?</span>userId<span class="token operator">=</span><span class="token number">111</span>
zuul<span class="token operator">:</span>
   ignoredPatterns<span class="token operator">:</span> <span class="token operator">/</span>api<span class="token doc-comment comment">/**
#  routes:
#    api-a:
#      path: /route-a/**
#      serviceId: itstack-demo-springcloud-feign
#    api-b:
#      path: /route-b/**
#      serviceId: itstack-demo-springcloud-ribbon
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æµ‹è¯•éªŒè¯" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•éªŒè¯" aria-hidden="true">#</a> æµ‹è¯•éªŒè¯</h2><ol><li>åˆ†åˆ«å¯åŠ¨å¦‚ä¸‹æœåŠ¡ï¼› <ol><li>itstack-demo-springcloud-eureka-server æœåŠ¡æ³¨å†Œä¸å‘ç°</li><li>itstack-demo-springcloud-eureka-client æ¥å£æä¾›æ–¹</li><li>itstack-demo-springcloud-hystrix-feign è°ƒç”¨ç«¯</li><li>itstack-demo-springcloud-hystrix-ribbon è°ƒç”¨ç«¯</li><li>itstack-demo-springcloud-zuul è·¯ç”±æœåŠ¡</li></ol></li><li>å¯æµ‹è¯•æ¥å£åˆ—è¡¨ï¼› <ol><li>è·¯ç”±æœåŠ¡ï¼šhttp://localhost:10001/route-a/api/queryUserInfo?userId=111&amp;token=111<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Hi</span> å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> <span class="token number">111</span> <span class="token operator">&gt;</span><span class="token operator">:</span> from eureka client port<span class="token operator">:</span> <span class="token number">8001</span> <span class="token class-name">From</span> <span class="token class-name">Feign</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>åˆ·æ–°é…ç½®ï¼šhttp://localhost:10001/api/refresh</li><li>å†…å®¹é…ç½®ï¼šhttp://localhost:10001/api/queryRouteInfo</li></ol></li></ol><h2 id="ç»¼ä¸Šæ€»ç»“" tabindex="-1"><a class="header-anchor" href="#ç»¼ä¸Šæ€»ç»“" aria-hidden="true">#</a> ç»¼ä¸Šæ€»ç»“</h2><ol><li>è·¯ç”±æœåŠ¡å¯ä»¥æ–¹ä¾¿çš„å¸®æˆ‘ä»¬æ§åˆ¶ä¸šåŠ¡ç±»å‹çš„åŒºåˆ†è®¿é—®ï¼ŒåŒæ—¶è‡ªåŠ¨åˆ·æ–°å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„ä½¿ç”¨ç½‘å…³è·¯ç”±</li><li>æƒé™éªŒè¯æ˜¯å‡ ä¹ä¸å¯å°‘çš„åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ä¼šç»å¸¸ç”¨åˆ°ï¼Œæ‰€æœ‰çš„æ¥å£å¿…é¡»æ˜¯å®‰å…¨å¯é çš„ï¼Œä¿è¯æ•°æ®ä¸æ³„éœ²</li><li>å¦å¤–è¿˜å¯ä»¥è€ƒè™‘ä»å…¥å‚çš„ç”¨æˆ·èº«ä»½è¿›è¡Œè·¯ç”±ï¼Œè¿™æ ·å¯ä»¥æŠŠæ•°æ®åº“è·¯ç”±æå‰ï¼Œè®©ä¸åŒç”¨æˆ·ç»„ç›´æ¥è®¿é—®åˆ°ä¸åŒçš„æ•°æ®åº“ç»„</li></ol><h2 id="æ–‡ç« æ±‡æ€»" tabindex="-1"><a class="header-anchor" href="#æ–‡ç« æ±‡æ€»" aria-hidden="true">#</a> æ–‡ç« æ±‡æ€»</h2>`,31),v={href:"https://bugstack.cn/itstack-demo-springcloud/2019/10/31/Spring-Cloud(%E9%9B%B6)-%E6%80%BB%E6%9C%89%E4%B8%80%E5%81%8F%E6%A6%82%E8%BF%B0%E5%91%8A%E8%AF%89%E4%BD%A0SpringCloud%E6%98%AF%E4%BB%80%E4%B9%88.html",target:"_blank",rel:"noopener noreferrer"},m={href:"https://bugstack.cn/itstack-demo-springcloud/2019/11/01/Spring-Cloud(%E4%B8%80)-%E6%9C%8D%E5%8A%A1%E9%9B%86%E7%BE%A4%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0-Eureka.html",target:"_blank",rel:"noopener noreferrer"},b={href:"https://bugstack.cn/itstack-demo-springcloud/2019/11/02/Spring-Cloud(%E4%BA%8C)-%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E4%B8%8E%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E8%B0%83%E7%94%A8-Eureka.html",target:"_blank",rel:"noopener noreferrer"},g={href:"https://bugstack.cn/itstack-demo-springcloud/2019/11/03/Spring-Cloud(%E4%B8%89)-%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%BF%AB%E9%80%9F%E5%A4%B1%E8%B4%A5%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7%E4%BF%9D%E6%8A%A4-Hystrix.html",target:"_blank",rel:"noopener noreferrer"},h={href:"https://bugstack.cn/itstack-demo-springcloud/2019/11/04/Spring-Cloud(%E5%9B%9B)-%E6%9C%8D%E5%8A%A1%E5%93%8D%E5%BA%94%E6%80%A7%E8%83%BD%E6%88%90%E5%8A%9F%E7%8E%87%E7%9B%91%E6%8E%A7-Hystrix.html",target:"_blank",rel:"noopener noreferrer"},E={href:"https://bugstack.cn/itstack-demo-springcloud/2019/11/05/Spring-Cloud(%E4%BA%94)-Turbine-%E7%9B%91%E6%8E%A7%E4%BF%A1%E6%81%AF%E8%81%9A%E5%90%88%E5%B1%95%E7%A4%BA-Hystrix.html",target:"_blank",rel:"noopener noreferrer"},f={href:"https://bugstack.cn/itstack-demo-springcloud/2019/11/06/Spring-Cloud(%E5%85%AD)-%E5%9F%BA%E4%BA%8EGithub-Webhook%E5%8A%A8%E6%80%81%E5%88%B7%E6%96%B0%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE.html",target:"_blank",rel:"noopener noreferrer"},y={href:"https://bugstack.cn/itstack-demo-springcloud/2019/11/07/Spring-Cloud(%E4%B8%83)-%E5%9F%BA%E4%BA%8ERabbitMQ%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF%E6%96%B9%E5%BC%8F%E5%88%B7%E6%96%B0%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1.html",target:"_blank",rel:"noopener noreferrer"},w={href:"https://bugstack.cn/itstack-demo-springcloud/2019/11/08/Spring-Cloud(%E5%85%AB)-%E6%9C%8D%E5%8A%A1%E7%BD%91%E5%85%B3%E8%B7%AF%E7%94%B1-Zuul1.html",target:"_blank",rel:"noopener noreferrer"},R=n("p",null,[s("å¾®ä¿¡æœç´¢ã€Œ"),n("strong",null,"bugstackè™«æ´æ ˆ"),s("ã€å…¬ä¼—å·ï¼Œå…³æ³¨åå›å¤ã€Œ"),n("strong",null,"SpringCloudä¸“é¢˜"),s("ã€è·å–æœ¬æ–‡æºç &æ›´å¤šåŸåˆ›ä¸“é¢˜æ¡ˆä¾‹ï¼")],-1);function A(B,S){const a=p("ExternalLinkIcon");return o(),l("div",null,[u,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),r,s("åšå®¢ï¼š"),n("a",d,[s("https://bugstack.cn"),e(a)])]),k,n("ol",null,[n("li",null,[n("a",v,[s("Spring Cloud(é›¶)ã€Šæ€»æœ‰ä¸€åæ¦‚è¿°å‘Šè¯‰ä½ SpringCloudæ˜¯ä»€ä¹ˆã€‹"),e(a)])]),n("li",null,[n("a",m,[s("Spring Cloud(ä¸€)ã€ŠæœåŠ¡é›†ç¾¤æ³¨å†Œä¸å‘ç° Eurekaã€‹"),e(a)])]),n("li",null,[n("a",b,[s("Spring Cloud(äºŒ)ã€ŠæœåŠ¡æä¾›ä¸è´Ÿè½½å‡è¡¡è°ƒç”¨ Eurekaã€‹"),e(a)])]),n("li",null,[n("a",g,[s("Spring Cloud(ä¸‰)ã€Šåº”ç”¨æœåŠ¡å¿«é€Ÿå¤±è´¥ç†”æ–­é™çº§ä¿æŠ¤ Hystrixã€‹"),e(a)])]),n("li",null,[n("a",h,[s("Spring Cloud(å››)ã€ŠæœåŠ¡å“åº”æ€§èƒ½æˆåŠŸç‡ç›‘æ§ Hystrixã€‹"),e(a)])]),n("li",null,[n("a",E,[s("Spring Cloud(äº”)ã€ŠTurbine ç›‘æ§ä¿¡æ¯èšåˆå±•ç¤º Hystrixã€‹"),e(a)])]),n("li",null,[n("a",f,[s("Spring Cloud(å…­)ã€ŠåŸºäºgithub webhookåŠ¨æ€åˆ·æ–°æœåŠ¡é…ç½®ã€‹"),e(a)])]),n("li",null,[n("a",y,[s("Spring Cloud(ä¸ƒ)ã€ŠåŸºäºRabbitMQæ¶ˆæ¯æ€»çº¿æ–¹å¼åˆ·æ–°é…ç½®æœåŠ¡ã€‹"),e(a)])]),n("li",null,[n("a",w,[s("Spring Cloud(å…«)ã€ŠæœåŠ¡ç½‘å…³è·¯ç”± Zuul1ã€‹"),e(a)])])]),R])}const q=t(i,[["render",A],["__file","2019-11-24-Spring Cloudjiuã€ŠfuwuwangguanZuul dongtailuyouyuquanxianguolvqiã€‹.html.vue"]]);export{q as default};
