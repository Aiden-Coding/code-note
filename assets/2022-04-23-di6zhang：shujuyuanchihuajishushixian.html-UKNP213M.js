import{_ as p,r as o,o as e,c,a as n,b as s,d as t,e as l}from"./app-3RcBQnkC.js";const u={},i=n("h1",{id:"ã€Šmybatis-æ‰‹æ’¸ä¸“æ ã€‹ç¬¬6ç« -æ•°æ®æºæ± åŒ–æŠ€æœ¯å®ç°",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ã€Šmybatis-æ‰‹æ’¸ä¸“æ ã€‹ç¬¬6ç« -æ•°æ®æºæ± åŒ–æŠ€æœ¯å®ç°","aria-hidden":"true"},"#"),s(" ã€ŠMybatis æ‰‹æ’¸ä¸“æ ã€‹ç¬¬6ç« ï¼šæ•°æ®æºæ± åŒ–æŠ€æœ¯å®ç°")],-1),k=n("br",null,null,-1),r={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=n("br",null,null,-1),m={href:"https://mp.weixin.qq.com/s/cvW7V-wd86DV-Rzs-Fdv1w",target:"_blank",rel:"noopener noreferrer"},v=n("blockquote",null,[n("p",null,"æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„")],-1),b=n("iframe",{id:"B-Video",src:"//player.bilibili.com/player.html?aid=898079301&bvid=BV1dN4y1g789&cid=761584030&page=1",scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",width:"100%",height:"480"}," ",-1),g=l(`<h2 id="ä¸€ã€å‰è¨€" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‰è¨€" aria-hidden="true">#</a> ä¸€ã€å‰è¨€</h2><p><code>ç å†œï¼Œåªä¼šåšä¸ä¼šè¯´ï¼Ÿ</code></p><p>ä½ æœ‰å‘ç°å—ï¼Œå…¶å®å¾ˆå¤§ä¸€éƒ¨åˆ†ç å†œï¼Œéƒ½åªæ˜¯ä¼šå†™ä»£ç ï¼Œä¸ä¼šè®²ä¸œè¥¿ã€‚ä¸€é‡åˆ°è¿°èŒã€ç­”è¾©ã€åˆ†äº«ã€æ±‡æŠ¥ï¼Œå°±å¾ˆéš¾æµç•…ä¸”æœ‰é«˜åº¦ã€æœ‰æ·±åº¦ï¼Œå¹¶èåˆä¸€éƒ¨åˆ†å¼•å…¥å…¥èƒœçš„è¶£å‘³æ€§æ¥è®©è§‚ä¼—æ›´å¥½çš„æ¥å—å’Œç†è§£ä½ è¦ä¼ é€’çš„ä¿¡æ¯ã€‚</p><p>é‚£ä¸ºä»€ä¹ˆå·²ç»åšäº†è¿˜è®²ä¸å‡ºæ¥å‘¢ï¼Ÿå› ä¸ºåšåªæ˜¯åœ¨å·²ç¡®å®šç›®æ ‡å’Œæ—¢å®šè·¯çº¿ä¸‹çš„æ‰§è¡Œï¼Œä½†ä¸ºä»€ä¹ˆç¡®å®šè¿™ä¸ªç›®æ ‡ã€ä¸ºä»€ä¹ˆåˆ¶å®šè¿™ä¸ªè·¯çº¿ã€æ¨ªå‘çš„å‚ç…§å¯¹æ¯”ã€çºµå‘çš„æ·±åº¦è®¾è®¡ï¼Œéƒ½æ²¡æœ‰åœ¨ä¸€ä¸ªæ‰§è¡Œè€…çš„å¤´è„‘ä¸­å½¢æˆè¿‡ç¨‹çš„æ¨æ¼”ï¼Œæ›´å¤šçš„æ—¶å€™éƒ½åªæ˜¯æ‰§è¡Œã€‚æ‰€ä»¥ä¹Ÿå°±å¾ˆéš¾æŠŠä¸€ä¸ªäº‹å®Œæ•´çš„è¡¨è¿°å‡ºæ¥ã€‚</p><p>æ‰€ä»¥ï¼Œåªæœ‰å½“ä½ ç»å†çš„è¶³å¤Ÿå¤šï¼Œé˜…å†çš„è¶³å¤Ÿä¸°å¯Œï¼Œæ‰èƒ½æœ‰æ›´å¥½çš„è¡¨è¿°èƒ½åŠ›å’Œä¸´åœºåº”å˜æŠ€å·§ï¼Œä¹Ÿå°±æ›´èƒ½æ›´æ¸…æ¥šçš„ä¼ é€’å‡ºä½ è¦è¡¨è¾¾çš„ä¿¡æ¯ã€‚</p><h2 id="äºŒã€ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#äºŒã€ç›®æ ‡" aria-hidden="true">#</a> äºŒã€ç›®æ ‡</h2><p>åœ¨ä¸Šä¸€ç« èŠ‚æˆ‘ä»¬è§£æäº† XML ä¸­æ•°æ®æºé…ç½®ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨ Druid åˆ›å»ºæ•°æ®æºå®Œæˆæ•°æ®åº“çš„æ“ä½œã€‚ä½†å…¶å®åœ¨ Mybatis ä¸­æ˜¯æœ‰è‡ªå·±çš„æ•°æ®æºå®ç°çš„ï¼ŒåŒ…æ‹¬æ— æ± åŒ–çš„ UnpooledDataSource å®ç°æ–¹å¼å’Œæœ‰æ± åŒ–çš„ PooledDataSource å®ç°æ–¹å¼ã€‚</p><p>é‚£ä¹ˆæœ¬ç« èŠ‚æˆ‘ä»¬å°±æ¥å®ç°ä¸€ä¸‹å…³äºæ± åŒ–æ•°æ®æºçš„å¤„ç†ï¼Œé€šè¿‡è¿™äº›å®ç°è¯»è€…ä¹Ÿèƒ½æ›´å¥½çš„ç†è§£åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ä¸€äº›å…³äºæ•°æ®æºçš„é…ç½®å±æ€§åˆ°åº•æ„æ¬²ä½•ä¸ºï¼ŒåŒ…æ‹¬ï¼šæœ€å¤§æ´»è·ƒè¿æ¥æ•°ã€ç©ºé—²è¿æ¥æ•°ã€æ£€æµ‹æ—¶é•¿ç­‰ï¼Œåœ¨è¿æ¥æ± ä¸­æ‰€èµ·åˆ°çš„ä½œç”¨ã€‚</p><h2 id="ä¸‰ã€è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€è®¾è®¡" aria-hidden="true">#</a> ä¸‰ã€è®¾è®¡</h2><p>é¦–å…ˆä½ å¯ä»¥æŠŠæ± åŒ–æŠ€æœ¯ç†è§£ä¸ºäº«å…ƒæ¨¡å¼çš„å…·ä½“å®ç°æ–¹æ¡ˆï¼Œé€šå¸¸æˆ‘ä»¬å¯¹ä¸€äº›éœ€è¦è¾ƒé«˜åˆ›å»ºæˆæœ¬ä¸”é«˜é¢‘ä½¿ç”¨çš„èµ„æºï¼Œéœ€è¦è¿›è¡Œç¼“å­˜æˆ–è€…ä¹Ÿç§°é¢„çƒ­å¤„ç†ã€‚å¹¶æŠŠè¿™äº›èµ„æºå­˜æ”¾åˆ°ä¸€ä¸ªé¢„çƒ­æ± å­ä¸­ï¼Œéœ€è¦ç”¨çš„æ—¶å€™ä»æ± å­ä¸­è·å–ï¼Œä½¿ç”¨å®Œæ¯•å†è¿›è¡Œä½¿ç”¨ã€‚é€šè¿‡æ± åŒ–å¯ä»¥éå¸¸æœ‰æ•ˆçš„æ§åˆ¶èµ„æºçš„ä½¿ç”¨æˆæœ¬ï¼ŒåŒ…æ‹¬ï¼›èµ„æºæ•°é‡ã€ç©ºé—²æ—¶é•¿ã€è·å–æ–¹å¼ç­‰è¿›è¡Œç»Ÿä¸€æ§åˆ¶å’Œç®¡ç†ã€‚å¦‚å›¾ 6-1 æ‰€ç¤º</p><p><img src="https://bugstack.cn/images/article/spring/mybatis-220423-01.png" alt="å›¾ 6-1 æ± åŒ–æ•°æ®æºè®¾è®¡"></p><ul><li>é€šè¿‡æä¾›ç»Ÿä¸€çš„è¿æ¥æ± ä¸­å¿ƒï¼Œå­˜æ”¾æ•°æ®æºé“¾æ¥ï¼Œå¹¶æ ¹æ®é…ç½®æŒ‰ç…§è¯·æ±‚è·å–é“¾æ¥çš„æ“ä½œï¼Œåˆ›å»ºè¿æ¥æ± çš„æ•°æ®æºé“¾æ¥æ•°é‡ã€‚è¿™é‡Œå°±åŒ…æ‹¬äº†æœ€å¤§ç©ºé—²é“¾æ¥å’Œæœ€å¤§æ´»è·ƒé“¾æ¥ï¼Œéƒ½éšç€åˆ›å»ºè¿‡ç¨‹è¢«æ§åˆ¶ã€‚</li><li>æ­¤å¤–ç”±äºæ§åˆ¶äº†è¿æ¥æ± ä¸­è¿æ¥çš„æ•°é‡ï¼Œæ‰€ä»¥å½“å¤–éƒ¨ä»è¿æ¥æ± è·å–é“¾æ¥æ—¶ï¼Œå¦‚æœé“¾æ¥å·²æ»¡åˆ™ä¼šè¿›è¡Œå¾ªç¯ç­‰å¾…ã€‚è¿™ä¹Ÿæ˜¯å¤§å®¶æ—¥å¸¸ä½¿ç”¨DBè¿æ¥æ± ï¼Œå¦‚æœä¸€ä¸ªSQLæ“ä½œå¼•èµ·äº†æ…¢æŸ¥è¯¢ï¼Œåˆ™ä¼šå¯¼è‡´æ•´ä¸ªæœåŠ¡è¿›å…¥ç˜«ç—ªçš„é˜¶æ®µï¼Œå„ä¸ªå’Œæ•°æ®åº“ç›¸å…³çš„æ¥å£è°ƒç”¨ï¼Œéƒ½ä¸èƒ½è·å¾—åˆ°é“¾æ¥ï¼Œæ¥å£æŸ¥è¯¢TP99é™¡ç„¶å¢é«˜ï¼Œç³»ç»Ÿå¼€å§‹å¤§é‡æŠ¥è­¦ã€‚<em>é‚£è¿æ¥æ± å¯ä»¥é…ç½®çš„å¾ˆå¤§å—ï¼Œä¹Ÿä¸å¯ä»¥ï¼Œå› ä¸ºè¿æ¥æ± è¦å’Œæ•°æ®åº“æ‰€åˆ†é…çš„è¿æ¥æ± å¯¹åº”ä¸Šï¼Œé¿å…åº”ç”¨é…ç½®è¿æ¥æ± è¶…è¿‡æ•°æ®åº“æ‰€æä¾›çš„è¿æ¥æ± æ•°é‡ï¼Œå¦åˆ™ä¼šå‡ºç°å¤¯ä½ä¸èƒ½åˆ†é…é“¾æ¥çš„é—®é¢˜ï¼Œå¯¼è‡´æ•°æ®åº“æ‹–å®ä»è€Œå¼•èµ·è¿é”ååº”ã€‚</em></li></ul><h2 id="å››ã€å®ç°" tabindex="-1"><a class="header-anchor" href="#å››ã€å®ç°" aria-hidden="true">#</a> å››ã€å®ç°</h2><h3 id="_1-å·¥ç¨‹ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1-å·¥ç¨‹ç»“æ„" aria-hidden="true">#</a> 1. å·¥ç¨‹ç»“æ„</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>mybatis<span class="token operator">-</span>step<span class="token operator">-</span><span class="token number">05</span>
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis
    â”‚           â”œâ”€â”€ binding
    â”‚           â”œâ”€â”€ builder
    â”‚           â”œâ”€â”€ datasource
    â”‚           â”‚   â”œâ”€â”€ druid
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">DruidDataSourceFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ pooled
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">PooledConnection</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">PooledDataSource</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">PooledDataSourceFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">PoolState</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ unpooled
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">UnpooledDataSource</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">UnpooledDataSourceFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">DataSourceFactory</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ io
    â”‚           â”œâ”€â”€ mapping
    â”‚           â”œâ”€â”€ session
    â”‚           â”‚   â”œâ”€â”€ defaults
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DefaultSqlSession</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">DefaultSqlSessionFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">Configuration</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">SqlSession</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">SqlSessionFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">TransactionIsolationLevel</span><span class="token punctuation">.</span>java  
    â”‚           â”œâ”€â”€ transaction
    â”‚           â””â”€â”€ type
    â””â”€â”€ test
        â”œâ”€â”€ java
        â”‚   â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span>dao
        â”‚       â”œâ”€â”€ dao
        â”‚       â”‚   â””â”€â”€ <span class="token class-name">IUserDao</span><span class="token punctuation">.</span>java
        â”‚       â”œâ”€â”€ po
        â”‚       â”‚   â””â”€â”€ <span class="token class-name">User</span><span class="token punctuation">.</span>java
        â”‚       â””â”€â”€ <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
        â””â”€â”€ resources
            â”œâ”€â”€ mapper
            â”‚   â””â”€â”€<span class="token class-name">User_Mapper</span><span class="token punctuation">.</span>xml
            â””â”€â”€ mybatis<span class="token operator">-</span>config<span class="token operator">-</span>datasource<span class="token punctuation">.</span>xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å·¥ç¨‹æºç </strong>ï¼š<code>å…¬ä¼—å·ã€Œbugstackè™«æ´æ ˆã€ï¼Œå›å¤ï¼šæ‰‹å†™Mybatisï¼Œè·å–å®Œæ•´æºç </code></p><p>æ± åŒ–æ•°æ®æºæ ¸å¿ƒç±»å…³ç³»ï¼Œå¦‚å›¾ 6-2 æ‰€ç¤º</p><p><img src="https://bugstack.cn/images/article/spring/mybatis-220423-02.png" alt="å›¾ 6-2 æ± åŒ–æ•°æ®æºæ ¸å¿ƒç±»å…³ç³»"></p><ul><li>åœ¨ Mybatis æ•°æ®æºçš„å®ç°ä¸­ï¼ŒåŒ…æ‹¬ä¸¤éƒ¨åˆ†åˆ†ä¸ºæ— æ± åŒ–çš„ UnpooledDataSource å®ç°ç±»å’Œæœ‰æ± åŒ–çš„ PooledDataSource å®ç°ç±»ï¼Œæ± åŒ–çš„å®ç°ç±» PooledDataSource ä»¥å¯¹æ— æ± åŒ–çš„ UnpooledDataSource è¿›è¡Œæ‰©å±•å¤„ç†ã€‚æŠŠåˆ›å»ºå‡ºæ¥çš„é“¾æ¥ä¿å­˜åˆ°å†…å­˜ä¸­ï¼Œè®°å½•ä¸ºç©ºé—²é“¾æ¥å’Œæ´»è·ƒé“¾æ¥ï¼Œåœ¨ä¸åŒçš„é˜¶æ®µè¿›è¡Œä½¿ç”¨ã€‚</li><li>PooledConnection æ˜¯å¯¹é“¾æ¥çš„ä»£ç†æ“ä½œï¼Œé€šè¿‡invokeæ–¹æ³•çš„åå°„è°ƒç”¨ï¼Œå¯¹å…³é—­çš„é“¾æ¥è¿›è¡Œå›æ”¶å¤„ç†ï¼Œå¹¶ä½¿ç”¨ notifyAll é€šçŸ¥æ­£åœ¨ç­‰å¾…é“¾æ¥çš„ç”¨æˆ·è¿›è¡ŒæŠ¢é“¾æ¥ã€‚</li><li>å¦å¤–æ˜¯å¯¹ DataSourceFactory æ•°æ®æºå·¥å‚æ¥å£çš„å®ç°ï¼Œç”±æ— æ± åŒ–å·¥å‚å®ç°åï¼Œæœ‰æ± åŒ–å·¥å‚ç»§æ‰¿çš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œæ²¡æœ‰å¤ªå¤šçš„å¤æ‚æ“ä½œï¼Œæ± åŒ–çš„å¤„ç†ä¸»è¦é›†ä¸­åœ¨ PooledDataSource ç±»ä¸­è¿›è¡Œå¤„ç†ã€‚</li></ul><h3 id="_2-æ— æ± åŒ–é“¾æ¥å®ç°" tabindex="-1"><a class="header-anchor" href="#_2-æ— æ± åŒ–é“¾æ¥å®ç°" aria-hidden="true">#</a> 2. æ— æ± åŒ–é“¾æ¥å®ç°</h3><p>å¯¹äºæ•°æ®åº“è¿æ¥æ± çš„å®ç°ï¼Œä¸ä¸€å®šéå¾—æä¾›æ± åŒ–æŠ€æœ¯ï¼Œå¯¹äºæŸäº›åœºæ™¯å¯ä»¥åªä½¿ç”¨æ— æ± åŒ–çš„è¿æ¥æ± ã€‚é‚£ä¹ˆåœ¨å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æŠŠæ— æ± åŒ–çš„å®ç°å’Œæ± åŒ–å®ç°æ‹†åˆ†è§£è€¦ï¼Œåœ¨éœ€è¦çš„æ—¶å€™åªéœ€è¦é…ç½®å¯¹åº”çš„æ•°æ®æºå³å¯ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnpooledDataSource</span> <span class="token keyword">implements</span> <span class="token class-name">DataSource</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">ClassLoader</span> driverClassLoader<span class="token punctuation">;</span>
    <span class="token comment">// é©±åŠ¨é…ç½®ï¼Œä¹Ÿå¯ä»¥æ‰©å±•å±æ€§ä¿¡æ¯ driver.encoding=UTF8</span>
    <span class="token keyword">private</span> <span class="token class-name">Properties</span> driverProperties<span class="token punctuation">;</span>
    <span class="token comment">// é©±åŠ¨æ³¨å†Œå™¨</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Driver</span><span class="token punctuation">&gt;</span></span> registeredDrivers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// é©±åŠ¨</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> driver<span class="token punctuation">;</span>
    <span class="token comment">// DB é“¾æ¥åœ°å€</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>
    <span class="token comment">// è´¦å·</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token comment">// å¯†ç </span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
    <span class="token comment">// æ˜¯å¦è‡ªåŠ¨æäº¤</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> autoCommit<span class="token punctuation">;</span>
    <span class="token comment">// äº‹åŠ¡çº§åˆ«</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> defaultTransactionIsolationLevel<span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token class-name">Enumeration</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Driver</span><span class="token punctuation">&gt;</span></span> drivers <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getDrivers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>drivers<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Driver</span> driver <span class="token operator">=</span> drivers<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            registeredDrivers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>driver<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> driver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Connection</span> <span class="token function">doGetConnection</span><span class="token punctuation">(</span><span class="token class-name">Properties</span> properties<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token function">initializerDriver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>autoCommit <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> autoCommit <span class="token operator">!=</span> connection<span class="token punctuation">.</span><span class="token function">getAutoCommit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            connection<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span>autoCommit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultTransactionIsolationLevel <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            connection<span class="token punctuation">.</span><span class="token function">setTransactionIsolation</span><span class="token punctuation">(</span>defaultTransactionIsolationLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> connection<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * åˆå§‹åŒ–é©±åŠ¨
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">initializerDriver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registeredDrivers<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> driverType <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>driver<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> driverClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// https://www.kfu.com/~nsayer/Java/dyn-jdbc.html</span>
                <span class="token class-name">Driver</span> driverInstance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Driver</span><span class="token punctuation">)</span> driverType<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">registerDriver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DriverProxy</span><span class="token punctuation">(</span>driverInstance<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                registeredDrivers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>driver<span class="token punctuation">,</span> driverInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SQLException</span><span class="token punctuation">(</span><span class="token string">&quot;Error setting driver on UnpooledDataSource. Cause: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
	
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ— æ± åŒ–çš„æ•°æ®æºé“¾æ¥å®ç°æ¯”è¾ƒç®€å•ï¼Œæ ¸å¿ƒåœ¨äº initializerDriver åˆå§‹åŒ–é©±åŠ¨ä¸­ä½¿ç”¨äº† Class.forName å’Œ newInstance çš„æ–¹å¼åˆ›å»ºäº†æ•°æ®æºé“¾æ¥æ“ä½œã€‚</li><li>åœ¨åˆ›å»ºå®Œæˆè¿æ¥ä»¥åï¼ŒæŠŠé“¾æ¥å­˜æ”¾åˆ°é©±åŠ¨æ³¨å†Œå™¨ä¸­ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ä¸­å¯ä»¥ç›´æ¥è·å–é“¾æ¥ï¼Œé¿å…é‡å¤åˆ›å»ºæ‰€å¸¦æ¥çš„èµ„æºæ¶ˆè€—ã€‚</li></ul><h3 id="_3-æœ‰æ± åŒ–é“¾æ¥å®ç°" tabindex="-1"><a class="header-anchor" href="#_3-æœ‰æ± åŒ–é“¾æ¥å®ç°" aria-hidden="true">#</a> 3. æœ‰æ± åŒ–é“¾æ¥å®ç°</h3><p>æœ‰æ± åŒ–çš„æ•°æ®æºé“¾æ¥ï¼Œæ ¸å¿ƒåœ¨äºå¯¹æ— æ± åŒ–é“¾æ¥çš„åŒ…è£…ï¼ŒåŒæ—¶æä¾›äº†ç›¸åº”çš„æ± åŒ–æŠ€æœ¯å®ç°ï¼ŒåŒ…æ‹¬ï¼špushConnectionã€popConnectionã€forceCloseAllã€pingConnection çš„æ“ä½œå¤„ç†ã€‚</p><p>è¿™æ ·å½“ç”¨æˆ·æƒ³è¦è·å–é“¾æ¥çš„æ—¶å€™ï¼Œåˆ™ä¼šä»è¿æ¥æ± ä¸­è¿›è¡Œè·å–ï¼ŒåŒæ—¶åˆ¤æ–­æ˜¯å¦æœ‰ç©ºé—²é“¾æ¥ã€æœ€å¤§æ´»è·ƒé“¾æ¥å¤šå°‘ï¼Œä»¥åŠæ˜¯å¦éœ€è¦ç­‰å¾…å¤„ç†æˆ–æ˜¯æœ€ç»ˆæŠ›å‡ºå¼‚å¸¸ã€‚</p><h4 id="_3-1-æ± åŒ–è¿æ¥çš„ä»£ç†" tabindex="-1"><a class="header-anchor" href="#_3-1-æ± åŒ–è¿æ¥çš„ä»£ç†" aria-hidden="true">#</a> 3.1 æ± åŒ–è¿æ¥çš„ä»£ç†</h4><p>ç”±äºæˆ‘ä»¬éœ€è¦å¯¹è¿æ¥è¿›è¡Œæ± åŒ–å¤„ç†ï¼Œæ‰€ä»¥å½“é“¾æ¥è°ƒç”¨ä¸€äº› CLOSE æ–¹æ³•çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦æŠŠé“¾æ¥ä»æ± ä¸­å…³é—­å’Œæ¢å¤å¯ç”¨ï¼Œå…è®¸å…¶ä»–ç”¨æˆ·è·å–åˆ°é“¾æ¥ã€‚é‚£ä¹ˆè¿™é‡Œå°±éœ€è¦å¯¹è¿æ¥ç±»è¿›è¡Œä»£ç†åŒ…è£…ï¼Œå¤„ç† CLOSE æ–¹æ³•ã€‚</p><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.datasource.pooled.PooledConnection</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PooledConnection</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> methodName <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¦‚æœæ˜¯è°ƒç”¨ CLOSE å…³é—­é“¾æ¥æ–¹æ³•ï¼Œåˆ™å°†é“¾æ¥åŠ å…¥è¿æ¥æ± ä¸­ï¼Œå¹¶è¿”å›null</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">CLOSE</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> methodName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token constant">CLOSE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dataSource<span class="token punctuation">.</span><span class="token function">pushConnection</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getDeclaringClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// é™¤äº†toString()æ–¹æ³•ï¼Œå…¶ä»–æ–¹æ³•è°ƒç”¨ä¹‹å‰è¦æ£€æŸ¥connectionæ˜¯å¦è¿˜æ˜¯åˆæ³•çš„,ä¸åˆæ³•è¦æŠ›å‡ºSQLException</span>
                <span class="token function">checkConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// å…¶ä»–æ–¹æ³•äº¤ç»™connectionå»è°ƒç”¨</span>
            <span class="token keyword">return</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>realConnection<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>é€šè¿‡ PooledConnection å®ç° InvocationHandler#invoke æ–¹æ³•ï¼ŒåŒ…è£…ä»£ç†é“¾æ¥ï¼Œè¿™æ ·å°±å¯ä»¥å¯¹å…·ä½“çš„è°ƒç”¨æ–¹æ³•è¿›è¡Œæ§åˆ¶äº†ã€‚</li><li>åœ¨ invoke æ–¹æ³•ä¸­å¤„ç†å¯¹ CLOSE æ–¹æ³•æ§åˆ¶ä»¥å¤–ï¼Œæ’é™¤ toString ç­‰Object çš„æ–¹æ³•åï¼Œåˆ™æ˜¯å…¶ä»–çœŸæ­£éœ€è¦è¢« DB é“¾æ¥å¤„ç†çš„æ–¹æ³•äº†ã€‚</li><li>é‚£ä¹ˆè¿™é‡Œæœ‰ä¸€ä¸ªå¯¹äº CLOSE æ–¹æ³•çš„æ•°æ®æºå›æ”¶æ“ä½œ dataSource.pushConnection(this); æœ‰ä¸€ä¸ªå…·ä½“çš„å®ç°æ–¹æ³•ï¼Œåœ¨æ± åŒ–å®ç°ç±» PooledDataSource ä¸­è¿›è¡Œå¤„ç†ã€‚</li></ul><h4 id="_3-2-pushconnection-å›æ”¶é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#_3-2-pushconnection-å›æ”¶é“¾æ¥" aria-hidden="true">#</a> 3.2 pushConnection å›æ”¶é“¾æ¥</h4><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.datasource.pooled.PooledDataSource</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">pushConnection</span><span class="token punctuation">(</span><span class="token class-name">PooledConnection</span> connection<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>activeConnections<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ¤æ–­é“¾æ¥æ˜¯å¦æœ‰æ•ˆ</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>connection<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœç©ºé—²é“¾æ¥å°äºè®¾å®šæ•°é‡ï¼Œä¹Ÿå°±æ˜¯å¤ªå°‘æ—¶</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>idleConnections<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> poolMaximumIdleConnections <span class="token operator">&amp;&amp;</span> connection<span class="token punctuation">.</span><span class="token function">getConnectionTypeCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> expectedConnectionTypeCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                state<span class="token punctuation">.</span>accumulatedCheckoutTime <span class="token operator">+=</span> connection<span class="token punctuation">.</span><span class="token function">getCheckoutTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>connection<span class="token punctuation">.</span><span class="token function">getRealConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAutoCommit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    connection<span class="token punctuation">.</span><span class="token function">getRealConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„DBè¿æ¥ï¼ŒåŠ å…¥åˆ°idleåˆ—è¡¨</span>
                <span class="token class-name">PooledConnection</span> newConnection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PooledConnection</span><span class="token punctuation">(</span>connection<span class="token punctuation">.</span><span class="token function">getRealConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                state<span class="token punctuation">.</span>idleConnections<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newConnection<span class="token punctuation">)</span><span class="token punctuation">;</span>
                newConnection<span class="token punctuation">.</span><span class="token function">setCreatedTimestamp</span><span class="token punctuation">(</span>connection<span class="token punctuation">.</span><span class="token function">getCreatedTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                newConnection<span class="token punctuation">.</span><span class="token function">setLastUsedTimestamp</span><span class="token punctuation">(</span>connection<span class="token punctuation">.</span><span class="token function">getLastUsedTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                connection<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Returned connection &quot;</span> <span class="token operator">+</span> newConnection<span class="token punctuation">.</span><span class="token function">getRealHashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; to pool.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// é€šçŸ¥å…¶ä»–çº¿ç¨‹å¯ä»¥æ¥æŠ¢DBè¿æ¥äº†</span>
                state<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// å¦åˆ™ï¼Œç©ºé—²é“¾æ¥è¿˜æ¯”è¾ƒå……è¶³</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                state<span class="token punctuation">.</span>accumulatedCheckoutTime <span class="token operator">+=</span> connection<span class="token punctuation">.</span><span class="token function">getCheckoutTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>connection<span class="token punctuation">.</span><span class="token function">getRealConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAutoCommit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    connection<span class="token punctuation">.</span><span class="token function">getRealConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// å°†connectionå…³é—­</span>
                connection<span class="token punctuation">.</span><span class="token function">getRealConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Closed connection &quot;</span> <span class="token operator">+</span> connection<span class="token punctuation">.</span><span class="token function">getRealHashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                connection<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;A bad connection (&quot;</span> <span class="token operator">+</span> connection<span class="token punctuation">.</span><span class="token function">getRealHashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;) attempted to return to the pool, discarding connection.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            state<span class="token punctuation">.</span>badConnectionCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨ PooledDataSource#pushConnection æ•°æ®æºå›æ”¶çš„å¤„ç†ä¸­ï¼Œæ ¸å¿ƒåœ¨äºåˆ¤æ–­é“¾æ¥æ˜¯å¦æœ‰æ•ˆï¼Œä»¥åŠè¿›è¡Œç›¸å…³çš„ç©ºé—²é“¾æ¥æ ¡éªŒï¼Œåˆ¤æ–­æ˜¯å¦æŠŠè¿æ¥å›æ”¶åˆ° idle ç©ºé—²é“¾æ¥åˆ—è¡¨ä¸­ï¼Œå¹¶é€šçŸ¥å…¶ä»–çº¿ç¨‹æ¥æŠ¢å ã€‚</li><li>å¦‚æœç°åœ¨ç©ºé—²é“¾æ¥å……è¶³ï¼Œé‚£ä¹ˆè¿™ä¸ªå›æ”¶çš„é“¾æ¥åˆ™ä¼šè¿›è¡Œå›æ»šå’Œå…³é—­çš„å¤„ç†ä¸­ã€‚connection.getRealConnection().close();</li></ul><h4 id="_3-3-popconnection-è·å–é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#_3-3-popconnection-è·å–é“¾æ¥" aria-hidden="true">#</a> 3.3 popConnection è·å–é“¾æ¥</h4><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.datasource.pooled.PooledDataSource</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">PooledConnection</span> <span class="token function">popConnection</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> countedWait <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token class-name">PooledConnection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> t <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> localBadConnectionCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>conn <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœæœ‰ç©ºé—²é“¾æ¥ï¼šè¿”å›ç¬¬ä¸€ä¸ª</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>state<span class="token punctuation">.</span>idleConnections<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                conn <span class="token operator">=</span> state<span class="token punctuation">.</span>idleConnections<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Checked out connection &quot;</span> <span class="token operator">+</span> conn<span class="token punctuation">.</span><span class="token function">getRealHashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; from pool.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// å¦‚æœæ— ç©ºé—²é“¾æ¥ï¼šåˆ›å»ºæ–°çš„é“¾æ¥</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ´»è·ƒè¿æ¥æ•°ä¸è¶³</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>activeConnections<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> poolMaximumActiveConnections<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PooledConnection</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Created connection &quot;</span> <span class="token operator">+</span> conn<span class="token punctuation">.</span><span class="token function">getRealHashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// æ´»è·ƒè¿æ¥æ•°å·²æ»¡</span>
                <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token comment">// å–å¾—æ´»è·ƒé“¾æ¥åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯æœ€è€çš„ä¸€ä¸ªè¿æ¥</span>
                    <span class="token class-name">PooledConnection</span> oldestActiveConnection <span class="token operator">=</span> state<span class="token punctuation">.</span>activeConnections<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">long</span> longestCheckoutTime <span class="token operator">=</span> oldestActiveConnection<span class="token punctuation">.</span><span class="token function">getCheckoutTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// å¦‚æœcheckoutæ—¶é—´è¿‡é•¿ï¼Œåˆ™è¿™ä¸ªé“¾æ¥æ ‡è®°ä¸ºè¿‡æœŸ</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>longestCheckoutTime <span class="token operator">&gt;</span> poolMaximumCheckoutTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        state<span class="token punctuation">.</span>claimedOverdueConnectionCount<span class="token operator">++</span><span class="token punctuation">;</span>
                        state<span class="token punctuation">.</span>accumulatedCheckoutTimeOfOverdueConnections <span class="token operator">+=</span> longestCheckoutTime<span class="token punctuation">;</span>
                        state<span class="token punctuation">.</span>accumulatedCheckoutTime <span class="token operator">+=</span> longestCheckoutTime<span class="token punctuation">;</span>
                        state<span class="token punctuation">.</span>activeConnections<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>oldestActiveConnection<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldestActiveConnection<span class="token punctuation">.</span><span class="token function">getRealConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAutoCommit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            oldestActiveConnection<span class="token punctuation">.</span><span class="token function">getRealConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token comment">// åˆ æ‰æœ€è€çš„é“¾æ¥ï¼Œç„¶åé‡æ–°å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„é“¾æ¥</span>
                        conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PooledConnection</span><span class="token punctuation">(</span>oldestActiveConnection<span class="token punctuation">.</span><span class="token function">getRealConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        oldestActiveConnection<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Claimed overdue connection &quot;</span> <span class="token operator">+</span> conn<span class="token punctuation">.</span><span class="token function">getRealHashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">// å¦‚æœcheckoutè¶…æ—¶æ—¶é—´ä¸å¤Ÿé•¿ï¼Œåˆ™ç­‰å¾…</span>
                    <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>countedWait<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                state<span class="token punctuation">.</span>hadToWaitCount<span class="token operator">++</span><span class="token punctuation">;</span>
                                countedWait <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Waiting as long as &quot;</span> <span class="token operator">+</span> poolTimeToWait <span class="token operator">+</span> <span class="token string">&quot; milliseconds for connection.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">long</span> wt <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            state<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>poolTimeToWait<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            state<span class="token punctuation">.</span>accumulatedWaitTime <span class="token operator">+=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> wt<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// è·å¾—åˆ°é“¾æ¥</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>conn<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>conn<span class="token punctuation">.</span><span class="token function">getRealConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAutoCommit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        conn<span class="token punctuation">.</span><span class="token function">getRealConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    conn<span class="token punctuation">.</span><span class="token function">setConnectionTypeCode</span><span class="token punctuation">(</span><span class="token function">assembleConnectionTypeCode</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// è®°å½•checkoutæ—¶é—´</span>
                    conn<span class="token punctuation">.</span><span class="token function">setCheckoutTimestamp</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    conn<span class="token punctuation">.</span><span class="token function">setLastUsedTimestamp</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    state<span class="token punctuation">.</span>activeConnections<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    state<span class="token punctuation">.</span>requestCount<span class="token operator">++</span><span class="token punctuation">;</span>
                    state<span class="token punctuation">.</span>accumulatedRequestTime <span class="token operator">+=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;A bad connection (&quot;</span> <span class="token operator">+</span> conn<span class="token punctuation">.</span><span class="token function">getRealHashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;) was returned from the pool, getting another connection.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// å¦‚æœæ²¡æ‹¿åˆ°ï¼Œç»Ÿè®¡ä¿¡æ¯ï¼šå¤±è´¥é“¾æ¥ +1</span>
                    state<span class="token punctuation">.</span>badConnectionCount<span class="token operator">++</span><span class="token punctuation">;</span>
                    localBadConnectionCount<span class="token operator">++</span><span class="token punctuation">;</span>
                    conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token comment">// å¤±è´¥æ¬¡æ•°è¾ƒå¤šï¼ŒæŠ›å¼‚å¸¸</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>localBadConnectionCount <span class="token operator">&gt;</span> <span class="token punctuation">(</span>poolMaximumIdleConnections <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;PooledDataSource: Could not get a good connection to the database.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SQLException</span><span class="token punctuation">(</span><span class="token string">&quot;PooledDataSource: Could not get a good connection to the database.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> conn<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>popConnection è·å–é“¾æ¥æ˜¯ä¸€ä¸ª while æ­»å¾ªç¯æ“ä½œï¼Œåªæœ‰è·å–åˆ°é“¾æ¥æŠ›å¼‚å¸¸æ‰ä¼šé€€å‡ºå¾ªç¯ï¼Œå¦‚æœä»”ç»†é˜…è¯»è¿™äº›å¼‚å¸¸ä»£ç ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿæ˜¯ä½ åœ¨åšä¸€äº›å¼€å‘çš„æ—¶å€™æ‰€é‡åˆ°çš„å¼‚å¸¸å‘¢ã€‚</li><li>è·å–é“¾æ¥çš„è¿‡ç¨‹ä¼šä½¿ç”¨ synchronized è¿›è¡ŒåŠ é”ï¼Œå› ä¸ºæ‰€æœ‰çº¿ç¨‹åœ¨èµ„æºç«äº‰çš„æƒ…å†µä¸‹ï¼Œéƒ½éœ€è¦è¿›è¡ŒåŠ é”å¤„ç†ã€‚åœ¨åŠ é”çš„ä»£ç å—ä¸­é€šè¿‡åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ç©ºé—²é“¾æ¥è¿›è¡Œè¿”å›ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¼šåˆ¤æ–­æ´»è·ƒè¿æ¥æ•°æ˜¯å¦å……è¶³ï¼Œä¸å……è¶³åˆ™è¿›è¡Œåˆ›å»ºåè¿”å›ã€‚åœ¨è¿™é‡Œä¹Ÿä¼šé‡åˆ°æ´»è·ƒé“¾æ¥å·²ç»è¿›è¡Œå¾ªç¯ç­‰å¾…çš„è¿‡ç¨‹ï¼Œæœ€åå†ä¸èƒ½è·å–åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><h3 id="_4-æ•°æ®æºå·¥å‚" tabindex="-1"><a class="header-anchor" href="#_4-æ•°æ®æºå·¥å‚" aria-hidden="true">#</a> 4. æ•°æ®æºå·¥å‚</h3><p>æ•°æ®æºå·¥å‚åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯æ— æ± åŒ–å’Œæœ‰æ± åŒ–ï¼Œæœ‰æ± åŒ–çš„å·¥å‚ç»§æ‰¿æ— æ± åŒ–å·¥å‚ï¼Œå› ä¸ºåœ¨ Mybatis æºç çš„å®ç°ç±»ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘å¯¹ Properties ç»Ÿä¸€åŒ…è£…çš„åå°„æ–¹å¼çš„å±æ€§å¤„ç†ã€‚ç”±äºæˆ‘ä»¬æš‚æ—¶æ²¡æœ‰å¯¹è¿™å—é€»è¾‘è¿›è¡Œå¼€å‘ï¼Œåªæ˜¯ç®€å•çš„è·å–å±æ€§ä¼ å‚ï¼Œæ‰€ä»¥è¿˜ä¸èƒ½ä½“ç°å‡ºè¿™æ ·çš„ç»§æ‰¿æœ‰å¤šä¾¿æ·ï¼Œè¯»è€…å¯ä»¥å‚è€ƒæºç è¿›è¡Œç†è§£ã€‚æºç ç±»ï¼šUnpooledDataSourceFactory</p><h4 id="_4-1-æ— æ± åŒ–å·¥å‚" tabindex="-1"><a class="header-anchor" href="#_4-1-æ— æ± åŒ–å·¥å‚" aria-hidden="true">#</a> 4.1 æ— æ± åŒ–å·¥å‚</h4><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.datasource.unpooled.UnpooledDataSourceFactory</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnpooledDataSourceFactory</span> <span class="token keyword">implements</span> <span class="token class-name">DataSourceFactory</span> <span class="token punctuation">{</span>

    <span class="token keyword">protected</span> <span class="token class-name">Properties</span> props<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProperties</span><span class="token punctuation">(</span><span class="token class-name">Properties</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token operator">=</span> props<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UnpooledDataSource</span> unpooledDataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UnpooledDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        unpooledDataSource<span class="token punctuation">.</span><span class="token function">setDriver</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        unpooledDataSource<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        unpooledDataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        unpooledDataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> unpooledDataSource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ç®€å•åŒ…è£… getDataSource è·å–æ•°æ®æºå¤„ç†ï¼ŒæŠŠå¿…è¦çš„å‚æ•°è¿›è¡Œä¼ é€’è¿‡å»ã€‚åœ¨ Mybatis æºç ä¸­è¿™éƒ¨åˆ†åˆ™æ˜¯è¿›è¡Œäº†å¤§é‡çš„åå°„å­—æ®µå¤„ç†çš„æ–¹å¼è¿›è¡Œå­˜æ”¾å’Œè·å–çš„ã€‚</li></ul><h4 id="_4-2-æœ‰æ± åŒ–å·¥å‚" tabindex="-1"><a class="header-anchor" href="#_4-2-æœ‰æ± åŒ–å·¥å‚" aria-hidden="true">#</a> 4.2 æœ‰æ± åŒ–å·¥å‚</h4><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.datasource.pooled.PooledDataSourceFactory</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PooledDataSourceFactory</span> <span class="token keyword">extends</span> <span class="token class-name">UnpooledDataSourceFactory</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">PooledDataSource</span> pooledDataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PooledDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pooledDataSource<span class="token punctuation">.</span><span class="token function">setDriver</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pooledDataSource<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pooledDataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pooledDataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> pooledDataSource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æœ‰æ± åŒ–çš„æ•°æ®æºå·¥å‚å®ç°çš„ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåªæ˜¯ç»§æ‰¿ UnpooledDataSourceFactory å…±ç”¨è·å–å±æ€§çš„èƒ½åŠ›ï¼Œä»¥åŠå®ä¾‹åŒ–å‡ºæ± åŒ–æ•°æ®æºå³å¯ã€‚</li></ul><h3 id="_5-æ–°å¢ç±»å‹åˆ«åæ³¨å†Œå™¨" tabindex="-1"><a class="header-anchor" href="#_5-æ–°å¢ç±»å‹åˆ«åæ³¨å†Œå™¨" aria-hidden="true">#</a> 5. æ–°å¢ç±»å‹åˆ«åæ³¨å†Œå™¨</h3><p>å½“æˆ‘ä»¬æ–°å¼€å‘äº†ä¸¤ä¸ªæ•°æ®æºå’Œå¯¹åº”çš„å·¥å‚å®ç°ç±»ä»¥åï¼Œåˆ™éœ€è¦æŠŠå®ƒä»¬é…ç½®åˆ° Configuration ä¸­ï¼Œè¿™æ ·æ‰èƒ½åœ¨è§£æ XML æ—¶å€™æ ¹æ®ä¸åŒçš„æ•°æ®æºç±»å‹è·å–å’Œå®ä¾‹åŒ–å¯¹åº”çš„å®ç°ç±»ã€‚</p><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.session.Configuration</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Configuration</span> <span class="token punctuation">{</span>

    <span class="token comment">// ç±»å‹åˆ«åæ³¨å†Œæœº</span>
    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">TypeAliasRegistry</span> typeAliasRegistry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypeAliasRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        typeAliasRegistry<span class="token punctuation">.</span><span class="token function">registerAlias</span><span class="token punctuation">(</span><span class="token string">&quot;JDBC&quot;</span><span class="token punctuation">,</span> <span class="token class-name">JdbcTransactionFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        typeAliasRegistry<span class="token punctuation">.</span><span class="token function">registerAlias</span><span class="token punctuation">(</span><span class="token string">&quot;DRUID&quot;</span><span class="token punctuation">,</span> <span class="token class-name">DruidDataSourceFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        typeAliasRegistry<span class="token punctuation">.</span><span class="token function">registerAlias</span><span class="token punctuation">(</span><span class="token string">&quot;UNPOOLED&quot;</span><span class="token punctuation">,</span> <span class="token class-name">UnpooledDataSourceFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        typeAliasRegistry<span class="token punctuation">.</span><span class="token function">registerAlias</span><span class="token punctuation">(</span><span class="token string">&quot;POOLED&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PooledDataSourceFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨æ„é€ æ–¹æ³• Configuration æ·»åŠ  UNPOOLEDã€POOLED ä¸¤ä¸ªæ•°æ®æºæ³¨å†Œåˆ°ç±»å‹æ³¨å†Œå™¨ä¸­ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ XMLConfigBuilder#environmentsElement æ–¹æ³•è§£æ XML å¤„ç†æ•°æ®æºæ—¶å€™è¿›è¡Œä½¿ç”¨ã€‚</li></ul><h2 id="äº”ã€æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#äº”ã€æµ‹è¯•" aria-hidden="true">#</a> äº”ã€æµ‹è¯•</h2><h3 id="_1-äº‹å…ˆå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#_1-äº‹å…ˆå‡†å¤‡" aria-hidden="true">#</a> 1. äº‹å…ˆå‡†å¤‡</h3><h4 id="_1-1-åˆ›å»ºåº“è¡¨" tabindex="-1"><a class="header-anchor" href="#_1-1-åˆ›å»ºåº“è¡¨" aria-hidden="true">#</a> 1.1 åˆ›å»ºåº“è¡¨</h4><p>åˆ›å»ºä¸€ä¸ªæ•°æ®åº“åç§°ä¸º mybatis å¹¶åœ¨åº“ä¸­åˆ›å»ºè¡¨ user ä»¥åŠæ·»åŠ æµ‹è¯•æ•°æ®ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span>
    <span class="token keyword">USER</span>
    <span class="token punctuation">(</span>
        id <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;è‡ªå¢ID&#39;</span><span class="token punctuation">,</span>
        userId <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;ç”¨æˆ·ID&#39;</span><span class="token punctuation">,</span>
        userHead <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;ç”¨æˆ·å¤´åƒ&#39;</span><span class="token punctuation">,</span>
        createTime <span class="token keyword">TIMESTAMP</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;åˆ›å»ºæ—¶é—´&#39;</span><span class="token punctuation">,</span>
        updateTime <span class="token keyword">TIMESTAMP</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;æ›´æ–°æ—¶é—´&#39;</span><span class="token punctuation">,</span>
        userName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
    
<span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">user</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> userId<span class="token punctuation">,</span> userHead<span class="token punctuation">,</span> createTime<span class="token punctuation">,</span> updateTime<span class="token punctuation">,</span> userName<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;10001&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1_04&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;2022-04-13 00:00:00&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;2022-04-13 00:00:00&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;å°å‚…å“¥&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-2-é…ç½®æ•°æ®æº" tabindex="-1"><a class="header-anchor" href="#_1-2-é…ç½®æ•°æ®æº" aria-hidden="true">#</a> 1.2 é…ç½®æ•°æ®æº</h4><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>JDBC<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DRUID<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driver<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.mysql.jdbc.Driver<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://127.0.0.1:3306/mybatis?useUnicode=true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>é€šè¿‡ <code>mybatis-config-datasource.xml</code> é…ç½®æ•°æ®æºä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šdriverã€urlã€usernameã€password</li><li>åœ¨è¿™é‡Œ dataSource çš„é…ç½®åˆä¸Šä¸€ç« èŠ‚çš„ DRUID ä¿®æ”¹ä¸ºï¼ŒUNPOOLED å’Œ POOLED è¿›è¡Œæµ‹è¯•éªŒè¯ã€‚è¿™ä¸¤ä¸ªæ•°æ®æºä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ¬ç« èŠ‚è‡ªå·±å®ç°çš„æ•°æ®æºã€‚</li></ul><h4 id="_1-3-é…ç½®mapper" tabindex="-1"><a class="header-anchor" href="#_1-3-é…ç½®mapper" aria-hidden="true">#</a> 1.3 é…ç½®Mapper</h4><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queryUserInfoById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.Long<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.mybatis.test.po.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    SELECT id, userId, userName, userHead
    FROM user
    where id = #{id}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Mapper çš„é…ç½®å†…å®¹åœ¨ä¸Šä¸€ç« èŠ‚çš„è§£æå­¦ä¹ ä¸­å·²ç»åšäº†é…ç½®ï¼Œæœ¬ç« èŠ‚åšäº†ç®€å•çš„è°ƒæ•´ã€‚</li></ul><h3 id="_2-å•å…ƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-å•å…ƒæµ‹è¯•" aria-hidden="true">#</a> 2. å•å…ƒæµ‹è¯•</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_SqlSessionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. ä»SqlSessionFactoryä¸­è·å–SqlSession</span>
    <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsReader</span><span class="token punctuation">(</span><span class="token string">&quot;mybatis-config-datasource.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 2. è·å–æ˜ å°„å™¨å¯¹è±¡</span>
    <span class="token class-name">IUserDao</span> userDao <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">IUserDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 3. æµ‹è¯•éªŒè¯</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userDao<span class="token punctuation">.</span><span class="token function">queryUserInfoById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•ç»“æœï¼š{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨æ— æ± åŒ–å’Œæœ‰æ± åŒ–çš„æµ‹è¯•ä¸­ï¼ŒåŸºç¡€çš„å•å…ƒæµ‹è¯•ç±»ä¸éœ€è¦æ”¹å˜ï¼Œä»æ˜¯é€šè¿‡ SqlSessionFactory ä¸­è·å– SqlSession å¹¶è·å¾—æ˜ å°„å¯¹è±¡å’Œæ‰§è¡Œæ–¹æ³•è°ƒç”¨ã€‚å¦å¤–è¿™é‡Œæ˜¯æ·»åŠ äº†50æ¬¡çš„æŸ¥è¯¢è°ƒç”¨ï¼Œä¾¿äºéªŒè¯è¿æ¥æ± çš„åˆ›å»ºå’Œè·å–ä»¥åŠç­‰å¾…ã€‚</li><li>å˜åŒ–çš„åœ¨äº mybatis-config-datasource.xml ä¸­ dataSource æ•°æ®æºç±»å‹çš„è°ƒæ•´ <code>dataSource type=&quot;POOLED/UNPOOLED&quot;</code></li></ul><h4 id="_2-1-æ— æ± åŒ–æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-1-æ— æ± åŒ–æµ‹è¯•" aria-hidden="true">#</a> 2.1 æ— æ± åŒ–æµ‹è¯•</h4><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UNPOOLED<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>æµ‹è¯•ç»“æœ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">11</span><span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span><span class="token number">48.604</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span><span class="token number">48.618</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span><span class="token number">48.622</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span><span class="token number">48.632</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span><span class="token number">48.637</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span><span class="token number">48.642</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span><span class="token number">48.649</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ— æ± åŒ–çš„è¿æ¥æ± æ“ä½œï¼Œä¼šä¸æ–­çš„ä¸æ•°æ®åº“å»ºç«‹æ–°çš„é“¾æ¥å¹¶æ‰§è¡Œ SQL æ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­åªè¦æ•°æ®åº“è¿˜æœ‰é“¾æ¥å¯ä»¥è¢«é“¾æ¥ï¼Œå°±å¯ä»¥åˆ›å»ºé“¾æ¥ã€‚</li></ul><h4 id="_2-2-æœ‰æ± åŒ–æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-2-æœ‰æ± åŒ–æµ‹è¯•" aria-hidden="true">#</a> 2.2 æœ‰æ± åŒ–æµ‹è¯•</h4><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POOLED<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>æµ‹è¯•ç»“æœ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">22.536</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">PooledDataSource</span> forcefully closed<span class="token operator">/</span>removed all connections<span class="token punctuation">.</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">22.541</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">PooledDataSource</span> forcefully closed<span class="token operator">/</span>removed all connections<span class="token punctuation">.</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">22.541</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">PooledDataSource</span> forcefully closed<span class="token operator">/</span>removed all connections<span class="token punctuation">.</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">22.541</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">PooledDataSource</span> forcefully closed<span class="token operator">/</span>removed all connections<span class="token punctuation">.</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">22.860</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">Created</span> connection <span class="token number">540642172.</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">22.996</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.009</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">Created</span> connection <span class="token number">140799417.</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.011</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.018</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">Created</span> connection <span class="token number">110431793.</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.019</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.032</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">Created</span> connection <span class="token number">1053631449.</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.033</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.041</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">Created</span> connection <span class="token number">1693847660.</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.042</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.047</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">Created</span> connection <span class="token number">212921632.</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.048</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.055</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">Created</span> connection <span class="token number">682376643.</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.056</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.060</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">Created</span> connection <span class="token number">334203599.</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.062</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.067</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">Created</span> connection <span class="token number">1971851377.</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.068</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.073</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">Created</span> connection <span class="token number">399534175.</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.074</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">23.074</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">Waiting</span> as <span class="token keyword">long</span> as <span class="token number">20000</span> milliseconds <span class="token keyword">for</span> connection<span class="token punctuation">.</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">43.078</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">Claimed</span> overdue connection <span class="token number">540642172.</span>
<span class="token number">11</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">43.079</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>é€šè¿‡ä½¿ç”¨è¿æ¥æ± çš„é…ç½®å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è°ƒç”¨å’Œè·å–è¿æ¥çš„è¿‡ç¨‹ä¸­ï¼Œå½“è°ƒç”¨æ¬¡æ•°æ‰“åˆ°10æ¬¡ä»¥åï¼Œè¿æ¥æ± ä¸­å°±æœ‰äº†10ä¸ªæ´»è·ƒçš„é“¾æ¥ï¼Œå†è°ƒç”¨çš„æ—¶å€™åˆ™éœ€è¦ç­‰å¾…è¿æ¥é‡Šæ”¾åæ‰èƒ½ä½¿ç”¨å¹¶æ‰§è¡Œ SQL æ“ä½œã€‚</li><li>æµ‹è¯•çš„è¿‡ç¨‹ä¸­è¿˜åŒ…æ‹¬äº†è¿æ¥çš„ç©ºé—²æ•°é‡ã€æ´»è·ƒæ•°é‡ã€å…³é—­ã€å¼‚å¸¸ç­‰ï¼Œè¯»è€…ä¼™ä¼´ä¹Ÿå¯ä»¥åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­è¿›è¡ŒéªŒè¯å¤„ç†ã€‚</li></ul><h2 id="å…­ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#å…­ã€æ€»ç»“" aria-hidden="true">#</a> å…­ã€æ€»ç»“</h2><ul><li>æœ¬ç« èŠ‚æˆ‘ä»¬å®Œæˆäº† Mybatis æ•°æ®æºæ± åŒ–çš„è®¾è®¡å’Œå®ç°ï¼Œä¹Ÿèƒ½é€šè¿‡è¿™æ ·çš„åˆ†æã€å®ç°ã€éªŒè¯çš„è¿‡ç¨‹è®©å¤§å®¶æ›´å¥½çš„ç†è§£æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„è¿æ¥æ± æ‰€é‡åˆ°çš„ä¸€äº›çœŸå®é—®é¢˜éƒ½æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ï¼Œåšåˆ°çŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚</li><li>å¦å¤–å…³äºè¿æ¥æ± çš„å®ç°é‡ç‚¹å¯ä»¥éšç€è°ƒè¯•éªŒè¯çš„è¿‡ç¨‹ä¸­è¿›è¡Œå­¦ä¹ ï¼ŒåŒ…æ‹¬ï¼šsynchronized åŠ é”ã€åˆ›å»ºè¿æ¥ã€æ´»è·ƒæ•°é‡æ§åˆ¶ã€ä¼‘çœ ç­‰å¾…æ—¶é•¿ï¼ŒæŠ›å¼‚å¸¸é€»è¾‘ç­‰ï¼Œè¿™äº›éƒ½ä¸æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨è¿æ¥æ± æ—¶çš„é…ç½®æ¯æ¯ç›¸å…³ã€‚</li><li>è¿™ä¸€ç« èŠ‚çš„å†…å®¹å¯ä»¥ç®—ä½œæ˜¯ Mybatis æ ¸å¿ƒåŠŸèƒ½å®ç°è¿‡ç¨‹ä¸Šçš„é‡è¦åˆ†æ”¯ï¼Œè™½ç„¶å¯ä»¥ä½¿ç”¨ Druid æ›¿ä»£æ•°æ®æºçš„å¤„ç†ï¼Œä½†åªæœ‰åŠ¨æ‰‹è‡ªå·±å®ç°ä¸€éæ•°æ®æºè¿æ¥æ± æ‰èƒ½æ›´å¥½çš„ç†è§£æ± åŒ–æŠ€æœ¯çš„è½åœ°æ–¹æ¡ˆï¼Œä¹Ÿèƒ½ä¸ºä»¥ååšæ­¤ç±»åŠŸèƒ½æ—¶ï¼Œæœ‰ä¸€ä¸ªå¯è½åœ°çš„å…·ä½“æ–¹æ¡ˆã€‚</li></ul><h2 id="ä¸ƒã€ä¼˜ç§€ä½œä¸š" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€ä¼˜ç§€ä½œä¸š" aria-hidden="true">#</a> ä¸ƒã€ä¼˜ç§€ä½œä¸š</h2>`,81),q={href:"https://t.zsxq.com/05AiEAMfu",target:"_blank",rel:"noopener noreferrer"},y={href:"https://t.zsxq.com/05JUnEYrR",target:"_blank",rel:"noopener noreferrer"},h={href:"https://t.zsxq.com/05JujAQZn",target:"_blank",rel:"noopener noreferrer"},f={href:"https://t.zsxq.com/06Y7Uniia",target:"_blank",rel:"noopener noreferrer"},w={href:"https://t.zsxq.com/07KmJnHXs",target:"_blank",rel:"noopener noreferrer"},C={href:"https://t.zsxq.com/08NdOTppd",target:"_blank",rel:"noopener noreferrer"},S={href:"https://t.zsxq.com/0bOLO8aNq",target:"_blank",rel:"noopener noreferrer"};function D(_,x){const a=o("ExternalLinkIcon");return e(),c("div",null,[i,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),k,s("åšå®¢ï¼š"),n("a",r,[s("https://bugstack.cn"),t(a)]),d,s("åŸæ–‡ï¼š"),n("a",m,[s("https://mp.weixin.qq.com/s/cvW7V-wd86DV-Rzs-Fdv1w"),t(a)])]),v,b,g,n("ul",null,[n("li",null,[n("a",q,[s("æ± åŒ–è¿æ¥æ± æ‰§è¡Œè¿‡ç¨‹ @JabesYang"),t(a)])]),n("li",null,[n("a",y,[s("ä¸ºä»€ä¹ˆè¦è¿›è¡Œæ•°æ®åº“çš„æ± åŒ–å‘¢ï¼Ÿ @æ™“ä¼Ÿ"),t(a)])]),n("li",null,[n("a",h,[s("é‡æ–°è®¾ç½®æ•°æ®æºå±æ€§çš„æ—¶å€™ï¼Œå¼ºåˆ¶å…³é—­æ´»è·ƒè¿æ¥å’Œç©ºé—²è¿æ¥ @æ¬§é˜³å®‡"),t(a)])]),n("li",null,[n("a",f,[s("å®ŒæˆMybatis ä¸­è‡ªå·±çš„æ•°æ®æºå®ç°ï¼ŒåŒ…æ‹¬æ— æ± åŒ–çš„ UnpooledDataSource å®ç°æ–¹å¼å’Œæœ‰æ± åŒ–çš„ PooledDataSource å®ç°æ–¹å¼ã€‚"),t(a)])]),n("li",null,[n("a",w,[s("å®ç°Mybatisè‡ªå·±çš„æ•°æ®åº“è¿æ¥æ±  @W"),t(a)])]),n("li",null,[n("a",C,[s("æ•°æ®æºæ± åŒ–æŠ€æœ¯å®ç° @liuc"),t(a)])]),n("li",null,[n("a",S,[s("å®ç°Mybatis è‡ªå·±çš„æ•°æ®æºï¼ŒåŒ…æ‹¬æ— æ± åŒ–çš„ UnpooledDataSource å®ç°æ–¹å¼å’Œæœ‰æ± åŒ–çš„ PooledDataSource å®ç°æ–¹å¼ @å°çŒªç¢ç¢å¿µ"),t(a)])])])])}const I=p(u,[["render",D],["__file","2022-04-23-di6zhangï¼šshujuyuanchihuajishushixian.html.vue"]]);export{I as default};
