import{_ as t,r as e,o,c,a as s,b as n,d as p,e as l}from"./app-3RcBQnkC.js";const r={},i=s("h1",{id:"架构框架搭建-二-《dubbo分布式领域驱动设计架构框体》",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#架构框架搭建-二-《dubbo分布式领域驱动设计架构框体》","aria-hidden":"true"},"#"),n(" 架构框架搭建(二)《Dubbo分布式领域驱动设计架构框体》")],-1),u=s("br",null,null,-1),k={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=s("blockquote",null,[s("p",null,"沉淀、分享、成长，让自己和他人都能有所收获！😄")],-1),m=s("h2",{id:"前言介绍",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#前言介绍","aria-hidden":"true"},"#"),n(" 前言介绍")],-1),v=s("p",null,"随着项目需求的变化，或者说从小公司跳槽了互联网。需求变化了、承载的用户体量增多了，整体系统的架构也随着改变了。就像你做毕业设计的时候，可能只为了完成功能即可，一个单体的MVC结构足可以让你毕业。但！现在你长大了，为了可以承载几百、几千、几亿的用户体量，你开始发现原来还有这么多套路在里面。对于爱学习的人，肯定蠢蠢欲动的想研究研究了(不研究也写不了代码，能抗住揍不)！",-1),b={href:"https://bugstack.cn/itstack-demo-netty-3/2019/09/03/%E6%89%8B%E5%86%99RPC%E6%A1%86%E6%9E%B6%E7%AC%AC%E4%B8%89%E7%AB%A0-RPC%E4%B8%AD%E9%97%B4%E4%BB%B6.html",target:"_blank",rel:"noopener noreferrer"},g=l(`<p>本章节我们主要将Dubbo技术与DDD的架构融合，搭建出分布式架构体系。随着一点点的深入，本案例没有引入过多的过技术栈，比如；Mq、ES、分库分表等，这些会随着后续的章节陆续完善。当前章节尽可能简单的体现核心内容；</p><ul><li>分布式框架下父类文件定义，统一版本标准</li><li>RPC框架需要接口信息描述性Jar对外发布，结合领域驱动设计进行定义</li><li>尝试使用Dubbo的广播模式，进行发布和使用，简化系统调试</li><li>感受领域驱动设计的魅力，能落地才有机会使用</li></ul><p><strong>好！</strong> 那么，最后在开始之前，再问一个小问题。</p><p><strong>实现了Serializable接口的类，怎么自动生成serialVersionUID(总不能自己乱编呀)</strong></p><p>答：其实在Idea中已经提供了这样自动生成功能，只需要配置上即可；File -&gt; Settings -&gt; Editor -&gt; Inspections -&gt; 搜索 Serialization issues ，找到 Serializable class without &#39;serialVersionUID&#39; -&gt;打上勾，Apply-&gt;OK 效果如图；</p><p><img src="https://bugstack.cn/assets/images/pic-content/2019/11/itstack-demo-frame-dcs-01.png" alt="微信公众号：bugstack虫洞栈 &amp; 配置方式"></p><h2 id="工程环境" tabindex="-1"><a class="header-anchor" href="#工程环境" aria-hidden="true">#</a> 工程环境</h2><ol><li>JDK1.8</li><li>Maven 3.2.3</li><li>Spring 4.3.24.RELEASE + Mybatis 3.3.0</li><li>Mysql 5.6 + dbcp2</li><li>Dubbo 2.6.6</li><li>Redis 2.9.0</li></ol><h2 id="工程模型" tabindex="-1"><a class="header-anchor" href="#工程模型" aria-hidden="true">#</a> 工程模型</h2><blockquote><p>itstack-demo-frame-parent 父类工程</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>frame<span class="token operator">-</span>parent
├── itstack<span class="token operator">-</span>demo<span class="token operator">-</span>frame<span class="token operator">-</span>parent
│	├── src
│	│	└── main
│	│	    └── java
│	│	        └── org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>common
│	│	            ├── constants	
│	│	            │	└── <span class="token class-name">Constants</span><span class="token punctuation">.</span>java	
│	│	            └── domain
│	│	             	├── <span class="token class-name">PageRequest</span><span class="token punctuation">.</span>java
│	│	             	└── <span class="token class-name">Result</span><span class="token punctuation">.</span>java
│	└──	pom<span class="token punctuation">.</span>xml
└──	pom<span class="token punctuation">.</span>xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>itstack-demo-frame-dcs 分布式框架</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>frame<span class="token operator">-</span>dcs
├──	itstack<span class="token operator">-</span>demo<span class="token operator">-</span>frame<span class="token operator">-</span>dcs<span class="token operator">-</span>ddd
│	└── src
│		├── main
│		│   ├── java
│		│   │   └── org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo
│		│   │       ├── application	
│		│   │       │	└── <span class="token class-name">UserService</span><span class="token punctuation">.</span>java	
│		│   │       ├── domain
│		│   │       │	├── model
│		│   │       │	│   ├── aggregates
│		│   │       │	│   │   └── <span class="token class-name">UserInfoCollect</span><span class="token punctuation">.</span>java
│		│   │       │	│   ├── req
│		│   │       │	│   │   └── <span class="token class-name">UserReq</span><span class="token punctuation">.</span>java		
│		│   │       │	│   └── vo
│		│   │       │	│       └── <span class="token class-name">UserInfo</span><span class="token punctuation">.</span>java	
│		│   │       │	├── repository
│		│   │       │	│   └── <span class="token class-name">IUserRepository</span><span class="token punctuation">.</span>java	
│		│   │       │	└── service	
│		│   │       │	    └── <span class="token class-name">UserServiceImpl</span><span class="token punctuation">.</span>java	
│		│   │       ├── infrastructure
│		│   │       │	├── common
│		│   │       │	│   ├── <span class="token class-name">EasyResult</span><span class="token punctuation">.</span>java
│		│   │       │	│   └── <span class="token class-name">PageRequest</span><span class="token punctuation">.</span>java
│		│   │       │	├── dao
│		│   │       │	│   └── <span class="token class-name">IUserDao</span><span class="token punctuation">.</span>java	
│		│   │       │	├── po
│		│   │       │	│   └── <span class="token class-name">User</span><span class="token punctuation">.</span>java		
│		│   │       │	└── repository
│		│   │       │	    └── <span class="token class-name">UserRepository</span><span class="token punctuation">.</span>java	
│		│   │       └── interfaces
│		│   │        	└── <span class="token class-name">UserController</span><span class="token punctuation">.</span>java
│		│   ├── resources	
│		│   │   ├── mapper
│		│   │   ├── props	
│		│   │   ├── spring
│		│   │   ├── logback<span class="token punctuation">.</span>xml
│		│   │   ├── mybatis<span class="token operator">-</span>config<span class="token punctuation">.</span>xml
│		│   │   └── spring<span class="token operator">-</span>config<span class="token punctuation">.</span>xml
│		│   └── webapp
│		│       ├── page
│		│       ├── res
│		│       ├── <span class="token constant">WEB</span><span class="token operator">-</span><span class="token constant">INF</span>
│		│       ├── index<span class="token punctuation">.</span>html
│		│       └── res_layui<span class="token punctuation">.</span>html
│		└── test
│			└── java
│				└── org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test
│					└── <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
│					
└── itstack<span class="token operator">-</span>demo<span class="token operator">-</span>frame<span class="token operator">-</span>dcs<span class="token operator">-</span>rpc
	└── src
		└── main
		    └── java
		        └── org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>rpc
		            ├── dto	
		            │	└── <span class="token class-name">UserDto</span><span class="token punctuation">.</span>java
		            ├── req	
		            │	└── <span class="token class-name">UserReq</span><span class="token punctuation">.</span>java
		            ├── res	
		            │	└── <span class="token class-name">UserRes</span><span class="token punctuation">.</span>java	
		            └── <span class="token class-name">IUserRpc</span><span class="token punctuation">.</span>java					
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>itstack-demo-frame-dcs-test RPC测试工程</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>frame<span class="token operator">-</span>dcs<span class="token operator">-</span>test
└── src
    ├── main
    │   ├── java
    │   │   └── org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>interfaces
    │   │       └── <span class="token class-name">UserController</span><span class="token punctuation">.</span>java
    │   ├── resources		
    │   │   ├── spring
    │   │   ├── logback<span class="token punctuation">.</span>xml
    │   │   └── spring<span class="token operator">-</span>config<span class="token punctuation">.</span>xml
    │   └── webapp
    │       ├── page
    │       ├── res
    │       ├── <span class="token constant">WEB</span><span class="token operator">-</span><span class="token constant">INF</span>
    │       ├── index<span class="token punctuation">.</span>html
    │       └── res_layui<span class="token punctuation">.</span>html
    └── test
         └── java
             └── org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test
                 └── <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>以下对工程模块进行介绍，整体源码获取，可以关注公众号：bugstack虫洞栈，回复：框架搭建</strong></p><h3 id="一、父类工程" tabindex="-1"><a class="header-anchor" href="#一、父类工程" aria-hidden="true">#</a> 一、父类工程</h3><ul><li>父类工程如果没有定义也是可以工作的，但是随着系统量的增加和复杂度提高后，会越来越难以维护各个版本和升级，所以需要；</li><li>定义通用common，使各个服务工程都有统一的；异常枚举、分页类、返回对象等</li><li>定义POM配置，协调各个组件版本保持统一；减少jar冲突、维护统一版本、方便升级</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.itstack.demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>itstack-demo-frame-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.0-RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modules</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">&gt;</span></span>itstack-demo-frame-common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modules</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>itstack-demo-frame-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>itstack Demo Project Dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Base --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdk.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdk.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Spring --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.version</span><span class="token punctuation">&gt;</span></span>4.3.24.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-api.version</span><span class="token punctuation">&gt;</span></span>2.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-api.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.redis.version</span><span class="token punctuation">&gt;</span></span>1.8.4.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.redis.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- DB：mysql、mybatis--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mysql.version</span><span class="token punctuation">&gt;</span></span>5.1.20<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mysql.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mybatis.version</span><span class="token punctuation">&gt;</span></span>3.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mybatis.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mybatis_spring.version</span><span class="token punctuation">&gt;</span></span>1.2.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mybatis_spring.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- JSON --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fastjson.version</span><span class="token punctuation">&gt;</span></span>1.2.60<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fastjson.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jackson.version</span><span class="token punctuation">&gt;</span></span>2.5.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jackson.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Junit --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>junit.version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>junit.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Common --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>commons-dbcp2.version</span><span class="token punctuation">&gt;</span></span>2.6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>commons-dbcp2.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>commons-lang3.version</span><span class="token punctuation">&gt;</span></span>3.8.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>commons-lang3.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 日志 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slf4j.version</span><span class="token punctuation">&gt;</span></span>1.7.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slf4j.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logback.version</span><span class="token punctuation">&gt;</span></span>1.0.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logback.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 其他服务 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dubbo.version</span><span class="token punctuation">&gt;</span></span>2.6.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dubbo.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>zookeeper.version</span><span class="token punctuation">&gt;</span></span>3.4.14<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>zookeeper.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>netty.version</span><span class="token punctuation">&gt;</span></span>4.1.36.Final<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>netty.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>redis.version</span><span class="token punctuation">&gt;</span></span>2.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>redis.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scheduler.version</span><span class="token punctuation">&gt;</span></span>2.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scheduler.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="二、分布式框架" tabindex="-1"><a class="header-anchor" href="#二、分布式框架" aria-hidden="true">#</a> 二、分布式框架</h3><ul><li>Dubbo结合领域驱动设计，由RPC定义接口描述信息，单独出一个模块便于外部调用方进行引用</li><li>领域驱动设计方面知识已经在https://bugstack.cn提供很多思路，可以参考</li><li>整体架构模型功能定义如下；</li></ul><p><img src="https://bugstack.cn/assets/images/pic-content/2019/11/itstack-demo-frame-dcs-02.png" alt="微信公众号：bugstack虫洞栈 &amp; 分布式框架功能定义"></p><h4 id="application应用层" tabindex="-1"><a class="header-anchor" href="#application应用层" aria-hidden="true">#</a> application应用层</h4><p>应用层是比较薄的一层，不做具体逻辑开发。本工程里只包括服务的定义，具体逻辑有领域层实现。</p><blockquote><p>UserService.java &amp; 服务定义</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

    <span class="token class-name">UserInfoCollect</span> <span class="token function">queryUserInfoList</span><span class="token punctuation">(</span><span class="token class-name">UserReq</span> req<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="domain领域层" tabindex="-1"><a class="header-anchor" href="#domain领域层" aria-hidden="true">#</a> domain领域层</h4><p>领域层是整个工程的核心服务层，这里负责处理具体的核心功能，完成领域服务。domain下可以有多个领域，每个领域里包括；聚合、请求对象、业务对象、仓储、服务。</p><blockquote><p>UserServiceImpl.java &amp; 服务实现</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;userRepository&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">IUserRepository</span> userRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserInfoCollect</span> <span class="token function">queryUserInfoList</span><span class="token punctuation">(</span><span class="token class-name">UserReq</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> userRepository<span class="token punctuation">.</span><span class="token function">queryUserInfoList</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>IUserRepository.java &amp; 仓库定义</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IUserRepository</span> <span class="token punctuation">{</span>

    <span class="token class-name">UserInfoCollect</span> <span class="token function">queryUserInfoList</span><span class="token punctuation">(</span><span class="token class-name">UserReq</span> req<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="infrastructure基础层" tabindex="-1"><a class="header-anchor" href="#infrastructure基础层" aria-hidden="true">#</a> infrastructure基础层</h4><p>实现领域层仓储定义，数据库操作为非业务属性的功能操作，在仓储实现层进行组合装配DAO&amp;Redis&amp;Cache等。</p><blockquote><p>UserDBRepository.java &amp; 仓库实现</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span><span class="token punctuation">(</span><span class="token string">&quot;userDBRepository&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDBRepository</span> <span class="token keyword">implements</span> <span class="token class-name">IUserRepository</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">IUserDao</span> userDao<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">Redis</span> redis<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserInfoCollect</span> <span class="token function">queryUserInfoList</span><span class="token punctuation">(</span><span class="token class-name">UserReq</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Long</span> count <span class="token operator">=</span> userDao<span class="token punctuation">.</span><span class="token function">queryUserInfoCount</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userList <span class="token operator">=</span> userDao<span class="token punctuation">.</span><span class="token function">queryUserInfoList</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> userInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>user <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userInfo<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userInfo<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userInfo<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userInfo<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userInfo<span class="token punctuation">.</span><span class="token function">setEntryTime</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getEntryTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userInfo<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userInfoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UserInfoCollect</span> userInfoCollect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfoCollect</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> userInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNoneBlank</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            redis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>userInfoCollect<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> userInfoCollect<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="interfaces接口层" tabindex="-1"><a class="header-anchor" href="#interfaces接口层" aria-hidden="true">#</a> interfaces接口层</h4><ul><li>实现rpc定义接口对外提供api，目前这一层比较简单只需要进行接口使用即可</li><li>如果是对外部提供服务接口，那么可以使用DTO方式进行转换，避免污染到业务类</li><li>assembler 是对DTO对象的转换类，可以封装的更加精致一些</li></ul><blockquote><p>UserRpc.java &amp; RPC接口实现</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">&quot;userRpc&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserRpc</span> <span class="token keyword">implements</span> <span class="token class-name">IUserRpc</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserRes</span> <span class="token function">queryUserInfoList</span><span class="token punctuation">(</span><span class="token class-name">UserReq</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserInfoCollect</span> userInfoCollect <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">queryUserInfoList</span><span class="token punctuation">(</span><span class="token class-name">UserAssembler</span><span class="token punctuation">.</span><span class="token function">buildUserReq</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">UserAssembler</span><span class="token punctuation">.</span><span class="token function">buildUserInfoCollect</span><span class="token punctuation">(</span>userInfoCollect<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="rpc对外提供服务层" tabindex="-1"><a class="header-anchor" href="#rpc对外提供服务层" aria-hidden="true">#</a> rpc对外提供服务层</h4><p>服务接口定义，rpc框架需要对外提供接口描述jar包，因此单独提取出来是最方面处理的。不要让这一层引用其他层的逻辑代码。</p><blockquote><p>IUserRpc.java &amp; 接口定义</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IUserRpc</span> <span class="token punctuation">{</span>

    <span class="token class-name">UserRes</span> <span class="token function">queryUserInfoList</span><span class="token punctuation">(</span><span class="token class-name">UserReq</span> req<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="父类配置" tabindex="-1"><a class="header-anchor" href="#父类配置" aria-hidden="true">#</a> 父类配置</h4><p>这一层是整个工程的最外层POM文件，引入父类的定义配置</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>project xmlns<span class="token operator">=</span><span class="token string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
         xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span><span class="token string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>modelVersion<span class="token punctuation">&gt;</span></span><span class="token number">4.0</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>modelVersion<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 框架统一服务定义 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>parent<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>frame<span class="token operator">-</span>parent<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.0</span><span class="token number">.0</span><span class="token operator">-</span><span class="token constant">RELEASE</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>parent<span class="token operator">&gt;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>frame<span class="token operator">-</span>dcs<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>packaging<span class="token punctuation">&gt;</span></span>pom<span class="token operator">&lt;</span><span class="token operator">/</span>packaging<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.0</span><span class="token number">.0</span><span class="token operator">-</span><span class="token constant">SNAPSHOT</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
    
    <span class="token generics"><span class="token punctuation">&lt;</span>modules<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span><span class="token keyword">module</span><span class="token punctuation">&gt;</span></span>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>frame<span class="token operator">-</span>dcs<span class="token operator">-</span>ddd<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">module</span><span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span><span class="token keyword">module</span><span class="token punctuation">&gt;</span></span>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>frame<span class="token operator">-</span>dcs<span class="token operator">-</span>rpc<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">module</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>modules<span class="token operator">&gt;</span>
	
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	
<span class="token operator">&lt;</span><span class="token operator">/</span>project<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="dubbo配置信息" tabindex="-1"><a class="header-anchor" href="#dubbo配置信息" aria-hidden="true">#</a> Dubbo配置信息</h4><ul><li>dubbo 2.6.x 版本可以使用广播方式进行服务暴漏，也就省去了zookeeper注册中心。对于一些中小服务来言，就更加方便了。</li><li>广播地址：address=&quot;multicast://224.5.6.7:1234&quot;</li><li>Netty服务端的端口：&lt;dubbo:protocol name=&quot;dubbo&quot; port=&quot;20880&quot;/&gt;</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">&quot;http://www.springframework.org/schema/beans&quot;</span>
       xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       xmlns<span class="token operator">:</span>dubbo<span class="token operator">=</span><span class="token string">&quot;http://dubbo.apache.org/schema/dubbo&quot;</span>
       xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span>&quot;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans
       http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans<span class="token operator">/</span>spring<span class="token operator">-</span>beans<span class="token operator">-</span><span class="token number">4.3</span><span class="token punctuation">.</span>xsd
       http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>dubbo<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>dubbo
       http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>dubbo<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>dubbo<span class="token operator">/</span>dubbo<span class="token punctuation">.</span>xsd&quot;<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 提供方应用信息，用于计算依赖关系 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>dubbo<span class="token operator">:</span>application name<span class="token operator">=</span><span class="token string">&quot;itstack-demo-frame-dcs&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 使用multicast广播注册中心暴露服务地址 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>dubbo<span class="token operator">:</span>registry address<span class="token operator">=</span><span class="token string">&quot;multicast://224.5.6.7:1234&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 用dubbo协议在<span class="token number">20880</span>端口暴露服务 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>dubbo<span class="token operator">:</span>protocol name<span class="token operator">=</span><span class="token string">&quot;dubbo&quot;</span> port<span class="token operator">=</span><span class="token string">&quot;20880&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 声明需要暴露的服务接口 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>dubbo<span class="token operator">:</span>service <span class="token keyword">interface</span><span class="token operator">=</span><span class="token string">&quot;org.itstack.demo.rpc.IUserRpc&quot;</span> ref<span class="token operator">=</span><span class="token string">&quot;userRpc&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="数据库表配置-itstack-sql" tabindex="-1"><a class="header-anchor" href="#数据库表配置-itstack-sql" aria-hidden="true">#</a> 数据库表配置(itstack.sql)</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token constant">DROP</span> <span class="token class-name">TABLE</span> user<span class="token punctuation">;</span>
<span class="token constant">CREATE</span> <span class="token class-name">TABLE</span> user <span class="token punctuation">(</span> id <span class="token function">bigint</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token class-name">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span> name <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> age <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> address <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span> entryTime datetime<span class="token punctuation">,</span> remark <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> createTime datetime<span class="token punctuation">,</span> updateTime datetime<span class="token punctuation">,</span> status <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token constant">DEFAULT</span> <span class="token char">&#39;0&#39;</span><span class="token punctuation">,</span> <span class="token class-name">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">INDEX</span> idx_name <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token constant">ENGINE</span><span class="token operator">=</span><span class="token class-name">InnoDB</span> <span class="token class-name">DEFAULT</span> <span class="token constant">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
insert into user <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> address<span class="token punctuation">,</span> entryTime<span class="token punctuation">,</span> remark<span class="token punctuation">,</span> createTime<span class="token punctuation">,</span> updateTime<span class="token punctuation">,</span> status<span class="token punctuation">)</span> values <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token char">&#39;水水&#39;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> &#39;吉林省榆树市黑林镇尹家村<span class="token number">5</span>组<span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token char">&#39;, &#39;</span>无<span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span>&#39;<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
insert into user <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> address<span class="token punctuation">,</span> entryTime<span class="token punctuation">,</span> remark<span class="token punctuation">,</span> createTime<span class="token punctuation">,</span> updateTime<span class="token punctuation">,</span> status<span class="token punctuation">)</span> values <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token char">&#39;豆豆&#39;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> &#39;辽宁省大连市清河湾司马道<span class="token number">407</span>路<span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token char">&#39;, &#39;</span>无<span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span>&#39;<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
insert into user <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> address<span class="token punctuation">,</span> entryTime<span class="token punctuation">,</span> remark<span class="token punctuation">,</span> createTime<span class="token punctuation">,</span> updateTime<span class="token punctuation">,</span> status<span class="token punctuation">)</span> values <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token char">&#39;花花&#39;</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> &#39;辽宁省大连市清河湾司马道<span class="token number">407</span>路<span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token char">&#39;, &#39;</span>无<span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span>&#39;<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="三、rpc测试工程" tabindex="-1"><a class="header-anchor" href="#三、rpc测试工程" aria-hidden="true">#</a> 三、RPC测试工程</h3><p>这一层就很简单了，添加好dubbo配置，引用RPC接口定义POM，调用服务端接口返回数据即可</p><blockquote><p>pom.xml 引用RPC定义接口</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>frame<span class="token operator">-</span>dcs<span class="token operator">-</span>rpc<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.0</span><span class="token number">.0</span><span class="token operator">-</span><span class="token constant">SNAPSHOT</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>spring-config-dubbo-consumer.xml &amp; dubbo配置</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">&quot;http://www.springframework.org/schema/beans&quot;</span>
       xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       xmlns<span class="token operator">:</span>dubbo<span class="token operator">=</span><span class="token string">&quot;http://dubbo.apache.org/schema/dubbo&quot;</span>
       xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span><span class="token string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans-4.3.xsd        http://dubbo.apache.org/schema/dubbo        http://dubbo.apache.org/schema/dubbo/dubbo.xsd&quot;</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 消费方应用名，用于计算依赖关系，不是匹配条件，不要与提供方一样 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>dubbo<span class="token operator">:</span>application name<span class="token operator">=</span><span class="token string">&quot;itstack-demo-frame-dcs-test&quot;</span>  <span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 使用multicast广播注册中心暴露发现服务地址 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>dubbo<span class="token operator">:</span>registry address<span class="token operator">=</span><span class="token string">&quot;multicast://224.5.6.7:1234&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 生成远程服务代理，可以和本地bean一样使用demoService <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>dubbo<span class="token operator">:</span>reference id<span class="token operator">=</span><span class="token string">&quot;userRpc&quot;</span> <span class="token keyword">interface</span><span class="token operator">=</span><span class="token string">&quot;org.itstack.demo.rpc.IUserRpc&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ApiTest.java &amp; 单元测试类</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:spring-config.xml&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApiTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ApiTest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">IUserRpc</span> userRpc<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_queryUserInfoList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserReq</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserReq</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        req<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;豆豆&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        req<span class="token punctuation">.</span><span class="token function">setPage</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UserRes</span> res <span class="token operator">=</span> userRpc<span class="token punctuation">.</span><span class="token function">queryUserInfoList</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;\\r\\n测试结果 req：{} res：{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="测试验证" tabindex="-1"><a class="header-anchor" href="#测试验证" aria-hidden="true">#</a> 测试验证</h2><ol><li>启动Redis配置服务(可以下载win版本)，因为本案例使用到Redis。</li><li>tomcat中启动itstack-demo-frame-dcs</li><li>启动单元测试调用itstack-demo-frame-dcs-test</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">29</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">20</span><span class="token operator">:</span><span class="token number">43.268</span> <span class="token punctuation">[</span><span class="token class-name">DubboMulticastRegistryReceiver</span><span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>registry<span class="token punctuation">.</span>multicast<span class="token punctuation">.</span></span>MulticastRegistry</span><span class="token punctuation">[</span><span class="token number">387</span><span class="token punctuation">]</span> <span class="token operator">-</span>  <span class="token punctuation">[</span><span class="token constant">DUBBO</span><span class="token punctuation">]</span> <span class="token class-name">Notify</span> urls <span class="token keyword">for</span> subscribe url consumer<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">/</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span></span>IUserRpc</span><span class="token operator">?</span>application<span class="token operator">=</span>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>frame<span class="token operator">-</span>dcs<span class="token operator">-</span>test<span class="token operator">&amp;</span>category<span class="token operator">=</span>providers<span class="token punctuation">,</span>configurators<span class="token punctuation">,</span>routers<span class="token operator">&amp;</span>dubbo<span class="token operator">=</span><span class="token number">2.0</span><span class="token number">.2</span><span class="token operator">&amp;</span><span class="token keyword">interface</span><span class="token operator">=</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span></span>IUserRpc</span><span class="token operator">&amp;</span>methods<span class="token operator">=</span>queryUserInfoList<span class="token operator">&amp;</span>pid<span class="token operator">=</span><span class="token number">14416</span><span class="token operator">&amp;</span>revision<span class="token operator">=</span><span class="token number">1.0</span><span class="token number">.0</span><span class="token operator">-</span><span class="token constant">SNAPSHOT</span><span class="token operator">&amp;</span>side<span class="token operator">=</span>consumer<span class="token operator">&amp;</span>timestamp<span class="token operator">=</span><span class="token number">1577582442523</span><span class="token punctuation">,</span> urls<span class="token operator">:</span> <span class="token punctuation">[</span>dubbo<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">20880</span><span class="token operator">/</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span></span>IUserRpc</span><span class="token operator">?</span>anyhost<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">&amp;</span>application<span class="token operator">=</span>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>frame<span class="token operator">-</span>dcs<span class="token operator">&amp;</span>bean<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span></span>IUserRpc</span><span class="token operator">&amp;</span>dubbo<span class="token operator">=</span><span class="token number">2.0</span><span class="token number">.2</span><span class="token operator">&amp;</span>generic<span class="token operator">=</span><span class="token boolean">false</span><span class="token operator">&amp;</span><span class="token keyword">interface</span><span class="token operator">=</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span></span>IUserRpc</span><span class="token operator">&amp;</span>methods<span class="token operator">=</span>queryUserInfoList<span class="token operator">&amp;</span>pid<span class="token operator">=</span><span class="token number">15048</span><span class="token operator">&amp;</span>revision<span class="token operator">=</span><span class="token number">1.0</span><span class="token number">.0</span><span class="token operator">-</span><span class="token constant">SNAPSHOT</span><span class="token operator">&amp;</span>side<span class="token operator">=</span>provider<span class="token operator">&amp;</span>timestamp<span class="token operator">=</span><span class="token number">1577582403854</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dubbo version<span class="token operator">:</span> <span class="token number">2.6</span><span class="token number">.6</span><span class="token punctuation">,</span> current host<span class="token operator">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">29</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">20</span><span class="token operator">:</span><span class="token number">43.397</span> <span class="token punctuation">[</span><span class="token class-name">DubboMulticastRegistryReceiver</span><span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>remoting<span class="token punctuation">.</span>transport<span class="token punctuation">.</span></span>AbstractClient</span><span class="token punctuation">[</span><span class="token number">282</span><span class="token punctuation">]</span> <span class="token operator">-</span>  <span class="token punctuation">[</span><span class="token constant">DUBBO</span><span class="token punctuation">]</span> <span class="token class-name">Successed</span> connect <span class="token keyword">to</span> <span class="token namespace">server</span> <span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">20880</span> from <span class="token class-name">NettyClient</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> using dubbo version <span class="token number">2.6</span><span class="token number">.6</span><span class="token punctuation">,</span> channel is <span class="token class-name">NettyChannel</span> <span class="token punctuation">[</span>channel<span class="token operator">=</span><span class="token punctuation">[</span>id<span class="token operator">:</span> <span class="token number">0x82d694ae</span><span class="token punctuation">,</span> <span class="token class-name">L</span><span class="token operator">:</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">65193</span> <span class="token operator">-</span> <span class="token class-name">R</span><span class="token operator">:</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">20880</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dubbo version<span class="token operator">:</span> <span class="token number">2.6</span><span class="token number">.6</span><span class="token punctuation">,</span> current host<span class="token operator">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">29</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">20</span><span class="token operator">:</span><span class="token number">43.398</span> <span class="token punctuation">[</span><span class="token class-name">DubboMulticastRegistryReceiver</span><span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>remoting<span class="token punctuation">.</span>transport<span class="token punctuation">.</span></span>AbstractClient</span><span class="token punctuation">[</span><span class="token number">91</span><span class="token punctuation">]</span> <span class="token operator">-</span>  <span class="token punctuation">[</span><span class="token constant">DUBBO</span><span class="token punctuation">]</span> <span class="token class-name">Start</span> <span class="token class-name">NettyClient</span> <span class="token constant">JRA1W11T0247</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> connect <span class="token keyword">to</span> <span class="token namespace">the</span> server <span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">20880</span><span class="token punctuation">,</span> dubbo version<span class="token operator">:</span> <span class="token number">2.6</span><span class="token number">.6</span><span class="token punctuation">,</span> current host<span class="token operator">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">29</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">20</span><span class="token operator">:</span><span class="token number">43.449</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>registry<span class="token punctuation">.</span>multicast<span class="token punctuation">.</span></span>MulticastRegistry</span><span class="token punctuation">[</span><span class="token number">387</span><span class="token punctuation">]</span> <span class="token operator">-</span>  <span class="token punctuation">[</span><span class="token constant">DUBBO</span><span class="token punctuation">]</span> <span class="token class-name">Notify</span> urls <span class="token keyword">for</span> subscribe url consumer<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">/</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span></span>IUserRpc</span><span class="token operator">?</span>application<span class="token operator">=</span>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>frame<span class="token operator">-</span>dcs<span class="token operator">-</span>test<span class="token operator">&amp;</span>category<span class="token operator">=</span>providers<span class="token punctuation">,</span>configurators<span class="token punctuation">,</span>routers<span class="token operator">&amp;</span>dubbo<span class="token operator">=</span><span class="token number">2.0</span><span class="token number">.2</span><span class="token operator">&amp;</span><span class="token keyword">interface</span><span class="token operator">=</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span></span>IUserRpc</span><span class="token operator">&amp;</span>methods<span class="token operator">=</span>queryUserInfoList<span class="token operator">&amp;</span>pid<span class="token operator">=</span><span class="token number">14416</span><span class="token operator">&amp;</span>revision<span class="token operator">=</span><span class="token number">1.0</span><span class="token number">.0</span><span class="token operator">-</span><span class="token constant">SNAPSHOT</span><span class="token operator">&amp;</span>side<span class="token operator">=</span>consumer<span class="token operator">&amp;</span>timestamp<span class="token operator">=</span><span class="token number">1577582442523</span><span class="token punctuation">,</span> urls<span class="token operator">:</span> <span class="token punctuation">[</span>dubbo<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">20880</span><span class="token operator">/</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span></span>IUserRpc</span><span class="token operator">?</span>anyhost<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">&amp;</span>application<span class="token operator">=</span>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>frame<span class="token operator">-</span>dcs<span class="token operator">&amp;</span>bean<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span></span>IUserRpc</span><span class="token operator">&amp;</span>dubbo<span class="token operator">=</span><span class="token number">2.0</span><span class="token number">.2</span><span class="token operator">&amp;</span>generic<span class="token operator">=</span><span class="token boolean">false</span><span class="token operator">&amp;</span><span class="token keyword">interface</span><span class="token operator">=</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span></span>IUserRpc</span><span class="token operator">&amp;</span>methods<span class="token operator">=</span>queryUserInfoList<span class="token operator">&amp;</span>pid<span class="token operator">=</span><span class="token number">15048</span><span class="token operator">&amp;</span>revision<span class="token operator">=</span><span class="token number">1.0</span><span class="token number">.0</span><span class="token operator">-</span><span class="token constant">SNAPSHOT</span><span class="token operator">&amp;</span>side<span class="token operator">=</span>provider<span class="token operator">&amp;</span>timestamp<span class="token operator">=</span><span class="token number">1577582403854</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dubbo version<span class="token operator">:</span> <span class="token number">2.6</span><span class="token number">.6</span><span class="token punctuation">,</span> current host<span class="token operator">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">29</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">20</span><span class="token operator">:</span><span class="token number">43.454</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span>AbstractConfig</span><span class="token punctuation">[</span><span class="token number">429</span><span class="token punctuation">]</span> <span class="token operator">-</span>  <span class="token punctuation">[</span><span class="token constant">DUBBO</span><span class="token punctuation">]</span> <span class="token class-name">Refer</span> dubbo service <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span></span>IUserRpc</span> from url multicast<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">224.5</span><span class="token number">.6</span><span class="token number">.7</span><span class="token operator">:</span><span class="token number">1234</span><span class="token operator">/</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>registry<span class="token punctuation">.</span></span>RegistryService</span><span class="token operator">?</span>anyhost<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">&amp;</span>application<span class="token operator">=</span>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>frame<span class="token operator">-</span>dcs<span class="token operator">-</span>test<span class="token operator">&amp;</span>bean<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span></span>IUserRpc</span><span class="token operator">&amp;</span>check<span class="token operator">=</span><span class="token boolean">false</span><span class="token operator">&amp;</span>dubbo<span class="token operator">=</span><span class="token number">2.0</span><span class="token number">.2</span><span class="token operator">&amp;</span>generic<span class="token operator">=</span><span class="token boolean">false</span><span class="token operator">&amp;</span><span class="token keyword">interface</span><span class="token operator">=</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span></span>IUserRpc</span><span class="token operator">&amp;</span>methods<span class="token operator">=</span>queryUserInfoList<span class="token operator">&amp;</span>pid<span class="token operator">=</span><span class="token number">14416</span><span class="token operator">&amp;</span>register<span class="token punctuation">.</span>ip<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">&amp;</span>remote<span class="token punctuation">.</span>timestamp<span class="token operator">=</span><span class="token number">1577582403854</span><span class="token operator">&amp;</span>revision<span class="token operator">=</span><span class="token number">1.0</span><span class="token number">.0</span><span class="token operator">-</span><span class="token constant">SNAPSHOT</span><span class="token operator">&amp;</span>side<span class="token operator">=</span>consumer<span class="token operator">&amp;</span>timestamp<span class="token operator">=</span><span class="token number">1577582442523</span><span class="token punctuation">,</span> dubbo version<span class="token operator">:</span> <span class="token number">2.6</span><span class="token number">.6</span><span class="token punctuation">,</span> current host<span class="token operator">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
十二月 <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">2019</span> <span class="token number">9</span><span class="token operator">:</span><span class="token number">20</span><span class="token operator">:</span><span class="token number">43</span> 上午 <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>mvc<span class="token punctuation">.</span>method<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>RequestMappingHandlerMapping</span> register
信息<span class="token operator">:</span> <span class="token class-name">Mapped</span> <span class="token string">&quot;{[/api/user/queryUserInfoList],methods=[GET]}&quot;</span> onto <span class="token keyword">public</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>res<span class="token punctuation">.</span></span>UserRes</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>controller<span class="token punctuation">.</span></span>UserController</span><span class="token punctuation">.</span><span class="token function">queryUserInfoList</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">)</span>
十二月 <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">2019</span> <span class="token number">9</span><span class="token operator">:</span><span class="token number">20</span><span class="token operator">:</span><span class="token number">43</span> 上午 <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>mvc<span class="token punctuation">.</span>method<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>RequestMappingHandlerAdapter</span> initControllerAdviceCache
信息<span class="token operator">:</span> <span class="token class-name">Looking</span> <span class="token keyword">for</span> <span class="token annotation punctuation">@ControllerAdvice</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>GenericApplicationContext</span><span class="token annotation punctuation">@4f51b3e0</span><span class="token operator">:</span> startup date <span class="token punctuation">[</span><span class="token class-name">Sun</span> <span class="token class-name">Dec</span> <span class="token number">29</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">20</span><span class="token operator">:</span><span class="token number">41</span> <span class="token constant">CST</span> <span class="token number">2019</span><span class="token punctuation">]</span><span class="token punctuation">;</span> root of context hierarchy
十二月 <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">2019</span> <span class="token number">9</span><span class="token operator">:</span><span class="token number">20</span><span class="token operator">:</span><span class="token number">43</span> 上午 <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>mvc<span class="token punctuation">.</span>method<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>RequestMappingHandlerAdapter</span> initControllerAdviceCache
信息<span class="token operator">:</span> <span class="token class-name">Looking</span> <span class="token keyword">for</span> <span class="token annotation punctuation">@ControllerAdvice</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>GenericApplicationContext</span><span class="token annotation punctuation">@4f51b3e0</span><span class="token operator">:</span> startup date <span class="token punctuation">[</span><span class="token class-name">Sun</span> <span class="token class-name">Dec</span> <span class="token number">29</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">20</span><span class="token operator">:</span><span class="token number">41</span> <span class="token constant">CST</span> <span class="token number">2019</span><span class="token punctuation">]</span><span class="token punctuation">;</span> root of context hierarchy
十二月 <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">2019</span> <span class="token number">9</span><span class="token operator">:</span><span class="token number">20</span><span class="token operator">:</span><span class="token number">44</span> 上午 <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>handler<span class="token punctuation">.</span></span>SimpleUrlHandlerMapping</span> registerHandler
信息<span class="token operator">:</span> <span class="token class-name">Mapped</span> <span class="token constant">URL</span> path <span class="token punctuation">[</span><span class="token doc-comment comment">/**] onto handler &#39;org.springframework.web.servlet.resource.DefaultServletHttpRequestHandler#0&#39;
2019-12-29 09:20:45.157 [main] INFO  org.itstack.demo.test.ApiTest[31] - 
测试结果 req：<span class="token punctuation">{</span>&quot;name&quot;:&quot;豆豆&quot;,&quot;pageEnd&quot;:5,&quot;pageStart&quot;:0<span class="token punctuation">}</span> res：<span class="token punctuation">{</span>&quot;count&quot;:1,&quot;list&quot;:[<span class="token punctuation">{</span>&quot;name&quot;:&quot;豆豆&quot;,&quot;status&quot;:1<span class="token punctuation">}</span>],&quot;result&quot;:<span class="token punctuation">{</span>&quot;code&quot;:&quot;0000&quot;,&quot;info&quot;:&quot;成功&quot;<span class="token punctuation">}</span><span class="token punctuation">}</span>
十二月 29, 2019 9:20:45 上午 org.springframework.context.support.GenericApplicationContext doClose
信息: Closing org.springframework.context.support.GenericApplicationContext@4f51b3e0: startup date [Sun Dec 29 09:20:41 CST 2019]; root of context hierarchy
2019-12-29 09:20:45.159 [DubboShutdownHook] INFO  com.alibaba.dubbo.config.DubboShutdownHook[56] -  [DUBBO] Run shutdown hook now., dubbo version: 2.6.6, current host: 127.0.0.1
2019-12-29 09:20:45.160 [Thread-1] INFO  com.alibaba.dubbo.registry.support.AbstractRegistryFactory[64] -  [DUBBO] Close all registries [multicast://224.5.6.7:1234/com.alibaba.dubbo.registry.RegistryService?application=itstack-demo-frame-dcs-test&amp;dubbo=2.0.2&amp;interface=com.alibaba.dubbo.registry.RegistryService&amp;pid=14416&amp;timestamp=1577582442547], dubbo version: 2.6.6, current host: 127.0.0.1
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="综上总结" tabindex="-1"><a class="header-anchor" href="#综上总结" aria-hidden="true">#</a> 综上总结</h2><ul><li>平常这种框架的开发可能也很多，但是往往不总结沉淀下来，也就没有办法从全局去学习。学会的只是开发功能，肯定满足不了你的成长快乐！</li><li>当DDD集合dubbo后，我也想过试图将四层分为四个模块开发。但是每一层衔接定义实现，会导致循环引用，除非改变整体的结构。但如果改变了就不太符合目前的DDD了，又是贫血模型。</li><li>架构的学习还是需要从多种架构模式中吸取营养，好的架构会让整个开发都变得舒服顺畅，如果总是在一坨一坨的东西里开发，日久生情就危险了！（巧克力味的shi，和shi味的巧克力你吃哪个）</li></ul>`,65);function h(f,q){const a=e("ExternalLinkIcon");return o(),c("div",null,[i,s("p",null,[n("作者：小傅哥 "),u,n("博客："),s("a",k,[n("https://bugstack.cn"),p(a)])]),d,m,v,s("p",null,[n("在我们的技术栈中RPC框架有；Dubbo、Motan、Tars、gRPC等等，而且每个公司可能还有自己的RPC，如果想深入了解那么可以参照《"),s("a",b,[n("手写RPC框架第三章《RPC中间件》"),p(a)]),n("》。对于一个程序猿来说还是要从多家的框架中吸取营养，精进技术。")]),g])}const w=t(r,[["render",h],["__file","2019-12-31-jiagoukuangjiadajianer《Dubbofenbushilingyuqudongshejijiagoukuangti》.html.vue"]]);export{w as default};
