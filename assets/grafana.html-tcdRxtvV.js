import{_ as p,r as o,o as c,c as i,a as n,b as a,d as e,e as t}from"./app-3RcBQnkC.js";const l={},r=n("h1",{id:"prometheus-grafana-ç›‘æ§-éªŒè¯-hystrix-è¶…æ—¶ç†”æ–­",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#prometheus-grafana-ç›‘æ§-éªŒè¯-hystrix-è¶…æ—¶ç†”æ–­","aria-hidden":"true"},"#"),a(" Prometheus + Grafana ç›‘æ§ï¼ŒéªŒè¯ Hystrix è¶…æ—¶ç†”æ–­")],-1),u={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=n("blockquote",null,[n("p",null,"æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„")],-1),k=n("iframe",{id:"B-Video",src:"//player.bilibili.com/player.html?aid=919588155&bvid=BV1iu4y1G7VQ&cid=1361583047&p=1",scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",width:"100%",height:"480"}," ",-1),m=n("p",null,"æœ¬æ–‡çš„å®—æ—¨åœ¨äºé€šè¿‡ç®€å•å¹²å‡€å®è·µçš„æ–¹å¼æ•™ä¼šè¯»è€…ï¼Œä½¿ç”¨ Prometheus + Grafana éƒ¨ç½²ç›‘æ§ï¼ŒåŒæ—¶ç»“åˆç›‘æ§äº†è§£åˆ°ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨ Hystrix å¯¹æ¥å£è¿›è¡Œè¶…æ—¶ç†”æ–­å¤„ç†ã€‚",-1),v=n("p",null,"å¾ˆå¤šä¼™ä¼´åœ¨é¢è¯•çš„æ—¶å€™ï¼Œéƒ½å¯èƒ½ä¼šè¢«é—®åˆ°ï¼›ä½ çš„åº”ç”¨æ¥å£å“åº”æ—¶é—´å¤šå°‘ï¼ŒTomcat é…ç½®äº†å¤šå°‘è¿æ¥æ•°ï¼Œå¦‚æœæ¥å£è¶…æ—¶äº†æ€ä¹ˆåŠï¼Œä¼šä¸ä¼šæŠŠæœåŠ¡æ‹–å®ã€‚é‚£ä¼šä¸ä¼šå‘¢ï¼Œå…¶å®ä¼šçš„ï¼Œå¯¹äºä¸€äº›æ¥å£ä¸ç¨³å®šå®¹æ˜“è¶…æ—¶ä½†åˆä¸ç†”æ–­çš„æ¥å£ï¼Œåœ¨ç”¨æˆ·å¤§é‡è¯·æ±‚çš„æƒ…å†µä¸‹ï¼Œæ˜¯å¾ˆå®¹æ˜“æŠŠTomcatè¿æ¥æ•°æ‰“æ»¡ï¼Œç›´è‡³æ‹–å®æ•´ä¸ªæœåŠ¡ï¼Œè®©æœåŠ¡çš„ä»»ä½•æ¥å£éƒ½æ²¡æœ‰å“åº”ã€‚æ‰€ä»¥æœ¬èŠ‚å°å‚…å“¥ä¼šå¸¦ç€å¤§å®¶ï¼Œæ¥æ¨¡æ‹Ÿè¿™æ ·çš„åœºæ™¯ï¼Œè®©å¤§å®¶å­¦ä¹ ä¸‹ã€‚",-1),h=n("p",null,"æœ¬æ–‡æ¶‰åŠçš„å·¥ç¨‹ï¼š",-1),b={href:"https://gitcode.net/KnowledgePlanet/road-map/xfg-dev-tech-grafana",target:"_blank",rel:"noopener noreferrer"},g=n("code",null,"æµ‹è¯•å·¥ç¨‹ã€ç›‘æ§Dockerå®‰è£…è„šæœ¬ã€Grafanaç›‘æ§é¢æ¿é…ç½®JSON",-1),f=t(`<h2 id="ä¸€ã€ä½ æ˜¯æ€ä¹ˆæŒ‚çš„" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€ä½ æ˜¯æ€ä¹ˆæŒ‚çš„" aria-hidden="true">#</a> ä¸€ã€ä½ æ˜¯æ€ä¹ˆæŒ‚çš„ï¼Ÿ</h2><p>Tomcat å¯åˆ†é…çš„è¿æ¥æ•°å°±åƒå•æ‰€çš„å‘ä½ï¼Œä¸€å †ç”¨æˆ·æ¥ä¸Šå¤§å·ã€‚æœ¬æ¥4ä¸ªå‘ä½ä¹Ÿå¤Ÿç”¨äº†ï¼Œå› ä¸ºç”¨æˆ·æ¥äº†ä¹Ÿå¯ä»¥å¿«é€Ÿé‡Šæ”¾è¯·æ±‚ï¼Œä¸ä¼šé•¿æ—¶é—´å ç”¨ã€‚ä½†çªç„¶æœ‰è¿™ä¹ˆä¸€å¤©ï¼Œç”¨æˆ·éƒ½æ‹‰è‚šå­ï¼Œä¸€ä¸ªè¿›å»å°±1ä¸ªå°æ—¶å€™ï¼Œå…¶ä½™äººéƒ½æ’é˜Ÿã€‚æœ€åç»™å‹å®äº†ï¼</p><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/road-map-grafana-01.png?raw=true" width="550px"></div><p>é‚£æ˜¯ä¸æ˜¯ï¼Œå¢åŠ äº†è¿æ¥æ•°(WC æ›´å¤šçš„å‘ä½å°±å¥½äº†å‘¢)ï¼Œå…¶å®ä¹Ÿå¥½ä¸å“ªå»ï¼Œä½ æ€»ä¸èƒ½ç»™æ‰€æœ‰çš„ç”¨æˆ·éƒ½å»ºä¸€ä¸ªå‘ä½ï¼Œè€Œä¸”å‘ä½è¶Šå¤šï¼Œè·ç¦»ä¹Ÿè¶Šé•¿äº†ï¼Œè¿™å°±ä¼šæ¶‰åŠåˆ°çº¿ç¨‹çš„åˆ‡æ¢ï¼Œä¹Ÿæ˜¯ä¸å°çš„èµ„æºæ¶ˆè€—ã€‚</p><p>æ‰€ä»¥ï¼Œä¸ºäº†ä¿æŠ¤æˆ‘æ–¹Tomcat(WC å‘ä½)ï¼Œåˆ™éœ€è¦å¿«é€Ÿç†”æ–­ï¼Œè€Œä¸æ˜¯è®©å®ƒä¸€ç›´å ç”¨ç€é“¾æ¥ä¸é‡Šæ”¾ã€‚</p><h2 id="äºŒã€å·¥ç¨‹ç¯å¢ƒé…ç½®" tabindex="-1"><a class="header-anchor" href="#äºŒã€å·¥ç¨‹ç¯å¢ƒé…ç½®" aria-hidden="true">#</a> äºŒã€å·¥ç¨‹ç¯å¢ƒé…ç½®</h2><p>è¿™é‡Œå°å‚…å“¥åšä¸€ä¸ª SpringBoot å·¥ç¨‹æµ‹è¯•æ¡ˆä¾‹ï¼Œå¹¶é…åˆæ·»åŠ  Hystrix ç†”æ–­ç»„ä»¶ï¼Œä»¥åŠä½¿ç”¨ Grafana ç›‘æ§æ¥è§‚å¯Ÿç®€å•å‹æµ‹æ—¶è¿æ¥æ•°çš„æ¶ˆè€—å’Œæ¥å£æ€§èƒ½çš„åé¦ˆã€‚</p><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/road-map-grafana-02.png?raw=true" width="450px"></div><ul><li>ç¯å¢ƒï¼›jdk 1.8ã€Maven 3.6.xã€Docker ç¯å¢ƒ</li><li>ä»£ç ï¼›åœ¨ xfg-dev-tech-grafana æµ‹è¯•å·¥ç¨‹ä¸­æä¾›äº†æµ‹è¯•ä»£ç å’Œç¯å¢ƒå®‰è£…</li></ul><h3 id="_1-é…ç½®ä¿®æ”¹" tabindex="-1"><a class="header-anchor" href="#_1-é…ç½®ä¿®æ”¹" aria-hidden="true">#</a> 1. é…ç½®ä¿®æ”¹</h3><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/road-map-grafana-07.png?raw=true" width="650px"></div><ul><li>é¦–å…ˆï¼Œä½ éœ€è¦æ‰“å¼€ prometheus.yml ä¿®æ”¹ç›‘æ§é‡‡é›†åº”ç”¨çš„IPåœ°å€ã€‚è¿™ä¸ªé…ç½®è¿˜å¯ä»¥ç›‘æ§ä¾‹å¦‚ MySQL å’Œå…¶ä»–åº”ç”¨ã€‚</li></ul><h3 id="_2-å®‰è£…ç›‘æ§" tabindex="-1"><a class="header-anchor" href="#_2-å®‰è£…ç›‘æ§" aria-hidden="true">#</a> 2. å®‰è£…ç›‘æ§</h3><p>æ–‡ä»¶ï¼š<code>docker-compose.yml</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>version<span class="token operator">:</span> <span class="token char">&#39;3&#39;</span>
# æ‰§è¡Œè„šæœ¬ï¼›docker<span class="token operator">-</span>compose <span class="token operator">-</span>f docker<span class="token operator">-</span>compose<span class="token punctuation">.</span>yml up <span class="token operator">-</span>d
# æ‹·è´é…ç½®ï¼›docker container cp grafana<span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>grafana<span class="token operator">/</span> <span class="token punctuation">.</span>/docs<span class="token operator">/</span>dev<span class="token operator">-</span>ops<span class="token operator">/</span>
services<span class="token operator">:</span>
  # æ•°æ®é‡‡é›†
  prometheus<span class="token operator">:</span>
    image<span class="token operator">:</span> bitnami<span class="token operator">/</span>prometheus<span class="token operator">:</span><span class="token number">2.47</span><span class="token number">.2</span>
    container_name<span class="token operator">:</span> prometheus
    restart<span class="token operator">:</span> always
    ports<span class="token operator">:</span>
      <span class="token operator">-</span> <span class="token number">9090</span><span class="token operator">:</span><span class="token number">9090</span>
    volumes<span class="token operator">:</span>
      <span class="token operator">-</span> <span class="token punctuation">.</span>/etc<span class="token operator">/</span>prometheus<span class="token operator">/</span>prometheus<span class="token punctuation">.</span>yml<span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>prometheus<span class="token operator">/</span>prometheus<span class="token punctuation">.</span>yml
  # ç›‘æ§ç•Œé¢
  grafana<span class="token operator">:</span>
    image<span class="token operator">:</span> grafana<span class="token operator">/</span>grafana<span class="token operator">:</span><span class="token number">10.2</span><span class="token number">.0</span>
    container_name<span class="token operator">:</span> grafana
    restart<span class="token operator">:</span> always
    ports<span class="token operator">:</span>
      <span class="token operator">-</span> <span class="token number">4000</span><span class="token operator">:</span><span class="token number">4000</span>
    depends_on<span class="token operator">:</span>
      <span class="token operator">-</span> prometheus
    volumes<span class="token operator">:</span>
      <span class="token operator">-</span> <span class="token punctuation">.</span>/etc<span class="token operator">/</span>grafana<span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>grafana
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/road-map-grafana-03.png?raw=true" width="950px"></div><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/road-map-grafana-04.png?raw=true" width="950px"></div><ul><li>è¿™æ˜¯ docker compose æ‰§è¡Œè„šæœ¬ï¼Œå¦‚æœä½ æœ¬åœ°å·²ç»å®‰è£…äº† Docker å¯ä»¥ç›´æ¥æ‰§è¡Œ å®‰è£…å³å¯ã€‚</li><li>æ³¨æ„ï¼›å¦‚æœä½ æ˜¯ç”Ÿäº§ä½¿ç”¨ï¼Œåˆ™éœ€è¦ä¿®æ”¹ <code>etc/grafana/grafana.ini</code> ä¸­ datasources ä¸º mysql è¿™æ ·åœ¨åé¢è¿ç§»çš„æ—¶å€™ä¹Ÿä¼šéå¸¸å®¹æ˜“ã€‚</li></ul><h3 id="_3-ç›‘æ§é…ç½®" tabindex="-1"><a class="header-anchor" href="#_3-ç›‘æ§é…ç½®" aria-hidden="true">#</a> 3. ç›‘æ§é…ç½®</h3>`,19),y={href:"http://127.0.0.1:4000",target:"_blank",rel:"noopener noreferrer"},_=n("code",null,"admin/admin",-1),x={href:"http://127.0.0.1:4000/dashboards",target:"_blank",rel:"noopener noreferrer"},w=t(`<div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/road-map-grafana-05.png?raw=true" width="950px"></div><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/road-map-grafana-06.png?raw=true" width="950px"></div><ul><li>æ‰“å¼€å¯¼å…¥é¢æ¿åï¼ŒæŠŠæ¡ˆä¾‹å·¥ç¨‹ä¸­çš„ JSON å¤åˆ¶åˆ°å¯¼å…¥é¢æ¿çš„ JSON é‡Œï¼Œç‚¹å‡» Load è¿™æ ·å°±é…ç½®è¿›å»äº†ã€‚</li><li>ä¸è¿‡è¿™ä¼šä½ è¿˜çœ‹ä¸è§æ•°æ®ï¼Œå› ä¸ºå·¥ç¨‹è¿˜æ²¡æœ‰å¯åŠ¨ï¼Œæ²¡æœ‰å¾€é‡Œå†™å…¥æ•°æ®ã€‚</li></ul><h2 id="ä¸‰ã€æµ‹è¯•åº”ç”¨è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€æµ‹è¯•åº”ç”¨è¯´æ˜" aria-hidden="true">#</a> ä¸‰ã€æµ‹è¯•åº”ç”¨è¯´æ˜</h2><h3 id="_1-ç†”æ–­é…ç½®" tabindex="-1"><a class="header-anchor" href="#_1-ç†”æ–­é…ç½®" aria-hidden="true">#</a> 1. ç†”æ–­é…ç½®</h3><div class="language-pom line-numbers-mode" data-ext="pom"><pre class="language-pom"><code>&lt;dependency&gt;
    &lt;groupId&gt;com.netflix.hystrix&lt;/groupId&gt;
    &lt;artifactId&gt;hystrix-javanica&lt;/artifactId&gt;
    &lt;version&gt;1.5.18&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™ä¸ªç†”æ–­çš„ç»„ä»¶ï¼Œä¸éœ€è¦å¼•å…¥ SpringCloud ä¸€å †çš„ä¸œè¥¿ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ å®¹æ˜“ã€‚</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HystrixConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">HystrixCommandAspect</span> <span class="token function">hystrixCommandAspect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HystrixCommandAspect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¼•å…¥ POM åï¼Œæ·»åŠ  HystrixConfig ç†”æ–­é…ç½®ã€‚</li></ul><h3 id="_2-æ¥å£é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-æ¥å£é…ç½®" aria-hidden="true">#</a> 2. æ¥å£é…ç½®</h3><p>è¿™é‡Œå°å‚…å“¥æä¾›äº†2ä¸ªæ¥å£ï¼Œä¸€ä¸ªæ™®é€šçš„æŸ¥è¯¢æ•°æ®æ¥å£ï¼Œä¸€ä¸ªæ˜¯ OpenAi ä¸­æœåŠ¡çš„ç»™å‰ç«¯å¼‚æ­¥å“åº”ç»“æœçš„æ¥å£ã€‚å°¤å…¶æ˜¯ OpenAi å¼‚æ­¥æ¥å£ï¼Œæˆ‘ä»¬åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œä¹Ÿæ€»ä¼šæœ‰è¶…æ—¶ç†”æ–­ï¼Œæ‰€ä»¥è¿™é‡Œç»™å¤§å®¶æ·»åŠ ä¸Šã€‚</p><h4 id="_2-1-æ™®é€šæ¥å£" tabindex="-1"><a class="header-anchor" href="#_2-1-æ™®é€šæ¥å£" aria-hidden="true">#</a> 2.1 æ™®é€šæ¥å£</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * curl http://localhost:8091/api/hystrix/query_order_info
 */</span>
<span class="token annotation punctuation">@HystrixCommand</span><span class="token punctuation">(</span>commandProperties <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;execution.isolation.thread.timeoutInMilliseconds&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;50&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> fallbackMethod <span class="token operator">=</span> <span class="token string">&quot;queryOrderInfo_error&quot;</span>
<span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;query_order_info&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">queryOrderInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;æ‚¨çš„è®¢å•ä¿¡æ¯æŸ¥è¯¢å®Œæ¯•&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">queryOrderInfo_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Fallback Hello&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œè¶…æ—¶ç†”æ–­æ—¶é—´ï¼Œå¯ä»¥è®¾ç½®çš„è¾ƒå¤§ä¸€äº›ï¼Œä¹Ÿå¯ä»¥å…ˆä¸æ·»åŠ è¶…æ—¶ç†”æ–­çš„æ³¨è§£ã€‚</li></ul><h4 id="_2-2-å¼‚æ­¥æ¥å£" tabindex="-1"><a class="header-anchor" href="#_2-2-å¼‚æ­¥æ¥å£" aria-hidden="true">#</a> 2.2 å¼‚æ­¥æ¥å£</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * curl http://localhost:8091/api/hystrix/stream
 */</span>
<span class="token annotation punctuation">@HystrixCommand</span><span class="token punctuation">(</span>commandProperties <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;execution.isolation.thread.timeoutInMilliseconds&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;150&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> fallbackMethod <span class="token operator">=</span> <span class="token string">&quot;stream_error&quot;</span>
<span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/stream&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseBodyEmitter</span> <span class="token function">stream</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/event-stream&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Cache-Control&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;no-cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ResponseBodyEmitter</span> emitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResponseBodyEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    emitter<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;å¼‚æ­¥å“åº”&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">200</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                emitter<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;hi xfg-dev-tech-grafana\\r\\n&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        emitter<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> emitter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">ResponseBodyEmitter</span> <span class="token function">stream_error</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/event-stream&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Cache-Control&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;no-cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ResponseBodyEmitter</span> emitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResponseBodyEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    emitter<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Err&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    emitter<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> emitter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¦å¤–ä¸€ä¸ªæ˜¯ä¸€æ­¥å“åº”æ¥å£ï¼Œå¦‚æœå“åº”æ—¶é—´è¾ƒé•¿ï¼Œåˆ™è¿›å…¥è¶…æ—¶ç†”æ–­æ–¹æ³•ä¸­ã€‚</li></ul><h2 id="å››ã€æœåŠ¡å‹æµ‹éªŒè¯" tabindex="-1"><a class="header-anchor" href="#å››ã€æœåŠ¡å‹æµ‹éªŒè¯" aria-hidden="true">#</a> å››ã€æœåŠ¡å‹æµ‹éªŒè¯</h2><h3 id="_1-é…ç½®ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#_1-é…ç½®ä¿¡æ¯" aria-hidden="true">#</a> 1. é…ç½®ä¿¡æ¯</h3><p><strong>application.yml</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8091</span>
  <span class="token comment"># 1æ ¸2Gå†…å­˜ï¼Œå¯é»˜è®¤é…ç½® 200ï¼›4æ ¸8Gå†…å­˜ã€accept-count=1000ã€max-threads=800ã€max-connections=10000ã€‘ï¼Œçº¿ç¨‹æ•°ç»éªŒå€¼800ã€‚çº¿ç¨‹æ± è¿‡å¤§ï¼Œcpuè°ƒåº¦ä¼šæ¶ˆè€—å¤§é‡æ—¶é—´</span>
  <span class="token key atrule">tomcat</span><span class="token punctuation">:</span>
    <span class="token key atrule">mbeanregistry</span><span class="token punctuation">:</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">max-connections</span><span class="token punctuation">:</span> <span class="token number">20</span> <span class="token comment"># æœ€å¤§è¿æ¥æ•°  </span>
    <span class="token key atrule">threads</span><span class="token punctuation">:</span>
      <span class="token key atrule">max</span><span class="token punctuation">:</span> <span class="token number">20</span>         <span class="token comment"># è®¾å®šå¤„ç†å®¢æˆ·è¯·æ±‚çš„çº¿ç¨‹çš„æœ€å¤§æ•°ç›®ï¼Œå†³å®šäº†æœåŠ¡å™¨å¯ä»¥åŒæ—¶å“åº”å®¢æˆ·è¯·æ±‚çš„æ•°,é»˜è®¤200</span>
      <span class="token key atrule">min-spare</span><span class="token punctuation">:</span> <span class="token number">10</span>   <span class="token comment"># åˆå§‹åŒ–çº¿ç¨‹æ•°,æœ€å°ç©ºé—²çº¿ç¨‹æ•°,é»˜è®¤æ˜¯10</span>
    <span class="token key atrule">accept-count</span><span class="token punctuation">:</span> <span class="token number">10</span>  <span class="token comment"># ç­‰å¾…é˜Ÿåˆ—é•¿åº¦</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æˆ‘ä»¬åœ¨ YML æ–‡ä»¶ä¸­æŒ‡å®šäº† tomcat çš„è¿æ¥æ•°é…ç½®ä¸º 20 ä¸ªï¼Œå¤„ç†çº¿ç¨‹æœ€å¤šä¹Ÿæ˜¯20ä¸ªã€‚</li><li>åŒæ—¶è¿˜æ·»åŠ äº†ç›‘æ§ç©ºä½ æš´éœ²ä¸ºtrueï¼Œè¿™æ · Grafana æ‰èƒ½ç›‘æ§åˆ°ã€‚</li></ul><h3 id="_2-å‹æµ‹å·¥å…·" tabindex="-1"><a class="header-anchor" href="#_2-å‹æµ‹å·¥å…·" aria-hidden="true">#</a> 2. å‹æµ‹å·¥å…·</h3>`,23),q={href:"https://bugstack.cn/md/road-map/jmeter.html",target:"_blank",rel:"noopener noreferrer"},C=t('<p>ä¸è¿‡è¿™é‡Œä¸ºäº†è®©å¤§å®¶æ›´åŠ ç®€å•çš„å‹æµ‹ä¸‹ï¼Œå°å‚…å“¥ä½¿ç”¨äº† ApiPost å·¥å…·è‡ªå¸¦çš„å‹æµ‹ï¼Œè¿™æ ·ä¸éœ€è¦è‡ªå·±å†å®‰è£…å…¶ä»–å·¥å…·å°±å¯ä»¥ç®€å•å‹æµ‹ä¸‹äº†ã€‚</p><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/road-map-grafana-08.png?raw=true" width="750px"></div><ul><li>ä½ åªè¦æŠŠ2ä¸ªæ¥å£é…ç½®åˆ° ApiPost å°±å¯ä»¥ç”¨ä¸€é”®å‹æµ‹å·¥å…·è¿›è¡Œå‹æµ‹ã€‚</li></ul><h3 id="_3-å‹æµ‹è§‚å¯Ÿ" tabindex="-1"><a class="header-anchor" href="#_3-å‹æµ‹è§‚å¯Ÿ" aria-hidden="true">#</a> 3. å‹æµ‹è§‚å¯Ÿ</h3><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/road-map-grafana-09.png?raw=true" width="850px"></div><ul><li>è¿™é‡Œå°å‚…å“¥å‹æµ‹äº†ä¸‹æ¥å£ <code>http://localhost:8091/api/hystrix/stream</code> æ¥å£ã€‚å› ä¸ºè¿™ä¸ªæ¥å£è®¾ç½®äº†è¶…æ—¶ï¼Œå¯ä»¥çœ‹è§ï¼Œå¿«é€Ÿçš„å°±æŠŠè¿æ¥æ•°ç»™å æ»¡äº†ã€‚</li><li>æ‰€ä»¥å¦‚æœä½ çš„åº”ç”¨é…ç½®çš„ Tomcat è¿æ¥æ•°ä¸åˆç†ï¼Œä¹‹åæ¥å£åˆå®¹æ˜“è¶…æ—¶ï¼Œè¶…æ—¶ååˆæ²¡æœ‰ç†”æ–­ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“å°±ä¼šæŠŠä½ çš„æœåŠ¡æ‹–å®ã€‚å¾ˆå¤šæ–°äººåœ¨åšä¸€äº›å¯¹å¤–çš„åº”ç”¨æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ³¨æ„åˆ°è¿™äº›ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯å¾ˆå®¹æ˜“å®•æœºçš„ã€‚</li></ul>',6);function E(H,j){const s=o("ExternalLinkIcon");return c(),i("div",null,[r,n("p",null,[a("ä½œè€…ï¼šå°å‚…å“¥ åšå®¢ï¼š"),n("a",u,[a("https://bugstack.cn"),e(s)])]),d,k,m,v,h,n("ul",null,[n("li",null,[a("xfg-dev-tech-grafanaï¼š"),n("a",b,[a("https://gitcode.net/KnowledgePlanet/road-map/xfg-dev-tech-grafana"),e(s)]),a(" - "),g])]),f,n("ul",null,[n("li",null,[n("p",null,[a("å®‰è£…å®Œç›‘æ§ç¯å¢ƒä»¥åï¼Œå¯ä»¥å…ˆæ‰“å¼€ Grafana åœ°å€ï¼š"),n("a",y,[a("http://127.0.0.1:4000"),e(s)]),a(" - "),_])]),n("li",null,[n("p",null,[a("åœ°å€ï¼š"),n("a",x,[a("http://127.0.0.1:4000/dashboards"),e(s)]),a(" - æ‰“å¼€ä»ªè¡¨ç›˜ï¼Œå¯¼å…¥ç›‘æ§é¢æ¿é…ç½®ã€‚")])])]),w,n("p",null,[a("å‹æµ‹å·¥å…·æœ‰å¾ˆå¤šï¼ŒåŒ…æ‹¬ï¼›"),n("a",q,[a("JMeterã€ApacheBenchã€Siege"),e(s)]),a(" å°å‚…å“¥å·²ç»åœ¨å‰é¢å†™è¿‡æ–‡ç« ï¼Œä¹Ÿå¯ä»¥å»å‚è€ƒä½¿ç”¨ã€‚")]),C])}const B=p(l,[["render",E],["__file","grafana.html.vue"]]);export{B as default};
