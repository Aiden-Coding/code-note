import{_ as p,r as e,o as c,c as o,a as n,b as s,d as t,e as l}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"ã€Šmybatis-æ‰‹æ’¸ä¸“æ ã€‹ç¬¬10ç« -ä½¿ç”¨ç­–ç•¥æ¨¡å¼-è°ƒç”¨å‚æ•°å¤„ç†å™¨",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ã€Šmybatis-æ‰‹æ’¸ä¸“æ ã€‹ç¬¬10ç« -ä½¿ç”¨ç­–ç•¥æ¨¡å¼-è°ƒç”¨å‚æ•°å¤„ç†å™¨","aria-hidden":"true"},"#"),s(" ã€ŠMybatis æ‰‹æ’¸ä¸“æ ã€‹ç¬¬10ç« ï¼šä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼Œè°ƒç”¨å‚æ•°å¤„ç†å™¨")],-1),r=n("br",null,null,-1),k={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=n("br",null,null,-1),m={href:"https://mp.weixin.qq.com/s/f-1g66RrbDeJI5tmHQykHg",target:"_blank",rel:"noopener noreferrer"},v=n("blockquote",null,[n("p",null,"æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„")],-1),b=n("iframe",{id:"B-Video",src:"//player.bilibili.com/player.html?aid=344648924&bvid=BV12d4y1P756&cid=809802013&page=1",scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",width:"100%",height:"480"}," ",-1),g=l(`<h2 id="ä¸€ã€å‰è¨€" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‰è¨€" aria-hidden="true">#</a> ä¸€ã€å‰è¨€</h2><p><code>ä½ è¿™ä»£ç å†™çš„ï¼Œå’‹è¿™ä¹ˆè½´å‘¢ï¼</code></p><p>è¯´åˆ°è½´ï¼Œè®©æˆ‘æƒ³èµ·åˆä¸­ä¸Šå­¦æ—¶è€å¸ˆè¯´çš„è¯ï¼š<strong>â€œä½ é‚£è„‘ç“œå­ï¼Œå’‹è·Ÿæ‰‹ç„–å­ä¼¼çš„ï¼â€</strong> ä¸œåŒ—è¯æ‰‹ç„–å­å°±æ˜¯é‚£ç§å†¬å¤©æˆ´çš„å¤§æ£‰æ‰‹å¥—ï¼Œæ£‰æ‰‹å¥—é‡Œçš„æ£‰èŠ±éƒ½è¢«å‹çš„åˆæ²‰åˆç¡¬çš„äº†ï¼Œæ‰€ä»¥æ¥æ¯”å–»è„‘ç“œå­ç¬¨ã€‚</p><p>è€Œå†™è½´ä»£ç çš„å¤§éƒ¨åˆ†éƒ½æ˜¯åˆšæ¯•ä¸šæ²¡å¤šä¹…ï¼Œæˆ–è€…åˆšå¼€å§‹å·¥ä½œçš„ç å†œï¼Œæ¯•ç«Ÿç»éªŒä¸è¶³ç»å†ä¸å¤šï¼Œå†™å‡ºä¸€äº›ä¸å¤ªå¥½ç»´æŠ¤çš„ä»£ç ä¹Ÿæƒ…æœ‰å¯åŸã€‚è€Œé‚£äº›ç»å¤§å¤šæ•°é”»ç‚¼å‡ºæ¥çš„è€ç å†œï¼Œå…¶å®ä»£ç çš„ç¨³å®šç¨‹åº¦ã€è®¾è®¡ç»éªŒã€ç¼œå¯†é€»è¾‘ï¼Œéƒ½æ˜¯ç›¸å¯¹æ¥è¯´è¦å¥½å¾ˆå¤šçš„ã€‚<em>å½“ç„¶ä¸€éƒ¨åˆ†è€ç å†œï¼Œåªæ˜¯è€äº†è€Œå·²ï¼Œä»£ç è¿˜æ˜¯é‚£ä¸ªä»£ç ï¼</em></p><p>æ‰€ä»¥ä¼ä¸šæ‹›è˜äº›å¹´è½»äººï¼Œéœ€è¦å¹´è½»çš„æ€æƒ³ã€‚ä½†æ²¡å¿…è¦åš¯åš¯åªæ˜¯å¤´å‘æ²¡å¤šå°‘çš„è€ç å†œï¼Œå¦åˆ™è°æ¥ç»™ä½ å¹³ç¨³è½åœ°ä½ é‚£äº›å¤©é©¬è¡Œç©ºçš„æƒ³æ³•å‘¢ï¼éš¾é“ä½“éªŒã€ç¨³å®šã€æµç•…ï¼Œä¸åº”è¯¥æ˜¯æ›´å€¼å¾—è¿½æ±‚çš„ï¼Œéå¾—å–œæ¬¢å…¨æ˜¯æ„£å¤´é’ä¼¼çš„ä»£ç ï¼Œå†™å‡ºå‡ ç™¾ä¸ªbugï¼Œé€ æˆå¤§é‡èµ„æŸå’Œå®¢è¯‰ï¼Œè®©è€æ¿è§‰å¾—å¾ˆçˆ½ï¼Ÿ</p><h2 id="äºŒã€ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#äºŒã€ç›®æ ‡" aria-hidden="true">#</a> äºŒã€ç›®æ ‡</h2><p>ä¸Šä¸€ç« èŠ‚ï¼Œå°å‚…å“¥å¸¦ç€å¤§å®¶ç»†åŒ–çš„ XML è¯­å¥æ„å»ºå™¨ï¼Œè§£è€¦åœ¨è§£æ XML ä¸­çš„æ‰€éœ€è¦å¤„ç†çš„ Mapper ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼›SQLã€å…¥å‚ã€å‡ºå‚ã€ç±»å‹ï¼Œå¹¶å¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œè®°å½•åˆ° ParameterMapping å‚æ•°æ˜ å°„å¤„ç†ç±»ä¸­ã€‚é‚£ä¹ˆè¿™ä¸ªä¸€ç« èŠ‚æˆ‘ä»¬å°†ç»“åˆè¿™éƒ¨åˆ†å‚æ•°çš„æå–ï¼Œå¯¹æ‰§è¡Œçš„ SQL è¿›è¡Œå‚æ•°çš„è‡ªåŠ¨åŒ–è®¾ç½®ï¼Œè€Œä¸æ˜¯åƒæˆ‘ä»¬ä¹‹å‰é‚£æ ·æŠŠå‚æ•°å†™æˆå›ºå®šçš„ï¼Œå¦‚å›¾ 10-1 æ‰€ç¤º</p><p><img src="https://bugstack.cn/images/article/spring/mybatis-220526-10-01.png" alt="å›¾ 10-1 ç¡¬ç¼–ç å‚æ•°è®¾ç½®"></p><ul><li>åœ¨æµç¨‹ä¸Šï¼Œé€šè¿‡ DefaultSqlSession#selectOne æ–¹æ³•è°ƒç”¨æ‰§è¡Œå™¨ï¼Œå¹¶é€šè¿‡é¢„å¤„ç†è¯­å¥å¤„ç†å™¨ PreparedStatementHandler æ‰§è¡Œå‚æ•°è®¾ç½®å’Œç»“æœæŸ¥è¯¢ã€‚</li><li>é‚£ä¹ˆè¿™ä¸ªæµç¨‹ä¸­æˆ‘ä»¬æ‰€å¤„ç†çš„å‚æ•°ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ª SQL æ‰§è¡Œæ—¶ï¼Œé‚£äº›<code>?å·</code> éœ€è¦è¢«æ›¿æ¢çš„åœ°æ–¹ï¼Œç›®å‰æ˜¯é€šè¿‡ç¡¬ç¼–ç çš„æ–¹å¼è¿›è¡Œå¤„ç†çš„ã€‚è€Œè¿™å°±æ˜¯æœ¬ç« èŠ‚éœ€è¦è§£å†³çš„é—®é¢˜ï¼Œå¦‚æœåªæ˜¯ç¡¬ç¼–ç å®Œæˆå‚æ•°è®¾ç½®ï¼Œé‚£ä¹ˆå¯¹äºæ‰€æœ‰å“ªäº›ä¸åŒç±»å‹çš„å‚æ•°å°±æ²¡æ³•è¿›è¡Œæ“ä½œäº†ã€‚</li><li>æ‰€ä»¥æœ¬ç« èŠ‚éœ€è¦ç»“åˆç»“åˆä¸Šä¸€ç« èŠ‚æ‰€å®Œæˆçš„è¯­å¥æ„å»ºå™¨å¯¹ SQL å‚æ•°ä¿¡æ¯çš„æ‹†è§£ï¼Œæœ¬ç« å°†ä¼šæŒ‰ç…§è¿™äº›å‚æ•°çš„è§£æï¼Œå¤„ç†è¿™é‡Œç¡¬ç¼–ç ä¸ºè‡ªåŠ¨åŒ–ç±»å‹è®¾ç½®ã€‚<em>é’ˆå¯¹ä¸åŒç±»å‹çš„å‚æ•°è®¾ç½®ï¼Œè¿™éƒ¨åˆ†ä½¿ç”¨äº†ä»€ä¹ˆè®¾è®¡æ¨¡å¼å‘¢ï¼Ÿ</em></li></ul><h2 id="ä¸‰ã€è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€è®¾è®¡" aria-hidden="true">#</a> ä¸‰ã€è®¾è®¡</h2><p>è¿™é‡Œå¯ä»¥æ€è€ƒğŸ¤”ä¸‹ï¼Œå‚æ•°çš„å¤„ç†ä¹Ÿå°±æ˜¯é€šå¸¸æˆ‘ä»¬ä½¿ç”¨ JDBC ç›´æ¥æ“ä½œæ•°æ®åº“æ—¶ï¼Œæ‰€ä½¿ç”¨ <code>ps.setXxx(i, parameter);</code> è®¾ç½®çš„å„ç±»å‚æ•°ã€‚é‚£ä¹ˆåœ¨è‡ªåŠ¨åŒ–è§£æ XML ä¸­ SQL æ‹†åˆ†å‡ºæ‰€æœ‰çš„å‚æ•°ç±»å‹åï¼Œåˆ™åº”è¯¥æ ¹æ®ä¸åŒçš„å‚æ•°è¿›è¡Œä¸åŒçš„ç±»å‹è®¾ç½®ï¼Œä¹Ÿå°±ï¼›<code>Long è°ƒç”¨ ps.setLong</code>ã€<code>String è°ƒç”¨ ps.setString</code> æ‰€ä»¥è¿™é‡Œéœ€è¦ä½¿ç”¨<strong>ç­–ç•¥æ¨¡å¼</strong>ï¼Œåœ¨è§£æ SQL æ—¶æŒ‰ç…§ä¸åŒçš„æ‰§è¡Œç­–ç•¥ï¼Œå°è£…è¿›å»ç±»å‹å¤„ç†å™¨ï¼ˆ<em>ä¹Ÿå°±æ˜¯æ˜¯å®ç° <code>TypeHandler&lt;T&gt; </code>æ¥å£çš„è¿‡ç¨‹</em>ï¼‰ã€‚æ•´ä½“è®¾è®¡å¦‚å›¾ 10-2 æ‰€ç¤º</p><p><img src="https://bugstack.cn/images/article/spring/mybatis-220526-10-02.png" alt="å›¾ 10-2 ç­–ç•¥æ¨¡å¼å¤„ç†å‚æ•°å¤„ç†å™¨"></p><ul><li>å…¶å®å…³äºå‚æ•°çš„å¤„ç†ï¼Œå› ä¸ºæœ‰å¾ˆå¤šçš„ç±»å‹(<code>Long\\String\\Object\\...</code>)ï¼Œæ‰€ä»¥è¿™é‡Œæœ€é‡è¦çš„ä½“ç°åˆ™æ˜¯ç­–ç•¥æ¨¡å¼çš„ä½¿ç”¨ã€‚</li><li>è¿™é‡ŒåŒ…æ‹¬äº†æ„å»ºå‚æ•°æ—¶æ ¹æ®ç±»å‹ï¼Œé€‰æ‹©å¯¹åº”çš„ç­–ç•¥ç±»å‹å¤„ç†å™¨ï¼Œå¡«å……åˆ°å‚æ•°æ˜ å°„é›†åˆä¸­ã€‚å¦å¤–ä¸€æ–¹é¢æ˜¯å‚æ•°çš„ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯åœ¨æ‰§è¡Œ DefaultSqlSession#selectOne çš„é“¾è·¯ä¸­ï¼ŒåŒ…æ‹¬äº†å‚æ•°çš„è®¾ç½®ï¼ŒæŒ‰ç…§å‚æ•°çš„ä¸åŒç±»å‹ï¼Œè·å–å‡ºå¯¹åº”çš„å¤„ç†å™¨ï¼Œä»¥åŠå…¥å‚å€¼ã€‚<em>æ³¨æ„ï¼šç”±äºå…¥å‚å€¼å¯èƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ä¸­çš„å±æ€§ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç”¨åˆ°äº†å‰é¢ç« èŠ‚å®ç°çš„åå°„ç±»å·¥å…· MetaObject è¿›è¡Œå€¼çš„è·å–ï¼Œé¿å…ç”±äºåŠ¨æ€çš„å¯¹è±¡ï¼Œæ²¡æ³•ç¡¬ç¼–ç è·å–å±æ€§å€¼ã€‚</em></li></ul><h2 id="å››ã€å®ç°" tabindex="-1"><a class="header-anchor" href="#å››ã€å®ç°" aria-hidden="true">#</a> å››ã€å®ç°</h2><h3 id="_1-å·¥ç¨‹ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1-å·¥ç¨‹ç»“æ„" aria-hidden="true">#</a> 1. å·¥ç¨‹ç»“æ„</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>mybatis<span class="token operator">-</span>step<span class="token operator">-</span><span class="token number">09</span>
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis
    â”‚           â”œâ”€â”€ binding
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">MapperMethod</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">MapperProxy</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">MapperProxyFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">MapperRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ builder
    â”‚           â”‚   â”œâ”€â”€ xml
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">XMLConfigBuilder</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">XMLMapperBuilder</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">XMLStatementBuilder</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">BaseBuilder</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ParameterExpression</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">SqlSourceBuilder</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">StaticSqlSource</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ datasource
    â”‚           â”œâ”€â”€ executor
    â”‚           â”‚   â”œâ”€â”€ resultset
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">ParameterHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ resultset
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DefaultResultSetHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">ResultSetHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ statement
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BaseStatementHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">PreparedStatementHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">SimpleStatementHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">StatementHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">BaseExecutor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">Executor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">SimpleExecutor</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ io
    â”‚           â”œâ”€â”€ mapping
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">BoundSql</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">Environment</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">MappedStatement</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ParameterMapping</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">SqlCommandType</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">SqlSource</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ parsing
    â”‚           â”œâ”€â”€ reflection
    â”‚           â”œâ”€â”€ scripting
    â”‚           â”‚   â”œâ”€â”€ defaults
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DefaultParameterHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">RawSqlSource</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ xmltags
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DynamicContext</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">MixedSqlNode</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">SqlNode</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">StaticTextSqlNode</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">XMLLanguageDriver</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">XMLScriptBuilder</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">LanguageDriver</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">LanguageDriverRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ session
    â”‚           â”‚   â”œâ”€â”€ defaults
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DefaultSqlSession</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">DefaultSqlSessionFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">Configuration</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ResultHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">SqlSession</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">SqlSessionFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">TransactionIsolationLevel</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ transaction
    â”‚           â””â”€â”€ type
    â”‚               â”œâ”€â”€ <span class="token class-name">BaseTypeHandler</span><span class="token punctuation">.</span>java
    â”‚               â”œâ”€â”€ <span class="token class-name">JdbcType</span><span class="token punctuation">.</span>java
    â”‚               â”œâ”€â”€ <span class="token class-name">LongTypeHandler</span><span class="token punctuation">.</span>java
    â”‚               â”œâ”€â”€ <span class="token class-name">StringTypeHandler</span><span class="token punctuation">.</span>java
    â”‚               â”œâ”€â”€ <span class="token class-name">TypeAliasRegistry</span><span class="token punctuation">.</span>java
    â”‚               â”œâ”€â”€ <span class="token class-name">TypeHandler</span><span class="token punctuation">.</span>java
    â”‚               â””â”€â”€ <span class="token class-name">TypeHandlerRegistry</span><span class="token punctuation">.</span>java
    â””â”€â”€ test
        â”œâ”€â”€ java
        â”‚   â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span>dao
        â”‚       â”œâ”€â”€ dao
        â”‚       â”‚   â””â”€â”€ <span class="token class-name">IUserDao</span><span class="token punctuation">.</span>java
        â”‚       â”œâ”€â”€ po
        â”‚       â”‚   â””â”€â”€ <span class="token class-name">User</span><span class="token punctuation">.</span>java
        â”‚       â””â”€â”€ <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
        â””â”€â”€ resources
            â”œâ”€â”€ mapper
            â”‚   â””â”€â”€<span class="token class-name">User_Mapper</span><span class="token punctuation">.</span>xml
            â””â”€â”€ mybatis<span class="token operator">-</span>config<span class="token operator">-</span>datasource<span class="token punctuation">.</span>xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å·¥ç¨‹æºç </strong>ï¼š<code>å…¬ä¼—å·ã€Œbugstackè™«æ´æ ˆã€ï¼Œå›å¤ï¼šæ‰‹å†™Mybatisï¼Œè·å–å®Œæ•´æºç </code></p><p>ä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼Œå¤„ç†å‚æ•°å¤„ç†å™¨æ ¸å¿ƒç±»å…³ç³»ï¼Œå¦‚å›¾ 10-3 æ‰€ç¤º</p><p><img src="https://bugstack.cn/images/article/spring/mybatis-220526-10-03.png" alt="å›¾ 10-3 ä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼Œå¤„ç†å‚æ•°å¤„ç†å™¨æ ¸å¿ƒç±»å…³ç³»"></p><p>æ ¸å¿ƒå¤„ç†ä¸»è¦åˆ†ä¸ºä¸‰å—ï¼›ç±»å‹å¤„ç†ã€å‚æ•°è®¾ç½®ã€å‚æ•°ä½¿ç”¨ï¼›</p><ul><li>ä»¥å®šä¹‰ TypeHandler ç±»å‹å¤„ç†å™¨ç­–ç•¥æ¥å£ï¼Œå®ç°ä¸åŒçš„å¤„ç†ç­–ç•¥ï¼ŒåŒ…æ‹¬ï¼›Longã€Stringã€Integer ç­‰ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆåªå®ç°2ç§ç±»å‹ï¼Œè¯»è€…åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æŒ‰ç…§è¿™ä¸ªç»“æ„æ¥æ·»åŠ å…¶ä»–ç±»å‹ã€‚</li><li>ç±»å‹ç­–ç•¥å¤„ç†å™¨å®ç°å®Œæˆåï¼Œéœ€è¦æ³¨å†Œåˆ°å¤„ç†å™¨æ³¨å†Œæœºä¸­ï¼Œåç»­å…¶ä»–æ¨¡å—å‚æ•°çš„è®¾ç½®è¿˜æ˜¯ä½¿ç”¨éƒ½æ˜¯ä» Configuration ä¸­è·å–åˆ° TypeHandlerRegistry è¿›è¡Œä½¿ç”¨ã€‚</li><li>é‚£ä¹ˆæœ‰äº†è¿™æ ·çš„ç­–ç•¥å¤„ç†å™¨ä»¥åï¼Œåœ¨è¿›è¡Œæ“ä½œè§£æ SQL çš„æ—¶å€™ï¼Œå°±å¯ä»¥æŒ‰ç…§ä¸åŒçš„ç±»å‹æŠŠå¯¹åº”çš„ç­–ç•¥å¤„ç†å™¨è®¾ç½®åˆ° BoundSql#parameterMappings å‚æ•°é‡Œï¼Œåç»­ä½¿ç”¨ä¹Ÿæ˜¯ä»è¿™é‡Œè¿›è¡Œè·å–ã€‚</li></ul><h3 id="_2-å…¥å‚æ•°æ ¡å‡†" tabindex="-1"><a class="header-anchor" href="#_2-å…¥å‚æ•°æ ¡å‡†" aria-hidden="true">#</a> 2. å…¥å‚æ•°æ ¡å‡†</h3><p>è¿™é‡Œæˆ‘ä»¬è¦å…ˆè§£å†³ä¸€ä¸ªå°é—®é¢˜ï¼Œä¸çŸ¥é“è¯»è€…åœ¨æˆ‘ä»¬æ‰€å®ç°çš„æºç ä¸­ï¼Œæ˜¯å¦æ³¨æ„åˆ°è¿™æ ·ä¸€ä¸ªå‚æ•°çš„ä¼ é€’ï¼Œå¦‚å›¾ 10-4</p><p><img src="https://bugstack.cn/images/article/spring/mybatis-220526-10-04.png" alt="å›¾ 10-4 å‚æ•°è®¾ç½®æ—¶å…¥å‚è·å–"></p><ul><li>è¿™é‡Œçš„å‚æ•°ä¼ é€’åï¼Œéœ€è¦è·å–ç¬¬0ä¸ªå‚æ•°ï¼Œè€Œä¸”æ˜¯ç¡¬ç¼–ç å›ºå®šçš„ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªç¬¬0ä¸ªå‚æ•°æ˜¯å“ªæ¥çš„ï¼Œæˆ‘ä»¬æ¥å£é‡Œé¢è°ƒç”¨çš„æ–¹æ³•ï¼Œå‚æ•°ä¸æ˜¯ä¸€ä¸ªå—ï¼Ÿå°±åƒï¼š<code>User queryUserInfoById(Long id);</code></li><li>å…¶å®è¿™ä¸ªå‚æ•°æ¥è‡ªäºæ˜ å°„å™¨ä»£ç†ç±» MapperProxy#invoke ä¸­ï¼Œå› ä¸º invoke åå°„è°ƒç”¨çš„æ–¹æ³•ï¼Œå…¥å‚ä¸­æ˜¯ Object[] argsï¼Œæ‰€ä»¥è¿™ä¸ªå‚æ•°è¢«ä¼ é€’åˆ°åç»­çš„å‚æ•°è®¾ç½®ä¸­ã€‚è€Œæˆ‘ä»¬çš„ DAO æµ‹è¯•ç±»æ˜¯ä¸€ä¸ªå·²çŸ¥çš„å›ºå®šå‚æ•°ï¼Œæ‰€ä»¥åé¢ç¡¬ç¼–ç äº†è·å–äº†ç¬¬0ä¸ªå‚æ•°ã€‚ <img src="https://bugstack.cn/images/article/spring/mybatis-220526-10-05.png" alt=""><ul><li>JDK åå°„è°ƒç”¨æ–¹æ³•æ“ä½œå›ºå®šæ–¹æ³•å…¥å‚</li></ul></li><li>é‚£ä¹ˆç»“åˆè¿™æ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬åˆ™éœ€è¦æ ¹æ®æ–¹æ³•çš„ä¿¡æ¯ï¼Œç»™æ–¹æ³•åšç­¾åæ“ä½œï¼Œä»¥ä¾¿äºè½¬æ¢å…¥å‚ä¿¡æ¯ä¸ºæ–¹æ³•çš„ä¿¡æ¯ã€‚æ¯”å¦‚æ•°ç»„è½¬æ¢ä¸ºå¯¹åº”çš„å¯¹è±¡ã€‚</li></ul><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.binding.MapperMethod</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapperMethod</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">SqlSession</span> sqlSession<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token constant">SELECT</span><span class="token operator">:</span>
                <span class="token class-name">Object</span> param <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">convertArgsToSqlCommandParam</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                result <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Unknown execution method for: &quot;</span> <span class="token operator">+</span> command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * æ–¹æ³•ç­¾å
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MethodSignature</span> <span class="token punctuation">{</span>

        <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">convertArgsToSqlCommandParam</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> paramCount <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>args <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> paramCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// å¦‚æœæ²¡å‚æ•°</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>paramCount <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> args<span class="token punctuation">[</span>params<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// å¦åˆ™ï¼Œè¿”å›ä¸€ä¸ªParamMapï¼Œä¿®æ”¹å‚æ•°åï¼Œå‚æ•°åå°±æ˜¯å…¶ä½ç½®</span>
                <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ParamMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> params<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 1.å…ˆåŠ ä¸€ä¸ª#{0},#{1},#{2}...å‚æ•°</span>
                    param<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">[</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// ...</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> param<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨æ˜ å°„å™¨æ–¹æ³•ä¸­ MapperMethod#execute å°†åŸæ¥çš„ç›´æ¥å°†å‚æ•° args ä¼ é€’ç»™ SqlSession#selectOne æ–¹æ³•ï¼Œè°ƒæ•´ä¸ºè½¬æ¢åå†ä¼ é€’å¯¹è±¡ã€‚</li><li>å…¶å®è¿™é‡Œçš„è½¬æ¢æ“ä½œå°±æ˜¯æ¥è‡ªäº Method#getParameterTypes å¯¹å‚æ•°çš„è·å–å’Œå¤„ç†ï¼Œä¸ args è¿›è¡Œæ¯”å¯¹ã€‚å¦‚æœæ˜¯å•ä¸ªå‚æ•°ï¼Œåˆ™ç›´æ¥è¿”å›å‚æ•° Tree æ ‘ç»“æ„ä¸‹çš„å¯¹åº”èŠ‚ç‚¹å€¼ã€‚éå•ä¸ªç±»å‹ï¼Œåˆ™éœ€è¦è¿›è¡Œå¾ªç¯å¤„ç†ï¼Œè¿™æ ·è½¬æ¢åçš„å‚æ•°æ‰èƒ½è¢«ç›´æ¥ä½¿ç”¨ã€‚</li></ul><h3 id="_3-å‚æ•°ç­–ç•¥å¤„ç†å™¨" tabindex="-1"><a class="header-anchor" href="#_3-å‚æ•°ç­–ç•¥å¤„ç†å™¨" aria-hidden="true">#</a> 3. å‚æ•°ç­–ç•¥å¤„ç†å™¨</h3><p>åœ¨ Mybatis çš„æºç åŒ…ä¸­ï¼Œæœ‰ä¸€ä¸ª type åŒ…ï¼Œè¿™ä¸ªåŒ…ä¸‹æ‰€æä¾›çš„å°±æ˜¯ä¸€å¥—å‚æ•°çš„å¤„ç†ç­–ç•¥é›†åˆã€‚å®ƒé€šè¿‡å®šä¹‰ç±»å‹å¤„ç†å™¨æ¥å£ã€ç”±æŠ½è±¡æ¨¡æ¿å®ç°å¹¶å®šä¹‰æ ‡å‡†æµç¨‹ï¼Œå®šæå–æŠ½è±¡æ–¹æ³•äº¤ç»™å­ç±»å®ç°ï¼Œè¿™äº›å­ç±»å°±æ˜¯å„ä¸ªç±»å‹å¤„ç†å™¨çš„å…·ä½“å®ç°ã€‚</p><h4 id="_3-1-ç­–ç•¥æ¥å£" tabindex="-1"><a class="header-anchor" href="#_3-1-ç­–ç•¥æ¥å£" aria-hidden="true">#</a> 3.1 ç­–ç•¥æ¥å£</h4><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.type.TypeHandler</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TypeHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * è®¾ç½®å‚æ•°
     */</span>
    <span class="token keyword">void</span> <span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span> ps<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token class-name">T</span> parameter<span class="token punctuation">,</span> <span class="token class-name">JdbcType</span> jdbcType<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>é¦–å…ˆå®šä¹‰ä¸€ä¸ªç±»å‹å¤„ç†å™¨çš„æ¥å£ï¼Œè¿™å’Œæˆ‘ä»¬åœ¨æ—¥å¸¸çš„ä¸šåŠ¡å¼€å‘ä¸­æ˜¯ç±»ä¼¼çš„ï¼Œå°±åƒå¦‚æœæ˜¯å‘è´§å•†å“ï¼Œåˆ™å®šä¹‰ä¸€ä¸ªç»Ÿä¸€æ ‡å‡†æ¥å£ï¼Œä¹‹åæ ¹æ®è¿™ä¸ªæ¥å£å®ç°å‡ºä¸åŒçš„å‘è´§ç­–ç•¥ã€‚</li><li>è¿™é‡Œè®¾ç½®å‚æ•°ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæ‰€æœ‰ä¸åŒç±»å‹çš„å‚æ•°ï¼Œéƒ½å¯ä»¥è¢«æå–å‡ºæ¥è¿™äº›æ ‡å‡†çš„å‚æ•°å­—æ®µå’Œå¼‚å¸¸ï¼Œåç»­çš„å­ç±»æŒ‰ç…§è¿™ä¸ªæ ‡å‡†å®ç°å³å¯ã€‚<em>Mybatis æºç ä¸­æœ‰30+ä¸ªç±»å‹å¤„ç†</em></li></ul><h4 id="_3-2-æ¨¡æ¿æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_3-2-æ¨¡æ¿æ¨¡å¼" aria-hidden="true">#</a> 3.2 æ¨¡æ¿æ¨¡å¼</h4><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.type.BaseTypeHandler</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseTypeHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">TypeHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span> ps<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token class-name">T</span> parameter<span class="token punctuation">,</span> <span class="token class-name">JdbcType</span> jdbcType<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token comment">// å®šä¹‰æŠ½è±¡æ–¹æ³•ï¼Œç”±å­ç±»å®ç°ä¸åŒç±»å‹çš„å±æ€§è®¾ç½®</span>
        <span class="token function">setNonNullParameter</span><span class="token punctuation">(</span>ps<span class="token punctuation">,</span> i<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> jdbcType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">setNonNullParameter</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span> ps<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token class-name">T</span> parameter<span class="token punctuation">,</span> <span class="token class-name">JdbcType</span> jdbcType<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>é€šè¿‡æŠ½è±¡åŸºç±»çš„æµç¨‹æ¨¡æ¿å®šä¹‰ï¼Œä¾¿äºä¸€äº›å‚æ•°çš„åˆ¤æ–­å’Œå¤„ç†ã€‚ä¸è¿‡ç›®å‰æˆ‘ä»¬è¿˜ä¸éœ€è¦é‚£ä¹ˆå¤šçš„æµç¨‹æ ¡éªŒï¼Œæ‰€ä»¥è¿™é‡Œåªæ˜¯å®šä¹‰å’Œè°ƒç”¨äº†ä¸€ä¸ªæœ€åŸºæœ¬çš„æŠ½è±¡æ–¹æ³• setNonNullParameterã€‚</li><li>ä¸è¿‡æœ‰ä¸€ä¸ªè¿™æ ·çš„ç»“æ„ï¼Œå¯ä»¥è®©å¤§å®¶æ›´åŠ æ¸…æ¥šæ•´ä¸ª Mybatis æºç çš„æ¡†æ¶ï¼Œä¾¿äºåç»­é˜…è¯»æˆ–è€…æ‰©å±•æ­¤éƒ¨åˆ†æºç çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªæ¡†æ¶ç»“æ„çš„è®¤çŸ¥ã€‚</li></ul><h4 id="_3-3-å­ç±»å®ç°" tabindex="-1"><a class="header-anchor" href="#_3-3-å­ç±»å®ç°" aria-hidden="true">#</a> 3.3 å­ç±»å®ç°</h4><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.type.*</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> Longç±»å‹å¤„ç†å™¨
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LongTypeHandler</span> <span class="token keyword">extends</span> <span class="token class-name">BaseTypeHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">setNonNullParameter</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span> ps<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token class-name">Long</span> parameter<span class="token punctuation">,</span> <span class="token class-name">JdbcType</span> jdbcType<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        ps<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> Stringç±»å‹å¤„ç†å™¨
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringTypeHandler</span> <span class="token keyword">extends</span> <span class="token class-name">BaseTypeHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">setNonNullParameter</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span> ps<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token class-name">String</span> parameter<span class="token punctuation">,</span> <span class="token class-name">JdbcType</span> jdbcType<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        ps<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™é‡Œçš„æ¥å£å®ç°ä¸¾äº†ä¸ªä¾‹å­ï¼Œåˆ†åˆ«æ˜¯ï¼›LongTypeHandlerã€StringTypeHandlerï¼Œåœ¨ Mybatis æºç ä¸­è¿˜æœ‰å¾ˆå¤šå…¶ä»–ç±»å‹ï¼Œè¿™é‡Œæˆ‘ä»¬æš‚æ—¶ä¸éœ€è¦å®ç°é‚£ä¹ˆå¤šï¼Œåªè¦æ¸…æ¥šè¿™ä¸ªå¤„ç†è¿‡ç¨‹å’Œç¼–ç æ–¹å¼å³å¯ã€‚<em>å¤§å®¶åœ¨å­¦ä¹ ä¸­ï¼Œå¯ä»¥å°è¯•å†æ·»åŠ å‡ ä¸ªå…¶ä»–ç±»å‹ï¼Œç”¨äºå­¦ä¹ éªŒè¯</em></li></ul><h4 id="_3-4-ç±»å‹æ³¨å†Œæœº" tabindex="-1"><a class="header-anchor" href="#_3-4-ç±»å‹æ³¨å†Œæœº" aria-hidden="true">#</a> 3.4 ç±»å‹æ³¨å†Œæœº</h4><p>ç±»å‹å¤„ç†å™¨æ³¨å†Œæœº TypeHandlerRegistry æ˜¯æˆ‘ä»¬å‰é¢ç« èŠ‚å®ç°çš„ï¼Œè¿™é‡Œåªéœ€è¦åœ¨è¿™ä¸ªç±»ç»“æ„ä¸‹ï¼Œæ³¨å†Œæ–°çš„ç±»å‹å°±å¯ä»¥äº†ã€‚</p><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.type.TypeHandlerRegistry</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">TypeHandlerRegistry</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JdbcType</span><span class="token punctuation">,</span> <span class="token class-name">TypeHandler</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token constant">JDBC_TYPE_HANDLER_MAP</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EnumMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">JdbcType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Type</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">JdbcType</span><span class="token punctuation">,</span> <span class="token class-name">TypeHandler</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token constant">TYPE_HANDLER_MAP</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">TypeHandler</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token constant">ALL_TYPE_HANDLERS_MAP</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">TypeHandlerRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LongTypeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LongTypeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">StringTypeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">JdbcType</span><span class="token punctuation">.</span><span class="token constant">CHAR</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">StringTypeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">JdbcType</span><span class="token punctuation">.</span><span class="token constant">VARCHAR</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">StringTypeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™é‡Œåœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæ–°å¢åŠ äº† LongTypeHandlerã€StringTypeHandler ä¸¤ç§ç±»å‹çš„æ³¨å†Œå™¨ã€‚</li><li>åŒæ—¶å¯ä»¥æ³¨æ„åˆ°ï¼Œæ— è®ºæ˜¯å¯¹è±¡ç±»å‹ï¼Œè¿˜æ˜¯åŸºæœ¬ç±»å‹ï¼Œéƒ½æ˜¯ä¸€ä¸ªç±»å‹å¤„ç†å™¨ã€‚åªä¸è¿‡åœ¨æ³¨å†Œçš„æ—¶å€™å¤šæ³¨å†Œäº†ä¸€ä¸ªã€‚<em>è¿™ç§æ“ä½œæ–¹å¼å’Œæˆ‘ä»¬å¹³å¸¸çš„ä¸šåŠ¡å¼€å‘ä¸­ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ä¸€ç§æ˜¯å¤šæ³¨å†Œï¼Œå¦å¤–ä¸€ç§æ˜¯åˆ¤æ–­å¤„ç†ã€‚</em></li></ul><h3 id="_4-å‚æ•°æ„å»º" tabindex="-1"><a class="header-anchor" href="#_4-å‚æ•°æ„å»º" aria-hidden="true">#</a> 4. å‚æ•°æ„å»º</h3><p>ç›¸å¯¹äºå‰é¢ç« èŠ‚æ‰€å®Œæˆçš„å†…å®¹ï¼Œè¿™ä¸ªç« èŠ‚éœ€è¦å¯¹ SqlSourceBuilder æºç æ„å»ºå™¨ä¸­ï¼Œåˆ›å»ºå‚æ•°æ˜ å°„ ParameterMapping éœ€è¦æ·»åŠ å‚æ•°å¤„ç†å™¨çš„å†…å®¹ã€‚å› ä¸ºåªæœ‰è¿™æ ·æ‰èƒ½æ–¹ä¾¿çš„ä»å‚æ•°æ˜ å°„ä¸­è·å–åˆ°å¯¹åº”ç±»å‹çš„å¤„ç†å™¨è¿›è¡Œä½¿ç”¨ã€‚</p><p>é‚£ä¹ˆå°±éœ€è¦å®Œå–„ ParameterMapping æ·»åŠ  TypeHandler å±æ€§ä¿¡æ¯ï¼Œä»¥åŠåœ¨ ParameterMappingTokenHandler#buildParameterMapping å¤„ç†å‚æ•°æ˜ å°„æ—¶ï¼Œæ„å»ºå‡ºå‚æ•°çš„æ˜ å°„ã€‚è¿™ä¸€éƒ¨åˆ†æ˜¯åœ¨ä¸Šä¸€ç« èŠ‚çš„å®ç°è¿‡ç¨‹ä¸­ï¼Œç»†åŒ–çš„å®Œå–„éƒ¨åˆ†ï¼Œå¦‚å›¾ 10-6</p><p><img src="https://bugstack.cn/images/article/spring/mybatis-220526-10-06.png" alt="å›¾ 10-6 æ„å»ºå‚æ•°æ˜ å°„"></p><p>é‚£ä¹ˆç»“åˆä¸Šä¸€ç« èŠ‚ï¼Œè¿™é‡Œæˆ‘ä»¬å¼€å§‹æ‰©å±•å‡ºç±»å‹çš„è®¾ç½®ã€‚<em>åŒæ—¶æ³¨æ„ MetaClass åå°„å·¥å…·ç±»çš„ä½¿ç”¨</em></p><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.builder.SqlSourceBuilder</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// æ„å»ºå‚æ•°æ˜ å°„</span>
<span class="token keyword">private</span> <span class="token class-name">ParameterMapping</span> <span class="token function">buildParameterMapping</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å…ˆè§£æå‚æ•°æ˜ å°„,å°±æ˜¯è½¬åŒ–æˆä¸€ä¸ª HashMap | #{favouriteSection,jdbcType=VARCHAR}</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> propertiesMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ParameterExpression</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> property <span class="token operator">=</span> propertiesMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;property&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> propertyType<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>typeHandlerRegistry<span class="token punctuation">.</span><span class="token function">hasTypeHandler</span><span class="token punctuation">(</span>parameterType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        propertyType <span class="token operator">=</span> parameterType<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>property <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MetaClass</span> metaClass <span class="token operator">=</span> <span class="token class-name">MetaClass</span><span class="token punctuation">.</span><span class="token function">forClass</span><span class="token punctuation">(</span>parameterType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>metaClass<span class="token punctuation">.</span><span class="token function">hasGetter</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            propertyType <span class="token operator">=</span> metaClass<span class="token punctuation">.</span><span class="token function">getGetterType</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            propertyType <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        propertyType <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ„å»ºå‚æ•°æ˜ å°„ propertyï¼š{} propertyTypeï¼š{}&quot;</span><span class="token punctuation">,</span> property<span class="token punctuation">,</span> propertyType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ParameterMapping<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ParameterMapping<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> property<span class="token punctuation">,</span> propertyType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™ä¸€éƒ¨åˆ†å°±æ˜¯å¯¹å‚æ•°çš„ç»†åŒ–å¤„ç†ï¼Œæ„å»ºå‡ºå‚æ•°çš„æ˜ å°„å…³ç³»ï¼Œé¦–å…ˆæ˜¯ if åˆ¤æ–­å¯¹åº”çš„å‚æ•°ç±»å‹æ˜¯å¦åœ¨ TypeHandlerRegistry æ³¨å†Œå™¨ä¸­ï¼Œå¦‚æœä¸åœ¨åˆ™æ‹†è§£å¯¹è±¡ï¼ŒæŒ‰å±æ€§è¿›è¡Œè·å– propertyType çš„æ“ä½œã€‚</li><li>è¿™ä¸€å—ä¹Ÿç”¨åˆ°äº† MetaClass åå°„å·¥å…·ç±»çš„ä½¿ç”¨ï¼Œå®ƒçš„å­˜åœ¨å¯ä»¥è®©æˆ‘ä»¬æ›´åŠ æ–¹ä¾¿çš„å¤„ç†ï¼Œå¦åˆ™è¿˜éœ€è¦è¦å†å†™åå°„ç±»è¿›è¡Œè·å–å¯¹è±¡å±æ€§æ“ä½œã€‚</li></ul><h3 id="_5-å‚æ•°ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_5-å‚æ•°ä½¿ç”¨" aria-hidden="true">#</a> 5. å‚æ•°ä½¿ç”¨</h3><p>å‚æ•°æ„å»ºå®Œæˆåï¼Œå°±å¯ä»¥åœ¨ DefaultSqlSession#selectOne è°ƒç”¨æ—¶è®¾ç½®å‚æ•°ä½¿ç”¨äº†ã€‚é‚£ä¹ˆè¿™é‡Œçš„é“¾è·¯å…³ç³»ï¼›<code>Executor#query - &gt; SimpleExecutor#doQuery -&gt; StatementHandler#parameterize -&gt; PreparedStatementHandler#parameterize -&gt; ParameterHandler#setParameters</code> åˆ°äº† ParameterHandler#setParameters å°±å¯ä»¥çœ‹åˆ°äº†æ ¹æ®å‚æ•°çš„ä¸åŒå¤„ç†å™¨å¾ªç¯è®¾ç½®å‚æ•°ã€‚</p><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.scripting.defaults.DefaultParameterHandler</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultParameterHandler</span> <span class="token keyword">implements</span> <span class="token class-name">ParameterHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setParameters</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span> ps<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ParameterMapping</span><span class="token punctuation">&gt;</span></span> parameterMappings <span class="token operator">=</span> boundSql<span class="token punctuation">.</span><span class="token function">getParameterMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> parameterMappings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parameterMappings<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ParameterMapping</span> parameterMapping <span class="token operator">=</span> parameterMappings<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> propertyName <span class="token operator">=</span> parameterMapping<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Object</span> value<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>typeHandlerRegistry<span class="token punctuation">.</span><span class="token function">hasTypeHandler</span><span class="token punctuation">(</span>parameterObject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    value <span class="token operator">=</span> parameterObject<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token comment">// é€šè¿‡ MetaObject.getValue åå°„å–å¾—å€¼è®¾è¿›å»</span>
                    <span class="token class-name">MetaObject</span> metaObject <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">newMetaObject</span><span class="token punctuation">(</span>parameterObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    value <span class="token operator">=</span> metaObject<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">JdbcType</span> jdbcType <span class="token operator">=</span> parameterMapping<span class="token punctuation">.</span><span class="token function">getJdbcType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// è®¾ç½®å‚æ•°</span>
                logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ ¹æ®æ¯ä¸ªParameterMappingä¸­çš„TypeHandlerè®¾ç½®å¯¹åº”çš„å‚æ•°ä¿¡æ¯ valueï¼š{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">TypeHandler</span> typeHandler <span class="token operator">=</span> parameterMapping<span class="token punctuation">.</span><span class="token function">getTypeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                typeHandler<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span>ps<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> jdbcType<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ¯ä¸€ä¸ªå¾ªç¯çš„å‚æ•°è®¾ç½®ï¼Œéƒ½æ˜¯ä» BoundSql ä¸­è·å– ParameterMapping é›†åˆè¿›è¡Œå¾ªç¯æ“ä½œï¼Œè€Œè¿™ä¸ªé›†åˆå‚æ•°å°±æ˜¯æˆ‘ä»¬å‰é¢ ParameterMappingTokenHandler#buildParameterMapping æ„å»ºå‚æ•°æ˜ å°„æ—¶å¤„ç†çš„ã€‚</li><li>è®¾ç½®å‚æ•°æ—¶æ ¹æ®å‚æ•°çš„ parameterObject å…¥å‚çš„ä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦åŸºæœ¬ç±»å‹ï¼Œå¦‚æœä¸æ˜¯åˆ™ä»å¯¹è±¡ä¸­è¿›è¡Œæ‹†è§£è·å–ï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸ªå¯¹è±¡Aä¸­åŒ…æ‹¬å±æ€§bï¼‰ï¼Œå¤„ç†å®Œæˆåå°±å¯ä»¥å‡†ç¡®æ‹¿åˆ°å¯¹åº”çš„å…¥å‚å€¼äº†ã€‚<em>å› ä¸ºåœ¨æ˜ å°„å™¨æ–¹æ³• MapperMethod ä¸­å·²ç»å¤„ç†äº†ä¸€éæ–¹æ³•ç­¾åï¼Œæ‰€ä»¥è¿™é‡Œçš„å…¥å‚å°±æ›´æ–¹ä¾¿ä½¿ç”¨äº†</em></li><li>åŸºæœ¬ä¿¡æ¯è·å–å®Œæˆåï¼Œåˆ™æ ¹æ®å‚æ•°ç±»å‹è·å–åˆ°å¯¹åº”çš„ TypeHandler ç±»å‹å¤„ç†å™¨ï¼Œä¹Ÿå°±æ˜¯æ‰¾åˆ° LongTypeHandlerã€StringTypeHandler ç­‰ï¼Œç¡®å®šæ‰¾åˆ°ä»¥åï¼Œåˆ™å¯ä»¥è¿›è¡Œå¯¹åº”çš„å‚æ•°è®¾ç½®äº† typeHandler.setParameter(ps, i + 1, value, jdbcType) é€šè¿‡è¿™æ ·çš„æ–¹å¼æŠŠæˆ‘ä»¬ä¹‹å‰ç¡¬ç¼–ç çš„æ“ä½œè¿›è¡Œè§£è€¦ã€‚</li></ul><h2 id="äº”ã€æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#äº”ã€æµ‹è¯•" aria-hidden="true">#</a> äº”ã€æµ‹è¯•</h2><h3 id="_1-äº‹å…ˆå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#_1-äº‹å…ˆå‡†å¤‡" aria-hidden="true">#</a> 1. äº‹å…ˆå‡†å¤‡</h3><h4 id="_1-1-åˆ›å»ºåº“è¡¨" tabindex="-1"><a class="header-anchor" href="#_1-1-åˆ›å»ºåº“è¡¨" aria-hidden="true">#</a> 1.1 åˆ›å»ºåº“è¡¨</h4><p>åˆ›å»ºä¸€ä¸ªæ•°æ®åº“åç§°ä¸º mybatis å¹¶åœ¨åº“ä¸­åˆ›å»ºè¡¨ user ä»¥åŠæ·»åŠ æµ‹è¯•æ•°æ®ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span>
    <span class="token keyword">USER</span>
    <span class="token punctuation">(</span>
        id <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;è‡ªå¢ID&#39;</span><span class="token punctuation">,</span>
        userId <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;ç”¨æˆ·ID&#39;</span><span class="token punctuation">,</span>
        userHead <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;ç”¨æˆ·å¤´åƒ&#39;</span><span class="token punctuation">,</span>
        createTime <span class="token keyword">TIMESTAMP</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;åˆ›å»ºæ—¶é—´&#39;</span><span class="token punctuation">,</span>
        updateTime <span class="token keyword">TIMESTAMP</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;æ›´æ–°æ—¶é—´&#39;</span><span class="token punctuation">,</span>
        userName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
    
<span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">user</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> userId<span class="token punctuation">,</span> userHead<span class="token punctuation">,</span> createTime<span class="token punctuation">,</span> updateTime<span class="token punctuation">,</span> userName<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;10001&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1_04&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;2022-04-13 00:00:00&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;2022-04-13 00:00:00&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;å°å‚…å“¥&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-2-é…ç½®æ•°æ®æº" tabindex="-1"><a class="header-anchor" href="#_1-2-é…ç½®æ•°æ®æº" aria-hidden="true">#</a> 1.2 é…ç½®æ•°æ®æº</h4><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>JDBC<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POOLED<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driver<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.mysql.jdbc.Driver<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://127.0.0.1:3306/mybatis?useUnicode=true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>é€šè¿‡ <code>mybatis-config-datasource.xml</code> é…ç½®æ•°æ®æºä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šdriverã€urlã€usernameã€password</li><li>åœ¨è¿™é‡Œ dataSource å¯ä»¥æŒ‰éœ€é…ç½®æˆ DRUIDã€UNPOOLED å’Œ POOLED è¿›è¡Œæµ‹è¯•éªŒè¯ã€‚</li></ul><h4 id="_1-3-é…ç½®mapper" tabindex="-1"><a class="header-anchor" href="#_1-3-é…ç½®mapper" aria-hidden="true">#</a> 1.3 é…ç½®Mapper</h4><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queryUserInfoById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.Long<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.mybatis.test.po.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    SELECT id, userId, userName, userHead
    FROM user
    where id = #{id}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queryUserInfo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.mybatis.test.po.User<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.mybatis.test.po.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    SELECT id, userId, userName, userHead
    FROM user
    where id = #{id} and userId = #{userId}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™éƒ¨åˆ†æš‚æ—¶ä¸éœ€è¦è°ƒæ•´ï¼Œç›®å‰è¿˜åªæ˜¯ä¸€ä¸ªå…¥å‚çš„ç±»å‹çš„å‚æ•°ï¼Œåç»­æˆ‘ä»¬å…¨éƒ¨å®Œå–„è¿™éƒ¨åˆ†å†…å®¹ä»¥åï¼Œåˆ™å†æä¾›æ›´å¤šçš„å…¶ä»–å‚æ•°è¿›è¡ŒéªŒè¯ã€‚</li></ul><h3 id="_2-å•å…ƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-å•å…ƒæµ‹è¯•" aria-hidden="true">#</a> 2. å•å…ƒæµ‹è¯•</h3><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.test.ApiTest</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Before</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. ä»SqlSessionFactoryä¸­è·å–SqlSession</span>
    <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsReader</span><span class="token punctuation">(</span><span class="token string">&quot;mybatis-config-datasource.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å› ä¸ºæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦éªŒè¯ä¸¤ç§ä¸åŒå…¥å‚çš„å•å…ƒæµ‹è¯•ï¼Œåˆ†åˆ«æ¥æµ‹è¯•åŸºæœ¬ç±»å‹å‚æ•°å’Œå¯¹è±¡ç±»å‹å‚æ•°ã€‚</li></ul><h4 id="_2-1-åŸºæœ¬ç±»å‹å‚æ•°" tabindex="-1"><a class="header-anchor" href="#_2-1-åŸºæœ¬ç±»å‹å‚æ•°" aria-hidden="true">#</a> 2.1 åŸºæœ¬ç±»å‹å‚æ•°</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_queryUserInfoById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. è·å–æ˜ å°„å™¨å¯¹è±¡</span>
    <span class="token class-name">IUserDao</span> userDao <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">IUserDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. æµ‹è¯•éªŒè¯ï¼šåŸºæœ¬å‚æ•°</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> userDao<span class="token punctuation">.</span><span class="token function">queryUserInfoById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•ç»“æœï¼š{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/images/article/spring/mybatis-220526-10-07.png" alt=""></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">07</span><span class="token operator">:</span><span class="token number">40</span><span class="token operator">:</span><span class="token number">08.531</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>builder<span class="token punctuation">.</span></span>SqlSourceBuilder</span> <span class="token operator">-</span> æ„å»ºå‚æ•°æ˜ å°„ propertyï¼šid propertyTypeï¼š<span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Long</span>
<span class="token number">07</span><span class="token operator">:</span><span class="token number">40</span><span class="token operator">:</span><span class="token number">08.598</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>s<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span></span>DefaultSqlSession</span> <span class="token operator">-</span> æ‰§è¡ŒæŸ¥è¯¢ statementï¼š<span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span>IUserDao</span><span class="token punctuation">.</span>queryUserInfoById parameterï¼š<span class="token number">1</span>
<span class="token number">07</span><span class="token operator">:</span><span class="token number">40</span><span class="token operator">:</span><span class="token number">08.875</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">Created</span> connection <span class="token number">183284570.</span>
<span class="token number">07</span><span class="token operator">:</span><span class="token number">40</span><span class="token operator">:</span><span class="token number">08.894</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>s<span class="token punctuation">.</span>d<span class="token punctuation">.</span></span>DefaultParameterHandler</span> <span class="token operator">-</span> æ ¹æ®æ¯ä¸ª<span class="token class-name">ParameterMapping</span>ä¸­çš„<span class="token class-name">TypeHandler</span>è®¾ç½®å¯¹åº”çš„å‚æ•°ä¿¡æ¯ valueï¼š<span class="token number">1</span>
<span class="token number">07</span><span class="token operator">:</span><span class="token number">40</span><span class="token operator">:</span><span class="token number">08.961</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æµ‹è¯•è¿‡ç¨‹ä¸­å¯ä»¥åœ¨ DefaultParameterHandler#setParameters ä¸­æ‰“æ–­ç‚¹ï¼ŒéªŒè¯æ–¹æ³•å‚æ•°ä»¥åŠè·å¾—åˆ°çš„ç±»å‹å¤„ç†å™¨ï¼Œè¿™é‡Œæµ‹è¯•éªŒè¯é€šè¿‡ï¼Œå¯ä»¥æ»¡è¶³åŸºæœ¬ç±»å‹å¯¹è±¡çš„å…¥å‚ä¿¡æ¯ã€‚</li></ul><h4 id="_2-2-å¯¹è±¡ç±»å‹å‚æ•°" tabindex="-1"><a class="header-anchor" href="#_2-2-å¯¹è±¡ç±»å‹å‚æ•°" aria-hidden="true">#</a> 2.2 å¯¹è±¡ç±»å‹å‚æ•°</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_queryUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. è·å–æ˜ å°„å™¨å¯¹è±¡</span>
    <span class="token class-name">IUserDao</span> userDao <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">IUserDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. æµ‹è¯•éªŒè¯ï¼šå¯¹è±¡å‚æ•°</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> userDao<span class="token punctuation">.</span><span class="token function">queryUserInfo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string">&quot;10001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•ç»“æœï¼š{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/images/article/spring/mybatis-220526-10-08.png" alt=""></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">07</span><span class="token operator">:</span><span class="token number">41</span><span class="token operator">:</span><span class="token number">11.025</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>builder<span class="token punctuation">.</span></span>SqlSourceBuilder</span> <span class="token operator">-</span> æ„å»ºå‚æ•°æ˜ å°„ propertyï¼šuserId propertyTypeï¼š<span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span>
<span class="token number">07</span><span class="token operator">:</span><span class="token number">41</span><span class="token operator">:</span><span class="token number">11.232</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>s<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span></span>DefaultSqlSession</span> <span class="token operator">-</span> æ‰§è¡ŒæŸ¥è¯¢ statementï¼š<span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span>IUserDao</span><span class="token punctuation">.</span>queryUserInfo parameterï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">}</span>
<span class="token number">07</span><span class="token operator">:</span><span class="token number">41</span><span class="token operator">:</span><span class="token number">11.638</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span></span>PooledDataSource</span> <span class="token operator">-</span> <span class="token class-name">Created</span> connection <span class="token number">402405659.</span>
<span class="token number">07</span><span class="token operator">:</span><span class="token number">41</span><span class="token operator">:</span><span class="token number">11.661</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>s<span class="token punctuation">.</span>d<span class="token punctuation">.</span></span>DefaultParameterHandler</span> <span class="token operator">-</span> æ ¹æ®æ¯ä¸ª<span class="token class-name">ParameterMapping</span>ä¸­çš„<span class="token class-name">TypeHandler</span>è®¾ç½®å¯¹åº”çš„å‚æ•°ä¿¡æ¯ valueï¼š<span class="token number">1</span>
<span class="token number">07</span><span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token number">28.516</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>s<span class="token punctuation">.</span>d<span class="token punctuation">.</span></span>DefaultParameterHandler</span> <span class="token operator">-</span> æ ¹æ®æ¯ä¸ª<span class="token class-name">ParameterMapping</span>ä¸­çš„<span class="token class-name">TypeHandler</span>è®¾ç½®å¯¹åº”çš„å‚æ•°ä¿¡æ¯ valueï¼š<span class="token string">&quot;10001&quot;</span>
<span class="token number">07</span><span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token number">30.820</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ­¤æ¡ˆä¾‹ä¸»è¦éªŒè¯å¯¹è±¡å‚æ•° User ä¸­åŒ…å«ä¸¤ä¸ªå±æ€§æ—¶ï¼Œæ£€æŸ¥æˆ‘ä»¬çš„ä»£ç å¤„ç†è¿‡ç¨‹ï¼ŒéªŒè¯æ˜¯å¦å¯ä»¥æ­£ç¡®è·å–åˆ°ä¸¤ä¸ªç±»å‹å¤„ç†å™¨ï¼Œåˆ†åˆ«è®¾ç½®å‚æ•°çš„è¿‡ç¨‹ã€‚</li><li>ä»æµ‹è¯•ç»“æœä¸­ï¼Œå¯ä»¥çœ‹åˆ°æµ‹è¯•é€šè¿‡ï¼Œå¹¶æ‰“å°äº†ç›¸å…³å‚æ•°çš„æ„å»ºå’Œä½¿ç”¨ã€‚</li></ul><h2 id="å…­ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#å…­ã€æ€»ç»“" aria-hidden="true">#</a> å…­ã€æ€»ç»“</h2><ul><li>åˆ°æœ¬ç« èŠ‚ï¼Œæˆ‘ä»¬ç®—æ˜¯æŠŠä¸€ä¸ª ORM æ¡†æ¶çš„åŸºæœ¬æµç¨‹ä¸²è”èµ·æ¥äº†ï¼Œä¸è¦ç¡¬ç¼–ç ä¹Ÿèƒ½å®Œæˆç®€å• SQL çš„å¤„ç†ã€‚è¯»è€…ä¼™ä¼´å¯ä»¥ä»”ç»†é˜…è¯»ä¸‹å½“å‰æ¡†æ¶ä¸­ï¼Œæ‰€åŒ…å«çš„åˆ†åŒ…ç»“æ„ã€‚æ¯”å¦‚ï¼šæ„å»ºã€ç»‘å®šã€æ˜ å°„ã€åå°„ã€æ‰§è¡Œã€ç±»å‹ã€äº‹åŠ¡ã€æ•°æ®æºç­‰ç­‰ï¼Œå°è¯•ç”»ä¸€ç”»ä»–ä»¬çš„é“¾æ¥å…³ç³»ï¼Œè¿™æ ·ä¼šè®©ä½ æ›´åŠ æ¸…æ™°ç°åœ¨çš„ä»£ç è§£è€¦ç»“æ„ã€‚</li><li>æ­¤ç« èŠ‚ä¸­æ¯”è¾ƒé‡è¦çš„ä½“ç°æ˜¯å…³äºå‚æ•°ç±»å‹çš„ç­–ç•¥åŒ–è®¾è®¡ï¼Œé€šè¿‡ç­–ç•¥è§£è€¦ï¼Œæ¨¡æ¿å®šä¹‰æµç¨‹ï¼Œè®©æˆ‘ä»¬æ•´ä¸ªå‚æ•°è®¾ç½®å˜å¾—æ›´åŠ æ¸…æ™°ï¼Œä¹Ÿå°±ä¸éœ€è¦ç¡¬ç¼–ç äº†ã€‚</li><li>é™¤æ­¤ä¹‹å¤–ä¹Ÿæœ‰ä¸€äº›ç»†èŠ‚çš„åŠŸèƒ½ç‚¹ï¼Œå¦‚ï¼›MapperMethod ä¸­æ·»åŠ æ–¹æ³•ç­¾åã€ç±»å‹å¤„ç†å™¨åˆ›å»ºå’Œä½¿ç”¨æ—¶å€™ï¼Œéƒ½ä½¿ç”¨äº† MetaObject è¿™æ ·çš„åå°„å™¨å·¥å…·ç±»è¿›è¡Œå¤„ç†ã€‚è¿™äº›ç»†èŠ‚çš„åŠŸèƒ½ç‚¹ï¼Œè¯»è€…éœ€è¦åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œè¿›è¡Œè°ƒè¯•éªŒè¯æ‰èƒ½æ›´å¥½çš„å¸æ”¶æ­¤ç±»ç¼–ç è®¾è®¡çš„æŠ€å·§å’Œç»éªŒã€‚</li></ul><h2 id="ä¸ƒã€ä¼˜ç§€ä½œä¸š" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€ä¼˜ç§€ä½œä¸š" aria-hidden="true">#</a> ä¸ƒã€ä¼˜ç§€ä½œä¸š</h2>`,88),y={href:"https://t.zsxq.com/09DAtfS4T",target:"_blank",rel:"noopener noreferrer"},h={href:"https://t.zsxq.com/0e8CESFcV",target:"_blank",rel:"noopener noreferrer"},w={href:"https://t.zsxq.com/11bIcdvEs",target:"_blank",rel:"noopener noreferrer"};function f(q,S){const a=e("ExternalLinkIcon");return c(),o("div",null,[u,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),r,s("åšå®¢ï¼š"),n("a",k,[s("https://bugstack.cn"),t(a)]),d,s("åŸæ–‡ï¼š"),n("a",m,[s("https://mp.weixin.qq.com/s/f-1g66RrbDeJI5tmHQykHg"),t(a)])]),v,b,g,n("ul",null,[n("li",null,[n("a",y,[s("é’ˆå¯¹ä¸åŒç±»å‹çš„å‚æ•°ï¼Œä½¿ç”¨äº†å¯¹åº”çš„ç±»å‹å¤„ç†å™¨å®Œæˆå‚æ•°å€¼çš„æ³¨å…¥ @liuc"),t(a)])]),n("li",null,[n("a",h,[s("æ‰‹å†™Mybatisæºç ç¬¬ä¸€ç« åˆ°ç¬¬åç« æ€»è§ˆ @å°ç†æƒ³"),t(a)])]),n("li",null,[n("a",w,[s("è¿™ä¸€èŠ‚æ ¸å¿ƒå°±æ˜¯æŠŠå‚æ•°åŒ–çš„åŠŸèƒ½ï¼Œç”±ç¡¬ç¼–ç å˜æˆä½¿ç”¨ç±»å‹å¤„ç†å™¨è¿›è¡Œè®¾ç½®ã€‚è¿ç”¨ç­–ç•¥æ¨¡å¼ï¼Œåœ¨æ„å»ºå‚æ•°æ—¶æ ¹æ®ç±»å‹ï¼Œé€‰æ‹©å¯¹åº”çš„ç­–ç•¥ç±»å‹å¤„ç†å™¨ã€‚"),t(a)])])])])}const j=p(i,[["render",f],["__file","2022-05-26-di10zhangï¼šshiyongceluemoshiï¼Œdiaoyongcanshuchuliqi.html.vue"]]);export{j as default};
