import{_ as e,r as o,o as c,c as i,a as n,b as s,d as t,e as p}from"./app-3RcBQnkC.js";const l={},u=n("h1",{id:"http-框架使用和场景实战-结合chatglm自动回帖",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#http-框架使用和场景实战-结合chatglm自动回帖","aria-hidden":"true"},"#"),s(" HTTP 框架使用和场景实战 - 结合ChatGLM自动回帖！")],-1),r=n("br",null,null,-1),k={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=n("blockquote",null,[n("p",null,"沉淀、分享、成长，让自己和他人都能有所收获！😄")],-1),m=n("iframe",{id:"B-Video",src:"//player.bilibili.com/player.html?aid=577179347&bvid=BV1GB4y1f7U4&cid=1299792581&p=1",scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",width:"100%",height:"480"}," ",-1),h=n("p",null,"本文的宗旨在于通过简单干净实践的方式教会读者，HTTP的常用框架使用，HTTP接口快速对接方式。以及在编码实战中练习 HTTP 对数据的采集、ChatGLM对接、问题回答。这样的场景学习，非常适合以后大家在做一些智能化问答进行参考使用。",-1),v=n("p",null,"本文涉及的工程：",-1),g={href:"https://gitcode.net/KnowledgePlanet/road-map/xfg-dev-tech-http",target:"_blank",rel:"noopener noreferrer"},b={href:"https://bugstack.cn/md/project/chatgpt/sdk/chatglm-sdk-java.html",target:"_blank",rel:"noopener noreferrer"},f=n("h2",{id:"一、案例背景",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#一、案例背景","aria-hidden":"true"},"#"),s(" 一、案例背景")],-1),_=n("p",null,"虽然在分布式架构的微服务内部是RPC调用，但在对外的Web/H5等场景下，则需要使用HTTP协议进行调用。因而我们在对接公司以外的其他服务时，通常都是HTTP协议，包括你对接微信支付、ChatGLM等。当然也有少部分使用 websocket 协议。",-1),w=n("p",null,"但众所周知HTTP的调用，会涉及较多的信息配置。包括；请求头、入参、出参，而这些内容都是非对象化的设计。很多人在对接特别多的 HTTP 请求以后，自己的工程代码就会变得非常混乱。所以我们需要用一些 HTTP 框架，来解决这个场景问题，让 HTTP 的调用更加优雅。",-1),x=n("p",null,"那么本章节小傅哥会结合知识星球的接口进行案例场景学习；",-1),y=n("div",{align:"center"},[n("img",{src:"https://bugstack.cn/images/roadmap/tutorial/roadmap-http-01.png?raw=true",width:"650px"})],-1),C=n("strong",null,"星球免费加入",-1),q={href:"https://wx.zsxq.com/dweb2/index/group/28885518425541",target:"_blank",rel:"noopener noreferrer"},S=n("li",null,"本章节所提供的课程源码，即可复现截图中的展示内容。自动化Ai回复问答。",-1),T=p('<h2 id="二、接口提取" tabindex="-1"><a class="header-anchor" href="#二、接口提取" aria-hidden="true">#</a> 二、接口提取</h2><p>接下来，小傅哥会告诉如何非常快速的使用Java代码对接上HTTP调用。—— 把🐘大象装冰箱统共分3步；</p><h3 id="_1-第一步" tabindex="-1"><a class="header-anchor" href="#_1-第一步" aria-hidden="true">#</a> 1. 第一步</h3><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-http-02.png?raw=true" width="650px"></div>',4),L={href:"https://wx.zsxq.com/dweb2/index/group/28885518425541",target:"_blank",rel:"noopener noreferrer"},M=n("li",null,"之后，摁F12打开控制台，选择网络模块。",-1),P=n("li",null,[s("最后，找到 topics 接口查询。在接口上鼠标右键。"),n("strong",null,"以cURL格式复制")],-1),I=n("h3",{id:"_2-第二步",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2-第二步","aria-hidden":"true"},"#"),s(" 2. 第二步")],-1),A=n("div",{align:"center"},[n("img",{src:"https://bugstack.cn/images/roadmap/tutorial/roadmap-http-03.png?raw=true",width:"650px"})],-1),j={href:"https://www.apipost.cn/",target:"_blank",rel:"noopener noreferrer"},G=n("li",null,"之后，点击左侧的导入接口，这个里面可以直接把 cURL 格式接口导入进去。",-1),R=n("li",null,[s("最后，点击"),n("strong",null,"立即导入"),s(" - 导入后你就可以点击"),n("strong",null,"发送"),s("按钮测试验证了。")],-1),D=p('<h3 id="_3-第三步" tabindex="-1"><a class="header-anchor" href="#_3-第三步" aria-hidden="true">#</a> 3. 第三步</h3><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-http-04.png?raw=true" width="650px"></div><ul><li>首先，点击生成代码，会弹出一个各类语言对接代码案例。</li><li>之后，在你需要的类型代码上复制生成的代码。</li><li>最后，把代码粘贴到Java工程中测试。这部分代码可以参考案例工程 <code>cn.bugstack.xfg.dev.tech.test#HttpClientTest|OKHttpTest|Retrofit2Test</code></li></ul><hr><p>除此之外，你还可以使用Ai工具，来生成对接的测试代码。</p><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-http-05.png?raw=true" width="850px"></div><ul><li>这样的方式也是非常好用的，而且如果有运行问题，你还可以继续提问。</li><li>用编程经验的人用 OpenAi 会更舒服，没有编程经验的人完全依赖 OpenAi 也会遇到各种错误。</li></ul><h2 id="三、玩个场景" tabindex="-1"><a class="header-anchor" href="#三、玩个场景" aria-hidden="true">#</a> 三、玩个场景</h2><h3 id="_1-需求说明" tabindex="-1"><a class="header-anchor" href="#_1-需求说明" aria-hidden="true">#</a> 1. 需求说明</h3><p>接下来，我结合所学技术锻炼下。结合星球完成一个自动Ai回贴的功能，通过定时任务扫描星球接口帖子，并对未回答且圈【@小傅哥】的帖子进行采集回答。</p><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-http-06.png?raw=true" width="650px"></div><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-http-07.png?raw=true" width="650px"></div>',12),H=n("li",null,"这里的接口，需要用到2个：一个扫描帖子的HTTP接口，一个回复帖子的HTTP接口。",-1),E={href:"https://github.com/fuzhengwei/chatglm-sdk-java",target:"_blank",rel:"noopener noreferrer"},K=p(`<h3 id="_2-工程结构" tabindex="-1"><a class="header-anchor" href="#_2-工程结构" aria-hidden="true">#</a> 2. 工程结构</h3><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-http-08.png?raw=true" width="850px"></div><ul><li>首先，你可以下载工程代码，按照这个结构来看代码。</li><li>之后，工程中对接了 ChatGLM SDK 并做了相关的配置在YML中。此外 YML中的 ChatGLM SDK 需要的 ApiSecretKey 可以通过官网申请。之后星球的 cookie 可以通过 F12 请求头中复制 Cookie 信息。</li><li>最后，是 ZSXQJob 的开发使用。</li></ul><h3 id="_3-代码实现" tabindex="-1"><a class="header-anchor" href="#_3-代码实现" aria-hidden="true">#</a> 3. 代码实现</h3><h4 id="_4-1-chatglm-sdk-对接" tabindex="-1"><a class="header-anchor" href="#_4-1-chatglm-sdk-对接" aria-hidden="true">#</a> 4.1 ChatGLM SDK 对接</h4><p><strong>源码</strong>：<code>cn.bugstack.xfg.dev.tech.config.ChatGLMSDKConfig</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;chatglm.sdk.config.enabled&quot;</span><span class="token punctuation">,</span> havingValue <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span> matchIfMissing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">OpenAiSession</span> <span class="token function">openAiSession</span><span class="token punctuation">(</span><span class="token class-name">ChatGLMSDKConfigProperties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. 配置文件</span>
    <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>chatglm<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span>Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>chatglm<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span>Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    configuration<span class="token punctuation">.</span><span class="token function">setApiHost</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getApiHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    configuration<span class="token punctuation">.</span><span class="token function">setApiSecretKey</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getApiSecretKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. 会话工厂</span>
    <span class="token class-name">OpenAiSessionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultOpenAiSessionFactory</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3. 开启会话</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7),O={href:"https://github.com/fuzhengwei/chatglm-sdk-java",target:"_blank",rel:"noopener noreferrer"},B=p(`<h4 id="_4-2-流程串联" tabindex="-1"><a class="header-anchor" href="#_4-2-流程串联" aria-hidden="true">#</a> 4.2 流程串联</h4><p><strong>源码</strong>：<code>cn.bugstack.xfg.dev.tech.job.ZSXQJob</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">&quot;0/10 * * * * ?&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">Response</span> response <span class="token operator">=</span> <span class="token function">getResponse</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RespData</span> respData <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getRespData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TopicsItem</span><span class="token punctuation">&gt;</span></span> topics <span class="token operator">=</span> respData<span class="token punctuation">.</span><span class="token function">getTopics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TopicsItem</span> topicsItem <span class="token operator">:</span> topics<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 是否回答过判断</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isCommentDone</span><span class="token punctuation">(</span>topicsItem<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token comment">// 找到圈我我帖子</span>
        <span class="token keyword">long</span> topicId <span class="token operator">=</span> topicsItem<span class="token punctuation">.</span><span class="token function">getTopicId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Talk</span> talk <span class="token operator">=</span> topicsItem<span class="token punctuation">.</span><span class="token function">getTalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// &quot;&lt;e type=&quot;mention&quot; uid=&quot;241858242255511&quot; title=&quot;%40%E5%B0%8F%E5%82%85%E5%93%A5&quot; /&gt; 提问 java 冒泡排序&quot;</span>
        <span class="token class-name">String</span> text <span class="token operator">=</span> talk<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 正在匹配处理</span>
        <span class="token class-name">String</span> regex <span class="token operator">=</span> <span class="token string">&quot;&lt;e type=\\&quot;mention\\&quot; uid=\\&quot;(\\\\d+)\\&quot; title=\\&quot;(.*?)\\&quot; /&gt; (.*)&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">Pattern</span> pattern <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Matcher</span> matcher <span class="token operator">=</span> pattern<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>matcher<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> uid <span class="token operator">=</span> matcher<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> remainingText <span class="token operator">=</span> matcher<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;241858242255511&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> openAiSession<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;你没有开启 ChatGLM 参考yml配置文件来开启&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 你可以使用 ChatGLM SDK 进行回答，回复问题；</span>
                    <span class="token function">comment</span><span class="token punctuation">(</span>cookie<span class="token punctuation">,</span> topicId<span class="token punctuation">,</span> <span class="token string">&quot;【测试，只回答圈我的帖子】对接 ChatGLM SDK https://bugstack.cn/md/project/chatgpt/sdk/chatglm-sdk-java.html 回答：&quot;</span> <span class="token operator">+</span> remainingText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ChatGLM 进入回答 {} {}&quot;</span><span class="token punctuation">,</span> topicId<span class="token punctuation">,</span> remainingText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>topicIds<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>topicId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token keyword">continue</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        topicIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>topicId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    
                        <span class="token comment">// 入参；模型、请求信息</span>
                        <span class="token class-name">ChatCompletionRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChatCompletionRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        request<span class="token punctuation">.</span><span class="token function">setModel</span><span class="token punctuation">(</span><span class="token class-name">Model</span><span class="token punctuation">.</span><span class="token constant">CHATGLM_LITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// chatGLM_6b_SSE、chatglm_lite、chatglm_lite_32k、chatglm_std、chatglm_pro</span>
                        request<span class="token punctuation">.</span><span class="token function">setPrompt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ChatCompletionRequest<span class="token punctuation">.</span>Prompt</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">7988151926241837899L</span><span class="token punctuation">;</span>
                            <span class="token punctuation">{</span>
                                <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">ChatCompletionRequest<span class="token punctuation">.</span>Prompt</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">role</span><span class="token punctuation">(</span><span class="token class-name">Role</span><span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span>remainingText<span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        
                        <span class="token comment">// 请求</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token class-name">StringBuilder</span> content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            openAiSession<span class="token punctuation">.</span><span class="token function">completions</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">EventSourceListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token annotation punctuation">@Override</span>
                                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onEvent</span><span class="token punctuation">(</span><span class="token class-name">EventSource</span> eventSource<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> type<span class="token punctuation">,</span> <span class="token class-name">String</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token class-name">ChatCompletionResponse</span> chatCompletionResponse <span class="token operator">=</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token class-name">ChatCompletionResponse</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;测试结果 onEvent：{}&quot;</span><span class="token punctuation">,</span> chatCompletionResponse<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token comment">// type 消息类型，add 增量，finish 结束，error 错误，interrupted 中断</span>
                                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">EventType</span><span class="token punctuation">.</span>finish<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token class-name">ChatCompletionResponse<span class="token punctuation">.</span>Meta</span> meta <span class="token operator">=</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>chatCompletionResponse<span class="token punctuation">.</span><span class="token function">getMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ChatCompletionResponse<span class="token punctuation">.</span>Meta</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;[输出结束] Tokens {}&quot;</span><span class="token punctuation">,</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>meta<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                    content<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>chatCompletionResponse<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                                <span class="token annotation punctuation">@Override</span>
                                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClosed</span><span class="token punctuation">(</span><span class="token class-name">EventSource</span> eventSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;对话完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token comment">// 你可以使用 ChatGLM SDK 进行回答，回复问题；</span>
                                    <span class="token function">comment</span><span class="token punctuation">(</span>cookie<span class="token punctuation">,</span> topicId<span class="token punctuation">,</span> <span class="token string">&quot;ChatGLM 回答：&quot;</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    topicIds<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>topicId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JsonProcessingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>以上代码就是自动智能Ai回贴的流程代码，因为是做示例，所以没有按照职责边界做拆分。</li><li>这段代码中会扫码帖子，并对符合流程需要我【@小傅哥】回答的帖子，进行采集和回答。</li><li>回答帖子会创建一个线程，调用 ChatGLM 并对返回的流式数据最封装。最后在完成时候，进行回答操作。</li><li>注意，这里因为限定的判断了 uId = 241858242255511 所以只有@小傅哥，才会回答。你也可以通过回复帖子，查看自己的 uId 替换。</li><li>此外，更多的细节代码，可以参考工程。</li></ul><h2 id="四、测试验证" tabindex="-1"><a class="header-anchor" href="#四、测试验证" aria-hidden="true">#</a> 四、测试验证</h2><h3 id="_1-环境配置" tabindex="-1"><a class="header-anchor" href="#_1-环境配置" aria-hidden="true">#</a> 1. 环境配置</h3><div class="language-pom line-numbers-mode" data-ext="pom"><pre class="language-pom"><code>chatglm:
  sdk:
    config:
      # 状态；true = 开启、false 关闭
      enabled: true
      # 官网地址
      api-host: https://open.bigmodel.cn/
      # 官网申请 https://open.bigmodel.cn/usercenter/apikeys
      api-secret-key: 4e087e4135306ef4a676f0cce*****.sgP2D*****
      # 知识星球 Cookie 你需要获取你的 cookie 登录
      cookie: zsxq_access_token=86EB23*****
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>首先你需要在 application-dev.yml 配置相关的信息，这些信息可以从下面的说明中获取。</li><li>如果你暂时又申请不到 ChatGLM 还想测试，可以把 enabled 配置为 false</li></ul><h4 id="_1-1-获取-chatglm-apisecretkey" tabindex="-1"><a class="header-anchor" href="#_1-1-获取-chatglm-apisecretkey" aria-hidden="true">#</a> 1.1 获取 ChatGLM ApiSecretKey</h4><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-http-09.png?raw=true" width="850px"></div>`,10),z={href:"https://open.bigmodel.cn/usercenter/apikeys",target:"_blank",rel:"noopener noreferrer"},N=n("li",null,"备注：申请开通即可，很快就可以使用。",-1),J=n("h4",{id:"_1-2-获取星球-cookie",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_1-2-获取星球-cookie","aria-hidden":"true"},"#"),s(" 1.2 获取星球 Cookie")],-1),V=n("div",{align:"center"},[n("img",{src:"https://bugstack.cn/images/roadmap/tutorial/roadmap-http-10.png?raw=true",width:"850px"})],-1),F={href:"https://wx.zsxq.com/dweb2/index/group/28885518425541",target:"_blank",rel:"noopener noreferrer"},U=n("li",null,"获取：你可以在进入后，点击任意一个调用的接口，找到 Cookie 信息。",-1),Q=n("li",null,"注意：如果你对接了模拟登录接口，还可以自动的获取 Cookie 信息。",-1),X=p('<h3 id="_2-启动程序和回贴" tabindex="-1"><a class="header-anchor" href="#_2-启动程序和回贴" aria-hidden="true">#</a> 2. 启动程序和回贴</h3><h4 id="_2-1-发个帖子" tabindex="-1"><a class="header-anchor" href="#_2-1-发个帖子" aria-hidden="true">#</a> 2.1 发个帖子</h4><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-http-11.png?raw=true" width="650px"></div><ul><li>注意要圈<strong>小傅哥</strong>发帖子，如果你程序中修改了uId 为自己，那么可以圈你提问。</li></ul><h4 id="_2-2-回复帖子" tabindex="-1"><a class="header-anchor" href="#_2-2-回复帖子" aria-hidden="true">#</a> 2.2 回复帖子</h4><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-http-12.png?raw=true" width="850px"></div>',6);function Y(Z,W){const a=o("ExternalLinkIcon");return c(),i("div",null,[u,n("p",null,[s("作者：小傅哥 "),r,s("博客："),n("a",k,[s("https://bugstack.cn"),t(a)])]),d,m,h,v,n("ul",null,[n("li",null,[s("xfg-dev-tech-http："),n("a",g,[s("https://gitcode.net/KnowledgePlanet/road-map/xfg-dev-tech-http"),t(a)])]),n("li",null,[s("chatglm-sdk-java："),n("a",b,[s("https://bugstack.cn/md/project/chatgpt/sdk/chatglm-sdk-java.html"),t(a)])])]),f,_,w,x,y,n("ol",null,[n("li",null,[C,s("："),n("a",q,[s("https://wx.zsxq.com/dweb2/index/group/28885518425541"),t(a)])]),S]),T,n("ul",null,[n("li",null,[s("首先，在PC端谷歌浏览器，打开知识星球首页："),n("a",L,[s("https://wx.zsxq.com/dweb2/index/group/28885518425541"),t(a)])]),M,P]),I,A,n("ul",null,[n("li",null,[s("首先，打开 "),n("a",j,[s("ApiPost"),t(a)]),s(" 工具中，如果没有可以下载一个。")]),G,R]),D,n("ul",null,[H,n("li",null,[s("ChatGLM部分，小傅哥已经做了 SDK 非常好对接。"),n("a",E,[s("https://github.com/fuzhengwei/chatglm-sdk-java"),t(a)])])]),K,n("ul",null,[n("li",null,[s("因为我们需要一个自动的智能Ai回帖，所以需要使用到 "),n("a",O,[s("ChatGLM"),t(a)]),s("。当然你也可以对接其他大厂开发的 OpenAi SDK 使用。")])]),B,n("ul",null,[n("li",null,[s("地址："),n("a",z,[s("https://open.bigmodel.cn/usercenter/apikeys"),t(a)])]),N]),J,V,n("ul",null,[n("li",null,[s("星球："),n("a",F,[s("https://wx.zsxq.com/dweb2/index/group/28885518425541"),t(a)])]),U,Q]),X,s(" - 这个是你就会看到后台会快速运行检测帖子和回答。 - 好啦，运行到这就全部完成了。你也可以去做做测试了。 ")])}const nn=e(l,[["render",Y],["__file","http.html.vue"]]);export{nn as default};
