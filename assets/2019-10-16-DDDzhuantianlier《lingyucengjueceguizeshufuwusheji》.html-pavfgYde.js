import{_ as e,r as p,o,c,a as n,b as s,d as t,e as l}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"ddd专题案例二《领域层决策规则树服务设计》",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ddd专题案例二《领域层决策规则树服务设计》","aria-hidden":"true"},"#"),s(" DDD专题案例二《领域层决策规则树服务设计》")],-1),r=n("br",null,null,-1),k={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=n("br",null,null,-1),m={href:"https://t.zsxq.com/jAi2nUf",target:"_blank",rel:"noopener noreferrer"},v=l(`<blockquote><p>沉淀、分享、成长，让自己和他人都能有所收获！😄</p></blockquote><h2 id="前言介绍" tabindex="-1"><a class="header-anchor" href="#前言介绍" aria-hidden="true">#</a> 前言介绍</h2><p>在上一章节介绍了领域驱动设计的基本概念以及按照领域驱动设计的思想进行代码分层，但是仅仅只是从一个简单的分层结构上依然没法理解DDD以及如何去开发这样的微服务。另外往往按照这样分层后依然感觉和MVC也没有什么差别，也没有感受到带来什么非常大的好处。那么问题出在哪呢？我个人觉得DDD学起来更像是一套指导思想，不断的将学习者引入到领域触发的思维中去，而这恰恰也是最难学习的地方。时而感觉会了，而实际开发中又不对，本来已经拆解清晰了，但怎么又那么像MVC了。甚至怀疑自己，我在干嘛？</p><p>无论是DDD、MVC，他们更像是家里三居或者四局的格局，每一种格局方式都是为了更好的实现对应架构下的设计思想。但，不是说给你一个通用的架构模式，你就能开发出干净(高内聚)、整洁(低耦合)、漂亮(模块化)的代码。这就像是你家住三居、他家也住三居，但是你们屋子的舒适情况就一样吗？｛再有，你家里会把厕所安在厨房吗？但你的代码是否这么干过，不合理的摆放导致重构延期。｝</p><p>另外DDD之所以看着简单但又不那么好落地，个人认为很重要就是领域思想，DDD只是指导但是不能把互联网天下每一个业务行为开发都拿出来举例子给你看，每个领域需要设计。所以需要一些领域专家｛产品+架构+不是杠精的程序猿｝来讨论梳理，将业务形态设计出合理的架构&amp;代码。</p><h2 id="案例目标" tabindex="-1"><a class="header-anchor" href="#案例目标" aria-hidden="true">#</a> 案例目标</h2><p>本案例通过一个商品下单规则的场景来进行演示DDD；</p><ol><li>假设产品需求业务运行人员可以对不同的商品配置一些规则，这些规则可以满足不同用户类型可以下单不同商品。</li><li>另外一些行为规则是会随着业务发展而增加或者变动的，所以不能写死｛写死太吓人了｝。</li><li>数据库的PO类不应该被外部服务调用，这也是必须的。如果你开发过很多系统，那么可能已经吃过亏并意识到这个问题。</li><li>按照DDD思想我们尝试需要设计一个规则引擎的服务，通过给外部提供非常简单的接口（application）来获取最终结果。</li><li>通过这样的案例可以很容易的感受到目前的四层架构确实在实现DDD思想上有很多的帮助。</li></ol><blockquote><p>如图；DDD分层结构 | 指导设计架构</p></blockquote><p><img src="https://bugstack.cn/assets/images/pic-content/2019/10/DDD-01-2.png" alt="bugstack虫洞栈 &amp; 分层结构"></p><h2 id="ddd思想-·-开发设计" tabindex="-1"><a class="header-anchor" href="#ddd思想-·-开发设计" aria-hidden="true">#</a> DDD思想 · 开发设计</h2><p>通过领域驱动设计的思想，从领域知识中提取和划分为一个一个的子领域（核心子域，通用子域，支撑子域），并在子领域上建立模型。那么在技术实现上就需要去支撑这种建模，以使我们的代码模块独立、免污染、易于扩展。</p><p>在上面我们提到需要开发一个可扩展使用的规则树，那么如果只是单纯的一次性需求，最快的方式是if语句就搞定了。但是为了使这个领域服务具备良好的使用和扩展性，我们需要做些拆分，那么如下；</p><ol><li>你是否想过系统在过滤过则的时候其实就像执行一棵二叉树一样非左即右侧，每一条线上都有着执行条件，通过判断来达到最终的结果。</li><li>按照树形结构我们将定义出来四个类；树、节点、果实、指向线(From-To)，用于描述我们的规则行为。</li><li>再此基础上需要实现一个逻辑定义与规则树执行引擎，通过统一的引擎服务来执行我们每次配置好的规则树。</li></ol><blockquote><p>如图；领域开发设计服务</p></blockquote><p><img src="https://bugstack.cn/assets/images/pic-content/2019/10/DDD-02-1.png" alt="bugstack虫洞栈 &amp; 领域开发设计服务"></p><h2 id="工程模型" tabindex="-1"><a class="header-anchor" href="#工程模型" aria-hidden="true">#</a> 工程模型</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>ddd<span class="token operator">-</span><span class="token number">02</span>
└── src
    ├── main
    │   ├── java
    │   │   └── org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo
    │   │       ├── application
    │   │       │	├── <span class="token class-name">MallRuleService</span><span class="token punctuation">.</span>java	
    │   │       │	└── <span class="token class-name">MallTreeService</span><span class="token punctuation">.</span>java	
    │   │       ├── domain
    │   │       │	├── rule
    │   │       │	│   ├── model
    │   │       │	│   │   ├── aggregates
    │   │       │	│   │   │   └── <span class="token class-name">UserRichInfo</span><span class="token punctuation">.</span>java	
    │   │       │	│   │   └── vo
    │   │       │	│   │       ├── <span class="token class-name">DecisionMatter</span><span class="token punctuation">.</span>java
    │   │       │	│   │       ├── <span class="token class-name">EngineResult</span><span class="token punctuation">.</span>java
    │   │       │	│   │       ├── <span class="token class-name">TreeNodeInfo</span><span class="token punctuation">.</span>java
    │   │       │	│   │       ├── <span class="token class-name">TreeNodeLineInfo</span><span class="token punctuation">.</span>java	
    │   │       │	│   │       └── <span class="token class-name">UserSchool</span><span class="token punctuation">.</span>java	
    │   │       │	│   ├── repository
    │   │       │	│   │   └── <span class="token class-name">IRuleRepository</span><span class="token punctuation">.</span>java	
    │   │       │	│   └── service
    │   │       │	│       ├── engine
    │   │       │	│       │   ├── impl	
    │   │       │	│       │   └── <span class="token class-name">EngineFilter</span><span class="token punctuation">.</span>java	
    │   │       │	│       ├── logic
    │   │       │	│       │   ├── impl	
    │   │       │	│       │   └── <span class="token class-name">LogicFilter</span><span class="token punctuation">.</span>java	
    │   │       │	│       └── <span class="token class-name">MallRuleServiceImpl</span><span class="token punctuation">.</span>java	
    │   │       │	└── tree
    │   │       │	    ├── model
    │   │       │	    │   ├── aggregates
    │   │       │	    │   │   └── <span class="token class-name">TreeCollect</span><span class="token punctuation">.</span>java	
    │   │       │	    │   └── vo
    │   │       │	    │       ├── <span class="token class-name">TreeInfo</span><span class="token punctuation">.</span>java	
    │   │       │	    │       └── <span class="token class-name">TreeRulePoint</span><span class="token punctuation">.</span>java	
    │   │       │	    ├── repository
    │   │       │	    │   └── <span class="token class-name">ITreeRepository</span><span class="token punctuation">.</span>java	
    │   │       │	    └── service
    │   │       │	        └── <span class="token class-name">MallTreeServiceImpl</span><span class="token punctuation">.</span>java	
    │   │       ├── infrastructure
    │   │       │	├── common
    │   │       │	│   └── <span class="token class-name">Constants</span><span class="token punctuation">.</span>java
    │   │       │	├── dao
    │   │       │	│   ├── <span class="token class-name">RuleTreeDao</span><span class="token punctuation">.</span>java
    │   │       │	│   ├── <span class="token class-name">RuleTreeNodeDao</span><span class="token punctuation">.</span>java	
    │   │       │	│   └── <span class="token class-name">RuleTreeNodeLineDao</span><span class="token punctuation">.</span>java	
    │   │       │	├── po
    │   │       │	│   ├── <span class="token class-name">RuleTree</span><span class="token punctuation">.</span>java
    │   │       │	│   ├── <span class="token class-name">RuleTreeConfig</span><span class="token punctuation">.</span>java
    │   │       │	│   ├── <span class="token class-name">RuleTreeNode</span><span class="token punctuation">.</span>java	
    │   │       │	│   └── <span class="token class-name">RuleTreeNodeLine</span><span class="token punctuation">.</span>java		
    │   │       │	├── repository
    │   │       │	│   ├── cache
    │   │       │	│   │   └── <span class="token class-name">RuleCacheRepository</span><span class="token punctuation">.</span>java
    │   │       │	│   ├── mysql
    │   │       │	│   │   ├── <span class="token class-name">RuleMysqlRepository</span><span class="token punctuation">.</span>java	
    │   │       │	│   │   └── <span class="token class-name">TreeMysqlRepository</span><span class="token punctuation">.</span>java
    │   │       │	│   ├── <span class="token class-name">RuleRepository</span><span class="token punctuation">.</span>java	
    │   │       │	│   └── <span class="token class-name">TreeRepository</span><span class="token punctuation">.</span>java	
    │   │       │	└── util
    │   │       │	    └── <span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>java
    │   │       ├── interfaces
    │   │       │	├── dto
    │   │       │	│	├── <span class="token class-name">DecisionMatterDTO</span><span class="token punctuation">.</span>java
    │   │       │	│	└── <span class="token class-name">TreeDTO</span><span class="token punctuation">.</span>java	
    │   │       │	└── <span class="token class-name">DDDController</span><span class="token punctuation">.</span>java
    │   │       └── <span class="token class-name">DDDApplication</span><span class="token punctuation">.</span>java
    │   └── resources	
    │       ├── mybatis
    │       └── application<span class="token punctuation">.</span>yml
    └── test
         └── java
             └── org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test
                 └── <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>演示部分重点代码块，完整代码下载关注公众号；bugstack虫洞栈 | 回复DDD落地</strong></p><h3 id="application应用层" tabindex="-1"><a class="header-anchor" href="#application应用层" aria-hidden="true">#</a> application应用层</h3><blockquote><p>application/MallRuleService.java | 应用层定义接口服务，也可以适当做简单包装</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 商超规则过滤服务；提供规则树决策功能
 * 微信公众号：bugstack虫洞栈 | 专注原创技术专题案例
 * 论坛：http://bugstack.cn
 * Create by 付政委 on @2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MallRuleService</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * 决策服务
     * <span class="token keyword">@param</span> <span class="token parameter">matter</span> 决策物料
     * <span class="token keyword">@return</span>       决策结果
     */</span>
    <span class="token class-name">EngineResult</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">DecisionMatter</span> matter<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="domain领域层" tabindex="-1"><a class="header-anchor" href="#domain领域层" aria-hidden="true">#</a> domain领域层</h3><p>domain中有两个领域服务；规则树信息领域、规则执行领域，通过合理的抽象化来实现高内聚、低耦合的模块化服务</p><blockquote><p>domain/service/MallRuleServiceImpl.java | 领域层中的service来实现应用层接口</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 规则树服务；提供规则规律功能
 *
 * 1、rule包下只进行规则决策领域的处理
 * 2、封装决策行为到领域模型中，外部只需要调用和处理结果即可
 * 3、可以扩展不同的决策引擎进行统一管理
 *
 * 微信公众号：bugstack虫洞栈 | 专注原创技术专题案例
 * 论坛：http://bugstack.cn
 * Create by 付政委 on @2019
 */</span>
<span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">&quot;mallRuleService&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MallRuleServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">MallRuleService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">MallRuleServiceImpl</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;ruleEngineHandle&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">EngineFilter</span> ruleEngineHandle<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">EngineResult</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">DecisionMatter</span> matter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> ruleEngineHandle<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>matter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;决策引擎执行失败&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">EngineResult</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>domain/service/logic/LogicFilter.java | 逻辑决策定义</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 微信公众号：bugstack虫洞栈 | 专注原创技术专题案例
 * 论坛：http://bugstack.cn
 * Create by 付政委 on @2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">LogicFilter</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * 逻辑决策器
     * <span class="token keyword">@param</span> <span class="token parameter">matterValue</span>          决策值
     * <span class="token keyword">@param</span> <span class="token parameter">treeNodeLineInfoList</span> 决策节点
     * <span class="token keyword">@return</span>                     下一个节点Id
     */</span>
    <span class="token class-name">Long</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">String</span> matterValue<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TreeNodeLineInfo</span><span class="token punctuation">&gt;</span></span> treeNodeLineInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 获取决策值
     *
     * <span class="token keyword">@param</span> <span class="token parameter">decisionMatter</span> 决策物料
     * <span class="token keyword">@return</span>               决策值
     */</span>
    <span class="token class-name">String</span> <span class="token function">matterValue</span><span class="token punctuation">(</span><span class="token class-name">DecisionMatter</span> decisionMatter<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>domain/service/engine/EngineFilter.java | 引擎执行定义</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 微信公众号：bugstack虫洞栈 | 专注原创技术专题案例
 * 论坛：http://bugstack.cn
 * Create by 付政委 on @2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EngineFilter</span> <span class="token punctuation">{</span>

    <span class="token class-name">EngineResult</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">DecisionMatter</span> matter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="infrastructure基础层" tabindex="-1"><a class="header-anchor" href="#infrastructure基础层" aria-hidden="true">#</a> infrastructure基础层</h3><p>1、实现领域层仓储定义 2、数据库操作为非业务属性的功能操作 3、在仓储实现层进行组合装配DAO&amp;Redis&amp;Cache等</p><blockquote><p>infrastructure/repository/RuleRepository.java</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 微信公众号：bugstack虫洞栈 | 专注原创技术专题案例
 * 论坛：http://bugstack.cn
 * Create by 付政委 on @2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EngineFilter</span> <span class="token punctuation">{</span>

    <span class="token class-name">EngineResult</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">DecisionMatter</span> matter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="interfaces接口层" tabindex="-1"><a class="header-anchor" href="#interfaces接口层" aria-hidden="true">#</a> interfaces接口层</h3><p>1、包装应用接口对外提供api 2、外部传输对象采用DTO类，主要为了避免内部类被污染｛不断的迭代的需求会在类中增加很多字段｝ 3、目前依然是提供的Http服务，如果提供的rpc服务，将需要对外提供可引用jar</p><blockquote><p>interfaces/DDDController.java</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">*</span><span class="token operator">*</span>
 <span class="token operator">*</span> 微信公众号：bugstack虫洞栈 <span class="token operator">|</span> 欢迎关注学习专题案例
 <span class="token operator">*</span> 论坛：http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>bugstack<span class="token punctuation">.</span>cn
 <span class="token operator">*</span> <span class="token class-name">Create</span> by 付政委 on <span class="token annotation punctuation">@2019</span>
 <span class="token operator">*</span><span class="token operator">/</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DDDController</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">DDDController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">MallTreeService</span> mallTreeService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">MallRuleService</span> mallRuleService<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 测试接口：http://localhost:8080/api/tree/queryTreeSummaryInfo
     * 请求参数：<span class="token punctuation">{</span>&quot;treeId&quot;:10001<span class="token punctuation">}</span>
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;/api/tree/queryTreeSummaryInfo&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span> <span class="token function">queryTreeSummaryInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">TreeDTO</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> reqStr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;查询规则树信息{}Begin req：{}&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getTreeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reqStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">TreeCollect</span> treeCollect <span class="token operator">=</span> mallTreeService<span class="token punctuation">.</span><span class="token function">queryTreeSummaryInfo</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getTreeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;查询规则树信息{}End res：{}&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getTreeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span>treeCollect<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>treeCollect<span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;查询规则树信息{}Error req：{}&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getTreeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reqStr<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 测试接口：http://localhost:8080/api/tree/decisionRuleTree
     * 请求参数：<span class="token punctuation">{</span>&quot;treeId&quot;:10001,&quot;userId&quot;:&quot;fuzhengwei&quot;,&quot;valMap&quot;:<span class="token punctuation">{</span>&quot;gender&quot;:&quot;man&quot;,&quot;age&quot;:&quot;25&quot;<span class="token punctuation">}</span><span class="token punctuation">}</span>
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;/api/tree/decisionRuleTree&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span> <span class="token function">decisionRuleTree</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">DecisionMatterDTO</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> reqStr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;规则树行为信息决策{}Begin req：{}&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getTreeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reqStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">DecisionMatter</span> decisionMatter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DecisionMatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            decisionMatter<span class="token punctuation">.</span><span class="token function">setTreeId</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getTreeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            decisionMatter<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            decisionMatter<span class="token punctuation">.</span><span class="token function">setValMap</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getValMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">EngineResult</span> engineResult <span class="token operator">=</span> mallRuleService<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>decisionMatter<span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;规则树行为信息决策{}End res：{}&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getTreeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span>engineResult<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>engineResult<span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;规则树行为信息决策{}Error req：{}&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getTreeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reqStr<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="测试验证" tabindex="-1"><a class="header-anchor" href="#测试验证" aria-hidden="true">#</a> 测试验证</h2><blockquote><p>规则树结构{数据库转Json} | 可自行定义</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;treeNodeMap&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;1&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;nodeType&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token string">&quot;ruleDesc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;用户性别[男/女]&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;ruleKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;userGender&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeId&quot;</span><span class="token operator">:</span> <span class="token number">10001</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeNodeId&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeNodeLineInfoList&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;nodeIdFrom&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;nodeIdTo&quot;</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;ruleLimitType&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;ruleLimitValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;man&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;nodeIdFrom&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;nodeIdTo&quot;</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;ruleLimitType&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;ruleLimitValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;woman&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;11&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;nodeType&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token string">&quot;ruleDesc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;用户年龄&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;ruleKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;userAge&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeId&quot;</span><span class="token operator">:</span> <span class="token number">10001</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeNodeId&quot;</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeNodeLineInfoList&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;nodeIdFrom&quot;</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;nodeIdTo&quot;</span><span class="token operator">:</span> <span class="token number">111</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;ruleLimitType&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;ruleLimitValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;25&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;nodeIdFrom&quot;</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;nodeIdTo&quot;</span><span class="token operator">:</span> <span class="token number">112</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;ruleLimitType&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;ruleLimitValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;25&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;12&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;nodeType&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token string">&quot;ruleDesc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;用户年龄&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;ruleKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;userAge&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeId&quot;</span><span class="token operator">:</span> <span class="token number">10001</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeNodeId&quot;</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeNodeLineInfoList&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;nodeIdFrom&quot;</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;nodeIdTo&quot;</span><span class="token operator">:</span> <span class="token number">121</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;ruleLimitType&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;ruleLimitValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;25&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;nodeIdFrom&quot;</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;nodeIdTo&quot;</span><span class="token operator">:</span> <span class="token number">122</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;ruleLimitType&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;ruleLimitValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;25&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;111&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;nodeType&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token string">&quot;nodeValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;果实A&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeId&quot;</span><span class="token operator">:</span> <span class="token number">10001</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeNodeId&quot;</span><span class="token operator">:</span> <span class="token number">111</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeNodeLineInfoList&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;112&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;nodeType&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token string">&quot;nodeValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;果实B&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeId&quot;</span><span class="token operator">:</span> <span class="token number">10001</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeNodeId&quot;</span><span class="token operator">:</span> <span class="token number">112</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeNodeLineInfoList&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;121&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;nodeType&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token string">&quot;nodeValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;果实C&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeId&quot;</span><span class="token operator">:</span> <span class="token number">10001</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeNodeId&quot;</span><span class="token operator">:</span> <span class="token number">121</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeNodeLineInfoList&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;122&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;nodeType&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token string">&quot;nodeValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;果实D&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeId&quot;</span><span class="token operator">:</span> <span class="token number">10001</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeNodeId&quot;</span><span class="token operator">:</span> <span class="token number">122</span><span class="token punctuation">,</span>
            <span class="token string">&quot;treeNodeLineInfoList&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;treeRoot&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;treeId&quot;</span><span class="token operator">:</span> <span class="token number">10001</span><span class="token punctuation">,</span>
        <span class="token string">&quot;treeName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;购物分类规则树&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;treeRootNodeId&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>通过postman调用 | raw =&gt; json</p></blockquote><p><strong>查询规则树信息</strong> 测试接口：http://localhost:8080/api/tree/decisionRuleTree 请求参数：{&quot;treeId&quot;:10001}</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;treeInfo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;treeId&quot;</span><span class="token operator">:</span> <span class="token number">10001</span><span class="token punctuation">,</span>
        <span class="token string">&quot;treeName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;购物分类规则树&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;treeDesc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;用于分类不同类型用户可购物范围&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;nodeCount&quot;</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
        <span class="token string">&quot;lineCount&quot;</span><span class="token operator">:</span> <span class="token number">6</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;treeRulePointList&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">&quot;ruleKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;userGender&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;ruleDesc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;用户性别[男/女]&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token string">&quot;ruleKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;userAge&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;ruleDesc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;用户年龄&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/assets/images/pic-content/2019/10/DDD-02-2.png" alt="微信公众号：bugstack虫洞栈 &amp; 查询规则树信息"></p><p><strong>规则树行为信息决策</strong> 测试接口：http://localhost:8080/api/tree/decisionRuleTree 请求参数：{&quot;treeId&quot;:10001}</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;userId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fuzhengwei&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;treeId&quot;</span><span class="token operator">:</span> <span class="token number">10001</span><span class="token punctuation">,</span>
    <span class="token string">&quot;nodeId&quot;</span><span class="token operator">:</span> <span class="token number">112</span><span class="token punctuation">,</span>
    <span class="token string">&quot;nodeValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;果实B&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;success&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/assets/images/pic-content/2019/10/DDD-02-3.png" alt="微信公众号：bugstack虫洞栈 &amp; 规则树行为信息决策"></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>  <span class="token punctuation">.</span>   ____          _            __ _ _
 <span class="token operator">/</span>\\\\ <span class="token operator">/</span> ___&#39;_ __ _ <span class="token function">_</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span>_ __  __ _ \\ \\ \\ \\
<span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span>\\___ <span class="token operator">|</span> <span class="token char">&#39;_ | &#39;</span>_<span class="token operator">|</span> <span class="token operator">|</span> &#39;_ \\<span class="token operator">/</span> _\` <span class="token operator">|</span> \\ \\ \\ \\
 \\\\<span class="token operator">/</span>  ___<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token operator">|</span>_<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span>  <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
  &#39;  <span class="token operator">|</span>____<span class="token operator">|</span> <span class="token punctuation">.</span>__<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_\\__<span class="token punctuation">,</span> <span class="token operator">|</span> <span class="token operator">/</span> <span class="token operator">/</span> <span class="token operator">/</span> <span class="token operator">/</span>
 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">|</span>_<span class="token operator">|=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">|</span>___<span class="token operator">/=</span><span class="token operator">/</span>_<span class="token operator">/</span>_<span class="token operator">/</span>_<span class="token operator">/</span>
 <span class="token operator">::</span> <span class="token class-name">Spring</span> <span class="token class-name">Boot</span> <span class="token operator">::</span>        <span class="token punctuation">(</span>v2<span class="token punctuation">.</span><span class="token number">0.5</span><span class="token punctuation">.</span><span class="token constant">RELEASE</span><span class="token punctuation">)</span>

<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">05.672</span>  <span class="token constant">INFO</span> <span class="token number">13820</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span></span>DDDApplication</span>          <span class="token operator">:</span> <span class="token class-name">Starting</span> <span class="token class-name">DDDApplication</span> on fuzhengwei<span class="token operator">-</span><span class="token constant">PC</span> <span class="token keyword">with</span> <span class="token class-name">PID</span> <span class="token number">13820</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token operator">:</span>\\itstack\\itstack<span class="token punctuation">.</span>org\\itstack<span class="token operator">-</span>demo<span class="token operator">-</span>ddd<span class="token operator">-</span><span class="token number">02</span>\\target\\classes started by fuzhengwei in <span class="token class-name">E</span><span class="token operator">:</span>\\itstack\\itstack<span class="token punctuation">.</span>org\\itstack<span class="token operator">-</span>demo<span class="token operator">-</span>ddd<span class="token operator">-</span><span class="token number">02</span><span class="token punctuation">)</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">05.675</span>  <span class="token constant">INFO</span> <span class="token number">13820</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span></span>DDDApplication</span>          <span class="token operator">:</span> <span class="token class-name">No</span> active profile set<span class="token punctuation">,</span> falling back <span class="token keyword">to</span> <span class="token keyword">default</span> profiles<span class="token operator">:</span> <span class="token keyword">default</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">05.952</span>  <span class="token constant">INFO</span> <span class="token number">13820</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name">ConfigServletWebServerApplicationContext</span> <span class="token operator">:</span> <span class="token class-name">Refreshing</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span>AnnotationConfigServletWebServerApplicationContext</span><span class="token annotation punctuation">@3c4297f</span><span class="token operator">:</span> startup date <span class="token punctuation">[</span><span class="token class-name">Sat</span> <span class="token class-name">Oct</span> <span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">05</span> <span class="token constant">CST</span> <span class="token number">2019</span><span class="token punctuation">]</span><span class="token punctuation">;</span> root of context hierarchy
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">07.756</span>  <span class="token constant">INFO</span> <span class="token number">13820</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>b<span class="token punctuation">.</span>w<span class="token punctuation">.</span>embedded<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span></span>TomcatWebServer</span>  <span class="token operator">:</span> <span class="token class-name">Tomcat</span> initialized <span class="token keyword">with</span> <span class="token namespace">port</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token number">8080</span> <span class="token punctuation">(</span>http<span class="token punctuation">)</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">07.870</span>  <span class="token constant">INFO</span> <span class="token number">13820</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>StandardService</span>   <span class="token operator">:</span> <span class="token class-name">Starting</span> service <span class="token punctuation">[</span><span class="token class-name">Tomcat</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">07.870</span>  <span class="token constant">INFO</span> <span class="token number">13820</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>StandardEngine</span>  <span class="token operator">:</span> <span class="token class-name">Starting</span> <span class="token class-name">Servlet</span> <span class="token class-name">Engine</span><span class="token operator">:</span> <span class="token class-name">Apache</span> <span class="token class-name">Tomcat</span><span class="token operator">/</span><span class="token number">8.5</span><span class="token number">.34</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">07.896</span>  <span class="token constant">INFO</span> <span class="token number">13820</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ost<span class="token operator">-</span>startStop<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>a<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>AprLifecycleListener</span>   <span class="token operator">:</span> <span class="token class-name">The</span> <span class="token constant">APR</span> based <span class="token class-name">Apache</span> <span class="token class-name">Tomcat</span> <span class="token class-name">Native</span> library which allows optimal performance in production environments was not found on the java<span class="token punctuation">.</span>library<span class="token punctuation">.</span>path<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token class-name">D</span><span class="token operator">:</span>\\<span class="token class-name">Program</span> <span class="token class-name">Files</span> <span class="token class-name">Java</span>\\<span class="token class-name">Java</span>\\jdk1<span class="token punctuation">.</span><span class="token number">8.0_162</span>\\bin<span class="token punctuation">;</span><span class="token class-name">C</span><span class="token operator">:</span>\\<span class="token class-name">Windows</span>\\<span class="token class-name">Sun</span>\\<span class="token class-name">Java</span>\\bin<span class="token punctuation">;</span><span class="token class-name">C</span><span class="token operator">:</span>\\<span class="token class-name">Windows</span>\\system32<span class="token punctuation">;</span><span class="token class-name">C</span><span class="token operator">:</span>\\<span class="token class-name">Windows</span><span class="token punctuation">;</span><span class="token class-name">C</span><span class="token operator">:</span>\\<span class="token class-name">ProgramData</span>\\<span class="token class-name">Oracle</span>\\<span class="token class-name">Java</span>\\javapath<span class="token punctuation">;</span><span class="token class-name">C</span><span class="token operator">:</span>\\<span class="token class-name">Windows</span>\\system32<span class="token punctuation">;</span><span class="token class-name">C</span><span class="token operator">:</span>\\<span class="token class-name">Windows</span><span class="token punctuation">;</span><span class="token class-name">C</span><span class="token operator">:</span>\\<span class="token class-name">Windows</span>\\<span class="token class-name">System32</span>\\<span class="token class-name">Wbem</span><span class="token punctuation">;</span><span class="token class-name">C</span><span class="token operator">:</span>\\<span class="token class-name">Windows</span>\\<span class="token class-name">System32</span>\\<span class="token class-name">WindowsPowerShell</span>\\v1<span class="token punctuation">.</span><span class="token number">0</span>\\<span class="token punctuation">;</span><span class="token class-name">D</span><span class="token operator">:</span>\\<span class="token class-name">Program</span> <span class="token class-name">Files</span> <span class="token class-name">Java</span>\\<span class="token class-name">SlikSvn</span>\\bin<span class="token punctuation">;</span><span class="token class-name">D</span><span class="token operator">:</span>\\<span class="token class-name">Program</span> <span class="token class-name">Files</span> <span class="token class-name">Java</span>\\<span class="token class-name">MySQL</span> <span class="token class-name">Server</span> <span class="token number">5.1</span>\\bin<span class="token punctuation">;</span><span class="token class-name">D</span><span class="token operator">:</span>\\<span class="token class-name">Program</span> <span class="token class-name">Files</span> <span class="token class-name">Java</span>\\<span class="token class-name">TortoiseGit</span>\\bin<span class="token punctuation">;</span><span class="token class-name">D</span><span class="token operator">:</span>\\<span class="token class-name">Program</span> <span class="token class-name">Files</span>\\nodejs\\<span class="token punctuation">;</span><span class="token class-name">D</span><span class="token operator">:</span>\\<span class="token class-name">Program</span> <span class="token class-name">Files</span> <span class="token class-name">Java</span>\\<span class="token class-name">Java</span>\\jdk1<span class="token punctuation">.</span><span class="token number">6.0_24</span>\\bin<span class="token punctuation">;</span><span class="token class-name">D</span><span class="token operator">:</span>\\<span class="token class-name">Program</span> <span class="token class-name">Files</span> <span class="token class-name">Java</span>\\apache<span class="token operator">-</span>maven<span class="token operator">-</span><span class="token number">3.2</span><span class="token number">.3</span>\\bin<span class="token punctuation">;</span><span class="token class-name">C</span><span class="token operator">:</span>\\<span class="token class-name">Users</span>\\fuzhengwei\\<span class="token class-name">AppData</span>\\<span class="token class-name">Roaming</span>\\npm<span class="token punctuation">;</span><span class="token class-name">D</span><span class="token operator">:</span>\\<span class="token class-name">Program</span> <span class="token class-name">Files</span> <span class="token class-name">Java</span>\\<span class="token class-name">Git</span>\\cmd<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">08.040</span>  <span class="token constant">INFO</span> <span class="token number">13820</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ost<span class="token operator">-</span>startStop<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>a<span class="token punctuation">.</span>c<span class="token punctuation">.</span>c<span class="token punctuation">.</span></span>C</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token class-name">Tomcat</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>localhost<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token operator">/</span><span class="token punctuation">]</span>       <span class="token operator">:</span> <span class="token class-name">Initializing</span> <span class="token class-name">Spring</span> embedded <span class="token class-name">WebApplicationContext</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">08.040</span>  <span class="token constant">INFO</span> <span class="token number">13820</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ost<span class="token operator">-</span>startStop<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>web<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span>ContextLoader</span>            <span class="token operator">:</span> <span class="token class-name">Root</span> <span class="token class-name">WebApplicationContext</span><span class="token operator">:</span> initialization completed in <span class="token number">2088</span> ms
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">08.102</span>  <span class="token constant">INFO</span> <span class="token number">13820</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ost<span class="token operator">-</span>startStop<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>b<span class="token punctuation">.</span>w<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>ServletRegistrationBean</span>  <span class="token operator">:</span> <span class="token class-name">Servlet</span> dispatcherServlet mapped <span class="token keyword">to</span> <span class="token punctuation">[</span><span class="token operator">/</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">08.126</span>  <span class="token constant">INFO</span> <span class="token number">13820</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ost<span class="token operator">-</span>startStop<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>b<span class="token punctuation">.</span>w<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>FilterRegistrationBean</span>   <span class="token operator">:</span> <span class="token class-name">Mapping</span> filter<span class="token operator">:</span> &#39;characterEncodingFilter&#39; <span class="token keyword">to</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token comment">/*]
2019-10-19 18:22:08.127  INFO 13820 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: &#39;hiddenHttpMethodFilter&#39; to: [/*]
2019-10-19 18:22:08.127  INFO 13820 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: &#39;httpPutFormContentFilter&#39; to: [/*]
2019-10-19 18:22:08.127  INFO 13820 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: &#39;requestContextFilter&#39; to: [/*]
2019-10-19 18:22:09.118  INFO 13820 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**/</span>favicon<span class="token punctuation">.</span>ico<span class="token punctuation">]</span> onto handler of type <span class="token punctuation">[</span><span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>resource<span class="token punctuation">.</span></span>ResourceHttpRequestHandler</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">09.383</span>  <span class="token constant">INFO</span> <span class="token number">13820</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">s<span class="token punctuation">.</span>w<span class="token punctuation">.</span>s<span class="token punctuation">.</span>m<span class="token punctuation">.</span>m<span class="token punctuation">.</span>a<span class="token punctuation">.</span></span>RequestMappingHandlerAdapter</span> <span class="token operator">:</span> <span class="token class-name">Looking</span> <span class="token keyword">for</span> <span class="token annotation punctuation">@ControllerAdvice</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span>AnnotationConfigServletWebServerApplicationContext</span><span class="token annotation punctuation">@3c4297f</span><span class="token operator">:</span> startup date <span class="token punctuation">[</span><span class="token class-name">Sat</span> <span class="token class-name">Oct</span> <span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">05</span> <span class="token constant">CST</span> <span class="token number">2019</span><span class="token punctuation">]</span><span class="token punctuation">;</span> root of context hierarchy
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">10.261</span>  <span class="token constant">INFO</span> <span class="token number">13820</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">s<span class="token punctuation">.</span>w<span class="token punctuation">.</span>s<span class="token punctuation">.</span>m<span class="token punctuation">.</span>m<span class="token punctuation">.</span>a<span class="token punctuation">.</span></span>RequestMappingHandlerMapping</span> <span class="token operator">:</span> <span class="token class-name">Mapped</span> <span class="token string">&quot;{[/api/tree/decisionRuleTree],methods=[POST]}&quot;</span> onto <span class="token keyword">public</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>ResponseEntity</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>interfaces<span class="token punctuation">.</span></span>DDDController</span><span class="token punctuation">.</span><span class="token function">decisionRuleTree</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>interfaces<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span>DecisionMatterDTO</span><span class="token punctuation">)</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">10.263</span>  <span class="token constant">INFO</span> <span class="token number">13820</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">s<span class="token punctuation">.</span>w<span class="token punctuation">.</span>s<span class="token punctuation">.</span>m<span class="token punctuation">.</span>m<span class="token punctuation">.</span>a<span class="token punctuation">.</span></span>RequestMappingHandlerMapping</span> <span class="token operator">:</span> <span class="token class-name">Mapped</span> <span class="token string">&quot;{[/api/tree/queryTreeSummaryInfo],methods=[POST]}&quot;</span> onto <span class="token keyword">public</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>ResponseEntity</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>interfaces<span class="token punctuation">.</span></span>DDDController</span><span class="token punctuation">.</span><span class="token function">queryTreeSummaryInfo</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>interfaces<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span>TreeDTO</span><span class="token punctuation">)</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">10.272</span>  <span class="token constant">INFO</span> <span class="token number">13820</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">s<span class="token punctuation">.</span>w<span class="token punctuation">.</span>s<span class="token punctuation">.</span>m<span class="token punctuation">.</span>m<span class="token punctuation">.</span>a<span class="token punctuation">.</span></span>RequestMappingHandlerMapping</span> <span class="token operator">:</span> <span class="token class-name">Mapped</span> <span class="token string">&quot;{[/error]}&quot;</span> onto <span class="token keyword">public</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Map</span><span class="token punctuation">&lt;</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>error<span class="token punctuation">.</span></span>BasicErrorController</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>HttpServletRequest</span><span class="token punctuation">)</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">10.274</span>  <span class="token constant">INFO</span> <span class="token number">13820</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">s<span class="token punctuation">.</span>w<span class="token punctuation">.</span>s<span class="token punctuation">.</span>m<span class="token punctuation">.</span>m<span class="token punctuation">.</span>a<span class="token punctuation">.</span></span>RequestMappingHandlerMapping</span> <span class="token operator">:</span> <span class="token class-name">Mapped</span> <span class="token string">&quot;{[/error],produces=[text/html]}&quot;</span> onto <span class="token keyword">public</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>ModelAndView</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>error<span class="token punctuation">.</span></span>BasicErrorController</span><span class="token punctuation">.</span><span class="token function">errorHtml</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>HttpServletRequest</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>HttpServletResponse</span><span class="token punctuation">)</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">10.309</span>  <span class="token constant">INFO</span> <span class="token number">13820</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>w<span class="token punctuation">.</span>s<span class="token punctuation">.</span>handler<span class="token punctuation">.</span></span>SimpleUrlHandlerMapping</span>  <span class="token operator">:</span> <span class="token class-name">Mapped</span> <span class="token constant">URL</span> path <span class="token punctuation">[</span><span class="token operator">/</span>webjars<span class="token doc-comment comment">/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2019-10-19 18:22:10.309  INFO 13820 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2019-10-19 18:22:16.272  INFO 13820 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup
2019-10-19 18:22:16.273  INFO 13820 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Bean with name &#39;dataSource&#39; has been autodetected for JMX exposure
2019-10-19 18:22:16.279  INFO 13820 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Located MBean &#39;dataSource&#39;: registering with JMX server as MBean [com.zaxxer.hikari:name=dataSource,type=HikariDataSource]
2019-10-19 18:22:16.375  INFO 13820 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path &#39;&#39;
2019-10-19 18:22:16.381  INFO 13820 --- [           main] org.itstack.demo.DDDApplication          : Started DDDApplication in 11.458 seconds (JVM running for 20.584)
2019-10-19 18:22:31.336  INFO 13820 --- [nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring FrameworkServlet &#39;dispatcherServlet&#39;
2019-10-19 18:22:31.336  INFO 13820 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : FrameworkServlet &#39;dispatcherServlet&#39;: initialization started
2019-10-19 18:22:31.372  INFO 13820 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : FrameworkServlet &#39;dispatcherServlet&#39;: initialization completed in 36 ms
2019-10-19 18:22:32.427  INFO 13820 --- [nio-8080-exec-1] o.itstack.demo.interfaces.DDDController  : 规则树行为信息决策10001Begin req：<span class="token punctuation">{</span>&quot;treeId&quot;:10001,&quot;userId&quot;:&quot;fuzhengwei&quot;,&quot;valMap&quot;:<span class="token punctuation">{</span>&quot;gender&quot;:&quot;man&quot;,&quot;age&quot;:&quot;25&quot;<span class="token punctuation">}</span><span class="token punctuation">}</span>
2019-10-19 18:22:32.508  INFO 13820 --- [nio-8080-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2019-10-19 18:22:32.956  INFO 13820 --- [nio-8080-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2019-10-19 18:22:33.028  INFO 13820 --- [nio-8080-exec-1] o.i.d.d.rule.service.engine.EngineBase   : 树引擎=&gt;Test分类规则树 userId：fuzhengwei treeId：10001 treeNode：11 ruleKey：userGender matterValue：man
2019-10-19 18:22:33.028  INFO 13820 --- [nio-8080-exec-1] o.i.d.d.rule.service.engine.EngineBase   : 树引擎=&gt;Test分类规则树 userId：fuzhengwei treeId：10001 treeNode：112 ruleKey：userAge matterValue：25
2019-10-19 18:22:33.039  INFO 13820 --- [nio-8080-exec-1] o.itstack.demo.interfaces.DDDController  : 规则树行为信息决策10001End res：<span class="token punctuation">{</span>&quot;treeId&quot;:10001,&quot;nodeValue&quot;:&quot;果实B&quot;,&quot;success&quot;:true,&quot;nodeId&quot;:112,&quot;userId&quot;:&quot;fuzhengwei&quot;<span class="token punctuation">}</span>
2019-10-19 18:23:36.989  INFO 13820 --- [nio-8080-exec-5] o.itstack.demo.interfaces.DDDController  : 查询规则树信息10001Begin req：<span class="token punctuation">{</span>&quot;treeId&quot;:10001<span class="token punctuation">}</span>
2019-10-19 18:23:37.006  INFO 13820 --- [nio-8080-exec-5] o.itstack.demo.interfaces.DDDController  : 查询规则树信息10001End res：<span class="token punctuation">{</span>&quot;treeInfo&quot;:<span class="token punctuation">{</span>&quot;treeId&quot;:10001,&quot;treeName&quot;:&quot;购物分类规则树&quot;,&quot;treeDesc&quot;:&quot;用于分类不同类型用户可购物范围&quot;,&quot;nodeCount&quot;:7,&quot;lineCount&quot;:6<span class="token punctuation">}</span>,&quot;treeRulePointList&quot;:[<span class="token punctuation">{</span>&quot;ruleDesc&quot;:&quot;用户性别[男/女]&quot;,&quot;ruleKey&quot;:&quot;userGender&quot;<span class="token punctuation">}</span>,<span class="token punctuation">{</span>&quot;ruleDesc&quot;:&quot;用户年龄&quot;,&quot;ruleKey&quot;:&quot;userAge&quot;<span class="token punctuation">}</span>]<span class="token punctuation">}</span>

</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="综上总结" tabindex="-1"><a class="header-anchor" href="#综上总结" aria-hidden="true">#</a> 综上总结</h2>`,50),b={href:"http://www.drools.org/",target:"_blank",rel:"noopener noreferrer"},g=n("li",null,[n("strong",null,"一些大型架构设计往往不是换一个设计模型就能彻底提升效率，还是需要人员整体素质，这是一个不断培养的过程")],-1),q=n("li",null,[n("strong",null,"领域驱动设计的思想并不只是教会程序猿写代码，也是非程序员以外的所有互联网人员都适合学习的内容")],-1),h=n("li",null,[n("strong",null,"家里住的舒适不舒适，并不一定取决于三居或者四居，大部分还是依赖于怎么对格局的布置。事必躬亲、亲力亲为的精益求精之路，终究会让你设计出更加合理的代码")],-1),f=n("strong",null,"bugstack虫洞栈",-1),D=n("strong",null,"DDD落地案例",-1),y={href:"https://t.zsxq.com/jAi2nUf",target:"_blank",rel:"noopener noreferrer"};function w(I,S){const a=p("ExternalLinkIcon");return o(),c("div",null,[u,n("p",null,[s("作者：小傅哥 "),r,s("博客："),n("a",k,[s("https://bugstack.cn"),t(a)]),d,s("DDD项目："),n("a",m,[s("https://t.zsxq.com/jAi2nUf"),t(a)])]),v,n("ul",null,[n("li",null,[n("strong",null,[s("以上模拟购物场景下的规则处理抽象为树决策引擎，以达到独立领域服务。另外决策服务可以使用"),n("a",b,[s("drools"),t(a)]),s("，任何抽象并不一定永远使用，不要拘泥于一种形式")])]),g,q,h]),n("p",null,[s("微信搜索「"),f,s("」公众号，关注后回复「"),D,s("」获取本文源码&更多原创专题案例！此外推荐你一个可以上手实践的DDD项目，看看如何从流程中提炼领域设计代码实现，在应用层、领域层以及基础层的仓储实现是如何完成开发和调用的，项目地址："),n("a",y,[s("https://t.zsxq.com/jAi2nUf"),t(a)])])])}const _=e(i,[["render",w],["__file","2019-10-16-DDDzhuantianlier《lingyucengjueceguizeshufuwusheji》.html.vue"]]);export{_ as default};
