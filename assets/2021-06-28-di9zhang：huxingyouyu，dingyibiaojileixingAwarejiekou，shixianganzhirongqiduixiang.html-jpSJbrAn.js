import{_ as t,r as p,o,c,a as n,b as a,d as e,e as i}from"./app-3RcBQnkC.js";const l={},u=n("h1",{id:"ã€Šspring-æ‰‹æ’¸ä¸“æ ã€‹ç¬¬-9-ç« -è™è¡Œæœ‰é›¨-å®šä¹‰æ ‡è®°ç±»å‹awareæ¥å£-å®ç°æ„ŸçŸ¥å®¹å™¨å¯¹è±¡",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ã€Šspring-æ‰‹æ’¸ä¸“æ ã€‹ç¬¬-9-ç« -è™è¡Œæœ‰é›¨-å®šä¹‰æ ‡è®°ç±»å‹awareæ¥å£-å®ç°æ„ŸçŸ¥å®¹å™¨å¯¹è±¡","aria-hidden":"true"},"#"),a(" ã€ŠSpring æ‰‹æ’¸ä¸“æ ã€‹ç¬¬ 9 ç« ï¼šè™è¡Œæœ‰é›¨ï¼Œå®šä¹‰æ ‡è®°ç±»å‹Awareæ¥å£ï¼Œå®ç°æ„ŸçŸ¥å®¹å™¨å¯¹è±¡")],-1),r=n("br",null,null,-1),k={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=n("br",null,null,-1),v={href:"https://mp.weixin.qq.com/s/KP_4IQ2MZ-Pzq80WrJpCOA",target:"_blank",rel:"noopener noreferrer"},m=i(`<blockquote><p>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„</p></blockquote><h2 id="ä¸€ã€å‰è¨€" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‰è¨€" aria-hidden="true">#</a> ä¸€ã€å‰è¨€</h2><p><code>åŒäº‹å†™çš„ä»£ç ï¼Œæˆ‘ç«Ÿä¸æ¯«çœ‹ä¸æ‡‚ï¼</code></p><p>å¤§ä½¬çš„ä»£ç ï¼Œå°±åƒ <strong>â€œèµ–è›¤èŸ†æ³¡é’è›™ï¼Œé•¿çš„ä¸‘ç©çš„èŠ±â€</strong>ï¼šä¸€ä¸ªç±»å®ç°äº†å¤šä¸ªæ¥å£ã€ç»§æ‰¿çš„ç±»åˆç»§æ‰¿äº†å…¶ä»–ç±»ã€æ¥å£è¿˜å¯ä»¥å’Œæ¥å£ç»§æ‰¿ã€å®ç°æ¥å£çš„æŠ½è±¡ç±»å†ç”±ç±»å®ç°æŠ½è±¡ç±»æ–¹æ³•ã€ç±»Aç»§æ‰¿çš„ç±»Bå®ç°äº†ç±»Aå®ç°çš„æ¥å£Cï¼Œç­‰ç­‰ã€‚</p><p>çœ‹ä¸Šå»<code>å¤æ‚åˆéš¾æ‡‚</code>çš„ä»£ç ï¼Œå´åˆèƒ½ä¸€æ¬¡æ¬¡æ»¡è¶³éœ€æ±‚çš„é«˜æ•ˆè¿­ä»£å’Œé¡ºåˆ©æ‰©å±•ï¼Œè€Œåƒèºä¸é’‰ä¸€æ ·æ¬ç –çš„ä½ ï¼Œåªæ˜¯åœ¨<code>å¤§ä½¬</code>å†™çš„ä»£ç é‡Œï¼Œå®ŒæˆæŸä¸ªæ¥å£ä¸‹çš„ä¸€å°å—åŠŸèƒ½ï¼Œç”šè‡³å†™å®Œäº†ä¹Ÿä¸çŸ¥é“æ€ä¹ˆå°±è¢«è°ƒç”¨è¿è¡Œäº†ï¼Œæ•´ä¸ªè¿‡ç¨‹åƒçœ‹ Spring æºç ä¸€æ ·ç¥å¥‡ï¼Œè·³æ¥è·³å»çš„æ‘¸ä¸ç€å¤´ç»ªï¼</p><p>å…¶å®è¿™ä¸»è¦æ˜¯å› ä¸ºä½ çš„ä»£ç æ˜¯å¦è¿ç”¨äº†è®¾è®¡æ¨¡å¼ï¼Œå½“ç„¶è®¾è®¡æ¨¡å¼ä¹Ÿæ²¡é‚£ä¹ˆç¥å¥‡ï¼Œå°±åƒä½ ä»¬ä¸¤å®¶éƒ½æ˜¯120å¹³ç±³çš„æˆ¿å­ï¼Œä»–å®¶æœ‰ä¸‰å®¤ä¸¤å…ä¸€å¨ä¸€å«ï¼Œå—åŒ—é€šé€ï¼Œå…¨é˜³é‡‡å…‰ã€‚ä½†ä½ å®¶å°±ä¸ä¸€æ ·äº†ï¼Œä½ å®¶æ˜¯é”…ç¢—ç“¢ç›†ã€å«æµ´é©¬æ¡¶ã€æ²™å‘èŒ¶å‡ è¿˜æœ‰é‚£1.8çš„åŒäººåºŠï¼Œåœ¨120å¹³ç±³çš„æˆ¿å­é‡Œæ•å¼€äº†æ”¾ï¼Œæ²¡æœ‰åŠ¨é™éš”ç¦»ï¼Œä¹Ÿæ²¡æœ‰å¹²æ¹¿åˆ†ç¦»ï¼Œçº¯è‡ªç”±å‘æŒ¥ã€‚<em>æ‰€ä»¥ä½ çš„ä»£ç çœ‹ä¸Šå»å°±ä¹±çš„å¾ˆï¼</em></p><h2 id="äºŒã€ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#äºŒã€ç›®æ ‡" aria-hidden="true">#</a> äºŒã€ç›®æ ‡</h2><p>ç›®å‰å·²å®ç°çš„ Spring æ¡†æ¶ï¼Œåœ¨ Bean æ“ä½œä¸Šèƒ½æä¾›å‡ºçš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬ï¼šBean å¯¹è±¡çš„å®šä¹‰å’Œæ³¨å†Œï¼Œä»¥åŠåœ¨æ“ä½œ Bean å¯¹è±¡è¿‡ç¨‹ä¸­æ‰§è¡Œçš„ï¼ŒBeanFactoryPostProcessorã€BeanPostProcessorã€InitializingBeanã€DisposableBeanï¼Œä»¥åŠåœ¨ XML æ–°å¢çš„ä¸€äº›é…ç½®å¤„ç†ï¼Œè®©æˆ‘ä»¬å¯ä»¥ Bean å¯¹è±¡æœ‰æ›´å¼ºçš„æ“ä½œæ€§ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬æƒ³è·å¾— Spring æ¡†æ¶æä¾›çš„ BeanFactoryã€ApplicationContextã€BeanClassLoaderç­‰è¿™äº›èƒ½åŠ›åšä¸€äº›æ‰©å±•æ¡†æ¶çš„ä½¿ç”¨æ—¶è¯¥æ€ä¹ˆæ“ä½œå‘¢ã€‚æ‰€ä»¥æˆ‘ä»¬æœ¬ç« èŠ‚å¸Œæœ›åœ¨ Spring æ¡†æ¶ä¸­æä¾›ä¸€ç§èƒ½æ„ŸçŸ¥å®¹å™¨æ“ä½œçš„æ¥å£ï¼Œå¦‚æœè°å®ç°äº†è¿™æ ·çš„ä¸€ä¸ªæ¥å£ï¼Œå°±å¯ä»¥è·å–æ¥å£å…¥å‚ä¸­çš„å„ç±»èƒ½åŠ›ã€‚</p><h2 id="ä¸‰ã€è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€è®¾è®¡" aria-hidden="true">#</a> ä¸‰ã€è®¾è®¡</h2><p>å¦‚æœè¯´æˆ‘å¸Œæœ›æ‹¿åˆ° Spring æ¡†æ¶ä¸­ä¸€äº›æä¾›çš„èµ„æºï¼Œé‚£ä¹ˆé¦–å…ˆéœ€è¦è€ƒè™‘ä»¥ä¸€ä¸ªä»€ä¹ˆæ–¹å¼å»è·å–ï¼Œä¹‹åä½ å®šä¹‰å‡ºæ¥çš„è·å–æ–¹å¼ï¼Œåœ¨ Spring æ¡†æ¶ä¸­è¯¥æ€ä¹ˆå»æ‰¿æ¥ï¼Œå®ç°äº†è¿™ä¸¤é¡¹å†…å®¹ï¼Œå°±å¯ä»¥æ‰©å±•å‡ºä½ éœ€è¦çš„ä¸€äº›å±äº Spring æ¡†æ¶æœ¬èº«çš„èƒ½åŠ›äº†ã€‚</p><p>åœ¨å…³äº Bean å¯¹è±¡å®ä¾‹åŒ–é˜¶æ®µæˆ‘ä»¬æ“ä½œè¿‡ä¸€äº›é¢å¤–å®šä¹‰ã€å±æ€§ã€åˆå§‹åŒ–å’Œé”€æ¯çš„æ“ä½œï¼Œå…¶å®æˆ‘ä»¬å¦‚æœåƒè·å– Spring ä¸€äº›å¦‚ BeanFactoryã€ApplicationContext æ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ­¤ç±»æ–¹å¼è¿›è¡Œå®ç°ã€‚é‚£ä¹ˆæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªæ ‡è®°æ€§çš„æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä¸éœ€è¦æœ‰æ–¹æ³•ï¼Œå®ƒåªèµ·åˆ°æ ‡è®°ä½œç”¨å°±å¯ä»¥ï¼Œè€Œå…·ä½“çš„åŠŸèƒ½ç”±ç»§æ‰¿æ­¤æ¥å£çš„å…¶ä»–åŠŸèƒ½æ€§æ¥å£å®šä¹‰å…·ä½“æ–¹æ³•ï¼Œæœ€ç»ˆè¿™ä¸ªæ¥å£å°±å¯ä»¥é€šè¿‡ <code>instanceof</code> è¿›è¡Œåˆ¤æ–­å’Œè°ƒç”¨äº†ã€‚æ•´ä½“è®¾è®¡ç»“æ„å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://bugstack.cn/assets/images/spring/spring-9-01.png" alt=""></p><ul><li>å®šä¹‰æ¥å£ Awareï¼Œåœ¨ Spring æ¡†æ¶ä¸­å®ƒæ˜¯ä¸€ç§æ„ŸçŸ¥æ ‡è®°æ€§æ¥å£ï¼Œå…·ä½“çš„å­ç±»å®šä¹‰å’Œå®ç°èƒ½æ„ŸçŸ¥å®¹å™¨ä¸­çš„ç›¸å…³å¯¹è±¡ã€‚<em>ä¹Ÿå°±æ˜¯é€šè¿‡è¿™ä¸ªæ¡¥æ¢ï¼Œå‘å…·ä½“çš„å®ç°ç±»ä¸­æä¾›å®¹å™¨æœåŠ¡</em></li><li>ç»§æ‰¿ Aware çš„æ¥å£åŒ…æ‹¬ï¼šBeanFactoryAwareã€BeanClassLoaderAwareã€BeanNameAwareå’ŒApplicationContextAwareï¼Œå½“ç„¶åœ¨ Spring æºç ä¸­è¿˜æœ‰ä¸€äº›å…¶ä»–å…³äºæ³¨è§£çš„ï¼Œä¸è¿‡ç›®å‰æˆ‘ä»¬è¿˜æ˜¯ç”¨ä¸åˆ°ã€‚</li><li>åœ¨å…·ä½“çš„æ¥å£å®ç°è¿‡ç¨‹ä¸­ä½ å¯ä»¥çœ‹åˆ°ï¼Œä¸€éƒ¨åˆ†(<em>BeanFactoryAwareã€BeanClassLoaderAwareã€BeanNameAware</em>)åœ¨ factory çš„ support æ–‡ä»¶å¤¹ä¸‹ï¼Œå¦å¤– ApplicationContextAware æ˜¯åœ¨ context çš„ support ä¸­ï¼Œè¿™æ˜¯å› ä¸ºä¸åŒçš„å†…å®¹è·å–éœ€è¦åœ¨ä¸åŒçš„åŒ…ä¸‹æä¾›ã€‚æ‰€ä»¥ï¼Œåœ¨ AbstractApplicationContext çš„å…·ä½“å®ç°ä¸­ä¼šç”¨åˆ°å‘ beanFactory æ·»åŠ  BeanPostProcessor å†…å®¹çš„ <code>ApplicationContextAwareProcessor</code> æ“ä½œï¼Œæœ€åç”± AbstractAutowireCapableBeanFactory åˆ›å»º createBean æ—¶å¤„ç†ç›¸åº”çš„è°ƒç”¨æ“ä½œã€‚<em>å…³äº applyBeanPostProcessorsBeforeInitialization å·²ç»åœ¨å‰é¢ç« èŠ‚ä¸­å®ç°è¿‡ï¼Œå¦‚æœå¿˜è®°å¯ä»¥å¾€å‰ç¿»ç¿»</em></li></ul><h2 id="å››ã€å®ç°" tabindex="-1"><a class="header-anchor" href="#å››ã€å®ç°" aria-hidden="true">#</a> å››ã€å®ç°</h2><h3 id="_1-å·¥ç¨‹ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1-å·¥ç¨‹ç»“æ„" aria-hidden="true">#</a> 1. å·¥ç¨‹ç»“æ„</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>small<span class="token operator">-</span>spring<span class="token operator">-</span>step<span class="token operator">-</span><span class="token number">08</span>
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework
    â”‚           â”œâ”€â”€ beans
    â”‚           â”‚   â”œâ”€â”€ factory
    â”‚           â”‚   â”‚   â”œâ”€â”€ config
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AutowireCapableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanDefinition</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanFactoryPostProcessor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanPostProcessor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanReference</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ConfigurableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ <span class="token class-name">SingletonBeanRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractBeanDefinitionReader</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanDefinitionReader</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanDefinitionRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">CglibSubclassingInstantiationStrategy</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DefaultListableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DefaultSingletonBeanRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DisposableBeanAdapter</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">InstantiationStrategy</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ <span class="token class-name">SimpleInstantiationStrategy</span><span class="token punctuation">.</span>java  
    â”‚           â”‚   â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ <span class="token class-name">XmlBeanDefinitionReader</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">Aware</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanClassLoaderAware</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanFactoryAware</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanNameAware</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ConfigurableListableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DisposableBean</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">HierarchicalBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">InitializingBean</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">ListableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">BeansException</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">PropertyValue</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">PropertyValues</span><span class="token punctuation">.</span>java 
    â”‚           â”œâ”€â”€ context
    â”‚           â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractRefreshableApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractXmlApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationContextAwareProcessor</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationContextAware</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ core<span class="token punctuation">.</span>io
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ClassPathResource</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">DefaultResourceLoader</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">FileSystemResource</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">Resource</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ResourceLoader</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">UrlResource</span><span class="token punctuation">.</span>java
    â”‚           â””â”€â”€ utils
    â”‚               â””â”€â”€ <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span>java
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test
                â”œâ”€â”€ bean
                â”‚   â”œâ”€â”€ <span class="token class-name">UserDao</span><span class="token punctuation">.</span>java
                â”‚   â””â”€â”€ <span class="token class-name">UserService</span><span class="token punctuation">.</span>java
                â””â”€â”€ <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å·¥ç¨‹æºç </strong>ï¼š<code>å…¬ä¼—å·ã€Œbugstackè™«æ´æ ˆã€ï¼Œå›å¤ï¼šSpring ä¸“æ ï¼Œè·å–å®Œæ•´æºç </code></p><p>Spring æ„ŸçŸ¥æ¥å£çš„è®¾è®¡å’Œå®ç°ç±»å…³ç³»ï¼Œå¦‚å›¾ 9-2</p><p><img src="https://bugstack.cn/assets/images/spring/spring-9-02.png" alt="å›¾ 9-2"></p><ul><li>ä»¥ä¸Šæ•´ä¸ªç±»å…³ç³»å°±æ˜¯å…³äº Aware æ„ŸçŸ¥çš„å®šä¹‰å’Œå¯¹å®¹å™¨æ„ŸçŸ¥çš„å®ç°ã€‚</li><li>Aware æœ‰å››ä¸ªç»§æ‰¿çš„æ¥å£ï¼Œå…¶ä»–è¿™äº›æ¥å£çš„ç»§æ‰¿éƒ½æ˜¯ä¸ºäº†ç»§æ‰¿ä¸€ä¸ªæ ‡è®°ï¼Œæœ‰äº†æ ‡è®°çš„å­˜åœ¨æ›´æ–¹ä¾¿ç±»çš„æ“ä½œå’Œå…·ä½“åˆ¤æ–­å®ç°ã€‚</li><li>å¦å¤–ç”±äº ApplicationContext å¹¶ä¸æ˜¯åœ¨ AbstractAutowireCapableBeanFactory ä¸­ createBean æ–¹æ³•ä¸‹çš„å†…å®¹ï¼Œæ‰€ä»¥éœ€è¦åƒå®¹å™¨ä¸­æ³¨å†Œ <code>addBeanPostProcessor</code> ï¼Œå†ç”± createBean ç»Ÿä¸€è°ƒç”¨ applyBeanPostProcessorsBeforeInitialization æ—¶è¿›è¡Œæ“ä½œã€‚</li></ul><h3 id="_2-å®šä¹‰æ ‡è®°æ¥å£" tabindex="-1"><a class="header-anchor" href="#_2-å®šä¹‰æ ‡è®°æ¥å£" aria-hidden="true">#</a> 2. å®šä¹‰æ ‡è®°æ¥å£</h3><p><strong>cn.bugstack.springframework.beans.factory.Aware</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Marker superinterface indicating that a bean is eligible to be
 * notified by the Spring container of a particular framework object
 * through a callback-style method.  Actual method signature is
 * determined by individual subinterfaces, but should typically
 * consist of just one void-returning method that accepts a single
 * argument.
 *
 * æ ‡è®°ç±»æ¥å£ï¼Œå®ç°è¯¥æ¥å£å¯ä»¥è¢«Springå®¹å™¨æ„ŸçŸ¥
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Aware</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨ Spring ä¸­æœ‰ç‰¹åˆ«å¤šç±»ä¼¼è¿™æ ·çš„æ ‡è®°æ¥å£çš„è®¾è®¡æ–¹å¼ï¼Œå®ƒä»¬çš„å­˜åœ¨å°±åƒæ˜¯ä¸€ç§æ ‡ç­¾ä¸€æ ·ï¼Œå¯ä»¥æ–¹ä¾¿ç»Ÿä¸€æ‘˜å–å‡ºå±äºæ­¤ç±»æ¥å£çš„å®ç°ç±»ï¼Œé€šå¸¸ä¼šæœ‰ instanceof ä¸€èµ·åˆ¤æ–­ä½¿ç”¨ã€‚</li></ul><h3 id="_3-å®¹å™¨æ„ŸçŸ¥ç±»" tabindex="-1"><a class="header-anchor" href="#_3-å®¹å™¨æ„ŸçŸ¥ç±»" aria-hidden="true">#</a> 3. å®¹å™¨æ„ŸçŸ¥ç±»</h3><h4 id="_3-1-beanfactoryaware" tabindex="-1"><a class="header-anchor" href="#_3-1-beanfactoryaware" aria-hidden="true">#</a> 3.1 BeanFactoryAware</h4><p><strong>cn.bugstack.springframework.beans.factory.BeanFactoryAware</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BeanFactoryAware</span> <span class="token keyword">extends</span> <span class="token class-name">Aware</span> <span class="token punctuation">{</span>

   <span class="token keyword">void</span> <span class="token function">setBeanFactory</span><span class="token punctuation">(</span><span class="token class-name">BeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Interface to be implemented by beans that wish to be aware of their owning {@link BeanFactory}.</li><li>å®ç°æ­¤æ¥å£ï¼Œæ—¢èƒ½æ„ŸçŸ¥åˆ°æ‰€å±çš„ BeanFactory</li></ul><h4 id="_3-2-beanclassloaderaware" tabindex="-1"><a class="header-anchor" href="#_3-2-beanclassloaderaware" aria-hidden="true">#</a> 3.2 BeanClassLoaderAware</h4><p><strong>cn.bugstack.springframework.beans.factory.BeanClassLoaderAware</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BeanClassLoaderAware</span> <span class="token keyword">extends</span> <span class="token class-name">Aware</span><span class="token punctuation">{</span>

    <span class="token keyword">void</span> <span class="token function">setBeanClassLoader</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Callback that allows a bean to be aware of the bean{@link ClassLoader class loader}; that is, the class loader used by the present bean factory to load bean classes.</li><li>å®ç°æ­¤æ¥å£ï¼Œæ—¢èƒ½æ„ŸçŸ¥åˆ°æ‰€å±çš„ ClassLoader</li></ul><h4 id="_3-3-beannameaware" tabindex="-1"><a class="header-anchor" href="#_3-3-beannameaware" aria-hidden="true">#</a> 3.3 BeanNameAware</h4><p><strong>cn.bugstack.springframework.beans.factory.BeanNameAware</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BeanNameAware</span> <span class="token keyword">extends</span> <span class="token class-name">Aware</span> <span class="token punctuation">{</span>

    <span class="token keyword">void</span> <span class="token function">setBeanName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Interface to be implemented by beans that want to be aware of their bean name in a bean factory.</li><li>å®ç°æ­¤æ¥å£ï¼Œæ—¢èƒ½æ„ŸçŸ¥åˆ°æ‰€å±çš„ BeanName</li></ul><h4 id="_3-4-applicationcontextaware" tabindex="-1"><a class="header-anchor" href="#_3-4-applicationcontextaware" aria-hidden="true">#</a> 3.4 ApplicationContextAware</h4><p><strong>cn.bugstack.springframework.context.ApplicationContextAware</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApplicationContextAware</span> <span class="token keyword">extends</span> <span class="token class-name">Aware</span> <span class="token punctuation">{</span>

    <span class="token keyword">void</span> <span class="token function">setApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Interface to be implemented by any object that wishes to be notifiedof the {@link ApplicationContext} that it runs in.</li><li>å®ç°æ­¤æ¥å£ï¼Œæ—¢èƒ½æ„ŸçŸ¥åˆ°æ‰€å±çš„ ApplicationContext</li></ul><h3 id="_4-åŒ…è£…å¤„ç†å™¨-applicationcontextawareprocessor" tabindex="-1"><a class="header-anchor" href="#_4-åŒ…è£…å¤„ç†å™¨-applicationcontextawareprocessor" aria-hidden="true">#</a> 4. åŒ…è£…å¤„ç†å™¨(ApplicationContextAwareProcessor)</h3><p><strong>cn.bugstack.springframework.context.support.ApplicationContextAwareProcessor</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationContextAwareProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ApplicationContextAwareProcessor</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext <span class="token operator">=</span> applicationContext<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">ApplicationContextAware</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContextAware</span><span class="token punctuation">)</span> bean<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setApplicationContext</span><span class="token punctuation">(</span>applicationContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ç”±äº ApplicationContext çš„è·å–å¹¶ä¸èƒ½ç›´æ¥åœ¨åˆ›å»º Bean æ—¶å€™å°±å¯ä»¥æ‹¿åˆ°ï¼Œæ‰€ä»¥éœ€è¦åœ¨ refresh æ“ä½œæ—¶ï¼ŒæŠŠ ApplicationContext å†™å…¥åˆ°ä¸€ä¸ªåŒ…è£…çš„ BeanPostProcessor ä¸­å»ï¼Œå†ç”± AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsBeforeInitialization æ–¹æ³•è°ƒç”¨ã€‚</li></ul><h3 id="_5-æ³¨å†Œ-beanpostprocessor" tabindex="-1"><a class="header-anchor" href="#_5-æ³¨å†Œ-beanpostprocessor" aria-hidden="true">#</a> 5. æ³¨å†Œ BeanPostProcessor</h3><p><strong>cn.bugstack.springframework.context.support.AbstractApplicationContext</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractApplicationContext</span> <span class="token keyword">extends</span> <span class="token class-name">DefaultResourceLoader</span> <span class="token keyword">implements</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. åˆ›å»º BeanFactoryï¼Œå¹¶åŠ è½½ BeanDefinition</span>
        <span class="token function">refreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2. è·å– BeanFactory</span>
        <span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3. æ·»åŠ  ApplicationContextAwareProcessorï¼Œè®©ç»§æ‰¿è‡ª ApplicationContextAware çš„ Bean å¯¹è±¡éƒ½èƒ½æ„ŸçŸ¥æ‰€å±çš„ ApplicationContext</span>
        beanFactory<span class="token punctuation">.</span><span class="token function">addBeanPostProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ApplicationContextAwareProcessor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4. åœ¨ Bean å®ä¾‹åŒ–ä¹‹å‰ï¼Œæ‰§è¡Œ BeanFactoryPostProcessor (Invoke factory processors registered as beans in the context.)</span>
        <span class="token function">invokeBeanFactoryPostProcessors</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 5. BeanPostProcessor éœ€è¦æå‰äºå…¶ä»– Bean å¯¹è±¡å®ä¾‹åŒ–ä¹‹å‰æ‰§è¡Œæ³¨å†Œæ“ä½œ</span>
        <span class="token function">registerBeanPostProcessors</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 6. æå‰å®ä¾‹åŒ–å•ä¾‹Beanå¯¹è±¡</span>
        beanFactory<span class="token punctuation">.</span><span class="token function">preInstantiateSingletons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
 	<span class="token comment">// ...   </span>
<span class="token punctuation">}</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>refresh() æ–¹æ³•å°±æ˜¯æ•´ä¸ª Spring å®¹å™¨çš„æ“ä½œè¿‡ç¨‹ï¼Œä¸ä¸Šä¸€ç« èŠ‚å¯¹æ¯”ï¼Œæœ¬æ¬¡æ–°å¢åŠ äº†å…³äº addBeanPostProcessor çš„æ“ä½œã€‚</li><li>æ·»åŠ  ApplicationContextAwareProcessorï¼Œè®©ç»§æ‰¿è‡ª ApplicationContextAware çš„ Bean å¯¹è±¡éƒ½èƒ½æ„ŸçŸ¥æ‰€å±çš„ ApplicationContextã€‚</li></ul><h3 id="_6-æ„ŸçŸ¥è°ƒç”¨æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_6-æ„ŸçŸ¥è°ƒç”¨æ“ä½œ" aria-hidden="true">#</a> 6. æ„ŸçŸ¥è°ƒç”¨æ“ä½œ</h3><p><strong>cn.bugstack.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractAutowireCapableBeanFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractBeanFactory</span> <span class="token keyword">implements</span> <span class="token class-name">AutowireCapableBeanFactory</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">InstantiationStrategy</span> instantiationStrategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CglibSubclassingInstantiationStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">createBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> bean <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            bean <span class="token operator">=</span> <span class="token function">createBeanInstance</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ç»™ Bean å¡«å……å±æ€§</span>
            <span class="token function">applyPropertyValues</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ‰§è¡Œ Bean çš„åˆå§‹åŒ–æ–¹æ³•å’Œ BeanPostProcessor çš„å‰ç½®å’Œåç½®å¤„ç†æ–¹æ³•</span>
            bean <span class="token operator">=</span> <span class="token function">initializeBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeansException</span><span class="token punctuation">(</span><span class="token string">&quot;Instantiation of bean failed&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// æ³¨å†Œå®ç°äº† DisposableBean æ¥å£çš„ Bean å¯¹è±¡</span>
        <span class="token function">registerDisposableBeanIfNecessary</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">addSingleton</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">initializeBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// invokeAwareMethods</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">Aware</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">BeanFactoryAware</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">BeanFactoryAware</span><span class="token punctuation">)</span> bean<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setBeanFactory</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">BeanClassLoaderAware</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">BeanClassLoaderAware</span><span class="token punctuation">)</span> bean<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setBeanClassLoader</span><span class="token punctuation">(</span><span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">BeanNameAware</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">BeanNameAware</span><span class="token punctuation">)</span> bean<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setBeanName</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 1. æ‰§è¡Œ BeanPostProcessor Before å¤„ç†</span>
        <span class="token class-name">Object</span> wrappedBean <span class="token operator">=</span> <span class="token function">applyBeanPostProcessorsBeforeInitialization</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ‰§è¡Œ Bean å¯¹è±¡çš„åˆå§‹åŒ–æ–¹æ³•</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">invokeInitMethods</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> wrappedBean<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeansException</span><span class="token punctuation">(</span><span class="token string">&quot;Invocation of init method of bean[&quot;</span> <span class="token operator">+</span> beanName <span class="token operator">+</span> <span class="token string">&quot;] failed&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 2. æ‰§è¡Œ BeanPostProcessor After å¤„ç†</span>
        wrappedBean <span class="token operator">=</span> <span class="token function">applyBeanPostProcessorsAfterInitialization</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> wrappedBean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>



    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">applyBeanPostProcessorsBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> existingBean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> existingBean<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BeanPostProcessor</span> processor <span class="token operator">:</span> <span class="token function">getBeanPostProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Object</span> current <span class="token operator">=</span> processor<span class="token punctuation">.</span><span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> current<span class="token punctuation">)</span> <span class="token keyword">return</span> result<span class="token punctuation">;</span>
            result <span class="token operator">=</span> current<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">applyBeanPostProcessorsAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> existingBean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> existingBean<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BeanPostProcessor</span> processor <span class="token operator">:</span> <span class="token function">getBeanPostProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Object</span> current <span class="token operator">=</span> processor<span class="token punctuation">.</span><span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> current<span class="token punctuation">)</span> <span class="token keyword">return</span> result<span class="token punctuation">;</span>
            result <span class="token operator">=</span> current<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>cn.bugstack.springframework.beans.factory.support.AbstractBeanFactory</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractBeanFactory</span> <span class="token keyword">extends</span> <span class="token class-name">DefaultSingletonBeanRegistry</span> <span class="token keyword">implements</span> <span class="token class-name">ConfigurableBeanFactory</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * ClassLoader to resolve bean class names with, if necessary
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">ClassLoader</span> beanClassLoader <span class="token operator">=</span> <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">getDefaultClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//...</span>

    <span class="token keyword">public</span> <span class="token class-name">ClassLoader</span> <span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanClassLoader<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™é‡Œæˆ‘ä»¬å»æ‰äº†ä¸€äº›ç±»çš„å†…å®¹ï¼Œåªä¿ç•™å…³äºæœ¬æ¬¡ Aware æ„ŸçŸ¥æ¥å£çš„æ“ä½œã€‚</li><li>é¦–å…ˆåœ¨ initializeBean ä¸­ï¼Œé€šè¿‡åˆ¤æ–­ <code>bean instanceof Aware</code>ï¼Œè°ƒç”¨äº†ä¸‰ä¸ªæ¥å£æ–¹æ³•ï¼Œ<code>BeanFactoryAware.setBeanFactory(this)</code>ã€<code>BeanClassLoaderAware.setBeanClassLoader(getBeanClassLoader())</code>ã€<code>BeanNameAware.setBeanName(beanName)</code>ï¼Œè¿™æ ·å°±èƒ½é€šçŸ¥åˆ°å·²ç»å®ç°äº†æ­¤æ¥å£çš„ç±»ã€‚</li><li>å¦å¤–æˆ‘ä»¬è¿˜å‘ BeanPostProcessor ä¸­æ·»åŠ äº† <code>ApplicationContextAwareProcessor</code>ï¼Œæ­¤æ—¶åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¹Ÿä¼šè¢«è°ƒç”¨åˆ°å…·ä½“çš„ç±»å®ç°ï¼Œå¾—åˆ°ä¸€ä¸ª ApplicationContex å±æ€§ã€‚</li></ul><h2 id="äº”ã€æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#äº”ã€æµ‹è¯•" aria-hidden="true">#</a> äº”ã€æµ‹è¯•</h2><h3 id="_1-äº‹å…ˆå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#_1-äº‹å…ˆå‡†å¤‡" aria-hidden="true">#</a> 1. äº‹å…ˆå‡†å¤‡</h3><p><strong>cn.bugstack.springframework.test.bean.UserDao</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDao</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> hashMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initDataMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œï¼šinit-method&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;10002&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;å…«æ¯æ°´&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;10003&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;é˜¿æ¯›&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroyDataMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œï¼šdestroy-method&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hashMap<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">queryUserName</span><span class="token punctuation">(</span><span class="token class-name">String</span> uId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> hashMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>uId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>cn.bugstack.springframework.test.bean.UserService</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token keyword">implements</span> <span class="token class-name">BeanNameAware</span><span class="token punctuation">,</span> <span class="token class-name">BeanClassLoaderAware</span><span class="token punctuation">,</span> <span class="token class-name">ApplicationContextAware</span><span class="token punctuation">,</span> <span class="token class-name">BeanFactoryAware</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">BeanFactory</span> beanFactory<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> uId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> company<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> location<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBeanFactory</span><span class="token punctuation">(</span><span class="token class-name">BeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory <span class="token operator">=</span> beanFactory<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext <span class="token operator">=</span> applicationContext<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBeanName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Bean Name isï¼š&quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBeanClassLoader</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ClassLoaderï¼š&quot;</span> <span class="token operator">+</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...get/set</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>UserDao æœ¬æ¬¡å¹¶æ²¡æœ‰ä»€ä¹ˆæ”¹å˜ï¼Œè¿˜æ˜¯æä¾›äº†å…³äºåˆå§‹åŒ–çš„æ–¹æ³•ï¼Œå¹¶åœ¨ Spring.xml ä¸­æä¾› init-methodã€destroy-method é…ç½®ä¿¡æ¯ã€‚</li><li>UserService æ–°å¢åŠ ï¼ŒBeanNameAware, BeanClassLoaderAware, ApplicationContextAware, BeanFactoryAwareï¼Œå››ä¸ªæ„ŸçŸ¥çš„å®ç°ç±»ï¼Œå¹¶åœ¨ç±»ä¸­å®ç°ç›¸åº”çš„æ¥å£æ–¹æ³•ã€‚</li></ul><h3 id="_2-é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> 2. é…ç½®æ–‡ä»¶</h3><p><strong>åŸºç¡€é…ç½®ï¼Œæ— BeanFactoryPostProcessorã€BeanPostProcessorï¼Œå®ç°ç±»</strong></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.springframework.test.bean.UserDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">init-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>initDataMethod<span class="token punctuation">&quot;</span></span> <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>destroyDataMethod<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.springframework.test.bean.UserService<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10001<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>company<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>è…¾è®¯<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>location<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>æ·±åœ³<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userDao<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æœ¬ç« èŠ‚ä¸­å¹¶æ²¡æœ‰é¢å¤–æ–°å¢åŠ é…ç½®ä¿¡æ¯ï¼Œä¸ä¸Šä¸€ç« èŠ‚å†…å®¹ç›¸åŒã€‚</li></ul><h3 id="_3-å•å…ƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-å•å…ƒæµ‹è¯•" aria-hidden="true">#</a> 3. å•å…ƒæµ‹è¯•</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_xml</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.åˆå§‹åŒ– BeanFactory</span>
    <span class="token class-name">ClassPathXmlApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:spring.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    applicationContext<span class="token punctuation">.</span><span class="token function">registerShutdownHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      

    <span class="token comment">// 2. è·å–Beanå¯¹è±¡è°ƒç”¨æ–¹æ³•</span>
    <span class="token class-name">UserService</span> userService <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">,</span> <span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> result <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">queryUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•ç»“æœï¼š&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ApplicationContextAwareï¼š&quot;</span><span class="token operator">+</span>userService<span class="token punctuation">.</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;BeanFactoryAwareï¼š&quot;</span><span class="token operator">+</span>userService<span class="token punctuation">.</span><span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æµ‹è¯•æ–¹æ³•ä¸­ä¸»è¦æ˜¯æ·»åŠ äº†ä¸€å†™å…³äºæ–°å¢ Aware å®ç°çš„è°ƒç”¨ï¼Œå…¶ä»–ä¸éœ€è¦è°ƒç”¨çš„ä¹Ÿæ‰“å°äº†ç›¸åº”çš„æ—¥å¿—ä¿¡æ¯ï¼Œå¯ä»¥åœ¨æµ‹è¯•ç»“æœä¸­çœ‹åˆ°ã€‚</li></ul><p><strong>æµ‹è¯•ç»“æœ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>æ‰§è¡Œï¼šinit<span class="token operator">-</span>method
<span class="token class-name">ClassLoader</span>ï¼š<span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>Launcher</span>$<span class="token class-name">AppClassLoader</span><span class="token annotation punctuation">@14dad5dc</span>
<span class="token class-name">Bean</span> <span class="token class-name">Name</span> isï¼šuserService
æµ‹è¯•ç»“æœï¼šå°å‚…å“¥<span class="token punctuation">,</span>è…¾è®¯<span class="token punctuation">,</span>æ·±åœ³
<span class="token class-name">ApplicationContextAware</span>ï¼š<span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>ClassPathXmlApplicationContext</span><span class="token annotation punctuation">@5ba23b66</span>
<span class="token class-name">BeanFactoryAware</span>ï¼š<span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>DefaultListableBeanFactory</span><span class="token annotation punctuation">@2ff4f00f</span>
æ‰§è¡Œï¼šdestroy<span class="token operator">-</span>method



<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä»æµ‹è¯•ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œæœ¬ç« èŠ‚æ–°å¢åŠ çš„æ„ŸçŸ¥æ¥å£å¯¹åº”çš„å…·ä½“å®ç°(BeanNameAware, BeanClassLoaderAware, ApplicationContextAware, BeanFactoryAware)ï¼Œå·²ç»å¯ä»¥å¦‚æœŸè¾“å‡ºç»“æœäº†ã€‚</li></ul><h2 id="å…­ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#å…­ã€æ€»ç»“" aria-hidden="true">#</a> å…­ã€æ€»ç»“</h2><ul><li><p>ç›®å‰å…³äº Spring æ¡†æ¶çš„å®ç°ä¸­ï¼ŒæŸäº›åŠŸèƒ½ç‚¹å·²ç»è¶Šæ¥è¶‹å‘äºå®Œæ•´ï¼Œå°¤å…¶æ˜¯ Bean å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå·²ç»æœ‰äº†å¾ˆå¤šçš„ä½“ç°ã€‚æ•´ä½“æ€»ç»“å¦‚å›¾ 9-3</p><p><img src="https://bugstack.cn/assets/images/spring/spring-9-03.png" alt="å›¾ 9-3"></p></li><li><p>æœ¬ç« èŠ‚å…³äº Aware çš„æ„ŸçŸ¥æ¥å£çš„å››ä¸ªç»§æ‰¿æ¥å£ BeanNameAware, BeanClassLoaderAware, ApplicationContextAware, BeanFactoryAware çš„å®ç°ï¼Œåˆæ‰©å±•äº† Spring çš„åŠŸèƒ½ã€‚å¦‚æœä½ æœ‰åšè¿‡å…³äº Spring ä¸­é—´ä»¶çš„å¼€å‘é‚£ä¹ˆä¸€å®šä¼šå¤§é‡ç”¨åˆ°è¿™äº›ç±»ï¼Œç°åœ¨ä½ ä¸åªæ˜¯ç”¨è¿‡ï¼Œè€Œä¸”è¿˜çŸ¥é“ä»–ä»¬éƒ½æ˜¯ä»€ä¹ˆæ—¶å€™è§¦è¾¾çš„ï¼Œåœ¨ä»¥åæƒ³æ’æŸ¥ç±»çš„å®ä¾‹åŒ–é¡ºåºä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ªæ¸…æ™°çš„æ€è·¯äº†ã€‚</p></li><li><p>æ¯ä¸€ç« èŠ‚å†…å®¹çš„å®ç°éƒ½æ˜¯åœ¨ä»¥è®¾è®¡æ¨¡å¼ä¸ºæ ¸å¿ƒçš„ç»“æ„ä¸Šå¡«å……å„é¡¹æ¨¡å—çš„åŠŸèƒ½ï¼Œå•çº¯çš„æ“ä½œç¼–å†™ä»£ç å¹¶ä¸ä¼šæœ‰å¤ªå¤šæ”¶è·ï¼Œä¸€å®šæ˜¯è¦ç†è§£ä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ï¼Œè¿™ä¹ˆè®¾è®¡çš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆå°±é‚£ä¹ˆå¤šæ¥å£å’ŒæŠ½è±¡ç±»çš„åº”ç”¨ï¼Œè¿™äº›æ‰æ˜¯ Spring æ¡†æ¶å­¦ä¹ çš„æ ¸å¿ƒæ‰€åœ¨ã€‚</p></li></ul><h2 id="ä¸ƒã€ä¼˜ç§€ä½œä¸š" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€ä¼˜ç§€ä½œä¸š" aria-hidden="true">#</a> ä¸ƒã€ä¼˜ç§€ä½œä¸š</h2>`,76),b={href:"https://t.zsxq.com/05vZ76aYr",target:"_blank",rel:"noopener noreferrer"},g={href:"https://t.zsxq.com/07D3i4lRJ",target:"_blank",rel:"noopener noreferrer"},w={href:"https://t.zsxq.com/08DptauLn",target:"_blank",rel:"noopener noreferrer"},h={href:"https://t.zsxq.com/087b5hc0O",target:"_blank",rel:"noopener noreferrer"},y={href:"https://t.zsxq.com/082KHHaer",target:"_blank",rel:"noopener noreferrer"},f={href:"https://t.zsxq.com/091KGjqpP",target:"_blank",rel:"noopener noreferrer"},B={href:"https://t.zsxq.com/09DZdKCfV",target:"_blank",rel:"noopener noreferrer"},A={href:"https://t.zsxq.com/0bTXvgV9i",target:"_blank",rel:"noopener noreferrer"},x={href:"https://t.zsxq.com/0bDzEXoMY",target:"_blank",rel:"noopener noreferrer"};function C(j,q){const s=p("ExternalLinkIcon");return o(),c("div",null,[u,n("p",null,[a("ä½œè€…ï¼šå°å‚…å“¥ "),r,a("åšå®¢ï¼š"),n("a",k,[a("https://bugstack.cn"),e(s)]),d,a("åŸæ–‡ï¼š"),n("a",v,[a("https://mp.weixin.qq.com/s/KP_4IQ2MZ-Pzq80WrJpCOA"),e(s)])]),m,n("ul",null,[n("li",null,[n("a",b,[a("Awareæ„ŸçŸ¥å®¹å™¨å¯¹è±¡ï¼Œå®ç°è‡ªå®šä¹‰æ‰©å±•æ¡†æ¶ @Ray"),e(s)])]),n("li",null,[n("a",g,[a("Awareæ„ŸçŸ¥å®¹å™¨å¯¹è±¡ @liuc"),e(s)])]),n("li",null,[n("a",w,[a("xmlè§£ææ—¶æ–°å¢scopeå±æ€§ï¼Œç”¨æ¥æ³¨æ˜è¯¥BeanDefinitionsæ˜¯å¦ä¸ºå•ä¾‹ã€‚è‹¥ä¸ºåŸå‹æ¨¡å¼ï¼Œåˆ™ä¸æ”¾å…¥Bean Mapç¼“å­˜ã€‚@å‚…å“¥åæ´ä¼šä¼šé•¿"),e(s)])]),n("li",null,[n("a",h,[a("å®ç° Bean çš„æ„ŸçŸ¥åŠŸèƒ½ï¼Œå³å¯ä»¥è®¿é—®Springå®¹å™¨å¹¶è·å–å¯¹åº”çš„å±æ€§ã€‚@Homage"),e(s)])]),n("li",null,[n("a",y,[a("å‘è™šæ‹Ÿæœºæ³¨å†Œé’©å­æ–¹æ³•åœ¨è™šæ‹Ÿæœºé€€å‡ºå‰åšä¸€äº›æ“ä½œï¼ˆå¦‚ç›‘æ§æœåŠ¡å™¨å®•æœºï¼Œå¤‡æœºå¯åŠ¨ç­‰ï¼‰@å¾®é£"),e(s)])]),n("li",null,[n("a",f,[a("å¯¹è±¡ä½œç”¨åŸŸï¼Œå¢åŠ äº†scopçš„æ³¨å…¥ é€šè¿‡scopçš„å€¼åˆ¤æ–­æ˜¯å¦å°†å¯¹è±¡æ³¨å…¥è¿›å•ä¾‹çš„é›†åˆä¸­ @Liuliuliu"),e(s)])]),n("li",null,[n("a",B,[a("äº†è§£äº†Awareæ¥å£çš„æ ¸å¿ƒåŠŸèƒ½ä¸å¤§è‡´çš„å®ç°æ–¹å¼ @åœ¨ä¹æœˆ"),e(s)])]),n("li",null,[n("a",A,[a("å½“ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¡†æ¶æˆ–è€…åº“æ—¶ï¼Œæœ‰æ—¶å€™æ˜¯æ— æ³•å» new ä¸€ä¸ªå¯¹è±¡çš„ @lucien"),e(s)])]),n("li",null,[n("a",x,[a("Spring ä¾èµ–æ³¨å…¥çš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯æ‰€æœ‰Bean å¯¹è±¡ @çˆ±å¥‹æ–—çš„å°é²¨é±¼"),e(s)])])])])}const _=t(l,[["render",C],["__file","2021-06-28-di9zhangï¼šhuxingyouyuï¼ŒdingyibiaojileixingAwarejiekouï¼Œshixianganzhirongqiduixiang.html.vue"]]);export{_ as default};
