import{_ as t,r as p,o as e,c as o,a as n,b as s,d as c,e as l}from"./app-3RcBQnkC.js";const u={},i=n("h1",{id:"websocketä¸ä¸‹ä½æœºé€šè¿‡nettyæ–¹å¼é€šä¿¡ä¼ è¾“è¡Œä¸ºä¿¡æ¯",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#websocketä¸ä¸‹ä½æœºé€šè¿‡nettyæ–¹å¼é€šä¿¡ä¼ è¾“è¡Œä¸ºä¿¡æ¯","aria-hidden":"true"},"#"),s(" websocketä¸ä¸‹ä½æœºé€šè¿‡nettyæ–¹å¼é€šä¿¡ä¼ è¾“è¡Œä¸ºä¿¡æ¯")],-1),k=n("br",null,null,-1),r={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=l(`<blockquote><p>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„</p></blockquote><h2 id="å‰è¨€ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#å‰è¨€ä»‹ç»" aria-hidden="true">#</a> å‰è¨€ä»‹ç»</h2><p>åœ¨ç‰©è”ç½‘å¼€å‘ä¸­ï¼Œå¸¸å¸¸éœ€è¦é€šè¿‡ç½‘é¡µç«¯æ¥æ§åˆ¶è®¾å¤‡ï¼ŒåŒ…æ‹¬ï¼›è·å–ä¿¡æ¯ã€æ‰§è¡Œæ“ä½œã€å¯åŠ¨åœæ­¢ç­‰ï¼Œå°±åƒæˆ‘ä»¬åœ¨æ‰‹æœºä¸Šä¼šæ§åˆ¶å®¶é‡Œçš„å°ç±³ç›’å­ã€è·¯ç”±å™¨ã€ç”µé¥­ç…²æˆ–è€…åœ¨çº¿å…»ç‹—ç­‰ä¸€äº›è®¾å¤‡ä¸€æ ·ã€‚åœ¨è¿™é‡Œæ‰€æœ‰çš„ä¸‹å±‚è®¾å¤‡éƒ½å¯ä»¥é€šè¿‡socketé€šä¿¡é“¾æ¥åˆ°æœåŠ¡ç«¯ï¼Œè€Œç”¨æˆ·ä¸€ç«¯åœ¨é€šè¿‡httpé“¾æ¥æˆ–è€…websocketé“¾æ¥åˆ°æœåŠ¡ç«¯ï¼Œé€šè¿‡å‘é€å’Œæ¥æ”¶æ•°æ®æ¥åšå‡ºç›¸åº”çš„è¡Œä¸ºæ“ä½œã€‚å¦‚ä¸‹å›¾ï¼› <img src="https://bugstack.cn/assets/images/pic-content/2019/09/netty-3-01.png" alt="å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ &amp; æ‰§è¡Œæµç¨‹"></p><h2 id="æ¡ˆä¾‹ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#æ¡ˆä¾‹ç›®æ ‡" aria-hidden="true">#</a> æ¡ˆä¾‹ç›®æ ‡</h2><ol><li>æœ¬ç« èŠ‚æ•´åˆSpringboot+Nettyï¼Œé€šè¿‡éƒ¨ç½²nettySocketä¸webSocketä¸¤å¥—æœåŠ¡ç«¯ï¼Œæ¥æ¥æ”¶è½¬å‘è¡Œä¸ºæ¶ˆæ¯ã€‚</li><li>å®¢æˆ·ç«¯é‡‡ç”¨jsé“¾æ¥websocketï¼Œç”¨äºæ¥æ”¶æœåŠ¡ç«¯åé¦ˆä¸å‘é€æŒ‡ä»¤ï¼Œç”¨äºè·å–ä¸‹ä½æœºä¿¡æ¯ã€‚</li><li>åœ¨testä¸­å¯åŠ¨ä¸€ä¸ªæ¨¡æ‹Ÿä¸‹ä½æœºï¼Œç”¨äºåé¦ˆä¿¡æ¯æ•°æ®ã€‚åœ¨çœŸå®å¼€å‘ä¸­ä¸‹ä½æœºä¸æœåŠ¡ç«¯é€šä¿¡é€šå¸¸æ˜¯å®šä¹‰å¥½çš„å­—èŠ‚ç ï¼Œéœ€è¦è‡ªå·±ç¼–å†™è§£ç å™¨ã€‚</li></ol><h2 id="ç¯å¢ƒå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#ç¯å¢ƒå‡†å¤‡" aria-hidden="true">#</a> ç¯å¢ƒå‡†å¤‡</h2><ol><li>jdk 1.8.0</li><li>IntelliJ IDEA Community Edition 2018.3.1 x64</li><li>Netty 4.1.36.Final</li></ol><h2 id="ä»£ç ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä»£ç ç¤ºä¾‹" aria-hidden="true">#</a> ä»£ç ç¤ºä¾‹</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>netty<span class="token operator">-</span><span class="token number">3</span><span class="token operator">-</span><span class="token number">01</span>
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â”œâ”€â”€ java
    â”‚   â”‚   â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>ark
    â”‚   â”‚       â”œâ”€â”€ domain
    â”‚   â”‚       â”‚	â”œâ”€â”€ msgobj
    â”‚   â”‚       â”‚	â”‚   â”œâ”€â”€ <span class="token class-name">Feedback</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	â”‚   â”œâ”€â”€ <span class="token class-name">QueryInfoReq</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	â”‚   â””â”€â”€ <span class="token class-name">Text</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	â”œâ”€â”€ <span class="token class-name">Device</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	â”œâ”€â”€ <span class="token class-name">EasyResult</span><span class="token punctuation">.</span>java	
    â”‚   â”‚       â”‚	â”œâ”€â”€ <span class="token class-name">InfoProtocol</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	â””â”€â”€ <span class="token class-name">ServerInfo</span><span class="token punctuation">.</span>java	
    â”‚   â”‚       â”œâ”€â”€ server
    â”‚   â”‚       â”‚	â”œâ”€â”€ socket
    â”‚   â”‚       â”‚	â”‚   â”œâ”€â”€ <span class="token class-name">MyChannelInitializer</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	â”‚   â”œâ”€â”€ <span class="token class-name">MyServerHandler</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	â”‚   â””â”€â”€ <span class="token class-name">NettyServer</span><span class="token punctuation">.</span>java	
    â”‚   â”‚       â”‚	â””â”€â”€ websocket
    â”‚   â”‚       â”‚	    â”œâ”€â”€ <span class="token class-name">MyWsChannelInitializer</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	    â”œâ”€â”€ <span class="token class-name">MyWsServerHandler</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	    â””â”€â”€ <span class="token class-name">WsNettyServer</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”œâ”€â”€ util
    â”‚   â”‚       â”‚	â”œâ”€â”€ <span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	â”œâ”€â”€ <span class="token class-name">MsgUtil</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	â””â”€â”€ <span class="token class-name">MsgUtil</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”œâ”€â”€ web
    â”‚   â”‚       â”‚	â””â”€â”€ <span class="token class-name">NettyController</span><span class="token punctuation">.</span>java	
    â”‚   â”‚       â””â”€â”€ <span class="token class-name">Application</span><span class="token punctuation">.</span>java
    â”‚   â””â”€â”€ resources	
    â”‚   â”‚   â””â”€â”€ application<span class="token punctuation">.</span>yml
    â”‚   â””â”€â”€ webapp
    â”‚       â”œâ”€â”€ arkWs
    â”‚       â”‚	â”œâ”€â”€ js
    â”‚       â”‚	â”‚   â””â”€â”€ ws<span class="token punctuation">.</span>js	
    â”‚       â”‚   â””â”€â”€ arkWsControlCenter<span class="token punctuation">.</span>html	
    â”‚       â”œâ”€â”€ res		
    â”‚       â””â”€â”€ <span class="token constant">WEB</span><span class="token operator">-</span><span class="token constant">INF</span>
    â”‚        	â””â”€â”€ index<span class="token punctuation">.</span>jsp	
    â”‚
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test
                â””â”€â”€ <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ¼”ç¤ºéƒ¨åˆ†é‡ç‚¹ä»£ç å—ï¼Œå®Œæ•´ä»£ç ä¸‹è½½å…³æ³¨å…¬ä¼—å·ï¼›bugstackè™«æ´æ ˆï¼Œå›å¤Nettyæ¡ˆä¾‹</strong></p><blockquote><p>server/socket/MyServerHandler.java &amp; socketæ•°æ®å¤„ç†</p></blockquote><ul><li>å½“æœ‰ä¸‹ä½æœºé“¾æ¥æœåŠ¡ç«¯æ—¶ï¼Œæ„å»ºä¸‹ä½æœºä¿¡æ¯ï¼Œå®é™…ä½¿ç”¨å¯ä»¥é€šè¿‡æ³¨å†Œæ–¹å¼è¿›è¡Œé“¾æ¥éªŒè¯ã€‚</li><li>å½“æ”¶åˆ°ä¸‹ä½æœºä¿¡æ¯åè½¬å‘åˆ°websocketç«¯ï¼Œä½¿ç½‘é¡µç«¯æ”¶åˆ°ä¸‹ä½æœºä¿¡æ¯åé¦ˆ</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">MyServerHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * å½“å®¢æˆ·ç«¯ä¸»åŠ¨é“¾æ¥æœåŠ¡ç«¯çš„é“¾æ¥åï¼Œè¿™ä¸ªé€šé“å°±æ˜¯æ´»è·ƒçš„äº†ã€‚ä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å»ºç«‹äº†é€šä¿¡é€šé“å¹¶ä¸”å¯ä»¥ä¼ è¾“æ•°æ®
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">SocketChannel</span> channel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> channelId <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é“¾æ¥æŠ¥å‘Šå¼€å§‹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é“¾æ¥æŠ¥å‘Šä¿¡æ¯ï¼šæœ‰ä¸€å®¢æˆ·ç«¯é“¾æ¥åˆ°æœ¬æœåŠ¡ç«¯ã€‚channelIdï¼š&quot;</span> <span class="token operator">+</span> channelId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é“¾æ¥æŠ¥å‘ŠIP:&quot;</span> <span class="token operator">+</span> channel<span class="token punctuation">.</span><span class="token function">localAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHostString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é“¾æ¥æŠ¥å‘ŠPort:&quot;</span> <span class="token operator">+</span> channel<span class="token punctuation">.</span><span class="token function">localAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é“¾æ¥æŠ¥å‘Šå®Œæ¯•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æ„å»ºè®¾å¤‡ä¿¡æ¯ï½›ä¸‹ä½æœºã€ä¸­ç»§å™¨ã€IOæ¿å¡ï½</span>
        <span class="token class-name">Device</span> device <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Device</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        device<span class="token punctuation">.</span><span class="token function">setChannelId</span><span class="token punctuation">(</span>channelId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        device<span class="token punctuation">.</span><span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        device<span class="token punctuation">.</span><span class="token function">setIp</span><span class="token punctuation">(</span>channel<span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHostString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        device<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span>channel<span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        device<span class="token punctuation">.</span><span class="token function">setConnectTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ·»åŠ è®¾å¤‡ä¿¡æ¯</span>
        deviceGroup<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>channelId<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>cacheClientChannel<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>channelId<span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> objMsgJsonStr<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//æ¥æ”¶è®¾å¤‡å‘æ¥ä¿¡æ¯</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; æ¥æ”¶åˆ°æ¶ˆæ¯å†…å®¹ï¼š&quot;</span> <span class="token operator">+</span> objMsgJsonStr<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//è½¬å‘æ¶ˆæ¯åˆ°Ws</span>
        <span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>wsChannelGroup<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TextWebSocketFrame</span><span class="token punctuation">(</span>objMsgJsonStr<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>server/websocket/MyWsServerHandler.java &amp; websocketæ•°æ®å¤„ç†</p></blockquote><ul><li>websocketæ•°æ®éœ€è¦è½¬æ¢åä½¿ç”¨ï¼Œå¯ä»¥æ”¯æŒæ–‡æœ¬æ¶ˆæ¯ï¼Œæœ¬æ¡ˆä¾‹ä¸­ä½¿ç”¨jsonå­—ç¬¦ä¸²ï¼Œæ–¹ä¾¿å¯¹è±¡ä¼ è¾“</li><li>channelReadè½¬å‘æ•°æ®ï¼Œå½“æ”¶åˆ°æ•°æ®åå‘é€ç»™ä¸‹ä½æœºï¼Œä¸»è¦é€šè¿‡å†…å®¹ä¸­channelæ§åˆ¶</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyWsServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">{</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token comment">//ws</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">WebSocketFrame</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">WebSocketFrame</span> webSocketFrame <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">WebSocketFrame</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
            <span class="token comment">//å…³é—­è¯·æ±‚</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>webSocketFrame <span class="token keyword">instanceof</span> <span class="token class-name">CloseWebSocketFrame</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                handshaker<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">CloseWebSocketFrame</span><span class="token punctuation">)</span> webSocketFrame<span class="token punctuation">.</span><span class="token function">retain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//pingè¯·æ±‚</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>webSocketFrame <span class="token keyword">instanceof</span> <span class="token class-name">PingWebSocketFrame</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PongWebSocketFrame</span><span class="token punctuation">(</span>webSocketFrame<span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">retain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//åªæ”¯æŒæ–‡æœ¬æ ¼å¼ï¼Œä¸æ”¯æŒäºŒè¿›åˆ¶æ¶ˆæ¯</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>webSocketFrame <span class="token keyword">instanceof</span> <span class="token class-name">TextWebSocketFrame</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">&quot;ä»…æ”¯æŒæ–‡æœ¬æ ¼å¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">String</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TextWebSocketFrame</span><span class="token punctuation">)</span> webSocketFrame<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æœåŠ¡ç«¯æ”¶åˆ°ï¼š&quot;</span> <span class="token operator">+</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">InfoProtocol</span> infoProtocol <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">InfoProtocol</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//socketè½¬å‘æ¶ˆæ¯</span>
            <span class="token class-name">String</span> channelId <span class="token operator">=</span> infoProtocol<span class="token punctuation">.</span><span class="token function">getChannelId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>cacheClientChannel<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>channelId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> channel<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">MsgUtil</span><span class="token punctuation">.</span><span class="token function">buildMsg</span><span class="token punctuation">(</span>infoProtocol<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//websocketæ¶ˆæ¯åé¦ˆå‘é€æˆåŠŸ</span>
            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">MsgUtil</span><span class="token punctuation">.</span><span class="token function">buildWsMsgText</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;å‘ä¸‹ä½æœºä¼ è¾¾æ¶ˆæ¯successï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>web/NettyController.java &amp; æ§åˆ¶å±‚æ–¹ä¾¿è·å–æœåŠ¡ç«¯ä¿¡æ¯</p></blockquote><ul><li>æ§åˆ¶å±‚æä¾›äº†æŸ¥è¯¢æœåŠ¡åˆ—è¡¨ã€é“¾æ¥è®¾å¤‡ä¿¡æ¯ã€ä»¥åŠä¸»åŠ¨è§¦å‘ä¿¡æ¯å‘é€</li><li>å¦å¤–å¦‚æœéœ€è¦å°†æœåŠ¡ç«¯çš„å¯åŠ¨å…³é—­è¿›è¡Œæ‰‹åŠ¨æ§åˆ¶ï¼Œå¯ä»¥åœ¨è¿™é‡Œé¢æä¾›æ–¹æ³•ä¾›è°ƒç”¨</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyController</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">NettyController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/index&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;index&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/queryNettyServerList&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryNettyServerList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerInfo</span><span class="token punctuation">&gt;</span></span> serverInfos <span class="token operator">=</span> <span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>serverInfoMap<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æŸ¥è¯¢æœåŠ¡ç«¯åˆ—è¡¨ã€‚{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>serverInfos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> serverInfos<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æŸ¥è¯¢æœåŠ¡ç«¯åˆ—è¡¨å¤±è´¥ã€‚&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/queryDeviceList&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Device</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryDeviceList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Device</span><span class="token punctuation">&gt;</span></span> deviceInfos <span class="token operator">=</span> <span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>deviceGroup<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æŸ¥è¯¢è®¾å¤‡é“¾æ¥åˆ—è¡¨ã€‚{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>deviceInfos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> deviceInfos<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æŸ¥è¯¢è®¾å¤‡é“¾æ¥åˆ—è¡¨å¤±è´¥ã€‚&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/doSendMsg&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">EasyResult</span> <span class="token function">doSendMsg</span><span class="token punctuation">(</span><span class="token class-name">String</span> reqStr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å‘è®¾å¤‡å‘é€ä¿¡æ¯[å¯ä»¥é€šè¿‡å¦å¤–ä¸€ä¸ªWebæœåŠ¡è°ƒç”¨æœ¬æ¥å£å‘é€ä¿¡æ¯]ï¼š{}&quot;</span><span class="token punctuation">,</span> reqStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">InfoProtocol</span> infoProtocol <span class="token operator">=</span> <span class="token class-name">MsgUtil</span><span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span>reqStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> channelId <span class="token operator">=</span> infoProtocol<span class="token punctuation">.</span><span class="token function">getChannelId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>cacheClientChannel<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>channelId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">MsgUtil</span><span class="token punctuation">.</span><span class="token function">buildMsg</span><span class="token punctuation">(</span>infoProtocol<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">EasyResult</span><span class="token punctuation">.</span><span class="token function">buildSuccessResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;å‘è®¾å¤‡å‘é€ä¿¡æ¯å¤±è´¥ï¼š{}&quot;</span><span class="token punctuation">,</span> reqStr<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">EasyResult</span><span class="token punctuation">.</span><span class="token function">buildErrResult</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Application.java &amp; å¯åŠ¨å±‚</p></blockquote><ul><li>é€šè¿‡ç»§æ‰¿CommandLineRunneræ–¹æ³•ï¼Œåœ¨æœåŠ¡å°±ç»ªåå¯åŠ¨socketæœåŠ¡</li><li>å¯åŠ¨åéœ€è¦å¾ªç¯éªŒè¯æ˜¯å¦å¯åŠ¨å®Œæˆ</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;org.itstack.demo.ark&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token keyword">implements</span> <span class="token class-name">CommandLineRunner</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${netty.socket.port}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> nettyServerPort<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${netty.websocket.port}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> nettyWsServerPort<span class="token punctuation">;</span>
    <span class="token comment">//é»˜è®¤çº¿ç¨‹æ± </span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//å¯åŠ¨NettyServer-socket</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å¯åŠ¨NettyServeræœåŠ¡ï¼Œå¯åŠ¨ç«¯å£ï¼š{}&quot;</span><span class="token punctuation">,</span> nettyServerPort<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">NettyServer</span> nettyServer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NettyServer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span>nettyServerPort<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>nettyServer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;netty server-s open error channel is null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>channel<span class="token punctuation">.</span><span class="token function">isActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å¯åŠ¨NettyServeræœåŠ¡ï¼Œå¾ªç¯ç­‰å¾…å¯åŠ¨...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å¯åŠ¨NettyServeræœåŠ¡ï¼Œå®Œæˆï¼š{}&quot;</span><span class="token punctuation">,</span> channel<span class="token punctuation">.</span><span class="token function">localAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>serverInfoMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>nettyServerPort<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ServerInfo</span><span class="token punctuation">(</span><span class="token string">&quot;NettySocket&quot;</span><span class="token punctuation">,</span> <span class="token class-name">NetUtil</span><span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nettyServerPort<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//å¯åŠ¨NettyServer-websocket</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å¯åŠ¨NettyWsServeræœåŠ¡ï¼Œå¯åŠ¨ç«¯å£ï¼š{}&quot;</span><span class="token punctuation">,</span> nettyWsServerPort<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WsNettyServer</span> wsNettyServer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WsNettyServer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span>nettyWsServerPort<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">&gt;</span></span> wsFuture <span class="token operator">=</span> executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>wsNettyServer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Channel</span> wsChannel <span class="token operator">=</span> wsFuture<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> wsChannel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;netty server-ws open error channel is null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>wsChannel<span class="token punctuation">.</span><span class="token function">isActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å¯åŠ¨NettyWsServeræœåŠ¡ï¼Œå¾ªç¯ç­‰å¾…å¯åŠ¨...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å¯åŠ¨NettyWsServeræœåŠ¡ï¼Œå®Œæˆï¼š{}&quot;</span><span class="token punctuation">,</span> wsChannel<span class="token punctuation">.</span><span class="token function">localAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CacheUtil</span><span class="token punctuation">.</span>serverInfoMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>nettyServerPort<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ServerInfo</span><span class="token punctuation">(</span><span class="token string">&quot;NettyWsSocket&quot;</span><span class="token punctuation">,</span> <span class="token class-name">NetUtil</span><span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nettyServerPort<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>webapp/arkWs/js/ws.js &amp; é“¾æ¥websocketæœåŠ¡ç«¯</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;ws://localhost:7398/websocket&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	socket<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> <span class="token function">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">{</span>

		<span class="token keyword">var</span> msg <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		$<span class="token punctuation">(</span><span class="token string">&quot;#msgBox&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span>$<span class="token punctuation">(</span><span class="token string">&quot;#msgBox&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>data <span class="token operator">+</span> <span class="token string">&quot;\\r\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ¡ˆä¾‹æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#æ¡ˆä¾‹æµ‹è¯•" aria-hidden="true">#</a> æ¡ˆä¾‹æµ‹è¯•</h2><ol><li>åˆ†åˆ«å¯åŠ¨å¦‚ä¸‹å†…å®¹ï¼› <ol><li>Application.javaï¼ŒPlugins/spring-boot/spring-boot:run</li><li>ApiTest.javaï¼Œå³é”®å¯åŠ¨æ¨¡æ‹Ÿä¸‹ä½æœº</li></ol></li><li>æ‰“å¼€æœåŠ¡ç«¯é“¾æ¥ï¼›http://localhost:8080/ http://localhost:8080/arkWs/arkWsControlCenter.html <img src="https://bugstack.cn/assets/images/pic-content/2019/09/netty-3-02.png" alt="å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ &amp; æœåŠ¡ç«¯ä¸ç›‘æ§"></li><li>å‘é€æ¨¡æ‹Ÿä¿¡æ¯ï¼Œè§‚å¯Ÿæ‰§è¡Œç»“æœï¼›<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">49.965</span>  <span class="token constant">INFO</span> <span class="token number">7620</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>nio<span class="token operator">-</span><span class="token number">8080</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>a<span class="token punctuation">.</span>c<span class="token punctuation">.</span>c<span class="token punctuation">.</span></span>C</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token class-name">Tomcat</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>localhost<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token operator">/</span><span class="token punctuation">]</span>       <span class="token operator">:</span> <span class="token class-name">Initializing</span> <span class="token class-name">Spring</span> <span class="token class-name">FrameworkServlet</span> &#39;dispatcherServlet&#39;
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">49.965</span>  <span class="token constant">INFO</span> <span class="token number">7620</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>nio<span class="token operator">-</span><span class="token number">8080</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>DispatcherServlet</span>        <span class="token operator">:</span> <span class="token class-name">FrameworkServlet</span> &#39;dispatcherServlet&#39;<span class="token operator">:</span> initialization started
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">49.980</span>  <span class="token constant">INFO</span> <span class="token number">7620</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>nio<span class="token operator">-</span><span class="token number">8080</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>DispatcherServlet</span>        <span class="token operator">:</span> <span class="token class-name">FrameworkServlet</span> &#39;dispatcherServlet&#39;<span class="token operator">:</span> initialization completed in <span class="token number">15</span> ms
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">51.157</span>  <span class="token constant">INFO</span> <span class="token number">7620</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>nio<span class="token operator">-</span><span class="token number">8080</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>ark<span class="token punctuation">.</span>web<span class="token punctuation">.</span></span>NettyController</span>   <span class="token operator">:</span> æŸ¥è¯¢è®¾å¤‡é“¾æ¥åˆ—è¡¨ã€‚<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;channelId&quot;</span><span class="token operator">:</span><span class="token string">&quot;281d1279&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;connectTime&quot;</span><span class="token operator">:</span><span class="token number">1575184302964</span><span class="token punctuation">,</span><span class="token string">&quot;ip&quot;</span><span class="token operator">:</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;number&quot;</span><span class="token operator">:</span><span class="token string">&quot;74de0967-c0b4-4426-a9d1-183feaff2acf&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;port&quot;</span><span class="token operator">:</span><span class="token number">3972</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">51.162</span>  <span class="token constant">INFO</span> <span class="token number">7620</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>io<span class="token operator">-</span><span class="token number">8080</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>ark<span class="token punctuation">.</span>web<span class="token punctuation">.</span></span>NettyController</span>   <span class="token operator">:</span> æŸ¥è¯¢æœåŠ¡ç«¯åˆ—è¡¨ã€‚<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;ip&quot;</span><span class="token operator">:</span><span class="token string">&quot;10.13.70.50&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;openDate&quot;</span><span class="token operator">:</span><span class="token number">1575184290501</span><span class="token punctuation">,</span><span class="token string">&quot;port&quot;</span><span class="token operator">:</span><span class="token number">7397</span><span class="token punctuation">,</span><span class="token string">&quot;typeInfo&quot;</span><span class="token operator">:</span><span class="token string">&quot;NettyWsSocket&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">58.476</span>  <span class="token constant">INFO</span> <span class="token number">7620</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ntLoopGroup<span class="token operator">-</span><span class="token number">7</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>i<span class="token punctuation">.</span>d<span class="token punctuation">.</span>a<span class="token punctuation">.</span>s<span class="token punctuation">.</span>websocket<span class="token punctuation">.</span></span>MyWsServerHandler</span>    <span class="token operator">:</span> é“¾æ¥æŠ¥å‘Šå¼€å§‹
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">58.476</span>  <span class="token constant">INFO</span> <span class="token number">7620</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ntLoopGroup<span class="token operator">-</span><span class="token number">7</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>i<span class="token punctuation">.</span>d<span class="token punctuation">.</span>a<span class="token punctuation">.</span>s<span class="token punctuation">.</span>websocket<span class="token punctuation">.</span></span>MyWsServerHandler</span>    <span class="token operator">:</span> é“¾æ¥æŠ¥å‘Šä¿¡æ¯ï¼šæœ‰ä¸€å®¢æˆ·ç«¯é“¾æ¥åˆ°æœ¬æœåŠ¡ç«¯
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">58.476</span>  <span class="token constant">INFO</span> <span class="token number">7620</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ntLoopGroup<span class="token operator">-</span><span class="token number">7</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>i<span class="token punctuation">.</span>d<span class="token punctuation">.</span>a<span class="token punctuation">.</span>s<span class="token punctuation">.</span>websocket<span class="token punctuation">.</span></span>MyWsServerHandler</span>    <span class="token operator">:</span> é“¾æ¥æŠ¥å‘Š<span class="token constant">IP</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">1</span>
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">58.476</span>  <span class="token constant">INFO</span> <span class="token number">7620</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ntLoopGroup<span class="token operator">-</span><span class="token number">7</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>i<span class="token punctuation">.</span>d<span class="token punctuation">.</span>a<span class="token punctuation">.</span>s<span class="token punctuation">.</span>websocket<span class="token punctuation">.</span></span>MyWsServerHandler</span>    <span class="token operator">:</span> é“¾æ¥æŠ¥å‘Š<span class="token class-name">Port</span><span class="token operator">:</span><span class="token number">7398</span>
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">58.476</span>  <span class="token constant">INFO</span> <span class="token number">7620</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ntLoopGroup<span class="token operator">-</span><span class="token number">7</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>i<span class="token punctuation">.</span>d<span class="token punctuation">.</span>a<span class="token punctuation">.</span>s<span class="token punctuation">.</span>websocket<span class="token punctuation">.</span></span>MyWsServerHandler</span>    <span class="token operator">:</span> é“¾æ¥æŠ¥å‘Šå®Œæ¯•
 æœåŠ¡ç«¯æ”¶åˆ°ï¼š<span class="token punctuation">{</span><span class="token string">&quot;channelId&quot;</span><span class="token operator">:</span><span class="token string">&quot;281d1279&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;msgType&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;msgObj&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;stateType&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">05</span> æ¥æ”¶åˆ°æ¶ˆæ¯å†…å®¹ï¼š<span class="token punctuation">{</span><span class="token string">&quot;msgObj&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;stateMsg&quot;</span><span class="token operator">:</span><span class="token string">&quot;æ¸©åº¦ä¿¡æ¯ï¼š91.31334894176383Â°C&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;stateType&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;channelId&quot;</span><span class="token operator">:</span><span class="token string">&quot;93c1120a&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;msgType&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&quot;channelId&quot;</span><span class="token operator">:</span><span class="token string">&quot;93c1120a&quot;</span><span class="token punctuation">}</span>
 æœåŠ¡ç«¯æ”¶åˆ°ï¼š<span class="token punctuation">{</span><span class="token string">&quot;channelId&quot;</span><span class="token operator">:</span><span class="token string">&quot;281d1279&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;msgType&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;msgObj&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;stateType&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span><span class="token number">05</span> æ¥æ”¶åˆ°æ¶ˆæ¯å†…å®¹ï¼š<span class="token punctuation">{</span><span class="token string">&quot;msgObj&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;stateMsg&quot;</span><span class="token operator">:</span><span class="token string">&quot;æ¸©åº¦ä¿¡æ¯ï¼š44.83794772946285Â°C&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;stateType&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;channelId&quot;</span><span class="token operator">:</span><span class="token string">&quot;93c1120a&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;msgType&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&quot;channelId&quot;</span><span class="token operator">:</span><span class="token string">&quot;93c1120a&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h2 id="ç»¼ä¸Šæ€»ç»“" tabindex="-1"><a class="header-anchor" href="#ç»¼ä¸Šæ€»ç»“" aria-hidden="true">#</a> ç»¼ä¸Šæ€»ç»“</h2><ol><li>åœ¨ä½¿ç”¨springbootä¸nettyç»“åˆï¼Œå¼€å‘ä¸€ä¸ªç®€ä¾¿çš„æœåŠ¡ç«¯è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œè€Œä¸”åœ¨é›†åˆä¸€äº›springcloudçš„æœåŠ¡ï¼Œå¯ä»¥ä½¿é¡¹ç›®å·¥ç¨‹æ›´åŠ å®Œå–„ã€‚</li><li>å¯ä»¥å°è¯•åšä¸€äº›è®¾å¤‡æ§åˆ¶æœåŠ¡ï¼Œåœ¨æˆ‘ä»¬ä¸åœ¨å®¶çš„æ—¶å€™ä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ªh5é“¾æ¥æ§åˆ¶å®¶é‡Œçš„è®¾å¤‡ï¼Œæ¯”å¦‚å¿«åˆ°å®¶å°†çƒ­æ°´å™¨æ‰“å¼€ã€‚</li><li>æœ¬æ¡ˆä¾‹è¿˜åå‘äºæ¨¡æ‹Ÿï¼Œåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­è¿˜æ˜¯ä¼šå‡ºç°å¾ˆå¤šä¸šåŠ¡é—®é¢˜éœ€è¦è§£å†³ï¼Œå°¤å…¶æ˜¯æœåŠ¡ç«¯ä¸ä¸‹ä½æœºçš„é€šä¿¡ï¼Œéœ€è¦ç¼–å†™ç¼–ç å™¨ä¸è§£ç å™¨ã€‚</li></ol><p>å¾®ä¿¡æœç´¢ã€Œ<strong>bugstackè™«æ´æ ˆ</strong>ã€å…¬ä¼—å·ï¼Œå…³æ³¨åå›å¤ã€Œ<strong>nettyæ¡ˆä¾‹</strong>ã€è·å–æœ¬æ–‡æºç &amp;æ›´å¤šåŸåˆ›ä¸“é¢˜æ¡ˆä¾‹ï¼</p>`,29);function v(m,b){const a=p("ExternalLinkIcon");return e(),o("div",null,[i,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),k,s("åšå®¢ï¼š"),n("a",r,[s("https://bugstack.cn"),c(a)])]),d])}const y=t(u,[["render",v],["__file","2019-12-01-websocketyuxiaweijitongguonettyfangshitongxinchuanshuxingweixinxi.html.vue"]]);export{y as default};
