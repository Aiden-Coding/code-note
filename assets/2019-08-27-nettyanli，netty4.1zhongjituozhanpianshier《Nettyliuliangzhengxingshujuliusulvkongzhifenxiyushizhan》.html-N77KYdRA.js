import{_ as t,r as e,o as p,c as o,a as n,b as s,d as c,e as l}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"nettyæ¡ˆä¾‹-netty4-1ä¸­çº§æ‹“å±•ç¯‡åäºŒã€Šnettyæµé‡æ•´å½¢æ•°æ®æµé€Ÿç‡æ§åˆ¶åˆ†æä¸å®æˆ˜ã€‹",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#nettyæ¡ˆä¾‹-netty4-1ä¸­çº§æ‹“å±•ç¯‡åäºŒã€Šnettyæµé‡æ•´å½¢æ•°æ®æµé€Ÿç‡æ§åˆ¶åˆ†æä¸å®æˆ˜ã€‹","aria-hidden":"true"},"#"),s(" nettyæ¡ˆä¾‹ï¼Œnetty4.1ä¸­çº§æ‹“å±•ç¯‡åäºŒã€ŠNettyæµé‡æ•´å½¢æ•°æ®æµé€Ÿç‡æ§åˆ¶åˆ†æä¸å®æˆ˜ã€‹")],-1),k=n("br",null,null,-1),r={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=l(`<blockquote><p>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„</p></blockquote><h2 id="å‰è¨€ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#å‰è¨€ä»‹ç»" aria-hidden="true">#</a> å‰è¨€ä»‹ç»</h2><p>ä½ æ˜¯å¦ä½¿ç”¨è¿‡æŸç›˜ï¼Œåœ¨å‰å‡ å¹´æˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™é€Ÿåº¦é£å¿«ï¼Œä¸Šä¼ ä¸‹è½½å—–å—–å—–ã€‚ä½†æ˜¯è¿‘å¹´æ¥åªè¦ä¸åŠä¼šå‘˜ï¼Œé€Ÿåº¦æ…¢çš„åƒèœ—ç‰›ï¼Œå½“ç„¶äººå®¶ä¹Ÿå¾—èµšé’±æˆ‘ä»¬èƒ½ç†è§£ã€‚é‚£ä¹ˆè¿™æ ·çš„é™é€Ÿæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Œæˆ‘ä»¬è¿™ä¸ªæ¡ˆä¾‹ä½¿ç”¨Nettyçš„æµé‡æ•´å½¢è¿›è¡Œé™é€Ÿä¼ è¾“ï¼Œæµ‹è¯•è¿‡ç¨‹ä¸­å½“ä½ æŠŠæµé‡æ•´å½¢åŠŸèƒ½å»æ‰åä½ å°±æ˜¯å¹´è´¹VIPã€‚</p><p>æµé‡æ•´å½¢ï¼ˆTraffic Shapingï¼‰æ˜¯ä¸€ç§ä¸»åŠ¨è°ƒæ•´æµé‡è¾“å‡ºé€Ÿç‡çš„æªæ–½ã€‚ä¸€ä¸ªå…¸å‹åº”ç”¨æ˜¯åŸºäºä¸‹æ¸¸ç½‘ç»œç»“ç‚¹çš„TPæŒ‡æ ‡æ¥æ§åˆ¶æœ¬åœ°æµé‡çš„è¾“å‡ºã€‚æµé‡æ•´å½¢ä¸æµé‡ç›‘ç®¡çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œæµé‡æ•´å½¢å¯¹æµé‡ç›‘ç®¡ä¸­éœ€è¦ä¸¢å¼ƒçš„æŠ¥æ–‡è¿›è¡Œç¼“å­˜â€”â€”é€šå¸¸æ˜¯å°†å®ƒä»¬æ”¾å…¥ç¼“å†²åŒºæˆ–é˜Ÿåˆ—å†…ï¼Œä¹Ÿç§°æµé‡æ•´å½¢ï¼ˆTraffic Shapingï¼Œç®€ç§°TSï¼‰ã€‚å½“ä»¤ç‰Œæ¡¶æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œæ—¶ï¼Œå†å‡åŒ€çš„å‘å¤–å‘é€è¿™äº›è¢«ç¼“å­˜çš„æŠ¥æ–‡ã€‚æµé‡æ•´å½¢ä¸æµé‡ç›‘ç®¡çš„å¦ä¸€åŒºåˆ«æ˜¯ï¼Œæ•´å½¢å¯èƒ½ä¼šå¢åŠ å»¶è¿Ÿï¼Œè€Œç›‘ç®¡å‡ ä¹ä¸å¼•å…¥é¢å¤–çš„å»¶è¿Ÿã€‚ <img src="https://bugstack.cn/assets/images/pic-content/2019/09/netty-2-12-1.png" alt="å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ"></p><p>Nettyä¸­é€šè¿‡å®ç°æŠ½è±¡ç±»AbstractTrafficShapingHandlerï¼Œæä¾›äº†ä¸‰ä¸ªæµé‡æ•´å½¢çš„ç±»ï¼›GlobalTrafficShapingHandlerã€ChannelTrafficShapingHandlerã€GlobalChannelTrafficShapingHandlerï¼›</p><blockquote><p>AbstractTrafficShapingHandler.java | åŠŸèƒ½ä»‹ç»</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>AbstractTrafficShapingHandler allows to limit the global bandwidth
 * (see <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">GlobalTrafficShapingHandler</span></span><span class="token punctuation">}</span>) or per session
 * bandwidth (see <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">ChannelTrafficShapingHandler</span></span><span class="token punctuation">}</span>), as traffic shaping.
 * It allows you to implement an almost real time monitoring of the bandwidth using
 * the monitors from <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">TrafficCounter</span></span><span class="token punctuation">}</span> that will call back every checkInterval
 * the method doAccounting of this handler.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>If you want for any particular reasons to stop the monitoring (accounting) or to change
 * the read/write limit or the check interval, several methods allow that for you:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tt</span><span class="token punctuation">&gt;</span></span><span class="token code-section"><span class="token line"><span class="token code language-java">configure</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tt</span><span class="token punctuation">&gt;</span></span> allows you to change read or write limits, or the checkInterval<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tt</span><span class="token punctuation">&gt;</span></span><span class="token code-section"><span class="token line"><span class="token code language-java">getTrafficCounter</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tt</span><span class="token punctuation">&gt;</span></span> allows you to have access to the TrafficCounter and so to stop
 * or start the monitoring, to change the checkInterval directly, or to have access to its values.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractTrafficShapingHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelDuplexHandler</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>AbstractTrafficShapingHandlerå…è®¸é™åˆ¶å…¨å±€çš„å¸¦å®½(è§GlobalTrafficShapingHandler)æˆ–è€…æ¯ä¸ªsessionçš„å¸¦å®½(è§ChannelTrafficShapingHandler)ä½œä¸ºæµé‡æ•´å½¢ã€‚ å®ƒå…è®¸ä½ ä½¿ç”¨TrafficCounteræ¥å®ç°å‡ ä¹å®æ—¶çš„å¸¦å®½ç›‘æ§ï¼ŒTrafficCounterä¼šåœ¨æ¯ä¸ªæ£€æµ‹é—´æœŸï¼ˆcheckIntervalï¼‰è°ƒç”¨è¿™ä¸ªå¤„ç†å™¨çš„doAccountingæ–¹æ³•ã€‚</p><p>å¦‚æœä½ æœ‰ä»»ä½•ç‰¹åˆ«çš„åŸå› æƒ³è¦åœæ­¢ç›‘æ§ï¼ˆè®¡æ•°ï¼‰æˆ–è€…æ”¹å˜è¯»å†™çš„é™åˆ¶æˆ–è€…æ”¹å˜æ£€æµ‹é—´æœŸï¼ˆcheckIntervalï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š</p><ol><li>configureï¼šå…è®¸ä½ æ”¹å˜è¯»æˆ–å†™çš„é™åˆ¶ï¼Œæˆ–è€…æ£€æµ‹é—´æœŸï¼ˆcheckIntervalï¼‰ï¼›</li><li>getTrafficCounterï¼šå…è®¸ä½ è·å¾—TrafficCounterï¼Œå¹¶å¯ä»¥åœæ­¢æˆ–å¯åŠ¨ç›‘æ§ï¼Œç›´æ¥æ”¹å˜æ£€æµ‹é—´æœŸï¼ˆcheckIntervalï¼‰ï¼Œæˆ–å»è®¿é—®å®ƒçš„å€¼ã€‚</li></ol><p><strong>TrafficCounter</strong>ï¼šå¯¹è¯»å’Œå†™çš„å­—èŠ‚è¿›è¡Œè®¡æ•°ä»¥ç”¨äºé™åˆ¶æµé‡ã€‚ å®ƒä¼šæ ¹æ®ç»™å®šçš„æ£€æµ‹é—´æœŸå‘¨æœŸæ€§çš„è®¡ç®—ç»Ÿè®¡å…¥ç«™å’Œå‡ºç«™çš„æµé‡ï¼Œå¹¶ä¼šå›è°ƒAbstractTrafficShapingHandlerçš„doAccountingæ–¹æ³•ã€‚ å¦‚æœæ£€æµ‹é—´æœŸï¼ˆcheckIntervalï¼‰æ˜¯0ï¼Œå°†ä¸ä¼šè¿›è¡Œè®¡æ•°å¹¶ä¸”ç»Ÿè®¡åªä¼šåœ¨æ¯æ¬¡è¯»æˆ–å†™æ“ä½œæ—¶è¿›è¡Œè®¡ç®—ã€‚</p><blockquote><p>GlobalTrafficShapingHandler.java | å…¨å±€é™åˆ¶</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This implementation of the <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">AbstractTrafficShapingHandler</span></span><span class="token punctuation">}</span> is for global
 * traffic shaping, that is to say a global limitation of the bandwidth, whatever
 * the number of opened channels.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Note the index used in <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">OutboundBuffer</span><span class="token punctuation">.</span><span class="token function">setUserDefinedWritability</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token keyword">boolean</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span> is <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>The general use should be as follow:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Create your unique GlobalTrafficShapingHandler like:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tt</span><span class="token punctuation">&gt;</span></span><span class="token code-section"><span class="token line"><span class="token code language-java"><span class="token class-name">GlobalTrafficShapingHandler</span> myHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GlobalTrafficShapingHandler</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tt</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>The executor could be the underlying IO worker pool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tt</span><span class="token punctuation">&gt;</span></span><span class="token code-section"><span class="token line"><span class="token code language-java">pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>myHandler<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tt</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>Note that this handler has a Pipeline Coverage of &quot;all&quot; which means only one such handler must be created
 * and shared among all channels as the counter must be shared among all channels.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Other arguments can be passed like write or read limitation (in bytes/s where 0 means no limitation)
 * or the check interval (in millisecond) that represents the delay between two computations of the
 * bandwidth and so the call back of the doAccounting method (0 means no accounting at all).<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>A value of 0 means no accounting for checkInterval. If you need traffic shaping but no such accounting,
 * it is recommended to set a positive value, even if it is high since the precision of the
 * Traffic Shaping depends on the period where the traffic is computed. The highest the interval,
 * the less precise the traffic shaping will be. It is suggested as higher value something close
 * to 5 or 10 minutes.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>maxTimeToWait, by default set to 15s, allows to specify an upper bound of time shaping.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>In your handler, you should consider to use the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">channel<span class="token punctuation">.</span><span class="token function">isWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span> and
 * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token function">channelWritabilityChanged</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span></span></span><span class="token punctuation">}</span> to handle writability, or through
 * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">future<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericFutureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span> on the future returned by
 * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">ctx<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>You shall also consider to have object size in read or write operations relatively adapted to
 * the bandwidth you required: for instance having 10 MB objects for 10KB/s will lead to burst effect,
 * while having 100 KB objects for 1 MB/s should be smoothly handle by this TrafficShaping handler.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Some configuration methods will be taken as best effort, meaning
 * that all already scheduled traffics will not be
 * changed, but only applied to new traffics.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * So the expected usage of those methods are to be used not too often,
 * accordingly to the traffic shaping configuration.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 *
 * Be sure to call <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> once this handler is not needed anymore to release all internal resources.
 * This will not shutdown the <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">EventExecutor</span></span><span class="token punctuation">}</span> as it may be shared, so you need to do this by your own.
 */</span>
<span class="token annotation punctuation">@Sharable</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalTrafficShapingHandler</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractTrafficShapingHandler</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™å®ç°äº†AbstractTrafficShapingHandlerçš„å…¨å±€æµé‡æ•´å½¢ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒé™åˆ¶äº†å…¨å±€çš„å¸¦å®½ï¼Œæ— è®ºå¼€å¯äº†å‡ ä¸ªchannelã€‚ æ³¨æ„<code>ã€ OutboundBuffer.setUserDefinedWritability(index, boolean)ã€</code>ä¸­ç´¢å¼•ä½¿ç”¨â€™2â€™ã€‚</p><p>ä¸€èˆ¬ç”¨é€”å¦‚ä¸‹ï¼š åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„GlobalTrafficShapingHandler</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">GlobalTrafficShapingHandler</span> myHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GlobalTrafficShapingHandler</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>myHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>executorå¯ä»¥æ˜¯åº•å±‚çš„IOå·¥ä½œæ± </p><p>æ³¨æ„ï¼Œè¿™ä¸ªå¤„ç†å™¨æ˜¯è¦†ç›–æ‰€æœ‰ç®¡é“çš„ï¼Œè¿™æ„å‘³ç€åªæœ‰ä¸€ä¸ªå¤„ç†å™¨å¯¹è±¡ä¼šè¢«åˆ›å»ºå¹¶ä¸”ä½œä¸ºæ‰€æœ‰channelé—´å…±äº«çš„è®¡æ•°å™¨ï¼Œå®ƒå¿…é¡»äºæ‰€æœ‰çš„channelå…±äº«ã€‚ æ‰€æœ‰ä½ å¯ä»¥è§åˆ°ï¼Œè¯¥ç±»çš„å®šä¹‰ä¸Šé¢æœ‰ä¸ª@Sharableæ³¨è§£ã€‚</p><p>åœ¨ä½ çš„å¤„ç†å™¨ä¸­ï¼Œä½ éœ€è¦è€ƒè™‘ä½¿ç”¨ã€channel.isWritable()ã€å’Œã€channelWritabilityChanged(ctx)ã€æ¥å¤„ç†å¯å†™æ€§ï¼Œæˆ–é€šè¿‡åœ¨ctx.write()è¿”å›çš„futureä¸Šæ³¨å†Œlisteneræ¥å®ç°ã€‚</p><p>ä½ è¿˜éœ€è¦è€ƒè™‘è¯»æˆ–å†™æ“ä½œå¯¹è±¡çš„å¤§å°éœ€è¦å’Œä½ è¦æ±‚çš„å¸¦å®½ç›¸å¯¹åº”ï¼šæ¯”å¦‚ï¼Œä½ å°†ä¸€ä¸ª10Må¤§å°çš„å¯¹è±¡ç”¨äº10KB/sçš„å¸¦å®½å°†ä¼šå¯¼è‡´çˆ†å‘æ•ˆæœï¼Œè‹¥ä½ å°†100KBå¤§å°çš„å¯¹è±¡ç”¨äºåœ¨1M/så¸¦å®½é‚£ä¹ˆå°†ä¼šè¢«æµé‡æ•´å½¢å¤„ç†å™¨å¹³æ»‘å¤„ç†ã€‚</p><p>ä¸€æ—¦ä¸åœ¨éœ€è¦è¿™ä¸ªå¤„ç†å™¨æ—¶è¯·ç¡®ä¿è°ƒç”¨ã€release()ã€ä»¥é‡Šæ”¾æ‰€æœ‰å†…éƒ¨çš„èµ„æºã€‚è¿™ä¸ä¼šå…³é—­EventExecutorï¼Œå› ä¸ºå®ƒå¯èƒ½æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥è¿™éœ€è¦ä½ è‡ªå·±åšã€‚</p><p>GlobalTrafficShapingHandlerä¸­æŒæœ‰ä¸€ä¸ªChannelçš„å“ˆå¸Œè¡¨ï¼Œç”¨äºå­˜å‚¨å½“å‰åº”ç”¨æ‰€æœ‰çš„Channelï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">PerChannel</span><span class="token punctuation">&gt;</span></span> channelQueues <span class="token operator">=</span> <span class="token class-name">PlatformDependent</span><span class="token punctuation">.</span><span class="token function">newConcurrentHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>keyä¸ºChannelçš„hashCodeï¼›valueæ˜¯ä¸€ä¸ªPerChannelå¯¹è±¡ã€‚ PerChannelå¯¹è±¡ä¸­ç»´æŠ¤æœ‰è¯¥Channelçš„å¾…å‘é€æ•°æ®çš„æ¶ˆæ¯é˜Ÿåˆ—<code>ArrayDeque&lt;ToSend&gt; messagesQueue</code>ã€‚</p><blockquote><p>ChannelTrafficShapingHandler.java | åŠŸèƒ½ä»‹ç»</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This implementation of the <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">AbstractTrafficShapingHandler</span></span><span class="token punctuation">}</span> is for channel
 * traffic shaping, that is to say a per channel limitation of the bandwidth.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Note the index used in <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">OutboundBuffer</span><span class="token punctuation">.</span><span class="token function">setUserDefinedWritability</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token keyword">boolean</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span> is <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>The general use should be as follow:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Add in your pipeline a new ChannelTrafficShapingHandler.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tt</span><span class="token punctuation">&gt;</span></span><span class="token code-section"><span class="token line"><span class="token code language-java"><span class="token class-name">ChannelTrafficShapingHandler</span> myHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChannelTrafficShapingHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tt</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tt</span><span class="token punctuation">&gt;</span></span><span class="token code-section"><span class="token line"><span class="token code language-java">pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>myHandler<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tt</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>Note that this handler has a Pipeline Coverage of &quot;one&quot; which means a new handler must be created
 * for each new channel as the counter cannot be shared among all channels.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Other arguments can be passed like write or read limitation (in bytes/s where 0 means no limitation)
 * or the check interval (in millisecond) that represents the delay between two computations of the
 * bandwidth and so the call back of the doAccounting method (0 means no accounting at all).<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>A value of 0 means no accounting for checkInterval. If you need traffic shaping but no such accounting,
 * it is recommended to set a positive value, even if it is high since the precision of the
 * Traffic Shaping depends on the period where the traffic is computed. The highest the interval,
 * the less precise the traffic shaping will be. It is suggested as higher value something close
 * to 5 or 10 minutes.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>maxTimeToWait, by default set to 15s, allows to specify an upper bound of time shaping.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>In your handler, you should consider to use the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">channel<span class="token punctuation">.</span><span class="token function">isWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span> and
 * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token function">channelWritabilityChanged</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span></span></span><span class="token punctuation">}</span> to handle writability, or through
 * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">future<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericFutureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span> on the future returned by
 * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">ctx<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>You shall also consider to have object size in read or write operations relatively adapted to
 * the bandwidth you required: for instance having 10 MB objects for 10KB/s will lead to burst effect,
 * while having 100 KB objects for 1 MB/s should be smoothly handle by this TrafficShaping handler.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Some configuration methods will be taken as best effort, meaning
 * that all already scheduled traffics will not be
 * changed, but only applied to new traffics.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>So the expected usage of those methods are to be used not too often,
 * accordingly to the traffic shaping configuration.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelTrafficShapingHandler</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractTrafficShapingHandler</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ChannelTrafficShapingHandleræ˜¯é’ˆå¯¹å•ä¸ªChannelçš„æµé‡æ•´å½¢ï¼Œå’ŒGlobalTrafficShapingHandlerçš„æ€æƒ³æ˜¯ä¸€æ ·çš„ã€‚åªæ˜¯å®ç°ä¸­æ²¡æœ‰å¯¹å…¨å±€æ¦‚å¿µçš„æ£€æµ‹ï¼Œä»…æ£€æµ‹äº†å½“å‰è¿™ä¸ªChannelçš„æ•°æ®ã€‚ è¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚</p><blockquote><p>GlobalChannelTrafficShapingHandler.java | åŠŸèƒ½ä»‹ç»</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * This implementation of the <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">AbstractTrafficShapingHandler</span></span><span class="token punctuation">}</span> is for global
 * and per channel traffic shaping, that is to say a global limitation of the bandwidth, whatever
 * the number of opened channels and a per channel limitation of the bandwidth.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 * This version shall not be in the same pipeline than other TrafficShapingHandler.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 *
 * The general use should be as follow:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Create your unique GlobalChannelTrafficShapingHandler like:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tt</span><span class="token punctuation">&gt;</span></span><span class="token code-section"><span class="token line"><span class="token code language-java"><span class="token class-name">GlobalChannelTrafficShapingHandler</span> myHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GlobalChannelTrafficShapingHandler</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tt</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 * The executor could be the underlying IO worker pool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tt</span><span class="token punctuation">&gt;</span></span><span class="token code-section"><span class="token line"><span class="token code language-java">pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>myHandler<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tt</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>Note that this handler has a Pipeline Coverage of &quot;all&quot; which means only one such handler must be created
 * and shared among all channels as the counter must be shared among all channels.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 *
 * Other arguments can be passed like write or read limitation (in bytes/s where 0 means no limitation)
 * or the check interval (in millisecond) that represents the delay between two computations of the
 * bandwidth and so the call back of the doAccounting method (0 means no accounting at all).<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 * Note that as this is a fusion of both Global and Channel Traffic Shaping, limits are in 2 sets,
 * respectively Global and Channel.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 *
 * A value of 0 means no accounting for checkInterval. If you need traffic shaping but no such accounting,
 * it is recommended to set a positive value, even if it is high since the precision of the
 * Traffic Shaping depends on the period where the traffic is computed. The highest the interval,
 * the less precise the traffic shaping will be. It is suggested as higher value something close
 * to 5 or 10 minutes.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 *
 * maxTimeToWait, by default set to 15s, allows to specify an upper bound of time shaping.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>In your handler, you should consider to use the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">channel<span class="token punctuation">.</span><span class="token function">isWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span> and
 * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token function">channelWritabilityChanged</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span></span></span><span class="token punctuation">}</span> to handle writability, or through
 * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">future<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericFutureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span> on the future returned by
 * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">ctx<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>You shall also consider to have object size in read or write operations relatively adapted to
 * the bandwidth you required: for instance having 10 MB objects for 10KB/s will lead to burst effect,
 * while having 100 KB objects for 1 MB/s should be smoothly handle by this TrafficShaping handler.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Some configuration methods will be taken as best effort, meaning
 * that all already scheduled traffics will not be
 * changed, but only applied to new traffics.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 * So the expected usage of those methods are to be used not too often,
 * accordingly to the traffic shaping configuration.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 *
 * Be sure to call <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> once this handler is not needed anymore to release all internal resources.
 * This will not shutdown the <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">EventExecutor</span></span><span class="token punctuation">}</span> as it may be shared, so you need to do this by your own.
 */</span>
<span class="token annotation punctuation">@Sharable</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalChannelTrafficShapingHandler</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractTrafficShapingHandler</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç›¸æ¯”äºGlobalTrafficShapingHandlerå¢åŠ äº†ä¸€ä¸ªè¯¯å·®æ¦‚å¿µï¼Œä»¥å¹³è¡¡å„ä¸ªChannelé—´çš„è¯»/å†™æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿å¾—å„ä¸ªChannelé—´çš„è¯»/å†™æ“ä½œå°½é‡å‡è¡¡ã€‚æ¯”å¦‚ï¼Œå°½é‡é¿å…ä¸åŒChannelçš„å¤§æ•°æ®åŒ…éƒ½å»¶è¿Ÿè¿‘ä¹ä¸€æ ·çš„æ˜¯æ—¶é—´å†æ“ä½œï¼Œä»¥åŠå¦‚æœå°æ•°æ®åŒ…åœ¨ä¸€ä¸ªå¤§æ•°æ®åŒ…åæ‰å‘é€ï¼Œåˆ™å‡å°‘è¯¥å°æ•°æ®åŒ…çš„å»¶è¿Ÿå‘é€æ—¶é—´ç­‰ã€‚ã€‚</p><h2 id="å¼€å‘ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#å¼€å‘ç¯å¢ƒ" aria-hidden="true">#</a> å¼€å‘ç¯å¢ƒ</h2><ol><li>jdk1.8ã€jdk1.7ä»¥ä¸‹åªèƒ½éƒ¨åˆ†æ”¯æŒnettyã€‘</li><li>Netty4.1.36.Finalã€netty3.x 4.x 5æ¯æ¬¡çš„å˜åŒ–è¾ƒå¤§ï¼Œæ¥å£ç±»åä¹Ÿéšç€å˜åŒ–ã€‘</li></ol><h2 id="ä»£ç ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä»£ç ç¤ºä¾‹" aria-hidden="true">#</a> ä»£ç ç¤ºä¾‹</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>netty<span class="token operator">-</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">12</span>
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>netty
    â”‚           â”œâ”€â”€ client
    â”‚           â”‚	â”œâ”€â”€ <span class="token class-name">MyChannelInitializer</span><span class="token punctuation">.</span>java
    â”‚           â”‚	â”œâ”€â”€ <span class="token class-name">MyClientHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚	â””â”€â”€ <span class="token class-name">NettyClient</span><span class="token punctuation">.</span>java
    â”‚           â””â”€â”€ server
    â”‚           	â”œâ”€â”€ common
    â”‚           	â”‚	â””â”€â”€ <span class="token class-name">MyServerCommonHandler</span><span class="token punctuation">.</span>java	
    â”‚           	â”œâ”€â”€ <span class="token class-name">MyChannelInitializer</span><span class="token punctuation">.</span>java
    â”‚           	â”œâ”€â”€ <span class="token class-name">MyServerHandler</span><span class="token punctuation">.</span>java	
    â”‚           	â””â”€â”€ <span class="token class-name">NettyServer</span><span class="token punctuation">.</span>java
    â”‚
    â””â”€â”€ test
         â””â”€â”€ java
             â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test
                 â””â”€â”€ <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>éƒ¨åˆ†é‡ç‚¹ä»£ç å—è®²è§£ï¼Œè·å–å…¨éƒ¨ä»£ç ï¼Œå…³æ³¨å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ | å›å¤nettyæºç </strong></p><blockquote><p>client/MyChannelInitializer.java | å¢åŠ Channelæµé‡æ•´å½¢é…ç½®ï¼Œé€Ÿç‡è®¾ç½®ä¸º10bytes/s</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * è™«æ´æ ˆï¼šhttps://bugstack.cn
 * å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ  ï½›è·å–å­¦ä¹ æºç ï½
 * Create by fuzhengwei on 2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyChannelInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//æµé‡æ•´å½¢</span>
        channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelTrafficShapingHandler</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åŸºäºæ¢è¡Œç¬¦å·</span>
        channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LineBasedFrameDecoder</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è§£ç è½¬Stringï¼Œæ³¨æ„è°ƒæ•´è‡ªå·±çš„ç¼–ç æ ¼å¼GBKã€UTF-8</span>
        channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;GBK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è§£ç è½¬Stringï¼Œæ³¨æ„è°ƒæ•´è‡ªå·±çš„ç¼–ç æ ¼å¼GBKã€UTF-8</span>
        channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;GBK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åœ¨ç®¡é“ä¸­æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„æ¥æ”¶æ•°æ®å®ç°æ–¹æ³•</span>
        channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyClientHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>server/common/MyServerCommonHandler.java | æä¾›æŠ½è±¡ç±»ï¼Œç›‘æ§å‘é€é€Ÿç‡ä»¥åŠè·å–å‘é€çŠ¶æ€</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * è™«æ´æ ˆï¼šhttps://bugstack.cn
 * å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ | æ¬¢è¿å…³æ³¨å¹¶è·å–ä¸“é¢˜&amp;æºç 
 * Create by fuzhengwei on 2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">MyServerCommonHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> sentFlag<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Runnable</span> counterTask<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">AtomicLong</span> consumeMsgLength <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> priorProgress<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerAdded</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        counterTask <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">long</span> length <span class="token operator">=</span> consumeMsgLength<span class="token punctuation">.</span><span class="token function">getAndSet</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> length<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ•°æ®å‘é€é€Ÿç‡(KB/S)ï¼š&quot;</span> <span class="token operator">+</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ignored<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">handlerAdded</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token function">sendData</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¯åŠ¨ç›‘æ§çº¿ç¨‹</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>counterTask<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">sendData</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token class-name">ChannelProgressivePromise</span> <span class="token function">getChannelProgressivePromise</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ChannelProgressiveFuture</span><span class="token punctuation">&gt;</span></span> completedAction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ChannelProgressivePromise</span> channelProgressivePromise <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">newProgressivePromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channelProgressivePromise<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelProgressiveFutureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationProgressed</span><span class="token punctuation">(</span><span class="token class-name">ChannelProgressiveFuture</span> future<span class="token punctuation">,</span> <span class="token keyword">long</span> progress<span class="token punctuation">,</span> <span class="token keyword">long</span> total<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                consumeMsgLength<span class="token punctuation">.</span><span class="token function">addAndGet</span><span class="token punctuation">(</span>progress <span class="token operator">-</span> priorProgress<span class="token punctuation">)</span><span class="token punctuation">;</span>
                priorProgress <span class="token operator">=</span> progress<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelProgressiveFuture</span> future<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                sentFlag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>future<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ | æé†’ï¼Œæ¶ˆæ¯å‘é€æˆåŠŸï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    priorProgress <span class="token operator">-=</span> <span class="token number">10</span><span class="token punctuation">;</span>
                    <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>completedAction<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>action <span class="token operator">-&gt;</span> action<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>future<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ | æé†’ï¼Œæ¶ˆæ¯å‘é€å¤±è´¥ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    future<span class="token punctuation">.</span><span class="token function">cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> channelProgressivePromise<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ | NettyServeræ¥æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>server/MyChannelInitializer.java | å¢åŠ å…¨å±€æµé‡æ•´å½¢é…ç½®ï¼Œé€Ÿç‡è®¾ç½®ä¸º10bytes/s</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * è™«æ´æ ˆï¼šhttps://bugstack.cn
 * å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ | æ¬¢è¿å…³æ³¨å¹¶è·å–ä¸“é¢˜&amp;æºç 
 * Create by fuzhengwei on 2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyChannelInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// åŸºäºæ¢è¡Œç¬¦å·</span>
        channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LineBasedFrameDecoder</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æµé‡æ•´å½¢ï¼›writeLimit/readLimit{0 or a limit in bytes/s}</span>
        channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GlobalTrafficShapingHandler</span><span class="token punctuation">(</span>channel<span class="token punctuation">.</span><span class="token function">eventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è§£ç è½¬Stringï¼Œæ³¨æ„è°ƒæ•´è‡ªå·±çš„ç¼–ç æ ¼å¼GBKã€UTF-8</span>
        channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;GBK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è§£ç è½¬Stringï¼Œæ³¨æ„è°ƒæ•´è‡ªå·±çš„ç¼–ç æ ¼å¼GBKã€UTF-8</span>
        channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;GBK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åœ¨ç®¡é“ä¸­æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„æ¥æ”¶æ•°æ®å®ç°æ–¹æ³•</span>
        channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>server/MyServerHandler.java | å¤„ç†æ¶ˆæ¯éªŒè¯æ˜¯å¦å¯ä»¥å‘é€ctx.channel().isWritable()</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * è™«æ´æ ˆï¼šhttps://bugstack.cn
 * å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ | æ¬¢è¿å…³æ³¨å¹¶è·å–ä¸“é¢˜&amp;æºç 
 * Create by fuzhengwei on 2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">MyServerCommonHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">sendData</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sentFlag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span> <span class="token string">&quot;111111111122222222223333333333\\r\\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getChannelProgressivePromise</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ChannelProgressiveFuture</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">ChannelProgressiveFuture</span> channelProgressiveFuture<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>sentFlag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">sendData</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æµ‹è¯•ç»“æœ" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•ç»“æœ" aria-hidden="true">#</a> æµ‹è¯•ç»“æœ</h2><blockquote><p>å¯åŠ¨æœåŠ¡ç«¯NettyServer | å¯ä»¥çœ‹åˆ°é€Ÿç‡å·²ç»è¢«é™åˆ¶</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>netty server start done<span class="token punctuation">.</span> <span class="token punctuation">{</span>å…³æ³¨å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> è·å–ä¸“é¢˜æ¡ˆä¾‹æºç <span class="token punctuation">}</span>
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> æé†’ï¼Œæ¶ˆæ¯å‘é€æˆåŠŸï¼
æ•°æ®å‘é€é€Ÿç‡<span class="token punctuation">(</span><span class="token constant">KB</span><span class="token operator">/</span><span class="token class-name">S</span><span class="token punctuation">)</span>ï¼š<span class="token number">32</span>
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> æé†’ï¼Œæ¶ˆæ¯å‘é€æˆåŠŸï¼
æ•°æ®å‘é€é€Ÿç‡<span class="token punctuation">(</span><span class="token constant">KB</span><span class="token operator">/</span><span class="token class-name">S</span><span class="token punctuation">)</span>ï¼š<span class="token number">10</span>
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> <span class="token class-name">NettyServer</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š<span class="token number">876d</span><span class="token number">251</span>b<span class="token operator">-</span>aba8<span class="token operator">-</span><span class="token number">481</span>a<span class="token operator">-</span><span class="token number">81d</span><span class="token number">0</span><span class="token operator">-</span>e123a4c42214
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> æé†’ï¼Œæ¶ˆæ¯å‘é€æˆåŠŸï¼
æ•°æ®å‘é€é€Ÿç‡<span class="token punctuation">(</span><span class="token constant">KB</span><span class="token operator">/</span><span class="token class-name">S</span><span class="token punctuation">)</span>ï¼š<span class="token number">10</span>
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> <span class="token class-name">NettyServer</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š<span class="token number">250d</span><span class="token number">53f</span>b<span class="token operator">-</span>acc3<span class="token operator">-</span><span class="token number">4390</span><span class="token operator">-</span>b5c5<span class="token operator">-</span>a660577fff6f
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> æé†’ï¼Œæ¶ˆæ¯å‘é€æˆåŠŸï¼
æ•°æ®å‘é€é€Ÿç‡<span class="token punctuation">(</span><span class="token constant">KB</span><span class="token operator">/</span><span class="token class-name">S</span><span class="token punctuation">)</span>ï¼š<span class="token number">10</span>
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> <span class="token class-name">NettyServer</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š<span class="token number">89</span>cad8a0<span class="token operator">-</span><span class="token number">8e5</span>b<span class="token operator">-</span><span class="token number">44</span>ef<span class="token operator">-</span><span class="token number">812</span>b<span class="token operator">-</span><span class="token number">39</span>c4b2d2e0fb
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> æé†’ï¼Œæ¶ˆæ¯å‘é€æˆåŠŸï¼
æ•°æ®å‘é€é€Ÿç‡<span class="token punctuation">(</span><span class="token constant">KB</span><span class="token operator">/</span><span class="token class-name">S</span><span class="token punctuation">)</span>ï¼š<span class="token number">10</span>
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> <span class="token class-name">NettyServer</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼še951ca01<span class="token operator">-</span>a583<span class="token operator">-</span><span class="token number">4</span>c20<span class="token operator">-</span>b884<span class="token operator">-</span><span class="token number">5</span>c272b1cc7a4
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> æé†’ï¼Œæ¶ˆæ¯å‘é€æˆåŠŸï¼
æ•°æ®å‘é€é€Ÿç‡<span class="token punctuation">(</span><span class="token constant">KB</span><span class="token operator">/</span><span class="token class-name">S</span><span class="token punctuation">)</span>ï¼š<span class="token number">10</span>
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> <span class="token class-name">NettyServer</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š<span class="token number">4</span>b13d77c<span class="token operator">-</span><span class="token number">188f</span><span class="token operator">-</span><span class="token number">4613</span><span class="token operator">-</span><span class="token number">9</span>cd9<span class="token operator">-</span><span class="token number">94</span>a2a7751932
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> æé†’ï¼Œæ¶ˆæ¯å‘é€æˆåŠŸï¼
æ•°æ®å‘é€é€Ÿç‡<span class="token punctuation">(</span><span class="token constant">KB</span><span class="token operator">/</span><span class="token class-name">S</span><span class="token punctuation">)</span>ï¼š<span class="token number">10</span>
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> æé†’ï¼Œæ¶ˆæ¯å‘é€æˆåŠŸï¼
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> <span class="token class-name">NettyServer</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šfdc5378c<span class="token operator">-</span>a594<span class="token operator">-</span><span class="token number">4</span>be8<span class="token operator">-</span><span class="token number">885d</span><span class="token operator">-</span><span class="token number">4</span>caa7ecccd82
æ•°æ®å‘é€é€Ÿç‡<span class="token punctuation">(</span><span class="token constant">KB</span><span class="token operator">/</span><span class="token class-name">S</span><span class="token punctuation">)</span>ï¼š<span class="token number">10</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token operator">-</span><span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>å¯åŠ¨å®¢æˆ·ç«¯NettyClient | å¯ä»¥çœ‹åˆ°é€Ÿç‡å·²ç»è¢«é™åˆ¶</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>netty client start done<span class="token punctuation">.</span> <span class="token punctuation">{</span>å…³æ³¨å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> è·å–ä¸“é¢˜æ¡ˆä¾‹æºç <span class="token punctuation">}</span>
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> <span class="token class-name">NettyClient</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š<span class="token number">111111111122222222223333333333</span> lengthï¼š<span class="token number">30</span>
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> <span class="token class-name">NettyClient</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š<span class="token number">111111111122222222223333333333</span> lengthï¼š<span class="token number">30</span>
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> <span class="token class-name">NettyClient</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š<span class="token number">111111111122222222223333333333</span> lengthï¼š<span class="token number">30</span>
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> <span class="token class-name">NettyClient</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š<span class="token number">111111111122222222223333333333</span> lengthï¼š<span class="token number">30</span>
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> <span class="token class-name">NettyClient</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š<span class="token number">111111111122222222223333333333</span> lengthï¼š<span class="token number">30</span>
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> <span class="token class-name">NettyClient</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š<span class="token number">111111111122222222223333333333</span> lengthï¼š<span class="token number">30</span>
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> <span class="token class-name">NettyClient</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š<span class="token number">111111111122222222223333333333</span> lengthï¼š<span class="token number">30</span>
å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ <span class="token operator">|</span> <span class="token class-name">NettyClient</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š<span class="token number">111111111122222222223333333333</span> lengthï¼š<span class="token number">30</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token operator">-</span><span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¾®ä¿¡æœç´¢ã€Œ<strong>bugstackè™«æ´æ ˆ</strong>ã€å…¬ä¼—å·ï¼Œå…³æ³¨åå›å¤ã€Œ<strong>Nettyä¸“é¢˜æ¡ˆä¾‹</strong>ã€è·å–æœ¬æ–‡æºç &amp;æ›´å¤šåŸåˆ›ä¸“é¢˜æ¡ˆä¾‹ï¼</p>`,49);function v(g,m){const a=e("ExternalLinkIcon");return p(),o("div",null,[u,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),k,s("åšå®¢ï¼š"),n("a",r,[s("https://bugstack.cn"),c(a)])]),d])}const h=t(i,[["render",v],["__file","2019-08-27-nettyanliï¼Œnetty4.1zhongjituozhanpianshierã€ŠNettyliuliangzhengxingshujuliusulvkongzhifenxiyushizhanã€‹.html.vue"]]);export{h as default};
