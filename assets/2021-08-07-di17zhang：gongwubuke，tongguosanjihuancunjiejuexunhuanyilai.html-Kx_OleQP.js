import{_ as t,r as p,o,c,a as n,b as s,d as e,e as l}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"ç¬¬-17-ç« -æ”»æ— ä¸å…‹-é€šè¿‡ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ç¬¬-17-ç« -æ”»æ— ä¸å…‹-é€šè¿‡ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–","aria-hidden":"true"},"#"),s(" ç¬¬ 17 ç« ï¼šæ”»æ— ä¸å…‹ï¼Œé€šè¿‡ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–")],-1),r=n("br",null,null,-1),k={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=n("br",null,null,-1),v={href:"https://articles.zsxq.com/id_w629m13v0hni.html",target:"_blank",rel:"noopener noreferrer"},m=n("blockquote",null,[n("p",null,"æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„")],-1),b=n("h2",{id:"é›¶ã€ä¼˜ç§€ä½œä¸š",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#é›¶ã€ä¼˜ç§€ä½œä¸š","aria-hidden":"true"},"#"),s(" é›¶ã€ä¼˜ç§€ä½œä¸š")],-1),g={href:"https://t.zsxq.com/06jEynIE2",target:"_blank",rel:"noopener noreferrer"},f={href:"https://t.zsxq.com/06AyBeiYN",target:"_blank",rel:"noopener noreferrer"},y={href:"https://t.zsxq.com/08x6okqWE",target:"_blank",rel:"noopener noreferrer"},h={href:"https://t.zsxq.com/08USMN0DG",target:"_blank",rel:"noopener noreferrer"},j={href:"https://t.zsxq.com/0aifC9zGU",target:"_blank",rel:"noopener noreferrer"},w={href:"https://t.zsxq.com/0bRmz6qty",target:"_blank",rel:"noopener noreferrer"},B={href:"https://t.zsxq.com/0bukMhjB7",target:"_blank",rel:"noopener noreferrer"},A={href:"https://t.zsxq.com/0bf6vuTJS",target:"_blank",rel:"noopener noreferrer"},S=l(`<h2 id="ä¸€ã€å‰è¨€" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‰è¨€" aria-hidden="true">#</a> ä¸€ã€å‰è¨€</h2><p><code>å˜å“ˆå‘€ï¼Œåˆä¸æ˜¯ä¸èƒ½ç”¨ï¼</code></p><p>æˆ‘ç»å¸¸è¯´ä¸šåŠ¡é€»è¾‘çš„ä»£ç å®ç°ï¼Œå°±åƒæ“¦å±å±çš„çº¸ï¼Œ<code>80%</code>çš„é¢ç§¯éƒ½æ˜¯ä¿æŠ¤æ‰‹çš„ã€‚è€Œé‚£<code>20%</code>çš„æ ¸å¿ƒæµç¨‹ä¹Ÿå°±ä»…ä»…æ˜¯ä½ è¯´çš„èƒ½ç”¨å°±è¡Œï¼Œåæ­£æ¯æ¬¡éƒ½æ´—æ‰‹å‘—ã€‚</p><p>å…¶å®æƒ³æŠŠç¨‹åºä»<strong>èƒ½ç”¨</strong>å®ç°åˆ°<strong>å¥½ç”¨</strong>å¹¶ä¸å®¹æ˜“ï¼Œè¿™åŒ…æ‹¬ä½ å¯¹ä¸šåŠ¡çš„ç†è§£ã€ä½ å¯¹æ¶æ„çš„æŠŠæ§ã€ä½ å¯¹ç»†èŠ‚çš„å®ç°ç­‰ç­‰ï¼Œä¹ŸåŒ…æ‹¬ä½ æ˜¯å¦èƒ½åšä¸€äº›åˆ—çš„æŠ½è±¡å®ç°ï¼Œä¸è‡³äºæ•´ä¸ªç¨‹åºéšç€å¼€å‘çš„è¶Šå¤šå°±å˜çš„è¶Šè‡ƒè‚¿ä¸å ªã€‚</p><p>é‚£ä¹ˆå¯¹äºç¼–ç¨‹ä¸Šçš„å†™<code>å¥½ç¨‹åºçš„ç†è§£</code>ï¼Œæˆ‘é€šå¸¸å–œæ¬¢ç”¨ç”Ÿæ´»ä¸­å®é™…çš„ä¾‹å­æ¥è¡¨è¾¾ï¼Œå› ä¸ºæœ‰ä¸å°‘å‰è¾ˆçš„ç ”å‘å¤§ç‰›éƒ½è¯´ï¼šâ€œä½ è¦é¢å¯¹å¯¹è±¡ç¼–ç¨‹â€ã€‚æ‰€ä»¥å˜ï¼Œæˆ‘å¯èƒ½ä¼šç”¨ç”Ÿæ´»ä¸­çš„è¶…å¸‚ã€å±•å°ã€è´§æ¶ã€å®˜æ¸¡ç­‰æ¥å¯¹æˆ‘çš„ç¨‹åºå¼€å‘ä¸­çš„ç±»æˆ–è€…é¢†åŸŸæœåŠ¡è¿›è¡Œå‘½åå’Œå®ç°ï¼Œè¿™æ ·æŠ½è±¡åŒ–å‡ºæ¥çš„ä»£ç é€»è¾‘æ›´å…·æœ‰æ‰©å±•æ€§ï¼Œä¹Ÿèƒ½è®©æ–°æ¥æ‰‹çš„äººå¿«é€Ÿç†è§£å¹¶ä¸”ä¸è‡³äºæ…Œä¹±çš„å¼€å‘ã€‚</p><h2 id="äºŒã€ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#äºŒã€ç›®æ ‡" aria-hidden="true">#</a> äºŒã€ç›®æ ‡</h2><p>æŒ‰ç…§ç›®å‰æˆ‘ä»¬å®ç°çš„ Spring æ¡†æ¶ï¼Œæ˜¯å¯ä»¥æ»¡è¶³ä¸€ä¸ªåŸºæœ¬éœ€æ±‚çš„ï¼Œä½†å¦‚æœä½ é…ç½®äº†Aã€Bä¸¤ä¸ªBeanå¯¹è±¡äº’ç›¸ä¾èµ–ï¼Œé‚£ä¹ˆç«‹é©¬ä¼šæŠ›å‡º <code>java.lang.StackOverflowError</code>ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸º<code>Aåˆ›å»º</code>æ—¶éœ€è¦ä¾èµ–<code>Båˆ›å»º</code>ï¼Œè€ŒBçš„åˆ›å»ºåˆä¾èµ–äºAåˆ›å»ºï¼Œå°±è¿™æ ·æ­»å¾ªç¯äº†ã€‚</p><p>è€Œè¿™ä¸ªå¾ªç¯ä¾èµ–åŸºæœ¬ä¹Ÿå¯ä»¥è¯´æ˜¯ Spring ä¸­éå¸¸ç»å…¸çš„å®ç°äº†ï¼Œæ‰€è¦è§£å†³çš„åœºæ™¯ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š</p><p><img src="https://bugstack.cn/assets/images/2020/interview/interview-31-1.png" alt=""></p><ul><li>å¾ªç¯ä¾èµ–ä¸»è¦åˆ†ä¸ºè¿™ä¸‰ç§ï¼Œè‡ªèº«ä¾èµ–äºè‡ªèº«ã€äº’ç›¸å¾ªç¯ä¾èµ–ã€å¤šç»„å¾ªç¯ä¾èµ–ã€‚</li><li>ä½†æ— è®ºå¾ªç¯ä¾èµ–çš„æ•°é‡æœ‰å¤šå°‘ï¼Œå¾ªç¯ä¾èµ–çš„æœ¬è´¨æ˜¯ä¸€æ ·çš„ã€‚å°±æ˜¯ä½ çš„å®Œæ•´åˆ›å»ºä¾èµ–äºæˆ‘ï¼Œè€Œæˆ‘çš„å®Œæ•´åˆ›å»ºä¹Ÿä¾èµ–äºä½ ï¼Œä½†æˆ‘ä»¬äº’ç›¸æ²¡æ³•è§£è€¦ï¼Œæœ€ç»ˆå¯¼è‡´ä¾èµ–åˆ›å»ºå¤±è´¥ã€‚</li><li>æ‰€ä»¥éœ€è¦ Spring æä¾›äº†é™¤äº†æ„é€ å‡½æ•°æ³¨å…¥å’ŒåŸå‹æ³¨å…¥å¤–çš„ï¼Œsetter å¾ªç¯ä¾èµ–æ³¨å…¥è§£å†³æ–¹æ¡ˆã€‚</li></ul><h2 id="ä¸‰ã€è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€è®¾è®¡" aria-hidden="true">#</a> ä¸‰ã€è®¾è®¡</h2><p>æŒ‰ç…§ Spring æ¡†æ¶çš„è®¾è®¡ï¼Œç”¨äºè§£å†³å¾ªç¯ä¾èµ–éœ€è¦ç”¨åˆ°ä¸‰ä¸ªç¼“å­˜ï¼Œè¿™ä¸‰ä¸ªç¼“å­˜åˆ†åˆ«å­˜æ”¾äº†<code>æˆå“å¯¹è±¡</code>ã€<code>åŠæˆå“å¯¹è±¡(æœªå¡«å……å±æ€§å€¼)</code>ã€<code>ä»£ç†å¯¹è±¡</code>ï¼Œåˆ†é˜¶æ®µå­˜æ”¾å¯¹è±¡å†…å®¹ï¼Œæ¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</p><p><strong>é‚£ä¹ˆ</strong>ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€ä¸ªæ ¸å¿ƒçš„åŸç†ï¼Œå°±æ˜¯ç”¨äºè§£å†³å¾ªç¯ä¾èµ–å°±å¿…é¡»æ˜¯ä¸‰çº§ç¼“å­˜å‘¢ï¼ŒäºŒçº§è¡Œå—ï¼Ÿä¸€çº§å¯ä»¥ä¸ï¼Ÿå…¶å®éƒ½èƒ½è§£å†³ï¼Œåªä¸è¿‡ Spring æ¡†æ¶çš„å®ç°è¦ä¿è¯å‡ ä¸ªäº‹æƒ…ï¼Œå¦‚åªæœ‰ä¸€çº§ç¼“å­˜å¤„ç†æµç¨‹æ²¡æ³•æ‹†åˆ†ï¼Œå¤æ‚åº¦ä¹Ÿä¼šå¢åŠ ï¼ŒåŒæ—¶åŠæˆå“å¯¹è±¡å¯èƒ½ä¼šæœ‰ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚è€Œå°†åŠæˆå“ä¸æˆå“å¯¹è±¡åˆ†å¼€ï¼Œå¤„ç†èµ·æ¥ä¹Ÿæ›´åŠ ä¼˜é›…ã€ç®€å•ã€æ˜“æ‰©å±•ã€‚å¦å¤– Spring çš„ä¸¤å¤§ç‰¹æ€§ä¸­ä¸ä»…æœ‰ IOC è¿˜æœ‰ AOPï¼Œä¹Ÿå°±æ˜¯åŸºäºå­—èŠ‚ç å¢å¼ºåçš„æ–¹æ³•ï¼Œè¯¥å­˜æ”¾åˆ°å“ªï¼Œè€Œä¸‰çº§ç¼“å­˜æœ€ä¸»è¦ï¼Œè¦è§£å†³çš„å¾ªç¯ä¾èµ–å°±æ˜¯å¯¹ AOP çš„å¤„ç†ï¼Œä½†å¦‚æœæŠŠ AOP ä»£ç†å¯¹è±¡çš„åˆ›å»ºæå‰ï¼Œé‚£ä¹ˆäºŒçº§ç¼“å­˜ä¹Ÿä¸€æ ·å¯ä»¥è§£å†³ã€‚ä½†æ˜¯ï¼Œè¿™å°±è¿èƒŒäº† Spring åˆ›å»ºå¯¹è±¡çš„åŸåˆ™ï¼ŒSpring æ›´å–œæ¬¢æŠŠæ‰€æœ‰çš„æ™®é€š Bean éƒ½åˆå§‹åŒ–å®Œæˆï¼Œåœ¨å¤„ç†ä»£ç†å¯¹è±¡çš„åˆå§‹åŒ–ã€‚</p><p><strong>ä¸è¿‡</strong>ï¼Œæ²¡å…³ç³»æˆ‘ä»¬å¯ä»¥å…ˆå°è¯•ä»…é€‚ç”¨ä¸€çº§ç¼“å­˜æ¥è§£å†³å¾ªç¯ä¾èµ–ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼ä»ä¸­å­¦ä¹ åˆ°å¤„ç†å¾ªç¯ä¾èµ–çš„æœ€æ ¸å¿ƒåŸæ¥ï¼Œä¹Ÿå°±æ˜¯é‚£20%çš„åœ°æ–¹ã€‚</p><p><img src="https://bugstack.cn/assets/images/spring/spring-17-02.png" alt=""></p><ul><li>å¦‚æœä»…ä»¥ä¸€çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ï¼Œé‚£ä¹ˆåœ¨å®ç°ä¸Šå¯ä»¥é€šè¿‡åœ¨Aå¯¹è±¡ newInstance åˆ›å»ºä¸”æœªå¡«å……å±æ€§åï¼Œç›´æ¥æ”¾å…¥ç¼“å­˜ä¸­ã€‚</li><li>åœ¨<code>Aå¯¹è±¡</code>çš„å±æ€§å¡«å……<code>Bå¯¹è±¡</code>æ—¶ï¼Œå¦‚æœç¼“å­˜ä¸­ä¸èƒ½è·å–åˆ°<code>Bå¯¹è±¡</code>ï¼Œåˆ™å¼€å§‹åˆ›å»º<code>Bå¯¹è±¡</code>ï¼ŒåŒæ ·åˆ›å»ºå®Œæˆåï¼ŒæŠŠ<code>Bå¯¹è±¡</code>å¡«å……åˆ°ç¼“å­˜ä¸­å»ã€‚</li><li>æ¥ä¸‹æ¥å°±å¼€å§‹å¯¹<code>Bå¯¹è±¡</code>çš„å±æ€§è¿›è¡Œå¡«å……ï¼Œæ°å¥½è¿™ä¼šå¯ä»¥ä»ç¼“å­˜ä¸­æ‹¿åˆ°<code>åŠæˆå“çš„Aå¯¹è±¡</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™<code>Bå¯¹è±¡</code>çš„å±æ€§å°±å¡«å……å®Œäº†ã€‚</li><li>æœ€åè¿”å›æ¥ç»§ç»­å®Œæˆ<code>Aå¯¹è±¡</code>çš„å±æ€§å¡«å……ï¼ŒæŠŠå®ä¾‹åŒ–åå¹¶å¡«å……äº†å±æ€§çš„<code>Bå¯¹è±¡</code>èµ‹å€¼ç»™Aå¯¹è±¡çš„<code>bå±æ€§</code>ï¼Œè¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªå¾ªç¯ä¾èµ–æ“ä½œã€‚</li></ul><p><strong>ä»£ç å®ç°</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> singletonObjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> beanClass<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> beanName <span class="token operator">=</span> beanClass<span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>singletonObjects<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> singletonObjects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å®ä¾‹åŒ–å¯¹è±¡å…¥ç¼“å­˜</span>
    <span class="token class-name">Object</span> obj <span class="token operator">=</span> beanClass<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    singletonObjects<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å±æ€§å¡«å……è¡¥å…¨å¯¹è±¡</span>
    <span class="token class-name">Field</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Field</span> field <span class="token operator">:</span> fields<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        field<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> fieldClass <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fieldBeanName <span class="token operator">=</span> fieldClass<span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        field<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> singletonObjects<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>fieldBeanName<span class="token punctuation">)</span> <span class="token operator">?</span> singletonObjects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>fieldBeanName<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">getBean</span><span class="token punctuation">(</span>fieldClass<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        field<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä½¿ç”¨ä¸€çº§ç¼“å­˜å­˜æ”¾å¯¹è±¡çš„æ–¹å¼ï¼Œå°±æ˜¯è¿™æ ·ç®€å•çš„å®ç°è¿‡ç¨‹ï¼Œåªè¦æ˜¯åˆ›å»ºå®Œå¯¹è±¡ï¼Œç«‹é©¬å¡åˆ°ç¼“å­˜é‡Œå»ã€‚è¿™æ ·å°±å¯ä»¥åœ¨å…¶ä»–å¯¹è±¡åˆ›å»ºæ—¶å€™è·å–åˆ°å±æ€§éœ€è¦å¡«å……çš„å¯¹è±¡äº†ã€‚</li></ul><p><strong>æµ‹è¯•ç»“æœ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">B</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>A</span><span class="token annotation punctuation">@49476842</span>
<span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>B</span><span class="token annotation punctuation">@78308db1</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/assets/images/spring/spring-17-03.png" alt=""></p><ul><li>ä»æµ‹è¯•æ•ˆæœå’Œæˆªå›¾ä¾èµ–è¿‡ç¨‹ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸€çº§ç¼“å­˜ä¹Ÿå¯ä»¥è§£å†³ç®€å•åœºæ™¯çš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</li><li>å…¶å® <code>getBean</code>ï¼Œæ˜¯æ•´ä¸ªè§£å†³å¾ªç¯ä¾èµ–çš„æ ¸å¿ƒå†…å®¹ï¼ŒA åˆ›å»ºåå¡«å……å±æ€§æ—¶ä¾èµ– Bï¼Œé‚£ä¹ˆå°±å»åˆ›å»º Bï¼Œåœ¨åˆ›å»º B å¼€å§‹å¡«å……æ—¶å‘ç°ä¾èµ–äº Aï¼Œä½†æ­¤æ—¶ A è¿™ä¸ªåŠæˆå“å¯¹è±¡å·²ç»å­˜æ”¾åœ¨ç¼“å­˜åˆ°<code>singletonObjects</code> ä¸­äº†ï¼Œæ‰€ä»¥ B å¯ä»¥æ­£å¸¸åˆ›å»ºï¼Œåœ¨é€šè¿‡é€’å½’æŠŠ A ä¹Ÿåˆ›å»ºå®Œæ•´äº†ã€‚</li></ul><hr><p>æœ‰äº†ä»¥ä¸Šè¿™éƒ¨åˆ†å…³äºå¾ªç¯ä¾èµ–çš„å¤„ç†å†…å®¹ï¼Œåœ¨ç†è§£å¾ªç¯ä¾èµ–å°±æ²¡é‚£ä¹ˆå¤æ‚äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¸¦ç€è¿™ä¸ª<code>æ„Ÿè§‰</code>å»æ€è€ƒå¦‚æœæœ‰å¯¹è±¡ä¸åªæ˜¯ç®€å•çš„å¯¹è±¡ï¼Œè¿˜æœ‰ä»£ç†å¯¹è±¡ï¼Œè¿˜æœ‰AOPåº”ç”¨ï¼Œè¦æ€ä¹ˆå¤„ç†è¿™æ ·çš„ä¾èµ–é—®é¢˜ã€‚æ•´ä½“è®¾è®¡ç»“æ„å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://bugstack.cn/assets/images/spring/spring-17-04.png" alt=""></p><ul><li>å…³äºå¾ªç¯ä¾èµ–åœ¨æˆ‘ä»¬ç›®å‰çš„ Spring æ¡†æ¶ä¸­æ‰©å±•èµ·æ¥ä¹Ÿå¹¶ä¸ä¼šå¤ªå¤æ‚ï¼Œä¸»è¦å°±æ˜¯å¯¹äºåˆ›å»ºå¯¹è±¡çš„<code>æå‰æš´éœ²</code>ï¼Œå¦‚æœæ˜¯å·¥å‚å¯¹è±¡åˆ™ä¼šä½¿ç”¨ getEarlyBeanReference é€»è¾‘æå‰å°†å·¥å‚ğŸ­å¯¹è±¡å­˜æ”¾åˆ°ä¸‰çº§ç¼“å­˜ä¸­ã€‚ç­‰åˆ°åç»­è·å–å¯¹è±¡çš„æ—¶å€™å®é™…æ‹¿åˆ°çš„æ˜¯å·¥å‚å¯¹è±¡ä¸­ getObjectï¼Œè¿™ä¸ªæ‰æ˜¯æœ€ç»ˆçš„å®é™…å¯¹è±¡ã€‚</li><li>åœ¨åˆ›å»ºå¯¹è±¡çš„ <code>AbstractAutowireCapableBeanFactory#doCreateBean</code> æ–¹æ³•ä¸­ï¼Œæå‰æš´éœ²å¯¹è±¡ä»¥åï¼Œå°±å¯ä»¥é€šè¿‡æ¥ä¸‹æ¥çš„æµç¨‹ï¼ŒgetSingleton ä»ä¸‰ä¸ªç¼“å­˜ä¸­ä»¥æ­¤å¯»æ‰¾å¯¹è±¡ï¼Œä¸€çº§ã€äºŒçº§å¦‚æœæœ‰åˆ™ç›´æ¥å–èµ°ï¼Œå¦‚æœå¯¹è±¡æ˜¯ä¸‰çº§ç¼“å­˜ä¸­åˆ™ä¼šä»ä¸‰çº§ç¼“å­˜ä¸­è·å–åå¹¶åˆ æ‰å·¥å‚å¯¹è±¡ï¼ŒæŠŠå®é™…å¯¹è±¡æ”¾åˆ°äºŒçº§ç¼“å­˜ä¸­ã€‚</li><li>æœ€åæ˜¯å…³äºå•ä¾‹çš„å¯¹è±¡çš„æ³¨å†Œæ“ä½œï¼Œè¿™ä¸ªæ³¨å†Œæ“ä½œå°±æ˜¯æŠŠçœŸå®çš„å®é™…å¯¹è±¡æ”¾åˆ°ä¸€çº§ç¼“å­˜ä¸­ï¼Œå› ä¸ºæ­¤æ—¶å®ƒå·²ç»æ˜¯ä¸€ä¸ªæˆå“å¯¹è±¡äº†ã€‚</li></ul><h2 id="å››ã€å®ç°" tabindex="-1"><a class="header-anchor" href="#å››ã€å®ç°" aria-hidden="true">#</a> å››ã€å®ç°</h2><h3 id="_1-å·¥ç¨‹ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1-å·¥ç¨‹ç»“æ„" aria-hidden="true">#</a> 1. å·¥ç¨‹ç»“æ„</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>small<span class="token operator">-</span>spring<span class="token operator">-</span>step<span class="token operator">-</span><span class="token number">16</span>
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework
    â”‚           â”œâ”€â”€ aop
    â”‚           â”‚   â”œâ”€â”€ aspectj
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">AspectJExpressionPointcut</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">AspectJExpressionPointcutAdvisor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ framework 
    â”‚           â”‚   â”‚   â”œâ”€â”€ adapter
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ <span class="token class-name">MethodBeforeAdviceInterceptor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ autoproxy
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ <span class="token class-name">MethodBeforeAdviceInterceptor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AopProxy</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">Cglib2AopProxy</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">JdkDynamicAopProxy</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ProxyFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">ReflectiveMethodInvocation</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">AdvisedSupport</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">Advisor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">BeforeAdvice</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ClassFilter</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">MethodBeforeAdvice</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">MethodMatcher</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">Pointcut</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">PointcutAdvisor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">TargetSource</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ beans
    â”‚           â”‚   â”œâ”€â”€ factory  
    â”‚           â”‚   â”‚   â”œâ”€â”€ annotation
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">Autowired</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AutowiredAnnotationBeanPostProcessor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">Qualifier</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ <span class="token class-name">Value</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ config
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AutowireCapableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanDefinition</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanFactoryPostProcessor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanPostProcessor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanReference</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ConfigurableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">InstantiationAwareBeanPostProcessor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ <span class="token class-name">SingletonBeanRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractBeanDefinitionReader</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanDefinitionReader</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanDefinitionRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">CglibSubclassingInstantiationStrategy</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DefaultListableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DefaultSingletonBeanRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DisposableBeanAdapter</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">FactoryBeanRegistrySupport</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">InstantiationStrategy</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ <span class="token class-name">SimpleInstantiationStrategy</span><span class="token punctuation">.</span>java  
    â”‚           â”‚   â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ <span class="token class-name">XmlBeanDefinitionReader</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">Aware</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanClassLoaderAware</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanFactoryAware</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanNameAware</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ConfigurableListableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DisposableBean</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">FactoryBean</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">HierarchicalBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">InitializingBean</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ListableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ObjectFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">PropertyPlaceholderConfigurer</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">BeansException</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">PropertyValue</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">PropertyValues</span><span class="token punctuation">.</span>java 
    â”‚           â”œâ”€â”€ context
    â”‚           â”‚   â”œâ”€â”€ annotation
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ClassPathBeanDefinitionScanner</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ClassPathScanningCandidateComponentProvider</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">Scope</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ event
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractApplicationEventMulticaster</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationContextEvent</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationEventMulticaster</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ContextClosedEvent</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ContextRefreshedEvent</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">SimpleApplicationEventMulticaster</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractRefreshableApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractXmlApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationContextAwareProcessor</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationContextAware</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationEvent</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationEventPublisher</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationListener</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ core<span class="token punctuation">.</span>io
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ClassPathResource</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">DefaultResourceLoader</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">FileSystemResource</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">Resource</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ResourceLoader</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">UrlResource</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ stereotype
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">Component</span><span class="token punctuation">.</span>java
    â”‚           â””â”€â”€ utils
    â”‚               â”œâ”€â”€ <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span>java
    â”‚               â””â”€â”€ <span class="token class-name">StringValueResolver</span><span class="token punctuation">.</span>java
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test
                â”œâ”€â”€ bean
                â”‚   â”œâ”€â”€ <span class="token class-name">Husband</span><span class="token punctuation">.</span>java
                â”‚   â”œâ”€â”€ <span class="token class-name">HusbandMother</span><span class="token punctuation">.</span>java
                â”‚   â”œâ”€â”€ <span class="token class-name">IMother</span><span class="token punctuation">.</span>java
                â”‚   â”œâ”€â”€ <span class="token class-name">SpouseAdvice</span><span class="token punctuation">.</span>java  
                â”‚   â””â”€â”€ <span class="token class-name">Wife</span><span class="token punctuation">.</span>java
                â”œâ”€â”€ <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
                â””â”€â”€ <span class="token class-name">CircleTest</span><span class="token punctuation">.</span>java  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å·¥ç¨‹æºç </strong>ï¼š<code>å…¬ä¼—å·ã€Œbugstackè™«æ´æ ˆã€ï¼Œå›å¤ï¼šSpring ä¸“æ ï¼Œè·å–å®Œæ•´æºç </code></p><p>å¤„ç†å¾ªç¯ä¾èµ–æ ¸å¿ƒæµç¨‹çš„ç±»å…³ç³»çš„æ“ä½œè¿‡ç¨‹åŒ…æ‹¬ï¼š</p><ul><li>å¾ªç¯ä¾èµ–çš„æ ¸å¿ƒåŠŸèƒ½å®ç°ä¸»è¦åŒ…æ‹¬ DefaultSingletonBeanRegistry æä¾›ä¸‰çº§ç¼“å­˜ï¼š<code>singletonObjects</code>ã€<code>earlySingletonObjects</code>ã€<code>singletonFactories</code>ï¼Œåˆ†åˆ«å­˜æ”¾æˆå“å¯¹è±¡ã€åŠæˆå“å¯¹è±¡å’Œå·¥å‚å¯¹è±¡ã€‚åŒæ—¶åŒ…è£…ä¸‰ä¸ªç¼“å­˜æä¾›æ–¹æ³•ï¼šgetSingletonã€registerSingletonã€addSingletonFactoryï¼Œè¿™æ ·ä½¿ç”¨æ–¹å°±å¯ä»¥åˆ†åˆ«åœ¨ä¸åŒæ—¶é—´æ®µå­˜æ”¾å’Œè·å–å¯¹åº”çš„å¯¹è±¡äº†ã€‚</li><li>åœ¨ AbstractAutowireCapableBeanFactory çš„ doCreateBean æ–¹æ³•ä¸­ï¼Œæä¾›äº†å…³äºæå‰æš´éœ²å¯¹è±¡çš„æ“ä½œï¼Œ<code>addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, beanDefinition, finalBean));</code>ï¼Œä»¥åŠåç»­è·å–å¯¹è±¡å’Œæ³¨å†Œå¯¹è±¡çš„æ“ä½œï¼Œ<code> exposedObject = getSingleton(beanName);</code>ã€<code>registerSingleton(beanName, exposedObject);</code>ï¼Œç»è¿‡è¿™æ ·çš„å¤„ç†å°±å¯ä»¥å®Œæˆå¯¹å¤æ‚åœºæ™¯å¾ªç¯ä¾èµ–çš„æ“ä½œã€‚</li><li>å¦å¤–åœ¨ DefaultAdvisorAutoProxyCreator æä¾›çš„åˆ‡é¢æœåŠ¡ä¸­ï¼Œä¹Ÿéœ€è¦å®ç°æ¥å£ InstantiationAwareBeanPostProcessor æ–°å¢çš„ getEarlyBeanReference æ–¹æ³•ï¼Œä¾¿äºæŠŠä¾èµ–çš„åˆ‡é¢å¯¹è±¡ä¹Ÿèƒ½å­˜æ”¾åˆ°ä¸‰çº§ç¼“å­˜ä¸­ï¼Œå¤„ç†å¯¹åº”çš„å¾ªç¯ä¾èµ–ã€‚</li></ul><h3 id="_2-è®¾ç½®ä¸‰çº§ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_2-è®¾ç½®ä¸‰çº§ç¼“å­˜" aria-hidden="true">#</a> 2. è®¾ç½®ä¸‰çº§ç¼“å­˜</h3><p><strong>cn.bugstack.springframework.beans.factory.support.DefaultSingletonBeanRegistry</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultSingletonBeanRegistry</span> <span class="token keyword">implements</span> <span class="token class-name">SingletonBeanRegistry</span> <span class="token punctuation">{</span>

    <span class="token comment">// ä¸€çº§ç¼“å­˜ï¼Œæ™®é€šå¯¹è±¡</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> singletonObjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// äºŒçº§ç¼“å­˜ï¼Œæå‰æš´æ¼å¯¹è±¡ï¼Œæ²¡æœ‰å®Œå…¨å®ä¾‹åŒ–çš„å¯¹è±¡</span>
    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> earlySingletonObjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ä¸‰çº§ç¼“å­˜ï¼Œå­˜æ”¾ä»£ç†å¯¹è±¡</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ObjectFactory</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> singletonFactories <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ObjectFactory</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">DisposableBean</span><span class="token punctuation">&gt;</span></span> disposableBeans <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> singletonObject <span class="token operator">=</span> singletonObjects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> singletonObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            singletonObject <span class="token operator">=</span> earlySingletonObjects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// åˆ¤æ–­äºŒçº§ç¼“å­˜ä¸­æ˜¯å¦æœ‰å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯ä»£ç†å¯¹è±¡ï¼Œå› ä¸ºåªæœ‰ä»£ç†å¯¹è±¡æ‰ä¼šæ”¾åˆ°ä¸‰çº§ç¼“å­˜ä¸­</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> singletonObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ObjectFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> singletonFactory <span class="token operator">=</span> singletonFactories<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>singletonFactory <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    singletonObject <span class="token operator">=</span> singletonFactory<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// æŠŠä¸‰çº§ç¼“å­˜ä¸­çš„ä»£ç†å¯¹è±¡ä¸­çš„çœŸå®å¯¹è±¡è·å–å‡ºæ¥ï¼Œæ”¾å…¥äºŒçº§ç¼“å­˜ä¸­</span>
                    earlySingletonObjects<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> singletonObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    singletonFactories<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> singletonObject<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerSingleton</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">Object</span> singletonObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        singletonObjects<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> singletonObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        earlySingletonObjects<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        singletonFactories<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">addSingletonFactory</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">ObjectFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> singletonFactory<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>singletonFactories<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> singletonFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>earlySingletonObjects<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerDisposableBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">DisposableBean</span> bean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        disposableBeans<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨ç”¨äºæä¾›å•ä¾‹å¯¹è±¡æ³¨å†Œçš„æ“ä½œçš„ DefaultSingletonBeanRegistry ç±»ä¸­ï¼Œå…±æœ‰ä¸‰ä¸ªç¼“å­˜å¯¹è±¡çš„å±æ€§ï¼›singletonObjectsã€earlySingletonObjectsã€singletonFactoriesï¼Œå¦‚å®ƒä»¬çš„åå­—ä¸€æ ·ï¼Œç”¨äºå­˜æ”¾ä¸åŒç±»å‹çš„å¯¹è±¡ï¼ˆå•ä¾‹å¯¹è±¡ã€æ—©æœŸçš„åŠæˆå“å•ä¾‹å¯¹è±¡ã€å•ä¾‹å·¥å‚å¯¹è±¡ï¼‰ã€‚</li><li>ç´§æ¥ç€åœ¨è¿™ä¸‰ä¸ªç¼“å­˜å¯¹è±¡ä¸‹æä¾›äº†è·å–ã€æ·»åŠ å’Œæ³¨å†Œä¸åŒå¯¹è±¡çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼šgetSingletonã€registerSingletonã€addSingletonFactoryï¼Œå…¶å®åé¢è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯ getSingleton çš„æ“ä½œï¼Œå®ƒæ˜¯åœ¨ä¸€å±‚å±‚å¤„ç†ä¸åŒæ—¶æœŸçš„å•ä¾‹å¯¹è±¡ï¼Œç›´è‡³æ‹¿åˆ°æœ‰æ•ˆçš„å¯¹è±¡ã€‚</li></ul><h3 id="_3-æå‰æš´éœ²å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#_3-æå‰æš´éœ²å¯¹è±¡" aria-hidden="true">#</a> 3. æå‰æš´éœ²å¯¹è±¡</h3><p><strong>cn.bugstack.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractAutowireCapableBeanFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractBeanFactory</span> <span class="token keyword">implements</span> <span class="token class-name">AutowireCapableBeanFactory</span> <span class="token punctuation">{</span>

    <span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">doCreateBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> bean <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// å®ä¾‹åŒ– Bean</span>
            bean <span class="token operator">=</span> <span class="token function">createBeanInstance</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// å¤„ç†å¾ªç¯ä¾èµ–ï¼Œå°†å®ä¾‹åŒ–åçš„Beanå¯¹è±¡æå‰æ”¾å…¥ç¼“å­˜ä¸­æš´éœ²å‡ºæ¥</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>beanDefinition<span class="token punctuation">.</span><span class="token function">isSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Object</span> finalBean <span class="token operator">=</span> bean<span class="token punctuation">;</span>
                <span class="token function">addSingletonFactory</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">getEarlyBeanReference</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">,</span> finalBean<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// å®ä¾‹åŒ–ååˆ¤æ–­</span>
            <span class="token keyword">boolean</span> continueWithPropertyPopulation <span class="token operator">=</span> <span class="token function">applyBeanPostProcessorsAfterInstantiation</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>continueWithPropertyPopulation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// åœ¨è®¾ç½® Bean å±æ€§ä¹‹å‰ï¼Œå…è®¸ BeanPostProcessor ä¿®æ”¹å±æ€§å€¼</span>
            <span class="token function">applyBeanPostProcessorsBeforeApplyingPropertyValues</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ç»™ Bean å¡«å……å±æ€§</span>
            <span class="token function">applyPropertyValues</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ‰§è¡Œ Bean çš„åˆå§‹åŒ–æ–¹æ³•å’Œ BeanPostProcessor çš„å‰ç½®å’Œåç½®å¤„ç†æ–¹æ³•</span>
            bean <span class="token operator">=</span> <span class="token function">initializeBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeansException</span><span class="token punctuation">(</span><span class="token string">&quot;Instantiation of bean failed&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// æ³¨å†Œå®ç°äº† DisposableBean æ¥å£çš„ Bean å¯¹è±¡</span>
        <span class="token function">registerDisposableBeanIfNecessary</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// åˆ¤æ–­ SCOPE_SINGLETONã€SCOPE_PROTOTYPE</span>
        <span class="token class-name">Object</span> exposedObject <span class="token operator">=</span> bean<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>beanDefinition<span class="token punctuation">.</span><span class="token function">isSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è·å–ä»£ç†å¯¹è±¡</span>
            exposedObject <span class="token operator">=</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">registerSingleton</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> exposedObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> exposedObject<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">getEarlyBeanReference</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">,</span> <span class="token class-name">Object</span> bean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> exposedObject <span class="token operator">=</span> bean<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BeanPostProcessor</span> beanPostProcessor <span class="token operator">:</span> <span class="token function">getBeanPostProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>beanPostProcessor <span class="token keyword">instanceof</span> <span class="token class-name">InstantiationAwareBeanPostProcessor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                exposedObject <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">InstantiationAwareBeanPostProcessor</span><span class="token punctuation">)</span> beanPostProcessor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEarlyBeanReference</span><span class="token punctuation">(</span>exposedObject<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> exposedObject<span class="token punctuation">)</span> <span class="token keyword">return</span> exposedObject<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> exposedObject<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

   <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨ AbstractAutowireCapableBeanFactory#doCreateBean çš„æ–¹æ³•ä¸­ä¸»è¦æ˜¯æ‰©å±•äº†å¯¹è±¡çš„æå‰æš´éœ²<code>addSingletonFactory</code>äº†ï¼Œå’Œå•ä¾‹å¯¹è±¡çš„è·å–<code>getSingleton</code>ä»¥åŠæ³¨å†Œæ“ä½œ<code>registerSingleton</code>ã€‚</li><li>è¿™é‡Œæåˆ°ä¸€ç‚¹ getEarlyBeanReference å°±æ˜¯å®šä¹‰åœ¨å¦‚ AOP åˆ‡é¢ä¸­è¿™æ ·çš„ä»£ç†å¯¹è±¡ï¼Œå¯ä»¥å‚è€ƒæºç ä¸­æ¥å£ InstantiationAwareBeanPostProcessor#getEarlyBeanReference æ–¹æ³•çš„å®ç°ã€‚</li></ul><h2 id="äº”ã€æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#äº”ã€æµ‹è¯•" aria-hidden="true">#</a> äº”ã€æµ‹è¯•</h2><p>å› ä¸ºæ˜¯è¦æµ‹è¯•å¾ªç¯ä¾èµ–ï¼Œæˆ‘ä»¬æ‰¾ä¸€ä¸ªæ¯”è¾ƒè´´è¿‘çš„åœºæ™¯æ¥åšæµ‹è¯•ï¼Œ<em>æˆ‘è¯´è¿‡æˆ‘æ˜¯ä¸€ä¸ªå–œæ¬¢ä»ç”Ÿæ´»ä¸­å‘ç°é¢å‘å¯¹è±¡ç¼–ç¨‹çš„äºº</em> æˆ‘ä»¬çš„æ¡ˆä¾‹åœºæ™¯äººç‰©åŒ…æ‹¬ï¼šè€å…¬å’Œåª³å¦‡äº’ç›¸ä¾èµ–ã€å©†å©†æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿæˆä»£ç†å¦ˆå¦ˆèŒè´£ã€åœ¨åŠ ä¸Šä¸€ä¸ªåˆ‡é¢æ¥å…³å¿ƒå®¶åº­ç”Ÿæ´»ğŸ‘ª</p><h3 id="_1-äº‹å…ˆå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#_1-äº‹å…ˆå‡†å¤‡" aria-hidden="true">#</a> 1. äº‹å…ˆå‡†å¤‡</h3><p><strong>è€å…¬ï¼Œç±»</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Husband</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Wife</span> wife<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">queryWife</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Husband.wife&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åª³å¦‡ï¼Œç±»</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Wife</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Husband</span> husband<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">IMother</span> mother<span class="token punctuation">;</span> <span class="token comment">// å©†å©†</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">queryHusband</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Wife.husbandã€Mother.callMotherï¼š&quot;</span> <span class="token operator">+</span> mother<span class="token punctuation">.</span><span class="token function">callMother</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å©†å©†ï¼Œä»£ç†äº†åª³å¦‡åŸæ¥å¦ˆå¦ˆçš„èŒè´£çš„ç±»</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HusbandMother</span> <span class="token keyword">implements</span> <span class="token class-name">FactoryBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IMother</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">IMother</span> <span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">IMother</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">IMother</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;å©šååª³å¦‡å¦ˆå¦ˆçš„èŒè´£è¢«å©†å©†ä»£ç†äº†ï¼&quot;</span> <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åˆ‡é¢ï¼Œç±»</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpouseAdvice</span> <span class="token keyword">implements</span> <span class="token class-name">MethodBeforeAdvice</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å…³æ€€å°ä¸¤å£(åˆ‡é¢)ï¼š&quot;</span> <span class="token operator">+</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-å±æ€§é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-å±æ€§é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> 2. å±æ€§é…ç½®æ–‡ä»¶</h3><p><strong>spring.xml</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;husband&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;cn.bugstack.springframework.test.bean.Husband&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;wife&quot;</span> ref<span class="token operator">=</span><span class="token string">&quot;wife&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
  
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;wife&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;cn.bugstack.springframework.test.bean.Wife&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;husband&quot;</span> ref<span class="token operator">=</span><span class="token string">&quot;husband&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;mother&quot;</span> ref<span class="token operator">=</span><span class="token string">&quot;husbandMother&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
  
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;husbandMother&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;cn.bugstack.springframework.test.bean.HusbandMother&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token constant">AOP</span> é…ç½®ï¼ŒéªŒè¯ä¸‰çº§ç¼“å­˜ <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>bean <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;cn.bugstack.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;beforeAdvice&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;cn.bugstack.springframework.test.bean.SpouseAdvice&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;methodInterceptor&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;cn.bugstack.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;advice&quot;</span> ref<span class="token operator">=</span><span class="token string">&quot;beforeAdvice&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
  
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;pointcutAdvisor&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;cn.bugstack.springframework.aop.aspectj.AspectJExpressionPointcutAdvisor&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;expression&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;execution(* cn.bugstack.springframework.test.bean.Wife.*(..))&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;advice&quot;</span> ref<span class="token operator">=</span><span class="token string">&quot;methodInterceptor&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™ä¸ªé‡Œçš„é…ç½®å°±å¾ˆç®€å•äº†ï¼Œé…ç½®husbandä¾èµ–wifeï¼Œé…ç½®wifeä¾èµ–husbandå’Œmotherï¼Œæœ€åæ˜¯å…³äºAOPåˆ‡é¢çš„ä¾èµ–ä½¿ç”¨ã€‚</li></ul><h3 id="_3-å•å…ƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-å•å…ƒæµ‹è¯•" aria-hidden="true">#</a> 3. å•å…ƒæµ‹è¯•</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_circular</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ClassPathXmlApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:spring.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Husband</span> husband <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;husband&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Husband</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Wife</span> wife <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;wife&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Wife</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è€å…¬çš„åª³å¦‡ï¼š&quot;</span> <span class="token operator">+</span> husband<span class="token punctuation">.</span><span class="token function">queryWife</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;åª³å¦‡çš„è€å…¬ï¼š&quot;</span> <span class="token operator">+</span> wife<span class="token punctuation">.</span><span class="token function">queryHusband</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•ç»“æœ</strong></p><p><img src="https://bugstack.cn/assets/images/spring/spring-17-06.png" alt=""></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>è€å…¬çš„åª³å¦‡ï¼š<span class="token class-name">Husband</span><span class="token punctuation">.</span>wife
å…³æ€€å°ä¸¤å£<span class="token punctuation">(</span>åˆ‡é¢<span class="token punctuation">)</span>ï¼š<span class="token keyword">public</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span> <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span>Wife</span><span class="token punctuation">.</span><span class="token function">queryHusband</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
åª³å¦‡çš„è€å…¬ï¼š<span class="token class-name">Wife</span><span class="token punctuation">.</span>husbandã€<span class="token class-name">Mother</span><span class="token punctuation">.</span>callMotherï¼šå©šååª³å¦‡å¦ˆå¦ˆçš„èŒè´£è¢«å©†å©†ä»£ç†äº†ï¼callMother

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä»æµ‹è¯•ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯ç®€å•å¯¹è±¡ä¾èµ– <em>è€å…¬ä¾èµ–åª³å¦‡ã€åª³å¦‡ä¾èµ–è€å…¬</em>ï¼Œè¿˜æ˜¯ä»£ç†å·¥ç¨‹å¯¹è±¡æˆ–è€… AOP åˆ‡é¢å¯¹è±¡éƒ½å¯ä»¥åœ¨ä¸‰çº§ç¼“å­˜ä¸‹è§£å†³å¾ªç¯ä¾èµ–çš„é—®é¢˜äº†ã€‚</li><li>æ­¤å¤–ä»è¿è¡Œæˆªå›¾ <code>DefaultSingletonBeanRegistry#getSingleton</code> ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°å‡¡äº‹éœ€è¦ä¸‰çº§ç¼“å­˜å­˜æ”¾å·¥å‚å¯¹è±¡çš„ç±»ï¼Œéƒ½ä¼šä½¿ç”¨åˆ° getObject è·å–çœŸå®å¯¹è±¡ï¼Œå¹¶éšåå­˜å…¥åŠæˆå“å¯¹è±¡ earlySingletonObjects ä¸­ä»¥åŠç§»é™¤å·¥å‚å¯¹è±¡ã€‚</li></ul><h2 id="å…­ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#å…­ã€æ€»ç»“" aria-hidden="true">#</a> å…­ã€æ€»ç»“</h2><ul><li>Spring ä¸­æ‰€æœ‰çš„åŠŸèƒ½éƒ½æ˜¯ä»¥è§£å†³ Java ç¼–ç¨‹ä¸­çš„ç‰¹æ€§è€Œå­˜åœ¨çš„ï¼Œå°±åƒæˆ‘ä»¬æœ¬ç« èŠ‚å¤„ç†çš„å¾ªç¯ä¾èµ–ï¼Œå¦‚æœæ²¡æœ‰ Spring æ¡†æ¶çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½æˆ‘ä»¬ä¹Ÿä¼šå°½å¯èƒ½é¿å…å†™å‡ºå¾ªç¯ä¾èµ–çš„æ“ä½œï¼Œå› ä¸ºåœ¨æ²¡æœ‰ç»è¿‡åŠ å·¥å¤„ç†åï¼Œè¿™æ ·çš„ä¾èµ–å…³ç³»è‚¯å®šä¼šæŠ¥é”™çš„ã€‚<em>é‚£ä¹ˆè¿™ä¹Ÿå°±æ˜¯ç¨‹åºä»èƒ½ç”¨åˆ°å¥½ç”¨çš„å‡çº§</em></li><li>åœ¨è§£å†³å¾ªç¯ä¾èµ–çš„æ ¸å¿ƒæµç¨‹ä¸­ï¼Œä¸»è¦æ˜¯æå‰æš´éœ²å¯¹è±¡çš„è®¾è®¡ï¼Œä»¥åŠå»ºç«‹ä¸‰çº§ç¼“å­˜çš„æ•°æ®ç»“æ„æ¥å­˜æ”¾ä¸åŒæ—¶æœŸçš„å¯¹è±¡ï¼Œå¦‚æœè¯´æ²¡æœ‰å¦‚åˆ‡é¢å’Œå·¥å‚ä¸­çš„ä»£ç†å¯¹è±¡ï¼Œé‚£ä¹ˆäºŒçº§ç¼“å­˜ä¹Ÿå°±å¯ä»¥è§£å†³äº†ï¼Œå“ªæ€•æ˜¯åªæœ‰ä¸€çº§ç¼“å­˜ã€‚ä½†ä¸ºäº†è®¾è®¡ä¸Šçš„åˆç†å’Œå¯æ‰©å±•æ€§ï¼Œæ‰€ä»¥åˆ›å»ºäº†ä¸‰çº§ç¼“å­˜æ¥æ”¾ç½®ä¸åŒæ—¶æœŸçš„å¯¹è±¡ã€‚</li><li>é€šè¿‡è¿™æ ·çš„å­¦ä¹ ä¹Ÿå¯ä»¥æ€è€ƒğŸ¤”æˆ‘ä»¬åœ¨åšç¨‹åºè®¾è®¡æ—¶ï¼Œå°†è¦ä¸Šçº¿çš„åŠŸèƒ½æ˜¯å¦èƒ½å…¨é¢æ”¯æ’‘èµ·ä¸šåŠ¡çš„æ‹“å±•å’Œé¢‘ç¹å˜åŒ–çš„ç‰¹æ€§ï¼Œæœ‰æ—¶å€™è¿™äº›è®¾è®¡æ€è·¯æ˜¯å¯ä»¥å¸®æˆ‘ä»¬æ‹“å®½æ›´å¤šçš„æŠ€æœ¯è®¾è®¡è§†é‡ã€‚<em>è®°å¾—è¦å¤šåŠ ç»ƒä¹ ï¼</em></li></ul>`,64);function x(q,O){const a=p("ExternalLinkIcon");return o(),c("div",null,[u,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),r,s("åšå®¢ï¼š"),n("a",k,[s("https://bugstack.cn"),e(a)]),d,s("æ˜Ÿçƒï¼š"),n("a",v,[s("https://articles.zsxq.com/id_w629m13v0hni.html"),e(a)])]),m,b,n("ul",null,[n("li",null,[n("a",g,[s("ä¸‰çº§ç¼“å­˜å¤„ç†å¾ªç¯ä¾èµ– @Rechie"),e(a)])]),n("li",null,[n("a",f,[s("æ‰‹æ’•Spring-è§£å†³å¾ªç¯ä¾èµ–åŠ å±æ€§ç±»å‹è½¬åŒ– @Chin"),e(a)])]),n("li",null,[n("a",y,[s("ä¸‰çº§ç¼“å­˜å¾ªç¯ä¾èµ–æ¢³ç† @èµ›åšä¸çœŸ"),e(a)])]),n("li",null,[n("a",h,[s("å¾ªç¯ä¾èµ–ä¸»è¦åˆ†ä¸ºä¸‰ç§ï¼šè‡ªèº«ä¾èµ–è‡ªèº«ã€äº’ç›¸å¾ªç¯ä¾èµ–ã€å¤šç»„å¾ªç¯ä¾èµ–ã€‚@æ°´ä¸­ææœˆ"),e(a)])]),n("li",null,[n("a",j,[s("åœ¨å®ä¾‹åŒ–å…¶ä»–beanå¯¹è±¡ä¹‹å‰å¯¹ConversionServiceFactoryBeanå¯¹è±¡æå‰æ³¨å†Œ @Liuliuliu"),e(a)])]),n("li",null,[n("a",w,[s("å¾ªç¯ä¾èµ–æ˜¯ Spring é‡Œé¢å¾ˆé‡è¦çš„ä¸€ä¸ªè®¾è®¡ï¼Œå› ä¸ºå®ƒç”¨åˆ°äº†ä¸‰çº§ç¼“å­˜ @lucien"),e(a)])]),n("li",null,[n("a",B,[s("éœ€è¦å®ç°ä¸€ä¸ª ConversionServiceFactoryBean æ¥å¯¹ç±»å‹è½¬æ¢æœåŠ¡è¿›è¡Œæ“ä½œ @lucien"),e(a)])]),n("li",null,[n("a",A,[s("é€šè¿‡ä»£ç†å¯¹è±¡åˆ¤æ–­ï¼ŒClassUtils.isCglibProxyClass(aClass)? aClass.getSuperclass():aClass; å¤„ç†Cglibä»£ç†ä½¿ç”¨"),e(a)])])]),S])}const P=t(i,[["render",x],["__file","2021-08-07-di17zhangï¼šgongwubukeï¼Œtongguosanjihuancunjiejuexunhuanyilai.html.vue"]]);export{P as default};
