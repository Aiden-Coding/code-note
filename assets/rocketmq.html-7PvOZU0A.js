import{_ as p,r as o,o as c,c as l,a as n,b as s,d as t,e}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"rocketmq-ä½¿ç”¨æ•™ç¨‹å’Œæ¨¡å‹ç»“æ„",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#rocketmq-ä½¿ç”¨æ•™ç¨‹å’Œæ¨¡å‹ç»“æ„","aria-hidden":"true"},"#"),s(" RocketMQ ä½¿ç”¨æ•™ç¨‹å’Œæ¨¡å‹ç»“æ„")],-1),r=n("br",null,null,-1),k={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=n("blockquote",null,[n("p",null,"æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„")],-1),m=n("iframe",{id:"B-Video",src:"//player.bilibili.com/player.html?aid=956583991&bvid=BV1ap4y1G764&cid=1214781475&page=1",scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",width:"100%",height:"480"}," ",-1),v={href:"https://bugstack.cn/md/road-map/mybatis.html",target:"_blank",rel:"noopener noreferrer"},g=n("p",null,"æœ¬ç« ä¹Ÿä¼šåŒ…æ‹¬å…³äº MQ æ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶åº”è¯¥å¤„äº DDD çš„å“ªä¸€å±‚çš„å®è·µè®²è§£å’Œä½¿ç”¨ã€‚",-1),b=n("p",null,"æœ¬æ–‡æ¶‰åŠçš„å·¥ç¨‹ï¼š",-1),h={href:"https://gitcode.net/KnowledgePlanet/road-map/xfg-dev-tech-rocketmq",target:"_blank",rel:"noopener noreferrer"},q={href:"https://gitcode.net/KnowledgePlanet/road-map/xfg-dev-tech-rocketmq/-/blob/master/docs/rocketmq/rocketmq-docker-compose-mac-amd-arm.yml",target:"_blank",rel:"noopener noreferrer"},y={href:"https://gitcode.net/KnowledgePlanet/road-map/xfg-dev-tech-rocketmq/-/blob/master/docs/mysql/road-map.sql",target:"_blank",rel:"noopener noreferrer"},f=n("h2",{id:"ä¸€ã€æ¡ˆä¾‹èƒŒæ™¯",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ä¸€ã€æ¡ˆä¾‹èƒŒæ™¯","aria-hidden":"true"},"#"),s(" ä¸€ã€æ¡ˆä¾‹èƒŒæ™¯")],-1),_=n("code",null,"è§£è€¦è¿‡é•¿çš„ä¸šåŠ¡æµç¨‹",-1),S=n("code",null,"åº”å¯¹æµé‡å†²å‡»çš„æ¶ˆå³°",-1),A={href:"https://bugstack.cn/md/road-map/mybatis.html",target:"_blank",rel:"noopener noreferrer"},x=e('<div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-rocketmq-01.png" width="650px"></div><ul><li>ä»è–ªèµ„è°ƒæ•´åˆ°é‚®ä»¶å‘é€ï¼Œè¿™é‡Œæ˜¯2ä¸ªä¸šåŠ¡æµç¨‹ï¼Œé€šè¿‡ MQ æ¶ˆæ¯çš„æ–¹å¼è¿›è¡Œè¿æ¥ã€‚</li><li>å…¶å®MQæ¶ˆæ¯çš„ä½¿ç”¨åœºæ™¯ç‰¹åˆ«å¤šï¼ŒåŸæ¥ä½ å¯èƒ½ä½¿ç”¨å¤šçº¿ç¨‹çš„ä¸€äº›æ“ä½œï¼Œç°åœ¨å°±æ‰©å±•ä¸ºå¤šå®ä¾‹çš„æ“ä½œäº†ã€‚å‘é€ MQ æ¶ˆæ¯å‡ºæ¥ï¼Œè®©åº”ç”¨çš„å„ä¸ªå®ä¾‹æ¥æ”¶å¹¶è¿›è¡Œæ¶ˆè´¹ã€‚</li></ul><h2 id="äºŒã€é¢†åŸŸäº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#äºŒã€é¢†åŸŸäº‹ä»¶" aria-hidden="true">#</a> äºŒã€é¢†åŸŸäº‹ä»¶</h2><p>å› ä¸ºæˆ‘ä»¬æœ¬ç« æ‰€è®²è§£çš„å†…å®¹æ˜¯æŠŠ RocketMQ æ”¾å…¥ DDD æ¶æ„ä¸­è¿›è¡Œä½¿ç”¨ï¼Œé‚£ä¹ˆä¹Ÿå°±å¼•ç”³å‡ºé¢†åŸŸäº‹ä»¶å®šä¹‰ã€‚æ‰€ä»¥æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹ï¼Œä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶ã€‚</p><p>é¢†åŸŸäº‹ä»¶ï¼Œå¯ä»¥è¯´æ˜¯è§£è€¦å¾®æœåŠ¡è®¾è®¡çš„å…³é”®ã€‚é¢†åŸŸäº‹ä»¶ä¹Ÿæ˜¯é¢†åŸŸæ¨¡å‹ä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†å†…å®¹ï¼Œç”¨äºæ ‡ç¤ºå½“å‰é¢†åŸŸæ¨¡å‹ä¸­å‘ç”Ÿçš„äº‹ä»¶è¡Œä¸ºã€‚ä¸€ä¸ªé¢†åŸŸäº‹ä»¶ä¼šæ¨è¿›ä¸šåŠ¡æµç¨‹çš„è¿›ä¸€æ­¥æ“ä½œï¼Œåœ¨å®ç°ä¸šåŠ¡è§£è€¦çš„åŒæ—¶ï¼Œä¹Ÿæ¨åŠ¨äº†æ•´ä¸ªä¸šåŠ¡çš„é—­ç¯ã€‚</p><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-rocketmq-02.png" width="850px"></div><ul><li>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¢†åŸŸæ¨¡å‹å±‚ï¼Œæ·»åŠ ä¸€å— event åŒºåŸŸã€‚å®ƒçš„å­˜åœ¨æ˜¯ä¸ºäº†å®šä¹‰å‡ºäºå½“å‰é¢†åŸŸä¸‹æ‰€éœ€çš„äº‹ä»¶æ¶ˆæ¯ä¿¡æ¯ã€‚ä¿¡æ¯çš„ç±»å‹å¯ä»¥æ˜¯model ä¸‹çš„å®ä½“å¯¹è±¡ã€èšåˆå¯¹è±¡ã€‚</li><li>ä¹‹åï¼Œæ¶ˆæ¯çš„å‘é€æ˜¯æ”¾åœ¨åŸºç¡€è®¾ç½®å±‚ã€‚æœ¬èº«åŸºç¡€è®¾ç½®å±‚å°±æ˜¯ä¾èµ–å€’ç½®äºæ¨¡å‹å±‚ï¼Œæ‰€ä»¥åœ¨æ¨¡å‹å±‚æ‰€å®šä¹‰çš„ event å¯¹è±¡ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åœ¨åŸºç¡€è®¾ç½®å±‚ä½¿ç”¨ã€‚è€Œä¸”å¤§éƒ¨åˆ†å¼€å‘çš„æ—¶å€™ï¼ŒMQæ¶ˆæ¯çš„å‘é€ä¸æ•°æ®åº“æ“ä½œéƒ½æ˜¯å…³è”çš„ï¼Œé‡‡ç”¨çš„æ–¹å¼æ˜¯ï¼Œåšå®Œæ•°æ®è½åº“åï¼Œæ¨é€MQæ¶ˆæ¯ã€‚æ‰€ä»¥å®šä¹‰åœ¨ä»“å‚¨ä¸­å®ç°ï¼Œä¼šæ›´åŠ å¾—å¿ƒåº”æ‰‹ã€æ°´åˆ°æ¸ æˆã€‚</li><li>æœ€åï¼Œå°±æ˜¯ MQ çš„æ¶ˆæ¯ï¼ŒMQ çš„æ¶ˆè´¹å¯ä»¥æ˜¯è‡ªèº«æœåŠ¡æ‰€å‘å‡ºçš„æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤–éƒ¨å…¶ä»–å¾®æœåŠ¡çš„æ¶ˆæ¯ã€‚å°±åœ¨å°å‚…å“¥æ‰€æ•´ä½“è®²è¿°çš„è¿™å¥—ç®€æ˜æ•™ç¨‹ä¸­ DDD éƒ¨åˆ†çš„è§¦å‘å™¨å±‚ã€‚</li></ul><h2 id="ä¸‰ã€ç¯å¢ƒå®‰è£…" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€ç¯å¢ƒå®‰è£…" aria-hidden="true">#</a> ä¸‰ã€ç¯å¢ƒå®‰è£…</h2><p>æœ¬æ¡ˆä¾‹æ¶‰åŠäº†æ•°æ®åº“å’ŒRocketMQçš„ä½¿ç”¨ï¼Œéƒ½å·²ç»åœ¨å·¥ç¨‹ä¸­æä¾›äº†å®‰è£…è„šæœ¬ï¼Œå¯ä»¥æŒ‰éœ€æ‰§è¡Œã€‚</p><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-rocketmq-03.png" width="450px"></div><p>è¿™é‡Œä¸»è¦ä»‹ç» RocketMQ çš„å®‰è£…ï¼›</p><h3 id="_1-æ‰§è¡Œ-compose-yml" tabindex="-1"><a class="header-anchor" href="#_1-æ‰§è¡Œ-compose-yml" aria-hidden="true">#</a> 1. æ‰§è¡Œ compose yml</h3>',12),w=n("strong",null,"æ–‡ä»¶",-1),j={href:"https://gitcode.net/KnowledgePlanet/road-map/xfg-dev-tech-rocketmq/-/blob/master/docs/rocketmq/rocketmq-docker-compose-mac-amd-arm.yml",target:"_blank",rel:"noopener noreferrer"},M=e(`<div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3&#39;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token comment"># https://hub.docker.com/r/xuchengen/rocketmq</span>
  <span class="token comment"># æ³¨æ„ä¿®æ”¹é¡¹ï¼›</span>
  <span class="token comment"># 01ï¼šdata/rocketmq/conf/broker.conf æ·»åŠ  brokerIP1=127.0.0.1</span>
  <span class="token comment"># 02ï¼šdata/console/config/application.properties server.port=9009 - å¦‚æœ8080ç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥ä¿®æ”¹æˆ–è€…æ·»åŠ æ˜ å°„ç«¯å£</span>
  <span class="token key atrule">rocketmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> livinphp/rocketmq<span class="token punctuation">:</span>5.1.0
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> rocketmq
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 9009<span class="token punctuation">:</span><span class="token number">9009</span>
      <span class="token punctuation">-</span> 9876<span class="token punctuation">:</span><span class="token number">9876</span>
      <span class="token punctuation">-</span> 10909<span class="token punctuation">:</span><span class="token number">10909</span>
      <span class="token punctuation">-</span> 10911<span class="token punctuation">:</span><span class="token number">10911</span>
      <span class="token punctuation">-</span> 10912<span class="token punctuation">:</span><span class="token number">10912</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./data<span class="token punctuation">:</span>/home/app/data
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">TZ</span><span class="token punctuation">:</span> <span class="token string">&quot;Asia/Shanghai&quot;</span>
      <span class="token key atrule">NAMESRV_ADDR</span><span class="token punctuation">:</span> <span class="token string">&quot;rocketmq:9876&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨ IDEA ä¸­æ‰“å¼€ rocketmq-docker-compose-mac-amd-arm.yml ä½ ä¼šçœ‹åˆ°ä¸€ä¸ªç»¿è‰²çš„æŒ‰é’®åœ¨å·¦ä¾§ä¾§è¾¹æ ï¼Œç‚¹å‡»å³å¯å®‰è£…ã€‚æˆ–è€…ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤å®‰è£…ï¼š<code># /usr/local/bin/docker-compose -f /docs/dev-ops/environment/environment-docker-compose.yml up -d</code> - æ¯”è¾ƒé€‚åˆåœ¨äº‘æœåŠ¡å™¨ä¸Šæ‰§è¡Œã€‚</li><li>é¦–æ¬¡å®‰è£…å¯èƒ½ä½¿ç”¨ä¸äº†ï¼Œä¸€ä¸ªåŸå› æ˜¯ brokerIP1 æœªé…ç½®IPï¼Œå¦å¤–ä¸€ä¸ªæ˜¯é»˜è®¤çš„ 8080 ç«¯å£å ç”¨ã€‚å¯ä»¥æŒ‰ç…§å¦‚ä¸‹å°å‚…å“¥è¯´çš„æ–¹å¼ä¿®æ”¹ã€‚</li></ul><h3 id="_2-ä¿®æ”¹é»˜è®¤é…åˆ" tabindex="-1"><a class="header-anchor" href="#_2-ä¿®æ”¹é»˜è®¤é…åˆ" aria-hidden="true">#</a> 2. ä¿®æ”¹é»˜è®¤é…åˆ</h3><ol><li>æ‰“å¼€ <code>data/rocketmq/conf/broker.conf</code> æ·»åŠ ä¸€æ¡ <code>brokerIP1=127.0.0.1</code> åœ¨ç»“å°¾</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code># é›†ç¾¤åç§°
brokerClusterName <span class="token operator">=</span> <span class="token class-name">DefaultCluster</span>
# <span class="token constant">BROKER</span> åç§°
brokerName <span class="token operator">=</span> broker<span class="token operator">-</span>a
# <span class="token number">0</span> è¡¨ç¤º <span class="token class-name">Master</span><span class="token punctuation">,</span> <span class="token operator">&gt;</span> <span class="token number">0</span> è¡¨ç¤º <span class="token class-name">Slave</span>
brokerId <span class="token operator">=</span> <span class="token number">0</span>
# åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ <span class="token number">4</span> ç‚¹
deleteWhen <span class="token operator">=</span> <span class="token number">04</span>
# æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ <span class="token number">48</span> å°æ—¶
fileReservedTime <span class="token operator">=</span> <span class="token number">48</span>
# <span class="token constant">BROKER</span> è§’è‰² <span class="token constant">ASYNC_MASTER</span>ä¸ºå¼‚æ­¥ä¸»èŠ‚ç‚¹ï¼Œ<span class="token constant">SYNC_MASTER</span>ä¸ºåŒæ­¥ä¸»èŠ‚ç‚¹ï¼Œ<span class="token constant">SLAVE</span>ä¸ºä»èŠ‚ç‚¹
brokerRole <span class="token operator">=</span> <span class="token constant">ASYNC_MASTER</span>
# åˆ·æ–°æ•°æ®åˆ°ç£ç›˜çš„æ–¹å¼ï¼Œ<span class="token constant">ASYNC_FLUSH</span> åˆ·æ–°
flushDiskType <span class="token operator">=</span> <span class="token constant">ASYNC_FLUSH</span>
# å­˜å‚¨è·¯å¾„
storePathRootDir <span class="token operator">=</span> <span class="token operator">/</span>home<span class="token operator">/</span>app<span class="token operator">/</span>data<span class="token operator">/</span>rocketmq<span class="token operator">/</span>store
# <span class="token constant">IP</span>åœ°å€
brokerIP1 <span class="token operator">=</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>æ‰“å¼€ \`\`data/console/config/application.properties<code>ä¿®æ”¹</code>server.port=9009\` ç«¯å£ã€‚</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>server<span class="token punctuation">.</span>address<span class="token operator">=</span><span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span>
server<span class="token punctuation">.</span>port<span class="token operator">=</span><span class="token number">9009</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä¿®æ”¹é…ç½®åï¼Œé‡å¯æœåŠ¡ã€‚</li></ul><h3 id="_3-rockmqç™»å½•ä¸é…ç½®" tabindex="-1"><a class="header-anchor" href="#_3-rockmqç™»å½•ä¸é…ç½®" aria-hidden="true">#</a> 3. RockMQç™»å½•ä¸é…ç½®</h3><h4 id="_3-1-ç™»å½•" tabindex="-1"><a class="header-anchor" href="#_3-1-ç™»å½•" aria-hidden="true">#</a> 3.1 ç™»å½•</h4><p>RocketMQ æ­¤é•œåƒï¼Œä¼šåœ¨å®‰è£…ååœ¨æ§åˆ¶å°æ‰“å°ç™»å½•è´¦å·ä¿¡æ¯ï¼Œä½ å¯ä»¥æŸ¥çœ‹ä½¿ç”¨ã€‚</p><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-rocketmq-04.png" width="850px"></div><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-rocketmq-05.png" width="850px"></div>`,13),T={href:"http://localhost:9009/",target:"_blank",rel:"noopener noreferrer"},E=e(`<h4 id="_3-2-åˆ›å»ºtopic" tabindex="-1"><a class="header-anchor" href="#_3-2-åˆ›å»ºtopic" aria-hidden="true">#</a> 3.2 åˆ›å»ºTopic</h4><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-rocketmq-06.png" width="850px"></div><ul><li>ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤åˆ›å»ºï¼š<code>docker exec -it rocketmq sh /home/app/rocketmq/bin/mqadmin updateTopic -n localhost:9876 -c DefaultCluster -t xfg-mq</code></li></ul><h4 id="_3-3-åˆ›å»ºæ¶ˆè´¹è€…ç»„" tabindex="-1"><a class="header-anchor" href="#_3-3-åˆ›å»ºæ¶ˆè´¹è€…ç»„" aria-hidden="true">#</a> 3.3 åˆ›å»ºæ¶ˆè´¹è€…ç»„</h4><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-rocketmq-07.png" width="850px"></div><ul><li>ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤åˆ›å»ºï¼š<code>docker exec -it rocketmq sh /home/app/rocketmq/bin/mqadmin updateSubGroup -n localhost:9876 -c DefaultCluster -g xfg-group</code></li></ul><h2 id="å››ã€å·¥ç¨‹å®ç°" tabindex="-1"><a class="header-anchor" href="#å››ã€å·¥ç¨‹å®ç°" aria-hidden="true">#</a> å››ã€å·¥ç¨‹å®ç°</h2><h3 id="_1-å·¥ç¨‹ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1-å·¥ç¨‹ç»“æ„" aria-hidden="true">#</a> 1. å·¥ç¨‹ç»“æ„</h3><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-rocketmq-08.png" width="850px"></div><ul><li>MQ çš„ä½¿ç”¨æ— è®ºæ˜¯ RocketMQ è¿˜æ˜¯ Kafka ç­‰ï¼Œéƒ½å¾ˆç®€å•ã€‚ä½†åœ¨ä½¿ç”¨ä¹‹å‰ï¼Œè¦è€ƒè™‘å¥½æ€ä¹ˆåœ¨æ¶æ„ä¸­åˆç†çš„ä½¿ç”¨ã€‚å¦‚æœæœ€åˆæ²¡æœ‰å®šä¹‰å¥½è¿™äº›ï¼Œé‚£ä¹ˆèƒ¡ä¹±çš„ä»»ä½•åœ°æ–¹éƒ½èƒ½å‘é€å’Œæ¥æ”¶MQï¼Œæœ€åçš„å·¥ç¨‹å°†éå¸¸éš¾ä»¥ç»´æŠ¤ã€‚</li><li>æ‰€ä»¥è¿™é‡Œæ•´ä¸ªMQçš„ç”Ÿäº§å’Œæ¶ˆè´¹ï¼Œæ˜¯æŒ‰ç…§æ•´ä¸ª DDD é¢†åŸŸäº‹ä»¶ç»“æ„è¿›è¡Œè®¾è®¡ã€‚åˆ†ä¸ºåœ¨ domain ä½¿ç”¨åŸºç¡€å±‚ç”Ÿäº§æ¶ˆæ¯ï¼Œå†æœ‰ trigger å±‚æ¥æ”¶æ¶ˆæ¯ã€‚</li></ul><h3 id="_2-é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> 2. é…ç½®æ–‡ä»¶</h3><p><strong>å¼•å…¥POM</strong></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.rocketmq/rocketmq-client-java --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-client-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.0.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ·»åŠ é…ç½®</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># RocketMQ é…ç½®</span>
<span class="token key atrule">rocketmq</span><span class="token punctuation">:</span>
  <span class="token key atrule">name-server</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">9876</span>
  <span class="token key atrule">consumer</span><span class="token punctuation">:</span>
    <span class="token key atrule">group</span><span class="token punctuation">:</span> xfg<span class="token punctuation">-</span>group
    <span class="token comment"># ä¸€æ¬¡æ‹‰å–æ¶ˆæ¯æœ€å¤§å€¼ï¼Œæ³¨æ„æ˜¯æ‹‰å–æ¶ˆæ¯çš„æœ€å¤§å€¼è€Œéæ¶ˆè´¹æœ€å¤§å€¼</span>
    <span class="token key atrule">pull-batch-size</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">producer</span><span class="token punctuation">:</span>
    <span class="token comment"># å‘é€åŒä¸€ç±»æ¶ˆæ¯çš„è®¾ç½®ä¸ºåŒä¸€ä¸ªgroupï¼Œä¿è¯å”¯ä¸€</span>
    <span class="token key atrule">group</span><span class="token punctuation">:</span> xfg<span class="token punctuation">-</span>group
    <span class="token comment"># å‘é€æ¶ˆæ¯è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤3000</span>
    <span class="token key atrule">sendMessageTimeout</span><span class="token punctuation">:</span> <span class="token number">10000</span>
    <span class="token comment"># å‘é€æ¶ˆæ¯å¤±è´¥é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤2</span>
    <span class="token key atrule">retryTimesWhenSendFailed</span><span class="token punctuation">:</span> <span class="token number">2</span>
    <span class="token comment"># å¼‚æ­¥æ¶ˆæ¯é‡è¯•æ­¤å¤„ï¼Œé»˜è®¤2</span>
    <span class="token key atrule">retryTimesWhenSendAsyncFailed</span><span class="token punctuation">:</span> <span class="token number">2</span>
    <span class="token comment"># æ¶ˆæ¯æœ€å¤§é•¿åº¦ï¼Œé»˜è®¤1024 * 1024 * 4(é»˜è®¤4M)</span>
    <span class="token key atrule">maxMessageSize</span><span class="token punctuation">:</span> <span class="token number">4096</span>
    <span class="token comment"># å‹ç¼©æ¶ˆæ¯é˜ˆå€¼ï¼Œé»˜è®¤4k(1024 * 4)</span>
    <span class="token key atrule">compressMessageBodyThreshold</span><span class="token punctuation">:</span> <span class="token number">4096</span>
    <span class="token comment"># æ˜¯å¦åœ¨å†…éƒ¨å‘é€å¤±è´¥æ—¶é‡è¯•å¦ä¸€ä¸ªbrokerï¼Œé»˜è®¤false</span>
    <span class="token key atrule">retryNextServer</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-å®šä¹‰é¢†åŸŸäº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#_3-å®šä¹‰é¢†åŸŸäº‹ä»¶" aria-hidden="true">#</a> 3. å®šä¹‰é¢†åŸŸäº‹ä»¶</h3><p><strong>æºç </strong>ï¼š<code>cn.bugstack.xfg.dev.tech.domain.salary.event.SalaryAdjustEvent</code></p><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-rocketmq-09.png" width="450px"></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@EqualsAndHashCode</span><span class="token punctuation">(</span>callSuper <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SalaryAdjustEvent</span> <span class="token keyword">extends</span> <span class="token class-name">BaseEvent</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AdjustSalaryApplyOrderAggregate</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">TOPIC</span> <span class="token operator">=</span> <span class="token string">&quot;xfg-mq&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SalaryAdjustEvent</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">AdjustSalaryApplyOrderAggregate</span> adjustSalaryApplyOrderAggregate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SalaryAdjustEvent</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SalaryAdjustEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        event<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">RandomStringUtils</span><span class="token punctuation">.</span><span class="token function">randomNumeric</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        event<span class="token punctuation">.</span><span class="token function">setTimestamp</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        event<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>adjustSalaryApplyOrderAggregate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> event<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ¯ä¸ªé¢†åŸŸçš„æ¶ˆæ¯ï¼Œéƒ½æœ‰é¢†åŸŸè‡ªå·±å®šä¹‰ã€‚å‘é€çš„æ—¶å€™å†äº¤ç»™åŸºç¡€è®¾æ–½å±‚æ¥å‘é€ã€‚</li></ul><h3 id="_4-æ¶ˆæ¯å‘é€" tabindex="-1"><a class="header-anchor" href="#_4-æ¶ˆæ¯å‘é€" aria-hidden="true">#</a> 4. æ¶ˆæ¯å‘é€</h3><p><strong>æºç </strong>ï¼š<code>cn.bugstack.xfg.dev.tech.infrastructure.event.EventPublisher</code></p><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-rocketmq-10.png" width="450px"></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EventPublisher</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Setter</span><span class="token punctuation">(</span>onMethod_ <span class="token operator">=</span> <span class="token annotation punctuation">@Autowired</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">RocketMQTemplate</span> rocketmqTemplate<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æ™®é€šæ¶ˆæ¯
     *
     * <span class="token keyword">@param</span> <span class="token parameter">topic</span>   ä¸»é¢˜
     * <span class="token keyword">@param</span> <span class="token parameter">message</span> æ¶ˆæ¯
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">publish</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">BaseEvent</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> mqMessage <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€MQæ¶ˆæ¯ topic:{} message:{}&quot;</span><span class="token punctuation">,</span> topic<span class="token punctuation">,</span> mqMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
            rocketmqTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> mqMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€MQæ¶ˆæ¯å¤±è´¥ topic:{} message:{}&quot;</span><span class="token punctuation">,</span> topic<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å¤§éƒ¨åˆ†MQå‘é€å¤±è´¥åï¼Œä¼šéœ€è¦ä»»åŠ¡è¡¥å¿</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * å»¶è¿Ÿæ¶ˆæ¯
     *
     * <span class="token keyword">@param</span> <span class="token parameter">topic</span>          ä¸»é¢˜
     * <span class="token keyword">@param</span> <span class="token parameter">message</span>        æ¶ˆæ¯
     * <span class="token keyword">@param</span> <span class="token parameter">delayTimeLevel</span> å»¶è¿Ÿæ—¶é•¿
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">publishDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">BaseEvent</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> message<span class="token punctuation">,</span> <span class="token keyword">int</span> delayTimeLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> mqMessage <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€MQå»¶è¿Ÿæ¶ˆæ¯ topic:{} message:{}&quot;</span><span class="token punctuation">,</span> topic<span class="token punctuation">,</span> mqMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
            rocketmqTemplate<span class="token punctuation">.</span><span class="token function">syncSend</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token class-name">MessageBuilder</span><span class="token punctuation">.</span><span class="token function">withPayload</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> delayTimeLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€MQå»¶è¿Ÿæ¶ˆæ¯å¤±è´¥ topic:{} message:{}&quot;</span><span class="token punctuation">,</span> topic<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å¤§éƒ¨åˆ†MQå‘é€å¤±è´¥åï¼Œä¼šéœ€è¦ä»»åŠ¡è¡¥å¿</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨åŸºç¡€è®¾æ–½å±‚æä¾› event äº‹ä»¶çš„å¤„ç†ï¼Œä¹Ÿå°±æ˜¯ MQ æ¶ˆæ¯çš„å‘é€ã€‚</li></ul><p><strong>æºç </strong>ï¼š<code>cn.bugstack.xfg.dev.tech.infrastructure.repository.SalaryAdjustRepository</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Resource</span>
<span class="token keyword">private</span> <span class="token class-name">EventPublisher</span> eventPublisher<span class="token punctuation">;</span>
    
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> timeout <span class="token operator">=</span> <span class="token number">350</span><span class="token punctuation">,</span> propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span><span class="token constant">REQUIRED</span><span class="token punctuation">,</span> isolation <span class="token operator">=</span> <span class="token class-name">Isolation</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">adjustSalary</span><span class="token punctuation">(</span><span class="token class-name">AdjustSalaryApplyOrderAggregate</span> adjustSalaryApplyOrderAggregate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		 
		<span class="token comment">// ... çœç•¥éƒ¨åˆ†ä»£ç  </span>

    eventPublisher<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token class-name">SalaryAdjustEvent</span><span class="token punctuation">.</span><span class="token constant">TOPIC</span><span class="token punctuation">,</span> <span class="token class-name">SalaryAdjustEvent</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>adjustSalaryApplyOrderAggregate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> orderId<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ SalaryAdjustRepository ä»“å‚¨çš„å®ç°ä¸­ï¼Œåšå®Œä¸šåŠ¡æµç¨‹å¼€å§‹å‘é€ MQ æ¶ˆæ¯ã€‚è¿™é‡Œæœ‰2ç‚¹è¦æ³¨æ„ï¼›</p><ol><li>æ¶ˆæ¯å‘é€ï¼Œä¸è¦å†™åœ¨æ•°æ®åº“äº‹åŠ¡ä¸­ã€‚å› ä¸ºäº‹åŠ¡ä¸€ç›´å ç”¨æ•°æ®åº“è¿æ¥ï¼Œéœ€è¦å¿«é€Ÿé‡Šæ”¾ã€‚</li><li>å¯¹äºä¸€äº›å¼ºMQè¦æ±‚çš„åœºæ™¯ï¼Œéœ€è¦åœ¨å‘é€MQå‰ï¼Œå†™å…¥ä¸€æ¡æ•°æ®åº“ Task è®°å½•ï¼Œå‘é€æ¶ˆæ¯åæ›´æ–° Task çŠ¶æ€ä¸ºæˆåŠŸã€‚å¦‚æœé•¿æ—¶é—´æœªæ›´æ–°æ•°æ®åº“çŠ¶æ€æˆ–è€…ä¸ºå¤±è´¥çš„ï¼Œåˆ™éœ€è¦ç”±ä»»åŠ¡è¡¥å¿è¿›è¡Œå¤„ç†ã€‚</li></ol><h3 id="_5-æ¶ˆè´¹æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#_5-æ¶ˆè´¹æ¶ˆæ¯" aria-hidden="true">#</a> 5. æ¶ˆè´¹æ¶ˆæ¯</h3><p><strong>æºç </strong>ï¼š<code>cn.bugstack.xfg.dev.tech.trigger.mq.SalaryAdjustMQListener</code></p><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-rocketmq-11.png" width="450px"></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RocketMQMessageListener</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">&quot;xfg-mq&quot;</span><span class="token punctuation">,</span> consumerGroup <span class="token operator">=</span> <span class="token string">&quot;xfg-group&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SalaryAdjustMQListener</span> <span class="token keyword">implements</span> <span class="token class-name">RocketMQListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ¥æ”¶åˆ°MQæ¶ˆæ¯ {}&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ¶ˆè´¹æ¶ˆæ¯ï¼Œé…ç½®æ¶ˆè´¹è€…ç»„åˆæ¶ˆè´¹çš„ä¸»é¢˜ï¼Œä¹‹åå°±å¯ä»¥æ¥æ”¶åˆ°æ¶ˆæ¯äº†ã€‚æ¥æ”¶ä»¥åä½ å¯ä»¥åšè‡ªå·±çš„ä¸šåŠ¡ï¼Œå¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œæ¶ˆæ¯ä¼šè¿›è¡Œé‡æ–°æ¥æ”¶å¤„ç†ã€‚</li></ul><h2 id="å…­ã€æµ‹è¯•éªŒè¯" tabindex="-1"><a class="header-anchor" href="#å…­ã€æµ‹è¯•éªŒè¯" aria-hidden="true">#</a> å…­ã€æµ‹è¯•éªŒè¯</h2><h3 id="_1-å•ç‹¬å‘é€æ¶ˆæ¯æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_1-å•ç‹¬å‘é€æ¶ˆæ¯æµ‹è¯•" aria-hidden="true">#</a> 1. å•ç‹¬å‘é€æ¶ˆæ¯æµ‹è¯•</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RocketMQTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Setter</span><span class="token punctuation">(</span>onMethod_ <span class="token operator">=</span> <span class="token annotation punctuation">@Autowired</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">RocketMQTemplate</span> rocketmqTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            rocketmqTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;xfg-mq&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æˆ‘æ˜¯æµ‹è¯•æ¶ˆæ¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™é‡Œæ–¹ä¾¿ä½ æ¥å‘é€æ¶ˆæ¯ï¼ŒéªŒè¯æµç¨‹ã€‚</li></ul><h3 id="_2-ä¸šåŠ¡æµç¨‹æ¶ˆæ¯éªŒè¯" tabindex="-1"><a class="header-anchor" href="#_2-ä¸šåŠ¡æµç¨‹æ¶ˆæ¯éªŒè¯" aria-hidden="true">#</a> 2. ä¸šåŠ¡æµç¨‹æ¶ˆæ¯éªŒè¯</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_execSalaryAdjust</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">AdjustSalaryApplyOrderAggregate</span> adjustSalaryApplyOrderAggregate <span class="token operator">=</span> <span class="token class-name">AdjustSalaryApplyOrderAggregate</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">employeeNumber</span><span class="token punctuation">(</span><span class="token string">&quot;10000001&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">orderId</span><span class="token punctuation">(</span><span class="token string">&quot;100908977676003&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">employeeEntity</span><span class="token punctuation">(</span><span class="token class-name">EmployeeEntity</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">employeeLevel</span><span class="token punctuation">(</span><span class="token class-name">EmployeePostVO</span><span class="token punctuation">.</span><span class="token constant">T3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">employeeTitle</span><span class="token punctuation">(</span><span class="token class-name">EmployeePostVO</span><span class="token punctuation">.</span><span class="token constant">T3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">employeeSalaryAdjustEntity</span><span class="token punctuation">(</span><span class="token class-name">EmployeeSalaryAdjustEntity</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">adjustTotalAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">adjustBaseAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">adjustMeritAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> orderId <span class="token operator">=</span> salaryAdjustApplyService<span class="token punctuation">.</span><span class="token function">execSalaryAdjust</span><span class="token punctuation">(</span>adjustSalaryApplyOrderAggregate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è°ƒè–ªæµ‹è¯• req: {} res: {}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>adjustSalaryApplyOrderAggregate<span class="token punctuation">)</span><span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">23</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">29.15</span><span class="token operator">:</span><span class="token number">40</span><span class="token operator">:</span><span class="token number">52.307</span> <span class="token punctuation">[</span>main            <span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name">HikariDataSource</span>       <span class="token operator">-</span> <span class="token class-name">HikariPool</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token class-name">Start</span> completed<span class="token punctuation">.</span>
<span class="token number">23</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">29.15</span><span class="token operator">:</span><span class="token number">40</span><span class="token operator">:</span><span class="token number">52.445</span> <span class="token punctuation">[</span>main            <span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name">EventPublisher</span>         <span class="token operator">-</span> å‘é€<span class="token constant">MQ</span>æ¶ˆæ¯ topic<span class="token operator">:</span>xfg<span class="token operator">-</span>mq message<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;data&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;employeeEntity&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;employeeLevel&quot;</span><span class="token operator">:</span><span class="token string">&quot;T3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;employeeTitle&quot;</span><span class="token operator">:</span><span class="token string">&quot;T3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;employeeNumber&quot;</span><span class="token operator">:</span><span class="token string">&quot;10000001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;employeeSalaryAdjustEntity&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;adjustBaseAmount&quot;</span><span class="token operator">:</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token string">&quot;adjustMeritAmount&quot;</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">&quot;adjustTotalAmount&quot;</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;orderId&quot;</span><span class="token operator">:</span><span class="token string">&quot;100908977676004&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;98117654515&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token string">&quot;2023-07-29 15:40:52.425&quot;</span><span class="token punctuation">}</span>
<span class="token number">23</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">29.15</span><span class="token operator">:</span><span class="token number">40</span><span class="token operator">:</span><span class="token number">52.517</span> <span class="token punctuation">[</span>main            <span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name">ISalaryAdjustApplyServiceTest</span> <span class="token operator">-</span> è°ƒè–ªæµ‹è¯• req<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">&quot;employeeEntity&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;employeeLevel&quot;</span><span class="token operator">:</span><span class="token string">&quot;T3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;employeeTitle&quot;</span><span class="token operator">:</span><span class="token string">&quot;T3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;employeeNumber&quot;</span><span class="token operator">:</span><span class="token string">&quot;10000001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;employeeSalaryAdjustEntity&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;adjustBaseAmount&quot;</span><span class="token operator">:</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token string">&quot;adjustMeritAmount&quot;</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">&quot;adjustTotalAmount&quot;</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;orderId&quot;</span><span class="token operator">:</span><span class="token string">&quot;100908977676004&quot;</span><span class="token punctuation">}</span> res<span class="token operator">:</span> <span class="token number">100908977676004</span>
<span class="token number">23</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">29.15</span><span class="token operator">:</span><span class="token number">40</span><span class="token operator">:</span><span class="token number">52.520</span> <span class="token punctuation">[</span><span class="token class-name">ConsumeMessageThread_1</span><span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name">SalaryAdjustMQListener</span> <span class="token operator">-</span> æ¥æ”¶åˆ°<span class="token constant">MQ</span>æ¶ˆæ¯ <span class="token punctuation">{</span><span class="token string">&quot;data&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;employeeEntity&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;employeeLevel&quot;</span><span class="token operator">:</span><span class="token string">&quot;T3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;employeeTitle&quot;</span><span class="token operator">:</span><span class="token string">&quot;T3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;employeeNumber&quot;</span><span class="token operator">:</span><span class="token string">&quot;10000001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;employeeSalaryAdjustEntity&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;adjustBaseAmount&quot;</span><span class="token operator">:</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token string">&quot;adjustMeritAmount&quot;</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">&quot;adjustTotalAmount&quot;</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;orderId&quot;</span><span class="token operator">:</span><span class="token string">&quot;100908977676004&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;98117654515&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token string">&quot;2023-07-29 15:40:52.425&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å½“æ‰§è¡Œä¸€æ¬¡åŠ è–ªè°ƒæ•´åï¼Œå°±ä¼šæ¥æ”¶åˆ°MQæ¶ˆæ¯äº†ã€‚</li></ul>`,42);function Q(I,R){const a=o("ExternalLinkIcon");return c(),l("div",null,[u,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),r,s("åšå®¢ï¼š"),n("a",k,[s("https://bugstack.cn"),t(a)])]),d,m,n("p",null,[s("æœ¬æ–‡çš„å®—æ—¨åœ¨äºé€šè¿‡ç®€å•å¹²å‡€å®è·µçš„æ–¹å¼æ•™ä¼šè¯»è€…ï¼Œä½¿ç”¨ Docker é…ç½® RocketMQ å¹¶åœ¨åŸºäº DDD åˆ†å±‚ç»“æ„çš„ SpringBoot å·¥ç¨‹ä¸­ä½¿ç”¨ RocketMQ æŠ€æœ¯ã€‚å› ä¸ºå¤§éƒ¨åˆ† MQ çš„å‘é€éƒ½æ˜¯åŸºäºç‰¹å®šä¸šåŠ¡åœºæ™¯çš„ï¼Œæ‰€ä»¥æœ¬ç« èŠ‚ä¹Ÿæ˜¯åŸºäº "),n("a",v,[s("ã€ŠMyBatis ä½¿ç”¨æ•™ç¨‹å’Œæ’ä»¶å¼€å‘ã€‹"),t(a)]),s(" ç« èŠ‚çš„æ‰©å±•ã€‚")]),g,b,n("ul",null,[n("li",null,[s("xfg-dev-tech-rocketmqï¼š"),n("a",h,[s("https://gitcode.net/KnowledgePlanet/road-map/xfg-dev-tech-rocketmq"),t(a)])]),n("li",null,[s("RocketMQ Docker å®‰è£…ï¼š"),n("a",q,[s("rocketmq-docker-compose-mac-amd-arm.yml"),t(a)])]),n("li",null,[s("å¯¼å…¥æµ‹è¯•åº“è¡¨ "),n("a",y,[s("road-map.sql"),t(a)])])]),f,n("p",null,[s("é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼ŒMQ æ¶ˆæ¯çš„ä½œç”¨æ˜¯ç”¨äºï¼›"),_,s("å’Œ"),S,s("ã€‚å¦‚ï¼›ç”¨æˆ·ä¸‹å•æ”¯ä»˜å®Œæˆåï¼Œæ‹¿åˆ°æ”¯ä»˜æ¶ˆæ¯æ¨åŠ¨åç»­çš„å‘è´§æµç¨‹ã€‚ä¹Ÿå¯ä»¥æ˜¯æˆ‘ä»¬åŸºäº "),n("a",A,[s("ã€ŠMyBatis ä½¿ç”¨æ•™ç¨‹å’Œæ’ä»¶å¼€å‘ã€‹"),t(a)]),s(" ä¸­çš„æ¡ˆä¾‹åœºæ™¯ï¼Œç»™é›‡å‘˜æå‡çº§åˆ«å’Œè–ªèµ„çš„æ—¶å€™ï¼Œä¹Ÿå‘é€ä¸€æ¡MQæ¶ˆæ¯ï¼Œç”¨äºå‘é€é‚®ä»¶é€šçŸ¥ç»™ç”¨æˆ·ã€‚")]),x,n("p",null,[w,s("ï¼š"),n("a",j,[s("docs/rocketmq/rocketmq-docker-compose-mac-amd-arm.yml"),t(a)]),s(" - å…³äºå®‰è£…å°å‚…å“¥æä¾›äº†ä¸åŒçš„é•œåƒï¼ŒåŒ…æ‹¬Macã€Mac M1ã€Windows å¯ä»¥æŒ‰éœ€é€‰æ‹©ä½¿ç”¨ã€‚")]),M,n("p",null,[s("ç™»å½•ï¼š"),n("a",T,[s("http://localhost:9009/"),t(a)])]),E])}const O=p(i,[["render",Q],["__file","rocketmq.html.vue"]]);export{O as default};
