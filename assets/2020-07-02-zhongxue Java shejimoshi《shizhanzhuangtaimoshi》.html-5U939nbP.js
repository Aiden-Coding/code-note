import{_ as e,r as c,o,c as l,a as n,b as s,d as t,e as p}from"./app-3RcBQnkC.js";const u={},i=n("h1",{id:"重学-java-设计模式-实战状态模式「模拟系统营销活动-状态流程审核发布上线场景」",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#重学-java-设计模式-实战状态模式「模拟系统营销活动-状态流程审核发布上线场景」","aria-hidden":"true"},"#"),s(" 重学 Java 设计模式：实战状态模式「模拟系统营销活动，状态流程审核发布上线场景」")],-1),k=n("br",null,null,-1),r={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=n("blockquote",null,[n("p",null,"沉淀、分享、成长，让自己和他人都能有所收获！😄")],-1),v=n("iframe",{id:"B-Video",src:"//player.bilibili.com/player.html?aid=683904414&bvid=BV1WU4y1S7uU&cid=716973391&page=1",scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",width:"100%",height:"480"}," ",-1),m=p('<h2 id="一、前言" tabindex="-1"><a class="header-anchor" href="#一、前言" aria-hidden="true">#</a> 一、前言</h2><p><code>写好代码三个关键点</code></p><p>如果把写代码想象成家里的软装，你肯定会想到家里需要有一个非常不错格局最好是南北通透的，买回来的家具最好是品牌保证质量的，之后呢是大小合适，不能摆放完了看着别扭。那么把这一过程抽象成写代码就是需要三个核心的关键点；<code>架构</code>(房间的格局)、<code>命名</code>(品牌和质量)、<code>注释</code>(尺寸大小说明书)，只有这三个点都做好才能完成出一套赏心悦目的<strong>家</strong>。</p><p><code>平原走码🐎易放难收</code></p><p>上学期间你写了多少代码？上班一年你能写多少代码？回家自己学习写了多少代码？个人素养的技术栈地基都是一块一块砖码出来的，写的越广越深，根基就越牢固。当根基牢固了以后在再上层建设就变得迎刃而解了，也更容易建设了。往往最难的就是一层一层阶段的突破，突破就像破壳一样，也像夯实地基，短时间看不到成绩，也看不出高度。但以后谁能走的稳，就靠着默默的沉淀。</p><p><code>技术传承的重要性</code></p><p>可能是现在时间节奏太快，一个需求下来恨不得当天就上线(<code>这个需求很简单，怎么实现我不管，明天上线！</code>)，导致团队的人都<code>很慌</code>、<code>很急</code>、<code>很累</code>、<code>很崩溃</code>，最终反反复复的人员更替，项目在这个过程中也交接了N次，文档不全、代码混乱、错综复杂，谁在后面接手也都只能修修补补，就像烂尾楼。这个没有传承、没有沉淀的项目，很难跟随业务的发展。最终！根基不牢，一地鸡毛。</p><h2 id="二、开发环境" tabindex="-1"><a class="header-anchor" href="#二、开发环境" aria-hidden="true">#</a> 二、开发环境</h2>',8),b=n("li",null,"JDK 1.8",-1),g=n("li",null,"Idea + Maven",-1),y=n("strong",null,"公众号",-1),S={href:"https://bugstack.cn/assets/images/qrcode.png",target:"_blank",rel:"noopener noreferrer"},f=n("code",null,"bugstack虫洞栈",-1),q=n("code",null,"源码下载",-1),w=p('<table><thead><tr><th>工程</th><th>描述</th></tr></thead><tbody><tr><td>itstack-demo-design-19-00</td><td>场景模拟工程；模拟营销活动操作服务(查询、审核)</td></tr><tr><td>itstack-demo-design-19-01</td><td>使用一坨代码实现业务需求</td></tr><tr><td>itstack-demo-design-19-02</td><td>通过设计模式优化改造代码，产生对比性从而学习</td></tr></tbody></table><h2 id="三、状态模式介绍" tabindex="-1"><a class="header-anchor" href="#三、状态模式介绍" aria-hidden="true">#</a> 三、状态模式介绍</h2><p><img src="https://bugstack.cn/assets/images/2020/itstack-demo-design-19-01.png" alt="状态模式，图片来自 refactoringguru.cn"></p>',3),h={href:"https://refactoringguru.cn/design-patterns/state",target:"_blank",rel:"noopener noreferrer"},I=p(`<p>状态模式描述的是一个行为下的多种状态变更，比如我们最常见的一个网站的页面，在你登录与不登录下展示的内容是略有差异的(<code>不登录不能展示个人信息</code>)，而这种<code>登录</code>与<code>不登录</code>就是我们通过改变<strong>状态</strong>，而让整个行为发生了变化。</p><p><img src="https://bugstack.cn/assets/images/2020/itstack-demo-design-19-02.png" alt="收音机&amp;放音机&amp;磁带机"></p><p>至少80后、90后的小伙伴基本都用过这种磁带放音机(<code>可能没有这个好看</code>)，它的上面是一排按钮，当放入磁带后，通过上面的按钮就可以让放音机播放磁带上的内容(<code>listen to 英语听力考试</code>)，而且有些按钮是互斥的，当在某个状态下才可以按另外的按钮(<code>这在设计模式里也是一个关键的点</code>)。</p><h2 id="四、案例场景模拟" tabindex="-1"><a class="header-anchor" href="#四、案例场景模拟" aria-hidden="true">#</a> 四、案例场景模拟</h2><p><img src="https://bugstack.cn/assets/images/2020/itstack-demo-design-19-03.png" alt="场景模拟；营销活动审核状态流转"></p><p><strong>在本案例中我们模拟营销活动审核状态流转场景(一个活动的上线是多个层级审核上线的)</strong></p><p>在上图中也可以看到我们的流程节点中包括了各个状态到下一个状态扭转的关联条件，比如；审核通过才能到活动中，而不能从编辑中直接到活动中，而这些状态的转变就是我们要完成的场景处理。</p><p>大部分程序员基本都开发过类似的业务场景，需要对活动或者一些配置需要审核后才能对外发布，而这个审核的过程往往会随着系统的重要程度而设立多级控制，来保证一个活动可以安全上线，避免造成资损。</p><p>当然有时候会用到一些审批流的过程配置，也是非常方便开发类似的流程的，也可以在配置中设定某个节点的审批人员。但这不是我们主要体现的点，在本案例中我们主要是模拟学习对一个活动的多个状态节点的审核控制。</p><h3 id="_1-场景模拟工程" tabindex="-1"><a class="header-anchor" href="#_1-场景模拟工程" aria-hidden="true">#</a> 1. 场景模拟工程</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>design<span class="token operator">-</span><span class="token number">19</span><span class="token operator">-</span><span class="token number">00</span>
└── src
    └── main
        └── java
            └── org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design
                ├── <span class="token class-name">ActivityInfo</span><span class="token punctuation">.</span>java
                ├── <span class="token class-name">Status</span><span class="token punctuation">.</span>java
                └── <span class="token class-name">ActivityService</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在这个模拟工程里我们提供了三个类，包括；状态枚举(<code>Status</code>)、活动对象(<code>ActivityInfo</code>)、活动服务(<code>ActivityService</code>)，三个服务类。</li><li>接下来我们就分别介绍三个类包括的内容。</li></ul><h3 id="_2-代码实现" tabindex="-1"><a class="header-anchor" href="#_2-代码实现" aria-hidden="true">#</a> 2. 代码实现</h3><h4 id="_2-1-基本活动信息" tabindex="-1"><a class="header-anchor" href="#_2-1-基本活动信息" aria-hidden="true">#</a> 2.1 基本活动信息</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActivityInfo</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> activityId<span class="token punctuation">;</span>    <span class="token comment">// 活动ID</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> activityName<span class="token punctuation">;</span>  <span class="token comment">// 活动名称</span>
    <span class="token keyword">private</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> status<span class="token punctuation">;</span>  <span class="token comment">// 活动状态</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> beginTime<span class="token punctuation">;</span>       <span class="token comment">// 开始时间</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> endTime<span class="token punctuation">;</span>         <span class="token comment">// 结束时间</span>
   
    <span class="token comment">// ...get/set</span>
<span class="token punctuation">}</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>一些基本的活动信息；活动ID、活动名称、活动状态、开始时间、结束时间。</li></ul><h4 id="_2-2-活动枚举状态" tabindex="-1"><a class="header-anchor" href="#_2-2-活动枚举状态" aria-hidden="true">#</a> 2.2 活动枚举状态</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Status</span> <span class="token punctuation">{</span>

    <span class="token comment">// 1创建编辑、2待审核、3审核通过(任务扫描成活动中)、4审核拒绝(可以撤审到编辑状态)、5活动中、6活动关闭、7活动开启(任务扫描成活动中)</span>
    <span class="token class-name">Editing</span><span class="token punctuation">,</span> <span class="token class-name">Check</span><span class="token punctuation">,</span> <span class="token class-name">Pass</span><span class="token punctuation">,</span> <span class="token class-name">Refuse</span><span class="token punctuation">,</span> <span class="token class-name">Doing</span><span class="token punctuation">,</span> <span class="token class-name">Close</span><span class="token punctuation">,</span> <span class="token class-name">Open</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>活动的枚举；1创建编辑、2待审核、3审核通过(任务扫描成活动中)、4审核拒绝(可以撤审到编辑状态)、5活动中、6活动关闭、7活动开启(任务扫描成活动中)</li></ul><h4 id="_2-3-活动服务接口" tabindex="-1"><a class="header-anchor" href="#_2-3-活动服务接口" aria-hidden="true">#</a> 2.3 活动服务接口</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActivityService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> statusMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 模拟查询活动信息</span>
        <span class="token class-name">ActivityInfo</span> activityInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActivityInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        activityInfo<span class="token punctuation">.</span><span class="token function">setActivityId</span><span class="token punctuation">(</span>activityId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        activityInfo<span class="token punctuation">.</span><span class="token function">setActivityName</span><span class="token punctuation">(</span><span class="token string">&quot;早起学习打卡领奖活动&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        activityInfo<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
        activityInfo<span class="token punctuation">.</span><span class="token function">setBeginTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        activityInfo<span class="token punctuation">.</span><span class="token function">setEndTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        statusMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 查询活动信息
     *
     * <span class="token keyword">@param</span> <span class="token parameter">activityId</span> 活动ID
     * <span class="token keyword">@return</span> 查询结果
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ActivityInfo</span> <span class="token function">queryActivityInfo</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 模拟查询活动信息</span>
        <span class="token class-name">ActivityInfo</span> activityInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActivityInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        activityInfo<span class="token punctuation">.</span><span class="token function">setActivityId</span><span class="token punctuation">(</span>activityId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        activityInfo<span class="token punctuation">.</span><span class="token function">setActivityName</span><span class="token punctuation">(</span><span class="token string">&quot;早起学习打卡领奖活动&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        activityInfo<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>statusMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>activityId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        activityInfo<span class="token punctuation">.</span><span class="token function">setBeginTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        activityInfo<span class="token punctuation">.</span><span class="token function">setEndTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> activityInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 查询活动状态
     *
     * <span class="token keyword">@param</span> <span class="token parameter">activityId</span> 活动ID
     * <span class="token keyword">@return</span> 查询结果
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryActivityStatus</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> statusMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>activityId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 执行状态变更
     *
     * <span class="token keyword">@param</span> <span class="token parameter">activityId</span>   活动ID
     * <span class="token keyword">@param</span> <span class="token parameter">beforeStatus</span> 变更前状态
     * <span class="token keyword">@param</span> <span class="token parameter">afterStatus</span>  变更后状态 b
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">execStatus</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> beforeStatus<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> afterStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>beforeStatus<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>statusMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>activityId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        statusMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> afterStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在这个静态类中提供了活动的查询和状态变更接口；<code>queryActivityInfo</code>、<code>queryActivityStatus</code>、<code>execStatus</code>。</li><li>同时使用Map的结构来记录活动ID和状态变化信息，另外还有init方法来初始化活动数据。实际的开发中这类信息基本都是从<code>数据库</code>或者<code>Redis</code>中获取。</li></ul><h2 id="五、用一坨坨代码实现" tabindex="-1"><a class="header-anchor" href="#五、用一坨坨代码实现" aria-hidden="true">#</a> 五、用一坨坨代码实现</h2><p><code>这里我们先使用最粗暴的方式来实现功能</code></p><p>对于这样各种状态的变更，最让我们直接想到的就是使用<code>if</code>和<code>else</code>进行判断处理。每一个状态可以流转到下一个什么状态，都可以使用嵌套的<code>if</code>实现。</p><h3 id="_1-工程结构" tabindex="-1"><a class="header-anchor" href="#_1-工程结构" aria-hidden="true">#</a> 1. 工程结构</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>design<span class="token operator">-</span><span class="token number">19</span><span class="token operator">-</span><span class="token number">01</span>
└── src
    └── main
        └── java
            └── org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design
                ├── <span class="token class-name">ActivityExecStatusController</span><span class="token punctuation">.</span>java
                └── <span class="token class-name">Result</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>整个实现的工程结构比较简单，只包括了两个类；<code>ActivityExecStatusController</code>、<code>Result</code>，一个是处理流程状态，另外一个是返回的对象。</li></ul><h3 id="_2-代码实现-1" tabindex="-1"><a class="header-anchor" href="#_2-代码实现-1" aria-hidden="true">#</a> 2. 代码实现</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActivityExecStatusController</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * 活动状态变更
     * 1. 编辑中 -&gt; 提审、关闭
     * 2. 审核通过 -&gt; 拒绝、关闭、活动中
     * 3. 审核拒绝 -&gt; 撤审、关闭
     * 4. 活动中 -&gt; 关闭
     * 5. 活动关闭 -&gt; 开启
     * 6. 活动开启 -&gt; 关闭
     *
     * <span class="token keyword">@param</span> <span class="token parameter">activityId</span>   活动ID
     * <span class="token keyword">@param</span> <span class="token parameter">beforeStatus</span> 变更前状态
     * <span class="token keyword">@param</span> <span class="token parameter">afterStatus</span>  变更后状态
     * <span class="token keyword">@return</span> 返回结果
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">execStatus</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> beforeStatus<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> afterStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// 1. 编辑中 -&gt; 提审、关闭</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Editing</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>beforeStatus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Check</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>afterStatus<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">Status<span class="token punctuation">.</span>Close</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>afterStatus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">execStatus</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> beforeStatus<span class="token punctuation">,</span> afterStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0000&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;变更状态成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;变更状态拒绝&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 2. 审核通过 -&gt; 拒绝、关闭、活动中</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Pass</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>beforeStatus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Refuse</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>afterStatus<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">Status<span class="token punctuation">.</span>Doing</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>afterStatus<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">Status<span class="token punctuation">.</span>Close</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>afterStatus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">execStatus</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> beforeStatus<span class="token punctuation">,</span> afterStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0000&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;变更状态成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;变更状态拒绝&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 3. 审核拒绝 -&gt; 撤审、关闭</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Refuse</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>beforeStatus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Editing</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>afterStatus<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">Status<span class="token punctuation">.</span>Close</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>afterStatus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">execStatus</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> beforeStatus<span class="token punctuation">,</span> afterStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0000&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;变更状态成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;变更状态拒绝&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 4. 活动中 -&gt; 关闭</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Doing</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>beforeStatus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Close</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>afterStatus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">execStatus</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> beforeStatus<span class="token punctuation">,</span> afterStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0000&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;变更状态成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;变更状态拒绝&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 5. 活动关闭 -&gt; 开启</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Close</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>beforeStatus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Open</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>afterStatus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">execStatus</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> beforeStatus<span class="token punctuation">,</span> afterStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0000&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;变更状态成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;变更状态拒绝&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 6. 活动开启 -&gt; 关闭</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Open</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>beforeStatus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Close</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>afterStatus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">execStatus</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> beforeStatus<span class="token punctuation">,</span> afterStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0000&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;变更状态成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;变更状态拒绝&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;非可处理的活动状态变更&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>这里我们只需要看一下代码实现的结构即可。从上到下是一整篇的<code>ifelse</code>，基本这也是大部分初级程序员的开发方式。</li><li>这样的面向过程式开发方式，对于不需要改动代码，也不需要二次迭代的，还是可以使用的(<code>但基本不可能不迭代</code>)。而且随着状态和需求变化，会越来越难以维护，后面的人也不好看懂并且很容易填充其他的流程进去。<code>越来越乱就是从点滴开始的</code></li></ul><h3 id="_3-测试验证" tabindex="-1"><a class="header-anchor" href="#_3-测试验证" aria-hidden="true">#</a> 3. 测试验证</h3><h4 id="_3-1-编写测试类" tabindex="-1"><a class="header-anchor" href="#_3-1-编写测试类" aria-hidden="true">#</a> 3.1 编写测试类</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 初始化数据</span>
    <span class="token class-name">String</span> activityId <span class="token operator">=</span> <span class="token string">&quot;100001&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Editing</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token class-name">ActivityExecStatusController</span> activityExecStatusController <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActivityExecStatusController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Result</span> resultRefuse <span class="token operator">=</span> activityExecStatusController<span class="token punctuation">.</span><span class="token function">execStatus</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Editing</span><span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Refuse</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;测试结果(编辑中To审核拒绝)：{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>resultRefuse<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                           

    <span class="token class-name">Result</span> resultCheck <span class="token operator">=</span> activityExecStatusController<span class="token punctuation">.</span><span class="token function">execStatus</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Editing</span><span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Check</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;测试结果(编辑中To提交审核)：{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>resultCheck<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>我们的测试代码包括了两个功能的验证，一个是从<code>编辑中</code>到<code>审核拒绝</code>，另外一个是从编辑中到<code>提交审核</code>。</li><li>因为从我们的场景流程中可以看到，编辑中的活动是不能直接到<code>审核拒绝</code>的，这中间还需要<code>提审</code>。</li></ul><h4 id="_3-2-测试结果" tabindex="-1"><a class="header-anchor" href="#_3-2-测试结果" aria-hidden="true">#</a> 3.2 测试结果</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">23</span><span class="token operator">:</span><span class="token number">24</span><span class="token operator">:</span><span class="token number">30.774</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> 测试结果<span class="token punctuation">(</span>编辑中<span class="token class-name">To</span>审核拒绝<span class="token punctuation">)</span>：<span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token operator">:</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;info&quot;</span><span class="token operator">:</span><span class="token string">&quot;变更状态拒绝&quot;</span><span class="token punctuation">}</span>
<span class="token number">23</span><span class="token operator">:</span><span class="token number">24</span><span class="token operator">:</span><span class="token number">30.778</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> 测试结果<span class="token punctuation">(</span>编辑中<span class="token class-name">To</span>提交审核<span class="token punctuation">)</span>：<span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token operator">:</span><span class="token string">&quot;0000&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;info&quot;</span><span class="token operator">:</span><span class="token string">&quot;变更状态成功&quot;</span><span class="token punctuation">}</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>从测试结果和我们的状态流程的流转中可以看到，是符合测试结果预期的。除了不好维护外，这样的开发过程还是蛮快的，但不建议这么搞！</li></ul><h2 id="六、状态模式重构代码" tabindex="-1"><a class="header-anchor" href="#六、状态模式重构代码" aria-hidden="true">#</a> 六、状态模式重构代码</h2><p><code>接下来使用状态模式来进行代码优化，也算是一次很小的重构。</code></p><p>重构的重点往往是处理掉<code>ifelse</code>，而想处理掉<code>ifelse</code>基本离不开<strong>接口</strong>与<strong>抽象类</strong>，另外还需要重新改造代码结构。</p><h3 id="_1-工程结构-1" tabindex="-1"><a class="header-anchor" href="#_1-工程结构-1" aria-hidden="true">#</a> 1. 工程结构</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>design<span class="token operator">-</span><span class="token number">19</span><span class="token operator">-</span><span class="token number">02</span>
└── src
    └── main
        └── java
            └── org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design
                ├── event
                │    ├── <span class="token class-name">CheckState</span><span class="token punctuation">.</span>java
                │    └── <span class="token class-name">CloseState</span><span class="token punctuation">.</span>java
                │    └── <span class="token class-name">DoingState</span><span class="token punctuation">.</span>java
                │    └── <span class="token class-name">EditingState</span><span class="token punctuation">.</span>java
                │    └── <span class="token class-name">OpenState</span><span class="token punctuation">.</span>java
                │    └── <span class="token class-name">PassState</span><span class="token punctuation">.</span>java
                │    └── <span class="token class-name">RefuseState</span><span class="token punctuation">.</span>java
                ├── <span class="token class-name">Result</span><span class="token punctuation">.</span>java
                ├── <span class="token class-name">State</span><span class="token punctuation">.</span>java
                └── <span class="token class-name">StateHandler</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>状态模式模型结构</strong></p><p><img src="https://bugstack.cn/assets/images/2020/itstack-demo-design-19-04.png" alt="状态模式模型结构"></p><ul><li>以上是状态模式的整个工程结构模型，State是一个抽象类，定义了各种操作接口(<code>提审、审核、拒审等</code>)。</li><li>右侧的不同颜色状态与我们场景模拟中的颜色保持一致，是各种状态流程流转的实现操作。这里的实现有一个关键点就是每一种状态到下一个状态，都分配到各个实现方法中控制，也就不需要<code>if</code>语言进行判断了。</li><li>最后是<code>StateHandler</code>对状态流程的统一处理，里面提供<code>Map</code>结构的各项服务接口调用，也就避免了使用<code>if</code>判断各项状态转变的流程。</li></ul><h3 id="_2-代码实现-2" tabindex="-1"><a class="header-anchor" href="#_2-代码实现-2" aria-hidden="true">#</a> 2. 代码实现</h3><h4 id="_2-1-定义状态抽象类" tabindex="-1"><a class="header-anchor" href="#_2-1-定义状态抽象类" aria-hidden="true">#</a> 2.1 定义状态抽象类</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * 活动提审
     *
     * <span class="token keyword">@param</span> <span class="token parameter">activityId</span>    活动ID
     * <span class="token keyword">@param</span> <span class="token parameter">currentStatus</span> 当前状态
     * <span class="token keyword">@return</span> 执行结果
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Result</span> <span class="token function">arraignment</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 审核通过
     *
     * <span class="token keyword">@param</span> <span class="token parameter">activityId</span>    活动ID
     * <span class="token keyword">@param</span> <span class="token parameter">currentStatus</span> 当前状态
     * <span class="token keyword">@return</span> 执行结果
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Result</span> <span class="token function">checkPass</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 审核拒绝
     *
     * <span class="token keyword">@param</span> <span class="token parameter">activityId</span>    活动ID
     * <span class="token keyword">@param</span> <span class="token parameter">currentStatus</span> 当前状态
     * <span class="token keyword">@return</span> 执行结果
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Result</span> <span class="token function">checkRefuse</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 撤审撤销
     *
     * <span class="token keyword">@param</span> <span class="token parameter">activityId</span>    活动ID
     * <span class="token keyword">@param</span> <span class="token parameter">currentStatus</span> 当前状态
     * <span class="token keyword">@return</span> 执行结果
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Result</span> <span class="token function">checkRevoke</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 活动关闭
     *
     * <span class="token keyword">@param</span> <span class="token parameter">activityId</span>    活动ID
     * <span class="token keyword">@param</span> <span class="token parameter">currentStatus</span> 当前状态
     * <span class="token keyword">@return</span> 执行结果
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Result</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 活动开启
     *
     * <span class="token keyword">@param</span> <span class="token parameter">activityId</span>    活动ID
     * <span class="token keyword">@param</span> <span class="token parameter">currentStatus</span> 当前状态
     * <span class="token keyword">@return</span> 执行结果
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Result</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 活动执行
     *
     * <span class="token keyword">@param</span> <span class="token parameter">activityId</span>    活动ID
     * <span class="token keyword">@param</span> <span class="token parameter">currentStatus</span> 当前状态
     * <span class="token keyword">@return</span> 执行结果
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Result</span> <span class="token function">doing</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在整个接口中提供了各项状态流转服务的接口，例如；活动提审、审核通过、审核拒绝、撤审撤销等7个方法。</li><li>在这些方法中所有的入参都是一样的，activityId(<code>活动ID</code>)、currentStatus(<code>当前状态</code>)，只有他们的具体实现是不同的。</li></ul><h4 id="_2-2-部分状态流转实现" tabindex="-1"><a class="header-anchor" href="#_2-2-部分状态流转实现" aria-hidden="true">#</a> 2.2 部分状态流转实现</h4><p><strong>编辑</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EditingState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">arraignment</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">execStatus</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> currentStatus<span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Check</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0000&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;活动提审成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">checkPass</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;编辑中不可审核通过&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">checkRefuse</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;编辑中不可审核拒绝&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">checkRevoke</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;编辑中不可撤销审核&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">execStatus</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> currentStatus<span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Close</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0000&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;活动关闭成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;非关闭活动不可开启&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">doing</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;编辑中活动不可执行活动中变更&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>提审</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CheckState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">arraignment</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;待审核状态不可重复提审&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">checkPass</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">execStatus</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> currentStatus<span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Pass</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0000&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;活动审核通过完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">checkRefuse</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">execStatus</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> currentStatus<span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Refuse</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0000&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;活动审核拒绝完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">checkRevoke</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">execStatus</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> currentStatus<span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Editing</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0000&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;活动审核撤销回到编辑中&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">execStatus</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> currentStatus<span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Close</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0000&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;活动审核关闭完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;非关闭活动不可开启&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">doing</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;待审核活动不可执行活动中变更&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>这里提供了两个具体实现类的内容，编辑状态和提审状态。</li><li>例如在这两个实现类中，<code>checkRefuse</code>这个方法对于不同的类中有不同的实现，也就是不同状态下能做的下一步流转操作已经可以在每一个方法中具体控制了。</li><li>其他5个类的操作是类似的具体就不在这里演示了，大部分都是重复代码。可以通过源码进行学习理解。</li></ul><h4 id="_2-3-状态处理服务" tabindex="-1"><a class="header-anchor" href="#_2-3-状态处理服务" aria-hidden="true">#</a> 2.3 状态处理服务</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StateHandler</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Enum</span><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">State</span><span class="token punctuation">&gt;</span></span> stateMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Enum</span><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">State</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">StateHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stateMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Check</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CheckState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 待审核</span>
        stateMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Close</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CloseState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 已关闭</span>
        stateMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Doing</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DoingState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 活动中</span>
        stateMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Editing</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">EditingState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 编辑中</span>
        stateMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Open</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OpenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 已开启</span>
        stateMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Pass</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PassState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 审核通过</span>
        stateMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Status<span class="token punctuation">.</span>Refuse</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">RefuseState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 审核拒绝</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">arraignment</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> stateMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>currentStatus<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arraignment</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> currentStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">checkPass</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> stateMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>currentStatus<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">checkPass</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> currentStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">checkRefuse</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> stateMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>currentStatus<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">checkRefuse</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> currentStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">checkRevoke</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> stateMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>currentStatus<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">checkRevoke</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> currentStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> stateMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>currentStatus<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> currentStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> stateMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>currentStatus<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> currentStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">doing</span><span class="token punctuation">(</span><span class="token class-name">String</span> activityId<span class="token punctuation">,</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">&gt;</span></span> currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> stateMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>currentStatus<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doing</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> currentStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>这是对状态服务的统一控制中心，可以看到在构造函数中提供了所有状态和实现的具体关联，放到Map数据结构中。</li><li>同时提供了不同名称的接口操作类，让外部调用方可以更加容易的使用此项功能接口，而不需要像在<code>itstack-demo-design-19-01</code>例子中还得传两个状态来判断。</li></ul><h3 id="_3-测试验证-1" tabindex="-1"><a class="header-anchor" href="#_3-测试验证-1" aria-hidden="true">#</a> 3. 测试验证</h3><h4 id="_3-1-编写测试类-editing2arraignment" tabindex="-1"><a class="header-anchor" href="#_3-1-编写测试类-editing2arraignment" aria-hidden="true">#</a> 3.1 编写测试类(Editing2Arraignment)</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_Editing2Arraignment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> activityId <span class="token operator">=</span> <span class="token string">&quot;100001&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Editing</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">StateHandler</span> stateHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StateHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Result</span> result <span class="token operator">=</span> stateHandler<span class="token punctuation">.</span><span class="token function">arraignment</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Editing</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;测试结果(编辑中To提审活动)：{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;活动信息：{} 状态：{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">queryActivityInfo</span><span class="token punctuation">(</span>activityId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">queryActivityInfo</span><span class="token punctuation">(</span>activityId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试结果</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">23</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">20.883</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> 测试结果<span class="token punctuation">(</span>编辑中<span class="token class-name">To</span>提审活动<span class="token punctuation">)</span>：<span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token operator">:</span><span class="token string">&quot;0000&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;info&quot;</span><span class="token operator">:</span><span class="token string">&quot;活动提审成功&quot;</span><span class="token punctuation">}</span>
<span class="token number">23</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">20.907</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> 活动信息：<span class="token punctuation">{</span><span class="token string">&quot;activityId&quot;</span><span class="token operator">:</span><span class="token string">&quot;100001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;activityName&quot;</span><span class="token operator">:</span><span class="token string">&quot;早起学习打卡领奖活动&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;beginTime&quot;</span><span class="token operator">:</span><span class="token number">1593694760892</span><span class="token punctuation">,</span><span class="token string">&quot;endTime&quot;</span><span class="token operator">:</span><span class="token number">1593694760892</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;Check&quot;</span><span class="token punctuation">}</span> 状态：<span class="token string">&quot;Check&quot;</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>测试编辑中To提审活动，的状态流转。</li></ul><h4 id="_3-2-编写测试类-editing2open" tabindex="-1"><a class="header-anchor" href="#_3-2-编写测试类-editing2open" aria-hidden="true">#</a> 3.2 编写测试类(Editing2Open)</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_Editing2Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> activityId <span class="token operator">=</span> <span class="token string">&quot;100001&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Editing</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">StateHandler</span> stateHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StateHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Result</span> result <span class="token operator">=</span> stateHandler<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Editing</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;测试结果(编辑中To开启活动)：{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;活动信息：{} 状态：{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">queryActivityInfo</span><span class="token punctuation">(</span>activityId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">queryActivityInfo</span><span class="token punctuation">(</span>activityId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试结果</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">23</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">36.904</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> 测试结果<span class="token punctuation">(</span>编辑中<span class="token class-name">To</span>开启活动<span class="token punctuation">)</span>：<span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token operator">:</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;info&quot;</span><span class="token operator">:</span><span class="token string">&quot;非关闭活动不可开启&quot;</span><span class="token punctuation">}</span>
<span class="token number">23</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">36.914</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> 活动信息：<span class="token punctuation">{</span><span class="token string">&quot;activityId&quot;</span><span class="token operator">:</span><span class="token string">&quot;100001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;activityName&quot;</span><span class="token operator">:</span><span class="token string">&quot;早起学习打卡领奖活动&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;beginTime&quot;</span><span class="token operator">:</span><span class="token number">1593694776907</span><span class="token punctuation">,</span><span class="token string">&quot;endTime&quot;</span><span class="token operator">:</span><span class="token number">1593694776907</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;Editing&quot;</span><span class="token punctuation">}</span> 状态：<span class="token string">&quot;Editing&quot;</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>测试编辑中To开启活动，的状态流转。</li></ul><h4 id="_3-3-编写测试类-refuse2doing" tabindex="-1"><a class="header-anchor" href="#_3-3-编写测试类-refuse2doing" aria-hidden="true">#</a> 3.3 编写测试类(Refuse2Doing)</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_Refuse2Doing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> activityId <span class="token operator">=</span> <span class="token string">&quot;100001&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Refuse</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">StateHandler</span> stateHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StateHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Result</span> result <span class="token operator">=</span> stateHandler<span class="token punctuation">.</span><span class="token function">doing</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Refuse</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;测试结果(拒绝To活动中)：{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;活动信息：{} 状态：{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">queryActivityInfo</span><span class="token punctuation">(</span>activityId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">queryActivityInfo</span><span class="token punctuation">(</span>activityId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试结果</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">23</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">46.339</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> 测试结果<span class="token punctuation">(</span>拒绝<span class="token class-name">To</span>活动中<span class="token punctuation">)</span>：<span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token operator">:</span><span class="token string">&quot;0001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;info&quot;</span><span class="token operator">:</span><span class="token string">&quot;审核拒绝不可执行活动为进行中&quot;</span><span class="token punctuation">}</span>
<span class="token number">23</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">46.352</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> 活动信息：<span class="token punctuation">{</span><span class="token string">&quot;activityId&quot;</span><span class="token operator">:</span><span class="token string">&quot;100001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;activityName&quot;</span><span class="token operator">:</span><span class="token string">&quot;早起学习打卡领奖活动&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;beginTime&quot;</span><span class="token operator">:</span><span class="token number">1593694786342</span><span class="token punctuation">,</span><span class="token string">&quot;endTime&quot;</span><span class="token operator">:</span><span class="token number">1593694786342</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;Refuse&quot;</span><span class="token punctuation">}</span> 状态：<span class="token string">&quot;Refuse&quot;</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>测试拒绝To活动中，的状态流转。</li></ul><h4 id="_3-4-编写测试类-refuse2revoke" tabindex="-1"><a class="header-anchor" href="#_3-4-编写测试类-refuse2revoke" aria-hidden="true">#</a> 3.4 编写测试类(Refuse2Revoke)</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_Refuse2Revoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> activityId <span class="token operator">=</span> <span class="token string">&quot;100001&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Refuse</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">StateHandler</span> stateHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StateHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Result</span> result <span class="token operator">=</span> stateHandler<span class="token punctuation">.</span><span class="token function">checkRevoke</span><span class="token punctuation">(</span>activityId<span class="token punctuation">,</span> <span class="token class-name">Status<span class="token punctuation">.</span>Refuse</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;测试结果(拒绝To撤审)：{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;活动信息：{} 状态：{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">queryActivityInfo</span><span class="token punctuation">(</span>activityId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token class-name">ActivityService</span><span class="token punctuation">.</span><span class="token function">queryActivityInfo</span><span class="token punctuation">(</span>activityId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试结果</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">23</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">50.197</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> 测试结果<span class="token punctuation">(</span>拒绝<span class="token class-name">To</span>撤审<span class="token punctuation">)</span>：<span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token operator">:</span><span class="token string">&quot;0000&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;info&quot;</span><span class="token operator">:</span><span class="token string">&quot;撤销审核完成&quot;</span><span class="token punctuation">}</span>
<span class="token number">23</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">50.208</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> 活动信息：<span class="token punctuation">{</span><span class="token string">&quot;activityId&quot;</span><span class="token operator">:</span><span class="token string">&quot;100001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;activityName&quot;</span><span class="token operator">:</span><span class="token string">&quot;早起学习打卡领奖活动&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;beginTime&quot;</span><span class="token operator">:</span><span class="token number">1593694810201</span><span class="token punctuation">,</span><span class="token string">&quot;endTime&quot;</span><span class="token operator">:</span><span class="token number">1593694810201</span><span class="token punctuation">,</span><span class="token string">&quot;status&quot;</span><span class="token operator">:</span><span class="token string">&quot;Editing&quot;</span><span class="token punctuation">}</span> 状态：<span class="token string">&quot;Editing&quot;</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>测试测试结果(拒绝To撤审)，的状态流转。</p></li><li><p><strong>综上</strong>以上四个测试类分别模拟了不同状态之间的<code>有效流转</code>和<code>拒绝流转</code>，不同的状态服务处理不同的服务内容。</p></li></ul><h2 id="七、总结" tabindex="-1"><a class="header-anchor" href="#七、总结" aria-hidden="true">#</a> 七、总结</h2><ul><li>从以上的两种方式对一个需求的实现中可以看到，在第二种使用设计模式处理后已经没有了<code>ifelse</code>，代码的结构也更加清晰易于扩展。这就是设计模式的好处，可以非常强大的改变原有代码的结构，让以后的扩展和维护都变得容易些。</li><li>在实现结构的编码方式上可以看到这不再是面向过程的编程，而是面向对象的结构。并且这样的设计模式满足了<code>单一职责</code>和<code>开闭原则</code>，当你只有满足这样的结构下才会发现代码的扩展是容易的，也就是增加和修改功能不会影响整体的变化。</li><li>但如果状态和各项流转较多像本文的案例中，就会产生较多的实现类。因此可能也会让代码的实现上带来了时间成本，因为如果遇到这样的场景可以按需评估投入回报率。主要点在于看是否经常修改、是否可以做成组件化、抽离业务与非业务功能。</li></ul>`,82);function R(_,x){const a=c("ExternalLinkIcon");return o(),l("div",null,[i,n("p",null,[s("作者：小傅哥 "),k,s("博客："),n("a",r,[s("https://bugstack.cn"),t(a)])]),d,v,m,n("ol",null,[b,g,n("li",null,[s("涉及工程三个，可以通过关注"),y,s("："),n("a",S,[f,t(a)]),s("，回复"),q,s("获取(打开获取的链接，找到序号18)")])]),w,n("ul",null,[n("li",null,[s("图片来自："),n("a",h,[s("https://refactoringguru.cn/design-patterns/state"),t(a)])])]),I])}const E=e(u,[["render",R],["__file","2020-07-02-zhongxue Java shejimoshi《shizhanzhuangtaimoshi》.html.vue"]]);export{E as default};
