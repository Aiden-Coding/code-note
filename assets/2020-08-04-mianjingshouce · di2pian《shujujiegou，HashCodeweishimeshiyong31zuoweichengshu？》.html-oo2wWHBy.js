import{_ as e,r as o,o as c,c as l,a as n,b as s,d as t,e as p}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"面经手册-·-第2篇《数据结构-hashcode为什么使用31作为乘数-》",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#面经手册-·-第2篇《数据结构-hashcode为什么使用31作为乘数-》","aria-hidden":"true"},"#"),s(" 面经手册 · 第2篇《数据结构，HashCode为什么使用31作为乘数？》")],-1),r=n("br",null,null,-1),k={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=n("blockquote",null,[n("p",null,"沉淀、分享、成长，让自己和他人都能有所收获！😄")],-1),m=n("h2",{id:"一、前言",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#一、前言","aria-hidden":"true"},"#"),s(" 一、前言")],-1),h={href:"https://bugstack.cn/interview/2020/07/28/%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C-%E5%BC%80%E7%AF%87-%E9%9D%A2%E8%AF%95%E5%AE%98%E9%83%BD%E9%97%AE%E6%88%91%E5%95%A5.html",target:"_blank",rel:"noopener noreferrer"},v=n("strong",null,"《面试官都问我啥》",-1),b={href:"https://bugstack.cn/interview/2020/07/30/%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C-%E7%AC%AC1%E7%AF%87-%E8%AE%A4%E7%9F%A5%E8%87%AA%E5%B7%B1%E7%9A%84%E6%8A%80%E6%9C%AF%E6%A0%88%E7%9B%B2%E5%8C%BA.html",target:"_blank",rel:"noopener noreferrer"},g=n("strong",null,"《认知自己的技术栈盲区》",-1),f=p('<p>在进入数据结构章节讲解之前可以先了解下，数据结构都有哪些，基本可以包括；<code>数组(Array)</code>、<code>栈(Stack)</code>、<code>队列(Queue)</code>、<code>链表(LinkList)</code>、<code>树(Tree)</code>、<code>散列表(Hash)</code>、<code>堆(Heap)</code>、<code>图(Graph)</code>。</p><p>而本文主要讲解的就是与散列表相关的<code>HashCode</code>，本来想先讲<code>HashMap</code>，但随着整理资料发现与<code>HashMap</code>的实现中，<code>HashCode</code>的散列占了很重要的一设计思路，所以最好把这部分知识补全，再往下讲解。</p><h2 id="二、面试题" tabindex="-1"><a class="header-anchor" href="#二、面试题" aria-hidden="true">#</a> 二、面试题</h2><p>说到HashCode的面试题，可能这是一个非常核心的了。其他考点；怎么实现散列、计算逻辑等，都可以通过这道题的学习了解相关知识。</p><p><strong>Why does Java&#39;s hashCode() in String use 31 as a multiplier?</strong></p><p><img src="https://bugstack.cn/assets/images/2020/interview/interview-3-01.png" alt=""></p><p><strong>这个问题其实☞指的就是，hashCode的计算逻辑中，为什么是31作为乘数。</strong></p><p><img src="https://bugstack.cn/assets/images/2020/interview/interview-3-02.png" alt=""></p><h2 id="三、资源下载" tabindex="-1"><a class="header-anchor" href="#三、资源下载" aria-hidden="true">#</a> 三、资源下载</h2>',9),w={href:"https://bugstack.cn/assets/images/qrcode.png",target:"_blank",rel:"noopener noreferrer"},_=n("code",null,"bugstack虫洞栈",-1),y=n("em",null,"回复下载后打开获得的链接，找到编号ID：19",-1),E=p(`<ol><li>HashCode 源码测试验证工程，<code>interview-03</code></li><li><strong>103976个英语单词库.txt</strong>，验证HashCode值</li><li><strong>HashCode散列分布.xlsx</strong>，散列和碰撞图表</li></ol><h2 id="四、源码讲解" tabindex="-1"><a class="header-anchor" href="#四、源码讲解" aria-hidden="true">#</a> 四、源码讲解</h2><h3 id="_1-固定乘积31在这用到了" tabindex="-1"><a class="header-anchor" href="#_1-固定乘积31在这用到了" aria-hidden="true">#</a> 1. 固定乘积31在这用到了</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 获取hashCode &quot;abc&quot;.hashCode();</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> h <span class="token operator">=</span> hash<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>h <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">char</span> val<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> value<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            h <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">*</span> h <span class="token operator">+</span> val<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        hash <span class="token operator">=</span> h<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> h<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在获取<code>hashCode</code>的源码中可以看到，有一个固定值<code>31</code>，在for循环每次执行时进行乘积计算，循环后的公式如下； <code>s[0]*31^(n-1) + s[1]*31^(n-2) + ... + s[n-1]</code></p><p><strong>那么这里为什么选择31作为乘积值呢？</strong></p><h3 id="_2-来自stackoverflow的回答" tabindex="-1"><a class="header-anchor" href="#_2-来自stackoverflow的回答" aria-hidden="true">#</a> 2. 来自stackoverflow的回答</h3>`,7),A=n("code",null,"stackoverflow",-1),x={href:"https://stackoverflow.com/questions/299304/why-does-javas-hashcode-in-string-use-31-as-a-multiplier",target:"_blank",rel:"noopener noreferrer"},C=p(`<p><strong>413个赞👍的回答</strong></p><p>最多的这个回答是来自《Effective Java》的内容；</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">The</span> value <span class="token number">31</span> was chosen because it is an odd <span class="token class-name"><span class="token namespace">prime<span class="token punctuation">.</span></span> If</span> it were even and the multiplication overflowed<span class="token punctuation">,</span> information would be lost<span class="token punctuation">,</span> as multiplication by <span class="token number">2</span> is equivalent <span class="token keyword">to</span> <span class="token namespace">shifting<span class="token punctuation">.</span></span> <span class="token class-name">The</span> advantage of using a prime is less clear<span class="token punctuation">,</span> but it is <span class="token class-name"><span class="token namespace">traditional<span class="token punctuation">.</span></span> A</span> nice property of <span class="token number">31</span> is that the multiplication can be replaced by a shift and a subtraction <span class="token keyword">for</span> better performance<span class="token operator">:</span> <span class="token number">31</span> <span class="token operator">*</span> i <span class="token operator">==</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token class-name"><span class="token namespace">i<span class="token punctuation">.</span></span> Modern</span> <span class="token class-name">VMs</span> <span class="token keyword">do</span> <span class="token keyword">this</span> sort of optimization automatically<span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这段内容主要阐述的观点包括；</p><ol><li>31 是一个奇质数，如果选择偶数会导致乘积运算时数据溢出。</li><li>另外在二进制中，2个5次方是32，那么也就是 <code>31 * i == (i &lt;&lt; 5) - i</code>。这主要是说乘积运算可以使用位移提升性能，同时目前的JVM虚拟机也会自动支持此类的优化。</li></ol><p><strong>80个赞👍的回答</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">As</span> <span class="token class-name">Goodrich</span> and <span class="token class-name">Tamassia</span> point out<span class="token punctuation">,</span> <span class="token class-name">If</span> you take over <span class="token number">50</span><span class="token punctuation">,</span><span class="token number">000</span> <span class="token class-name">English</span> words <span class="token punctuation">(</span>formed as the union of the word lists provided in two variants of <span class="token class-name">Unix</span><span class="token punctuation">)</span><span class="token punctuation">,</span> using the constants <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> and <span class="token number">41</span> will produce less than <span class="token number">7</span> collisions in each <span class="token class-name"><span class="token namespace">case<span class="token punctuation">.</span></span> Knowing</span> <span class="token keyword">this</span><span class="token punctuation">,</span> it should come as no surprise that many <span class="token class-name">Java</span> implementations choose one of these constants<span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>这个回答就很有实战意义了，告诉你用超过5万个单词计算hashCode，这个hashCode的运算使用31、33、37、39和41作为乘积，得到的碰撞结果，31被使用就很正常了。</li><li><strong>他这句话就就可以作为我们实践的指向了。</strong></li></ul><h3 id="_3-hash值碰撞概率统计" tabindex="-1"><a class="header-anchor" href="#_3-hash值碰撞概率统计" aria-hidden="true">#</a> 3. Hash值碰撞概率统计</h3><p>接下来要做的事情并不难，只是根据<code>stackoverflow</code>的回答，统计出不同的乘积数对10万个单词的hash计算结果。<em>10个单词表已提供，可以通过关注公众号：bugstack虫洞栈进行下载</em></p><h4 id="_3-1-读取单词字典表" tabindex="-1"><a class="header-anchor" href="#_3-1-读取单词字典表" aria-hidden="true">#</a> 3.1 读取单词字典表</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">1</span>	a	<span class="token string">&quot;n.(A)As 或 A&#39;s  安(ampere(a) art.一;n.字母A /[军] Analog.Digital,模拟/数字 /(=account of) 帐上&quot;</span>
<span class="token number">2</span>	aaal	<span class="token class-name">American</span> <span class="token class-name">Academy</span> of <span class="token class-name">Arts</span> and <span class="token class-name">Letters</span> 美国艺术和文学学会
<span class="token number">3</span>	aachen	 亚琛<span class="token punctuation">[</span>德意志联邦共和国西部城市<span class="token punctuation">]</span>
<span class="token number">4</span>	aacs	<span class="token class-name">Airways</span> and <span class="token class-name">Air</span> <span class="token class-name">Communications</span> <span class="token class-name">Service</span> <span class="token punctuation">(</span>美国<span class="token punctuation">)</span>航路与航空通讯联络处
<span class="token number">5</span>	aah	<span class="token string">&quot; [军]Armored Artillery Howitzer,装甲榴弹炮;[军]Advanced Attack Helicopter,先进攻击直升机&quot;</span>
<span class="token number">6</span>	aal	<span class="token string">&quot;ATM Adaptation Layer,ATM适应层&quot;</span>
<span class="token number">7</span>	aapamoor	<span class="token string">&quot;n.[生]丘泽,高低位镶嵌沼泽&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>单词表的文件格式如上，可以自行解析</li><li>读取文件的代码比较简单，这里不展示了，可以通过<code>资源下载</code>进行获取</li></ul><h4 id="_3-2-hash计算函数" tabindex="-1"><a class="header-anchor" href="#_3-2-hash计算函数" aria-hidden="true">#</a> 3.2 Hash计算函数</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">,</span> <span class="token class-name">Integer</span> multiplier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        hash <span class="token operator">=</span> multiplier <span class="token operator">*</span> hash <span class="token operator">+</span> str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> hash<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>这个过程比较简单，与原hash函数对比只是替换了可变参数，用于我们统计不同乘积数的计算结果。</li></ul><h4 id="_3-3-hash碰撞概率计算" tabindex="-1"><a class="header-anchor" href="#_3-3-hash碰撞概率计算" aria-hidden="true">#</a> 3.3 Hash碰撞概率计算</h4><p>想计算碰撞很简单，也就是计算那些出现相同哈希值的数量，计算出碰撞总量即可。这里的实现方式有很多，可以使用<code>set</code>、<code>map</code>也可以使用<code>java8</code>的<code>stream</code>流统计<code>distinct</code>。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">RateInfo</span> <span class="token function">hashCollisionRate</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> multiplier<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> hashCodeList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> maxHash <span class="token operator">=</span> hashCodeList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">compareTo</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> minHash <span class="token operator">=</span> hashCodeList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">compareTo</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> collisionCount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>hashCodeList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> hashCodeList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> collisionRate <span class="token operator">=</span> <span class="token punctuation">(</span>collisionCount <span class="token operator">*</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> hashCodeList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RateInfo</span><span class="token punctuation">(</span>maxHash<span class="token punctuation">,</span> minHash<span class="token punctuation">,</span> multiplier<span class="token punctuation">,</span> collisionCount<span class="token punctuation">,</span> collisionRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>这里记录了最大hash和最小hash值，以及最终返回碰撞数量的统计结果。</li></ul><h4 id="_3-4-单元测试" tabindex="-1"><a class="header-anchor" href="#_3-4-单元测试" aria-hidden="true">#</a> 3.4 单元测试</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Before</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;abc&quot;</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 读取文件，103976个英语单词库.txt</span>
    words <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readWordList</span><span class="token punctuation">(</span><span class="token string">&quot;E:/itstack/git/github.com/interview/interview-01/103976个英语单词库.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_collisionRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RateInfo</span><span class="token punctuation">&gt;</span></span> rateInfoList <span class="token operator">=</span> <span class="token class-name">HashCode</span><span class="token punctuation">.</span><span class="token function">collisionRateList</span><span class="token punctuation">(</span>words<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">199</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">RateInfo</span> rate <span class="token operator">:</span> rateInfoList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;乘数 = %4d, 最小Hash = %11d, 最大Hash = %10d, 碰撞数量 =%6d, 碰撞概率 = %.4f%%&quot;</span><span class="token punctuation">,</span> rate<span class="token punctuation">.</span><span class="token function">getMultiplier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rate<span class="token punctuation">.</span><span class="token function">getMinHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rate<span class="token punctuation">.</span><span class="token function">getMaxHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rate<span class="token punctuation">.</span><span class="token function">getCollisionCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rate<span class="token punctuation">.</span><span class="token function">getCollisionRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>以上先设定读取英文单词表中的10个单词，之后做hash计算。</li><li>在hash计算中把单词表传递进去，同时还有乘积数；<code>2, 3, 5, 7, 17, 31, 32, 33, 39, 41, 199</code>，最终返回一个list结果并输出。</li><li>这里主要验证同一批单词，对于不同乘积数会有怎么样的hash碰撞结果。</li></ul><p><strong>测试结果</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>单词数量：<span class="token number">103976</span>
乘数 <span class="token operator">=</span>    <span class="token number">2</span><span class="token punctuation">,</span> 最小<span class="token class-name">Hash</span> <span class="token operator">=</span>          <span class="token number">97</span><span class="token punctuation">,</span> 最大<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token number">1842581979</span><span class="token punctuation">,</span> 碰撞数量 <span class="token operator">=</span> <span class="token number">60382</span><span class="token punctuation">,</span> 碰撞概率 <span class="token operator">=</span> <span class="token number">58.0730</span><span class="token operator">%</span>
乘数 <span class="token operator">=</span>    <span class="token number">3</span><span class="token punctuation">,</span> 最小<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2147308825</span><span class="token punctuation">,</span> 最大<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token number">2146995420</span><span class="token punctuation">,</span> 碰撞数量 <span class="token operator">=</span> <span class="token number">24300</span><span class="token punctuation">,</span> 碰撞概率 <span class="token operator">=</span> <span class="token number">23.3708</span><span class="token operator">%</span>
乘数 <span class="token operator">=</span>    <span class="token number">5</span><span class="token punctuation">,</span> 最小<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2147091606</span><span class="token punctuation">,</span> 最大<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token number">2147227581</span><span class="token punctuation">,</span> 碰撞数量 <span class="token operator">=</span>  <span class="token number">7994</span><span class="token punctuation">,</span> 碰撞概率 <span class="token operator">=</span> <span class="token number">7.6883</span><span class="token operator">%</span>
乘数 <span class="token operator">=</span>    <span class="token number">7</span><span class="token punctuation">,</span> 最小<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2147431389</span><span class="token punctuation">,</span> 最大<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token number">2147226363</span><span class="token punctuation">,</span> 碰撞数量 <span class="token operator">=</span>  <span class="token number">3826</span><span class="token punctuation">,</span> 碰撞概率 <span class="token operator">=</span> <span class="token number">3.6797</span><span class="token operator">%</span>
乘数 <span class="token operator">=</span>   <span class="token number">17</span><span class="token punctuation">,</span> 最小<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2147238638</span><span class="token punctuation">,</span> 最大<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token number">2147101452</span><span class="token punctuation">,</span> 碰撞数量 <span class="token operator">=</span>   <span class="token number">576</span><span class="token punctuation">,</span> 碰撞概率 <span class="token operator">=</span> <span class="token number">0.5540</span><span class="token operator">%</span>
乘数 <span class="token operator">=</span>   <span class="token number">31</span><span class="token punctuation">,</span> 最小<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2147461248</span><span class="token punctuation">,</span> 最大<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token number">2147444544</span><span class="token punctuation">,</span> 碰撞数量 <span class="token operator">=</span>     <span class="token number">2</span><span class="token punctuation">,</span> 碰撞概率 <span class="token operator">=</span> <span class="token number">0.0019</span><span class="token operator">%</span>
乘数 <span class="token operator">=</span>   <span class="token number">32</span><span class="token punctuation">,</span> 最小<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2007883634</span><span class="token punctuation">,</span> 最大<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token number">2074238226</span><span class="token punctuation">,</span> 碰撞数量 <span class="token operator">=</span> <span class="token number">34947</span><span class="token punctuation">,</span> 碰撞概率 <span class="token operator">=</span> <span class="token number">33.6106</span><span class="token operator">%</span>
乘数 <span class="token operator">=</span>   <span class="token number">33</span><span class="token punctuation">,</span> 最小<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2147469046</span><span class="token punctuation">,</span> 最大<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token number">2147378587</span><span class="token punctuation">,</span> 碰撞数量 <span class="token operator">=</span>     <span class="token number">1</span><span class="token punctuation">,</span> 碰撞概率 <span class="token operator">=</span> <span class="token number">0.0010</span><span class="token operator">%</span>
乘数 <span class="token operator">=</span>   <span class="token number">39</span><span class="token punctuation">,</span> 最小<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2147463635</span><span class="token punctuation">,</span> 最大<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token number">2147443239</span><span class="token punctuation">,</span> 碰撞数量 <span class="token operator">=</span>     <span class="token number">0</span><span class="token punctuation">,</span> 碰撞概率 <span class="token operator">=</span> <span class="token number">0.0000</span><span class="token operator">%</span>
乘数 <span class="token operator">=</span>   <span class="token number">41</span><span class="token punctuation">,</span> 最小<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2147423916</span><span class="token punctuation">,</span> 最大<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token number">2147441721</span><span class="token punctuation">,</span> 碰撞数量 <span class="token operator">=</span>     <span class="token number">1</span><span class="token punctuation">,</span> 碰撞概率 <span class="token operator">=</span> <span class="token number">0.0010</span><span class="token operator">%</span>
乘数 <span class="token operator">=</span>  <span class="token number">199</span><span class="token punctuation">,</span> 最小<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2147459902</span><span class="token punctuation">,</span> 最大<span class="token class-name">Hash</span> <span class="token operator">=</span> <span class="token number">2147480320</span><span class="token punctuation">,</span> 碰撞数量 <span class="token operator">=</span>     <span class="token number">0</span><span class="token punctuation">,</span> 碰撞概率 <span class="token operator">=</span> <span class="token number">0.0000</span><span class="token operator">%</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/assets/images/2020/interview/interview-3-03.png" alt="公众号：bugstack虫洞栈，hash碰撞图表"></p><p>以上就是不同的乘数下的hash碰撞结果图标展示，从这里可以看出如下信息；</p><ol><li>乘数是2时，hash的取值范围比较小，基本是堆积到一个范围内了，后面内容会看到这块的展示。</li><li>乘数是3、5、7、17等，都有较大的碰撞概率</li><li><strong>乘数是31的时候，碰撞的概率已经很小了，基本稳定。</strong></li><li>顺着往下看，你会发现199的碰撞概率更小，这就相当于一排奇数的茅坑量多，自然会减少碰撞。<strong>但这个范围值已经远超过int的取值范围了，如果用此数作为乘数，又返回int值，就会丢失数据信息</strong>。</li></ol><h3 id="_4-hash值散列分布" tabindex="-1"><a class="header-anchor" href="#_4-hash值散列分布" aria-hidden="true">#</a> 4. Hash值散列分布</h3><p>除了以上看到哈希值在不同乘数的一个碰撞概率后，关于散列表也就是hash，还有一个非常重要的点，那就是要尽可能的让数据散列分布。只有这样才能减少hash碰撞次数，也就是后面章节要讲到的hashMap源码。</p><p>那么怎么看散列分布呢？如果我们能把10万个hash值铺到图表上，形成的一张图，就可以看出整个散列分布。但是这样的图会比较大，当我们缩小看后，就成一个了大黑点。所以这里我们采取分段统计，把2 ^ 32方分64个格子进行存放，每个格子都会有对应的数量的hash值，最终把这些数据展示在图表上。</p><h4 id="_4-1-哈希值分段存放" tabindex="-1"><a class="header-anchor" href="#_4-1-哈希值分段存放" aria-hidden="true">#</a> 4.1 哈希值分段存放</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">hashArea</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> hashCodeList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> statistics <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> <span class="token number">0x80000000</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">0x7fffffff</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">67108864</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> min <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token keyword">long</span> max <span class="token operator">=</span> min <span class="token operator">+</span> <span class="token number">67108864</span><span class="token punctuation">;</span>
        <span class="token comment">// 筛选出每个格子里的哈希值数量，java8流统计；https://bugstack.cn/itstack-demo-any/2019/12/10/%E6%9C%89%E7%82%B9%E5%B9%B2%E8%B4%A7-Jdk1.8%E6%96%B0%E7%89%B9%E6%80%A7%E5%AE%9E%E6%88%98%E7%AF%87(41%E4%B8%AA%E6%A1%88%E4%BE%8B).html</span>
        <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> hashCodeList<span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>x <span class="token operator">-&gt;</span> x <span class="token operator">&gt;=</span> min <span class="token operator">&amp;&amp;</span> x <span class="token operator">&lt;</span> max<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        statistics<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>start<span class="token operator">++</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> statistics<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>这个过程主要统计<code>int</code>取值范围内，每个哈希值存放到不同格子里的数量。</li><li>这里也是使用了java8的新特性语法，统计起来还是比较方便的。</li></ul><h4 id="_4-2-单元测试" tabindex="-1"><a class="header-anchor" href="#_4-2-单元测试" aria-hidden="true">#</a> 4.2 单元测试</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_hashArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">HashCode</span><span class="token punctuation">.</span><span class="token function">hashArea</span><span class="token punctuation">(</span>words<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">HashCode</span><span class="token punctuation">.</span><span class="token function">hashArea</span><span class="token punctuation">(</span>words<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">HashCode</span><span class="token punctuation">.</span><span class="token function">hashArea</span><span class="token punctuation">(</span>words<span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">HashCode</span><span class="token punctuation">.</span><span class="token function">hashArea</span><span class="token punctuation">(</span>words<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">HashCode</span><span class="token punctuation">.</span><span class="token function">hashArea</span><span class="token punctuation">(</span>words<span class="token punctuation">,</span> <span class="token number">199</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>这里列出我们要统计的乘数值，每一个乘数下都会有对应的哈希值数量汇总，也就是64个格子里的数量。</li><li>最终把这些统计值放入到excel中进行图表化展示。</li></ul><p><strong>统计图表</strong></p><p><img src="https://bugstack.cn/assets/images/2020/interview/interview-3-04.png" alt="公众号：bugstack虫洞栈，hash散列表"></p><ul><li>以上是一个堆积百分比统计图，可以看到下方是不同乘数下的，每个格子里的数据统计。</li><li>除了199不能用以外，31的散列结果相对来说比较均匀。</li></ul><h5 id="_4-2-1-乘数2散列" tabindex="-1"><a class="header-anchor" href="#_4-2-1-乘数2散列" aria-hidden="true">#</a> 4.2.1 乘数2散列</h5><p><img src="https://bugstack.cn/assets/images/2020/interview/interview-3-05.png" alt=""></p><ul><li>乘数是2的时候，散列的结果基本都堆积在中间，没有很好的散列。</li></ul><h5 id="_4-2-2-乘数31散列" tabindex="-1"><a class="header-anchor" href="#_4-2-2-乘数31散列" aria-hidden="true">#</a> 4.2.2 乘数31散列</h5><p><img src="https://bugstack.cn/assets/images/2020/interview/interview-3-06.png" alt=""></p><ul><li>乘数是31的时候，散列的效果就非常明显了，基本在每个范围都有数据存放。</li></ul><h5 id="_4-2-3-乘数199散列" tabindex="-1"><a class="header-anchor" href="#_4-2-3-乘数199散列" aria-hidden="true">#</a> 4.2.3 乘数199散列</h5><p><img src="https://bugstack.cn/assets/images/2020/interview/interview-3-07.png" alt=""></p><ul><li>乘数是199是不能用的散列结果，但是它的数据是更加分散的，从图上能看到有两个小山包。但因为数据区间问题会有数据丢失问题，所以不能选择。</li></ul><p><strong>文中引用</strong></p><ul><li>http://www.tianxiaobo.com/2018/01/18/String-hashCode-%E6%96%B9%E6%B3%95%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9%E6%95%B0%E5%AD%9731%E4%BD%9C%E4%B8%BA%E4%B9%98%E5%AD%90/</li><li>https://stackoverflow.com/questions/299304/why-does-javas-hashcode-in-string-use-31-as-a-multiplier</li></ul><h2 id="五、总结" tabindex="-1"><a class="header-anchor" href="#五、总结" aria-hidden="true">#</a> 五、总结</h2><ul><li>以上主要介绍了hashCode选择31作为乘数的主要原因和实验数据验证，算是一个散列的数据结构的案例讲解，在后续的类似技术中，就可以解释其他的源码设计思路了。</li><li>看过本文至少应该让你可以从根本上解释了hashCode的设计，关于他的所有问题也就不需要死记硬背了，学习编程内容除了最开始的模仿到深入以后就需要不断的研究数学逻辑和数据结构。</li><li>文中参考了优秀的hashCode资料和stackoverflow，并亲自做实验验证结果，大家也可以下载本文中资源内容；英文字典、源码、excel图表等内容。</li></ul>`,53);function H(j,B){const a=o("ExternalLinkIcon");return c(),l("div",null,[u,n("p",null,[s("作者：小傅哥 "),r,s("博客："),n("a",k,[s("https://bugstack.cn"),t(a)])]),d,m,n("p",null,[s("在面经手册的前两篇介绍了"),n("a",h,[v,t(a)]),s("和"),n("a",b,[g,t(a)]),s("，这两篇内容主要为了说明面试过程的考查范围，包括个人的自我介绍、技术栈积累、项目经验等，以及在技术栈盲区篇章中介绍了一个整套技术栈在系统架构用的应用，以此全方面的扫描自己有哪些盲区还需要补充。而接下来的章节会以各个系列的技术栈中遇到的面试题作为切入点，讲解技术要点，了解技术原理，包括；数据结构、数据算法、技术栈、框架等进行逐步展开学习。")]),f,n("p",null,[s("本文讲解的过程中涉及部分源码等资源，可以通过关注公众号："),n("a",w,[_,t(a)]),s("，回复下载进行获取{"),y,s("}，包括；")]),E,n("p",null,[s("在"),A,s("关于为什么选择31作为固定乘积值，有一篇讨论文章，"),n("a",x,[s("Why does Java's hashCode() in String use 31 as a multiplier?"),t(a)]),s(" 这是一个时间比较久的问题了，摘取两个回答点赞最多的；")]),C])}const L=e(i,[["render",H],["__file","2020-08-04-mianjingshouce · di2pian《shujujiegou，HashCodeweishimeshiyong31zuoweichengshu？》.html.vue"]]);export{L as default};
