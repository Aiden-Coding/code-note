import{_ as t,r as e,o as p,c as o,a as n,b as s,d as c,e as i}from"./app-3RcBQnkC.js";const l={},u=n("h1",{id:"æºç åˆ†æ-åƒç›—å¢“ä¸€æ ·åˆ†æspringæ˜¯æ€ä¹ˆåˆå§‹åŒ–xmlå¹¶æ³¨å†Œbeançš„",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#æºç åˆ†æ-åƒç›—å¢“ä¸€æ ·åˆ†æspringæ˜¯æ€ä¹ˆåˆå§‹åŒ–xmlå¹¶æ³¨å†Œbeançš„","aria-hidden":"true"},"#"),s(" æºç åˆ†æ | åƒç›—å¢“ä¸€æ ·åˆ†æSpringæ˜¯æ€ä¹ˆåˆå§‹åŒ–xmlå¹¶æ³¨å†Œbeançš„")],-1),k=n("br",null,null,-1),r={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=i(`<blockquote><p>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„</p></blockquote><h2 id="ä¸€ã€å‰è¨€ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‰è¨€ä»‹ç»" aria-hidden="true">#</a> ä¸€ã€å‰è¨€ä»‹ç»</h2><p>å¾€å¾€ç®€å•çš„èƒŒåéƒ½æœ‰äººä¸ºä½ æ‰¿æ‹…ç€ä¸ç®€å•ï¼ŒSpring å°±æ˜¯è¿™æ ·çš„å®¶ä¼™ï¼è€Œåˆ†æå®ƒçš„æºç å°±åƒé¬¼å¹ç¯ï¼Œéœ€è¦å¯»é¾™ã€ç‚¹ç©´ã€åˆ†é‡‘ã€å®šä½ï¼Œæœ€åå¾€å¾€å—ç‚¹ä¼¤(æ—¶é—´)ã€æµç‚¹è¡€(ç²¾åŠ›)ã€æ‰èƒ½è·å¾—å®è—(æˆæœ)ã€‚</p><p>å¦å¤–é‰´äºä¹‹å‰åˆ†æspring-mybatisã€quartzï¼Œä¸€ç¯‡å†™äº†å°†è¿‘2ä¸‡å­—ï¼Œå†…å®¹è¿‡äºåˆé•¿åˆå¹²ï¼ŒæŒ–è—å¸ˆå¥½è¾›è‹¦ï¼Œçœ‹æˆçš„ä¹Ÿæ†‹ç€è‚¾ï¼Œæ‰€ä»¥è¿™æ¬¡åˆ†æspringæºç åˆ†å—è§£è¯»ï¼Œä¾¿äºç†è§£ã€ä¾¿äºæ¶ˆåŒ–ã€‚</p><p>é‚£ä¹ˆï¼Œè¿™ä¸€ç¯‡å°±ä» bean çš„åŠ è½½å¼€å§‹ï¼Œä» xml é…ç½®æ–‡ä»¶è§£æ bean çš„å®šä¹‰ï¼Œåˆ°æ³¨å†Œåˆ° Spring çš„æ ¸å¿ƒç±» DefaultListableBeanFactory ï¼Œç›—å¢“è¿‡ç¨‹å¦‚ä¸‹ï¼›</p><p><img src="https://bugstack.cn/assets/images/pic-content/2019/11/itstack-demo-code-spring-02.png" alt="å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ &amp; ç›—å¢“"></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ä» xml è§£æå‡º bean åˆ°æ³¨å†Œå®Œæˆéœ€è¦ç»å†è¿‡8ä¸ªæ ¸å¿ƒç±»ä»¥åŠ22ä¸ªæ–¹æ³•è·³è½¬æµç¨‹ï¼Œè¿™ä¹Ÿæ˜¯æœ¬æ–‡åé¢éœ€è¦é‡ç‚¹åˆ†æçš„å†…å®¹ã€‚å¥½ï¼é‚£ä¹ˆå°±å½“ä¸ºäº†ä½ çš„<strong>é’±ç¨‹</strong>ä¸€èµ·ç›—å¢“å§ï¼</p><h2 id="äºŒã€æ¡ˆä¾‹å·¥ç¨‹" tabindex="-1"><a class="header-anchor" href="#äºŒã€æ¡ˆä¾‹å·¥ç¨‹" aria-hidden="true">#</a> äºŒã€æ¡ˆä¾‹å·¥ç¨‹</h2><p>å¯¹äºæºç åˆ†æä¸€å®šè¦å•ç‹¬åˆ—ä¸€ä¸ªç®€å•çš„å·¥ç¨‹ï¼Œä¸€é’ˆè§è¡€çš„æä½ æœ€éœ€è¦çš„åœ°æ–¹ï¼Œæ¨¡æ‹Ÿã€éªŒè¯ã€è°ƒè¯•ã€‚ç°åœ¨è¿™ä¸ªæ¡ˆä¾‹å·¥ç¨‹è¿˜å¾ˆç®€å•ï¼Œéšç€åé¢åˆ†æå†…å®¹çš„å¢åŠ ï¼Œä¼šä¸æ–­çš„æ‰©å……ã€‚æ•´ä½“å·¥ç¨‹å¯ä»¥ä¸‹è½½ï¼Œå¯ä»¥å…³æ³¨å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ | å›å¤ï¼šæºç åˆ†æ</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>code<span class="token operator">-</span>spring
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â”œâ”€â”€ java
    â”‚   â”‚   â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo
    â”‚   â”‚       â””â”€â”€ <span class="token class-name">UserService</span><span class="token punctuation">.</span>java   
    â”‚   â””â”€â”€ resources	
    â”‚       â””â”€â”€ spring<span class="token operator">-</span>config<span class="token punctuation">.</span>xml
    â””â”€â”€ test
         â””â”€â”€ java
             â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test			
                 â””â”€â”€ <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä¸‰ã€ç¯å¢ƒé…ç½®" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€ç¯å¢ƒé…ç½®" aria-hidden="true">#</a> ä¸‰ã€ç¯å¢ƒé…ç½®</h2><ol><li>JDK 1.8</li><li>IDEA 2019.3.1</li><li>Spring 4.3.24.RELEASE</li></ol><h2 id="å››ã€æºç åˆ†æ" tabindex="-1"><a class="header-anchor" href="#å››ã€æºç åˆ†æ" aria-hidden="true">#</a> å››ã€æºç åˆ†æ</h2><p>æ•´ä¸ª bean æ³¨å†Œè¿‡ç¨‹æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼›é…ç½®æ–‡ä»¶åŠ è½½ã€å·¥å‚åˆ›å»ºã€XMLè§£æã€Beanå®šä¹‰ã€Beanæ³¨å†Œï¼Œæ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼›</p><p><img src="https://bugstack.cn/assets/images/pic-content/2019/11/itstack-demo-code-spring-01.png" alt="å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ &amp; ç›—å¢“"></p><p>ä»ä¸Šå›¾çš„æ³¨å†Œ bean æµç¨‹çœ‹åˆ°ï¼Œæ ¸å¿ƒç±»åŒ…æ‹¬ï¼›</p><ul><li>ClassPathXmlApplicationContext</li><li>AbstractXmlApplicationContext</li><li>AbstractRefreshableApplicationContext</li><li>AbstractXmlApplicationContext</li><li>AbstractBeanDefinitionReader</li><li>XmlBeanDefinitionReader</li><li>DefaultBeanDefinitionDocumentReader</li><li>DefaultListableBeanFactory</li></ul><p>å¥½ï¼æ‘¸é‡‘åˆ†é‡‘å®šç©´å®Œäº‹ï¼Œæ¬å±±çš„æ¬å±±ã€å¸å²­çš„å¸å²­ï¼Œå¼€å§‹æï¼</p><h3 id="_1-å…ˆæ‰”ä¸ª-helloworld-æµ‹è¯•ä¸‹" tabindex="-1"><a class="header-anchor" href="#_1-å…ˆæ‰”ä¸ª-helloworld-æµ‹è¯•ä¸‹" aria-hidden="true">#</a> 1. å…ˆæ‰”ä¸ª helloworld æµ‹è¯•ä¸‹</h3><blockquote><p>UserService.java &amp; å®šä¹‰ä¸€ä¸ª beanï¼ŒSpring ä¸‡ç‰©çš†å¯ bean</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">queryUserInfo</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;èŠ±èŠ± idï¼š&quot;</span> <span class="token operator">+</span> userId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>spring-config.xml &amp; åœ¨ xml é…ç½® bean å†…å®¹</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">&quot;http://www.springframework.org/schema/beans&quot;</span>
       xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span><span class="token string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span>
       <span class="token keyword">default</span><span class="token operator">-</span>autowire<span class="token operator">=</span><span class="token string">&quot;byName&quot;</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;userService&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;org.itstack.demo.UserService&quot;</span> scope<span class="token operator">=</span><span class="token string">&quot;singleton&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ApiTest.java &amp; å•å…ƒæµ‹è¯•ç±»</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_XmlBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">BeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlBeanFactory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;spring-config.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">UserService</span> userService <span class="token operator">=</span> beanFactory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">,</span> <span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•ç»“æœï¼š{}&quot;</span><span class="token punctuation">,</span> userService<span class="token punctuation">.</span><span class="token function">queryUserInfo</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">BeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;spring-config.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">UserService</span> userService <span class="token operator">=</span> beanFactory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">,</span> <span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•ç»“æœï¼š{}&quot;</span><span class="token punctuation">,</span> userService<span class="token punctuation">.</span><span class="token function">queryUserInfo</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸¤ä¸ªå•æµ‹æ–¹æ³•éƒ½å¯ä»¥åšç»“æœè¾“å‡ºï¼Œä½†æ˜¯ XmlBeanFactory å·²ç»æ ‡è®°ä¸º @Deprecated å°±æ˜¯å‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªå¢“ç©´å•¥ä¹Ÿæ²¡æœ‰äº†ï¼Œè¢«ç›—è¿‡äº†ï¼Œåˆ«çœ‹äº†ã€‚å¥½ï¼æˆ‘ä»¬ä¹Ÿä¸çœ‹ä»–äº†ï¼Œæˆ‘ä»¬çœ‹ç°åœ¨æ¨èçš„2å·å¢“ ClassPathXmlApplicationContext</p><p>å¦‚ä¸Šä¸å‡ºæ„å¤–æ­£ç¡®ç»“æœå¦‚ä¸‹ï¼›</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">23</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">24.699</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼šèŠ±èŠ± idï¼š<span class="token number">1000</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-æŠŠ-xml-è§£æè¿‡ç¨‹æå®š" tabindex="-1"><a class="header-anchor" href="#_2-æŠŠ-xml-è§£æè¿‡ç¨‹æå®š" aria-hidden="true">#</a> 2. æŠŠ xml è§£æè¿‡ç¨‹æå®š</h3><p>åœ¨æ•´ä¸ª bean çš„æ³¨å†Œè¿‡ç¨‹ä¸­ï¼Œxml è§£ææ˜¯éå¸¸å¤§çš„ä¸€å—ï¼Œä¹Ÿæ˜¯éå¸¸é‡è¦çš„ä¸€å—ã€‚å¦‚æœé¡ºç€ bean å·¥å‚åˆå§‹åŒ–åˆ†æï¼Œé‚£ä¹ˆä¸€å±‚å±‚æ‰’å¼€ï¼Œå°±åƒé™ˆç‰æ¥¼å¢“ç©´æŒ–åˆ°ä¸€åŠï¼Œé‡åˆ°å¤§èœˆèš£ä¸€æ ·éš¾ç¼ ã€‚æ‰€ä»¥æˆ‘ä»¬å…ˆæŠŠèœˆèš£æå®šï¼</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_DocumentLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    
	<span class="token comment">// è®¾ç½®èµ„æº</span>
    <span class="token class-name">EncodedResource</span> encodedResource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EncodedResource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;spring-config.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
	<span class="token comment">// åŠ è½½è§£æ</span>
    <span class="token class-name">InputSource</span> inputSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputSource</span><span class="token punctuation">(</span>encodedResource<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DocumentLoader</span> documentLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultDocumentLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Document</span> doc <span class="token operator">=</span> documentLoader<span class="token punctuation">.</span><span class="token function">loadDocument</span><span class="token punctuation">(</span>inputSource<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ResourceEntityResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PathMatchingResourcePatternResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
	<span class="token comment">// è¾“å‡ºç»“æœ</span>
    <span class="token class-name">Element</span> root <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getDocumentElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">NodeList</span> nodeList <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">getChildNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nodeList<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Node</span> node <span class="token operator">=</span> nodeList<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>node <span class="token keyword">instanceof</span> <span class="token class-name">Element</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token class-name">Element</span> ele <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> node<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;bean&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>ele<span class="token punctuation">.</span><span class="token function">getNodeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> id <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> clazz <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> scope <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;scope&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•ç»“æœ beanNameï¼š{} beanClassï¼š{} scopeï¼š{}&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> clazz<span class="token punctuation">,</span> scope<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯èƒ½åˆæ¬¡çœ‹è¿™æ®µä»£ç è¿˜æ˜¯æœ‰ç‚¹æ™•çš„ï¼Œä½†è¿™æ ·æç‚¼å‡ºæ¥å•ç‹¬è§£å†³ï¼Œè‡³å°‘ç»™ä½ ä¸€ç§æœ‰æŠ“æ‰‹çš„æ„Ÿè§‰ã€‚åœ¨ spring è§£æ xml æ—¶å€™é¦–å…ˆæ˜¯å°†é…ç½®èµ„æºäº¤ç»™ ClassPathResource ï¼Œå†é€šè¿‡æ„é€ å‡½æ•°ä¼ é€’ç»™ EncodedResourceï¼›</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">EncodedResource</span><span class="token punctuation">(</span><span class="token class-name">Resource</span> resource<span class="token punctuation">,</span> <span class="token class-name">String</span> encoding<span class="token punctuation">,</span> <span class="token class-name">Charset</span> charset<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> <span class="token string">&quot;Resource must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>resource <span class="token operator">=</span> resource<span class="token punctuation">;</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>encoding <span class="token operator">=</span> encoding<span class="token punctuation">;</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>charset <span class="token operator">=</span> charset<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šè¿™ä¸ªè¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œåªæ˜¯ä¸€ä¸ªåˆå§‹åŒ–è¿‡ç¨‹ã€‚æ¥ä¸‹æ¥æ˜¯é€šè¿‡ Document è§£æå¤„ç† xml æ–‡ä»¶ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯ä»¿ç…§ spring åˆ›å»ºæ—¶å€™éœ€è¦çš„å‚æ•°ä¿¡æ¯è¿›è¡Œç»„è£…ï¼Œå¦‚ä¸‹ï¼›</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>documentLoader<span class="token punctuation">.</span><span class="token function">loadDocument</span><span class="token punctuation">(</span>inputSource<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ResourceEntityResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PathMatchingResourcePatternResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token class-name">Document</span> <span class="token function">loadDocument</span><span class="token punctuation">(</span><span class="token class-name">InputSource</span> inputSource<span class="token punctuation">,</span> <span class="token class-name">EntityResolver</span> entityResolver<span class="token punctuation">,</span>
		<span class="token class-name">ErrorHandler</span> errorHandler<span class="token punctuation">,</span> <span class="token keyword">int</span> validationMode<span class="token punctuation">,</span> <span class="token keyword">boolean</span> namespaceAware<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
	<span class="token class-name">DocumentBuilderFactory</span> factory <span class="token operator">=</span> <span class="token function">createDocumentBuilderFactory</span><span class="token punctuation">(</span>validationMode<span class="token punctuation">,</span> namespaceAware<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Using JAXP provider [&quot;</span> <span class="token operator">+</span> factory<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token class-name">DocumentBuilder</span> builder <span class="token operator">=</span> <span class="token function">createDocumentBuilder</span><span class="token punctuation">(</span>factory<span class="token punctuation">,</span> entityResolver<span class="token punctuation">,</span> errorHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>inputSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä¸Šé¢çš„ä»£ç è·å– org.w3c.dom.Document, Document é‡Œé¢æ­¤æ—¶åŒ…å«äº†æ‰€æœ‰ xml çš„å„ä¸ª Node èŠ‚ç‚¹ä¿¡æ¯ï¼Œæœ€åè¾“å‡ºèŠ‚ç‚¹å†…å®¹ï¼Œå¦‚ä¸‹ï¼›</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Element</span> root <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getDocumentElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">NodeList</span> nodeList <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">getChildNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¥½ï¼æµ‹è¯•ä¸€ä¸‹ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œç»“æœå¦‚ä¸‹ï¼›</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">23</span><span class="token operator">:</span><span class="token number">47</span><span class="token operator">:</span><span class="token number">00.249</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœ beanNameï¼šuserService beanClassï¼š<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span></span>UserService</span> scopeï¼šsingleton

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°çš„æˆ‘ä»¬çš„ xml é…ç½®å†…å®¹å·²ç»å®Œå®Œæ•´æ•´çš„å–å‡ºæ¥äº†ï¼Œæ¥ä¸‹æ¥å°±äº¤ç»™ spring è¿›è¡Œå¤„ç†äº†ã€‚çº¢å§‘å¨˜ã€é¹§é¸ªå“¨ã€å’±ä»¬å‡ºå‘ï¼</p><h3 id="_3-classpathxmlapplicationcontext-æ„é€ å‡½æ•°åˆå§‹åŒ–è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#_3-classpathxmlapplicationcontext-æ„é€ å‡½æ•°åˆå§‹åŒ–è¿‡ç¨‹" aria-hidden="true">#</a> 3. ClassPathXmlApplicationContext æ„é€ å‡½æ•°åˆå§‹åŒ–è¿‡ç¨‹</h3><blockquote><p>ClassPathXmlApplicationContext.java &amp; æˆªå–éƒ¨åˆ†ä»£ç </p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> configLocations<span class="token punctuation">,</span> <span class="token keyword">boolean</span> refresh<span class="token punctuation">,</span> <span class="token class-name">ApplicationContext</span> parent<span class="token punctuation">)</span>
		<span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
	<span class="token keyword">super</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setConfigLocations</span><span class="token punctuation">(</span>configLocations<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>refresh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>æºç 139è¡Œï¼š</strong> setConfigLocations è®¾ç½®æˆ‘ä»¬çš„é…ç½®çš„èµ„æºä½ç½®ä¿¡æ¯</li><li>é‡ç‚¹åœ¨ refresh() è¿™ä¸ªæ–¹æ³•é‡Œé¢å†…å®¹éå¸¸å¤šï¼Œéšç€æ–‡ç« çš„ç¼–å†™ä¼šé™†ç»­åˆ†æã€‚</li></ul><h3 id="_4-abstractapplicationcontext-åˆå§‹åŒ–å·¥å‚" tabindex="-1"><a class="header-anchor" href="#_4-abstractapplicationcontext-åˆå§‹åŒ–å·¥å‚" aria-hidden="true">#</a> 4. AbstractApplicationContext åˆå§‹åŒ–å·¥å‚</h3><blockquote><p>AbstractApplicationContext.java &amp; éƒ¨åˆ†ä»£ç æˆªå–</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalStateException</span> <span class="token punctuation">{</span>
	<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>startupShutdownMonitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// è®¾ç½®å®¹å™¨åˆå§‹åŒ–</span>
		<span class="token function">prepareRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">// è®©å­ç±»è¿›è¡Œ BeanFactory åˆå§‹åŒ–ï¼Œå¹¶ä¸”å°† Bean ä¿¡æ¯ è½¬æ¢ä¸º BeanFinitionï¼Œæœ€åæ³¨å†Œåˆ°å®¹å™¨ä¸­</span>
		<span class="token comment">// æ³¨æ„ï¼Œæ­¤æ—¶ Bean è¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼Œåªæ˜¯é…ç½®ä¿¡æ¯éƒ½æå–å‡ºæ¥äº†</span>
		<span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token function">obtainFreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>æºç 514è¡Œï¼š</strong> è¿™ä¸€è¡Œæ˜¯æˆ‘ä»¬é‡ç‚¹å¾€ååˆ†æçš„å†…å®¹ï¼Œå®ƒä¸»è¦å¼€å§‹å¤„ç† xml ä¸­ bean çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œä½†æ­¤æ—¶ä¸ä¼šæ³¨å†Œï¼Œæ„æ€å°±æ˜¯ä½ é€šè¿‡ beanFactory.getBean è¿˜è·å¾—ä¸åˆ°å†…å®¹</li></ul><blockquote><p>AbstractApplicationContext.java &amp; éƒ¨åˆ†ä»£ç æˆªå–</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">ConfigurableListableBeanFactory</span> <span class="token function">obtainFreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">refreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Bean factory for &quot;</span> <span class="token operator">+</span> <span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> beanFactory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™ä¸€å±‚æ–¹æ³•åœ¨å¤„ç†å®Œè§£æåè¿˜ä¼šè¿”å› bean å·¥å‚</li><li><strong>æºç 614è¡Œï¼š</strong> å›åˆ°æˆ‘ä»¬ä¸»çº¿ç»§ç»­åˆ†æè§£æè¿‡ç¨‹ï¼Œå¾€ä¸‹ä¸€å±‚ç»§ç»­çœ‹</li></ul><h3 id="_5-abstractrefreshableapplicationcontext-åˆ·æ–°ä¸Šä¸‹æ–‡" tabindex="-1"><a class="header-anchor" href="#_5-abstractrefreshableapplicationcontext-åˆ·æ–°ä¸Šä¸‹æ–‡" aria-hidden="true">#</a> 5. AbstractRefreshableApplicationContext åˆ·æ–°ä¸Šä¸‹æ–‡</h3><blockquote><p>AbstractRefreshableApplicationContext.java &amp; éƒ¨åˆ†ä»£ç æˆªå–</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">refreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">destroyBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">closeBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token class-name">DefaultListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token function">createBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		beanFactory<span class="token punctuation">.</span><span class="token function">setSerializationId</span><span class="token punctuation">(</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">customizeBeanFactory</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanFactoryMonitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory <span class="token operator">=</span> beanFactory<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ApplicationContextException</span><span class="token punctuation">(</span><span class="token string">&quot;I/O error parsing bean definition source for &quot;</span> <span class="token operator">+</span> <span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™é‡ŒåŒ…æ‹¬åˆ¤æ–­å¯¹ bean å·¥å‚åˆ¤æ–­çš„ä»¥åŠé”€æ¯å’Œåˆå§‹åŒ–åˆ›å»º</li><li><strong>æºç 129è¡Œï¼š</strong> loadBeanDefinitions(beanFactory);ï¼Œè·å– bean å·¥å‚åç»§ç»­æˆ‘ä»¬ bean æ³¨å†Œè¿‡ç¨‹</li></ul><h3 id="_6-abstractxmlapplicationcontext-xmlé…ç½®å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_6-abstractxmlapplicationcontext-xmlé…ç½®å¤„ç†" aria-hidden="true">#</a> 6. AbstractXmlApplicationContext xmlé…ç½®å¤„ç†</h3><blockquote><p>AbstractXmlApplicationContext.java &amp; éƒ¨åˆ†ä»£ç æˆªå–</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">DefaultListableBeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
	<span class="token comment">// Create a new XmlBeanDefinitionReader for the given BeanFactory.</span>
	<span class="token class-name">XmlBeanDefinitionReader</span> beanDefinitionReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlBeanDefinitionReader</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// Configure the bean definition reader with this context&#39;s</span>
	<span class="token comment">// resource loading environment.</span>
	beanDefinitionReader<span class="token punctuation">.</span><span class="token function">setEnvironment</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	beanDefinitionReader<span class="token punctuation">.</span><span class="token function">setResourceLoader</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	beanDefinitionReader<span class="token punctuation">.</span><span class="token function">setEntityResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ResourceEntityResolver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// Allow a subclass to provide custom initialization of the reader,</span>
	<span class="token comment">// then proceed with actually loading the bean definitions.</span>
	<span class="token function">initBeanDefinitionReader</span><span class="token punctuation">(</span>beanDefinitionReader<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>beanDefinitionReader<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>æºç 82è¡Œï¼š</strong> XmlBeanDefinitionReader å®šä¹‰é…ç½®æ–‡ä»¶è¯»å–ç±»ï¼Œå¹¶è®¾ç½®åŸºç¡€çš„å±æ€§ä¿¡æ¯ï¼ŒgetEnvironmentã€ResourceEntityResolver</li><li><strong>æºç 93è¡Œï¼š</strong> loadBeanDefinitions åœ¨æ‹¿åˆ° beanDefinitionReader ç»§ç»­æ‰§è¡Œ</li></ul><blockquote><p>AbstractXmlApplicationContext.java &amp; éƒ¨åˆ†ä»£ç æˆªå–</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">XmlBeanDefinitionReader</span> reader<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
	<span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> configResources <span class="token operator">=</span> <span class="token function">getConfigResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>configResources <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		reader<span class="token punctuation">.</span><span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>configResources<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> configLocations <span class="token operator">=</span> <span class="token function">getConfigLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>configLocations <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		reader<span class="token punctuation">.</span><span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>configLocations<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>æºç 121è¡Œï¼š</strong> è·å–æˆ‘ä»¬æœ€å¼€å§‹è®¾ç½®çš„èµ„æºä¿¡æ¯ï¼Œåœ¨è¿™é‡Œä¹Ÿå°±æ˜¯ spring-config.xml</li><li><strong>æºç 127è¡Œï¼š</strong> é€šè¿‡ beanDefinitionReader å¼€å§‹åŠ è½½è§£æé…ç½®æ–‡ä»¶</li></ul><h3 id="_7-abstractbeandefinitionreader-é…ç½®æ–‡ä»¶åŠ è½½" tabindex="-1"><a class="header-anchor" href="#_7-abstractbeandefinitionreader-é…ç½®æ–‡ä»¶åŠ è½½" aria-hidden="true">#</a> 7. AbstractBeanDefinitionReader é…ç½®æ–‡ä»¶åŠ è½½</h3><blockquote><p>AbstractBeanDefinitionReader.java &amp; éƒ¨åˆ†ä»£ç æˆªå–</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> locations<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
	<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>locations<span class="token punctuation">,</span> <span class="token string">&quot;Location array must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> location <span class="token operator">:</span> locations<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		counter <span class="token operator">+=</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> counter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æŠ½è±¡ç±»æ˜¯ä¸­æä¾›äº†åŠ è½½è§£æçš„æ–¹æ³•ï¼Œæ¯è§£æä¸€ç»„å°±è®¡æ•°ä¸€æ¬¡</li><li><strong>æºç 252è¡Œï¼š</strong> loadBeanDefinitions(location) å¾ªç¯åŠ è½½ bean çš„å®šä¹‰è¿›è¡Œè§£æ</li></ul><blockquote><p>AbstractBeanDefinitionReader.java &amp; éƒ¨åˆ†ä»£ç æˆªå–</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">String</span> location<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ç±»å†…éƒ¨æä¾›çš„å•ä¸ªè§£ææ–¹æ³•ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ã€‚ç»§ç»­å¾€ä¸‹</li></ul><blockquote><p>AbstractBeanDefinitionReader.java &amp; éƒ¨åˆ†ä»£ç æˆªå–</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">String</span> location<span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Resource</span><span class="token punctuation">&gt;</span></span> actualResources<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
	<span class="token class-name">ResourceLoader</span> resourceLoader <span class="token operator">=</span> <span class="token function">getResourceLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>resourceLoader <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>
				<span class="token string">&quot;Cannot import bean definitions from location [&quot;</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">&quot;]: no ResourceLoader available&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">if</span> <span class="token punctuation">(</span>resourceLoader <span class="token keyword">instanceof</span> <span class="token class-name">ResourcePatternResolver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Resource pattern matching available.</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> resources <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ResourcePatternResolver</span><span class="token punctuation">)</span> resourceLoader<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> loadCount <span class="token operator">=</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>resources<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>actualResources <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Resource</span> resource <span class="token operator">:</span> resources<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					actualResources<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Loaded &quot;</span> <span class="token operator">+</span> loadCount <span class="token operator">+</span> <span class="token string">&quot; bean definitions from location pattern [&quot;</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> loadCount<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>
					<span class="token string">&quot;Could not resolve bean definition resource pattern [&quot;</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token comment">// Can only load single resources by absolute URL.</span>
		<span class="token class-name">Resource</span> resource <span class="token operator">=</span> resourceLoader<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> loadCount <span class="token operator">=</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>actualResources <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			actualResources<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Loaded &quot;</span> <span class="token operator">+</span> loadCount <span class="token operator">+</span> <span class="token string">&quot; bean definitions from location [&quot;</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> loadCount<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>æºç 217è¡Œï¼š</strong> è·å–èµ„æºè§£æï¼Œæœ€ç»ˆæ‰§è¡Œåˆ° loadBeanDefinitions(resources);ï¼Œç»§ç»­å¾€ä¸‹</li></ul><h3 id="_8-xmlbeandefinitionreader-é…ç½®è§£æ" tabindex="-1"><a class="header-anchor" href="#_8-xmlbeandefinitionreader-é…ç½®è§£æ" aria-hidden="true">#</a> 8. XmlBeanDefinitionReader é…ç½®è§£æ</h3><blockquote><p>XmlBeanDefinitionReader.java &amp; éƒ¨åˆ†ä»£ç æˆªå–</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">EncodedResource</span> encodedResource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
	
	<span class="token comment">// åˆ¤æ–­éªŒè¯</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> encodedResource<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token class-name">InputSource</span> inputSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputSource</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>encodedResource<span class="token punctuation">.</span><span class="token function">getEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				inputSource<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span>encodedResource<span class="token punctuation">.</span><span class="token function">getEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token function">doLoadBeanDefinitions</span><span class="token punctuation">(</span>inputSource<span class="token punctuation">,</span> encodedResource<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">finally</span> <span class="token punctuation">{</span>
			inputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>
				<span class="token string">&quot;IOException parsing XML document from &quot;</span> <span class="token operator">+</span> encodedResource<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">finally</span> <span class="token punctuation">{</span>
		currentResources<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>encodedResource<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>currentResources<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>resourcesCurrentlyBeingLoaded<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>æºç 330è¡Œ -&gt; 336è¡Œï¼š</strong> è¿™ä¸ªå°±æ˜¯ xml çš„è§£æè¿‡ç¨‹ï¼Œåœ¨æˆ‘ä»¬æœ€å¼€å§‹ä¼˜å…ˆåˆ†æçš„éƒ¨åˆ†ï¼Œè¿™ä¸€éƒ¨åˆ†çœŸæ­£çš„è¦ä¸ºè§£æ xml åšå‡†å¤‡</li></ul><h3 id="_9-xmlbeandefinitionreader-é…ç½®æ–‡ä»¶è¯»å–" tabindex="-1"><a class="header-anchor" href="#_9-xmlbeandefinitionreader-é…ç½®æ–‡ä»¶è¯»å–" aria-hidden="true">#</a> 9. XmlBeanDefinitionReader é…ç½®æ–‡ä»¶è¯»å–</h3><blockquote><p>XmlBeanDefinitionReader.java &amp; éƒ¨åˆ†ä»£ç æˆªå–</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">doLoadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">InputSource</span> inputSource<span class="token punctuation">,</span> <span class="token class-name">Resource</span> resource<span class="token punctuation">)</span>
		<span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token class-name">Document</span> doc <span class="token operator">=</span> <span class="token function">doLoadDocument</span><span class="token punctuation">(</span>inputSource<span class="token punctuation">,</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>æºç 391è¡Œï¼š</strong> æ­¤æ—¶å°±è·å–åˆ°äº† Document ï¼Œè¿™é‡Œé¢å°±åŒ…æ‹¬äº†æ‰€æœ‰çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ bean çš„å®šä¹‰</li><li><strong>æºç 392è¡Œï¼š</strong> é€šè¿‡ doc ä¸ èµ„æºä¿¡æ¯å¼€å§‹å®šä¹‰ bean ç­‰å¾…æ³¨å†Œï¼Œè¿™ä¸ªæ³¨å†Œ bean çš„è¿‡ç¨‹æ˜¯éœ€è¦å…ˆå®šä¹‰ bean çš„å†…å®¹ï¼Œæ¯ä¸€ä¸ª bean éƒ½éœ€è¦ç”¨ BeanDefinitionHolder å°è£…</li></ul><h3 id="_10-defaultbeandefinitiondocumentreader-å®šä¹‰beanç±»" tabindex="-1"><a class="header-anchor" href="#_10-defaultbeandefinitiondocumentreader-å®šä¹‰beanç±»" aria-hidden="true">#</a> 10. DefaultBeanDefinitionDocumentReader å®šä¹‰beanç±»</h3><blockquote><p>DefaultBeanDefinitionDocumentReader.java &amp; éƒ¨åˆ†ä»£ç æˆªå–</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Document</span> doc<span class="token punctuation">,</span> <span class="token class-name">XmlReaderContext</span> readerContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>readerContext <span class="token operator">=</span> readerContext<span class="token punctuation">;</span>
	logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Loading bean definitions&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Element</span> root <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getDocumentElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">doRegisterBeanDefinitions</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>æºç 93è¡Œï¼š</strong> è¶Šæ¥è¶Šç†Ÿæ‚‰äº†å§ï¼Œå¼€å§‹è·å–èŠ‚ç‚¹å…ƒç´ äº†ï¼Œä¹Ÿå°±å¯ä»¥è·å– bean ä¿¡æ¯</li></ul><blockquote><p>DefaultBeanDefinitionDocumentReader.java &amp; éƒ¨åˆ†ä»£ç æˆªå–</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">parseBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Element</span> root<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionParserDelegate</span> deleg
	<span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">isDefaultNamespace</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">NodeList</span> nl <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">getChildNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nl<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">Node</span> node <span class="token operator">=</span> nl<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token keyword">instanceof</span> <span class="token class-name">Element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">Element</span> ele <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> node<span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">isDefaultNamespace</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">parseDefaultElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> delegate<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span> <span class="token punctuation">{</span>
					delegate<span class="token punctuation">.</span><span class="token function">parseCustomElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{</span>
		delegate<span class="token punctuation">.</span><span class="token function">parseCustomElement</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>NodeList å¾ªç¯å¤„ç†èŠ‚ç‚¹å†…å®¹ï¼Œå¼€å¯æ³¨å†Œ</li><li><strong>æºç 169è¡Œï¼š</strong> parseDefaultElement(ele, delegate); è§£æå…ƒç´ æ“ä½œ</li></ul><blockquote><p>DefaultBeanDefinitionDocumentReader.java &amp; éƒ¨åˆ†ä»£ç æˆªå–</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">parseDefaultElement</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionParserDelegate</span> delegate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">nodeNameEquals</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token constant">IMPORT_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">importBeanDefinitionResource</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">nodeNameEquals</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token constant">ALIAS_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">processAliasRegistration</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">nodeNameEquals</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token constant">BEAN_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">processBeanDefinition</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> delegate<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">nodeNameEquals</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token constant">NESTED_BEANS_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// recurse</span>
		<span class="token function">doRegisterBeanDefinitions</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™ä¸ªæ–¹æ³•ä¼šæ ¹æ®ä¸åŒçš„èŠ‚ç‚¹ç±»å‹ï¼›IMPORT_ELEMENTã€ALIAS_ELEMENTã€BEAN_ELEMENTã€NESTED_BEANS_ELEMENTï¼Œè¿›è¡Œä¸åŒçš„æ“ä½œ</li><li><strong>æºç 190è¡Œï¼š</strong> è¿™é‡Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨ processBeanDefinition(ele, delegate) å³å¯ï¼Œå¤„ç† bean æ“ä½œ</li></ul><blockquote><p>DefaultBeanDefinitionDocumentReader.java &amp; éƒ¨åˆ†ä»£ç æˆªå–</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">processBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionParserDelegate</span> delegate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">BeanDefinitionHolder</span> bdHolder <span class="token operator">=</span> delegate<span class="token punctuation">.</span><span class="token function">parseBeanDefinitionElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>bdHolder <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		bdHolder <span class="token operator">=</span> delegate<span class="token punctuation">.</span><span class="token function">decorateBeanDefinitionIfRequired</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> bdHolder<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token comment">// Register the final decorated instance.</span>
			<span class="token class-name">BeanDefinitionReaderUtils</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span>bdHolder<span class="token punctuation">,</span> <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinitionStoreException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to register bean definition with name &#39;&quot;</span> <span class="token operator">+</span>
					bdHolder<span class="token punctuation">.</span><span class="token function">getBeanName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&#39;&quot;</span><span class="token punctuation">,</span> ele<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// Send registration event.</span>
		<span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fireComponentRegistered</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BeanComponentDefinition</span><span class="token punctuation">(</span>bdHolder<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¦‚æœä½ è®¤çœŸçš„è¯»æ–‡ç« äº†ï¼ŒBeanDefinitionHolder æˆ‘ä»¬åœ¨ä¸Šé¢å·²ç»è¯´è¿‡ä¸€æ¬¡ï¼Œè¿™æ˜¯æ¯ä¸€ä¸ª bean éƒ½ä¼šå®šä¹‰çš„æ“ä½œï¼Œæœ€åäº¤ç»™æ³¨å†Œä¸­å¿ƒ</li><li><strong>æºç 304è¡Œï¼š</strong> BeanDefinitionReaderUtils.registerBeanDefinitionï¼Œç±»é‡Œçš„ä¸€ä¸ªé™æ€æ³¨å†Œæ“ä½œæ–¹æ³•</li></ul><h3 id="_11-beandefinitionreaderutils-beanæ³¨å†Œå·¥å…·ç±»" tabindex="-1"><a class="header-anchor" href="#_11-beandefinitionreaderutils-beanæ³¨å†Œå·¥å…·ç±»" aria-hidden="true">#</a> 11. BeanDefinitionReaderUtils beanæ³¨å†Œå·¥å…·ç±»</h3><blockquote><p>BeanDefinitionReaderUtils.java &amp; éƒ¨åˆ†ä»£ç æˆªå–</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span>
		<span class="token class-name">BeanDefinitionHolder</span> definitionHolder<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span>
		<span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
	
	<span class="token comment">// Register bean definition under primary name.</span>
	<span class="token class-name">String</span> beanName <span class="token operator">=</span> definitionHolder<span class="token punctuation">.</span><span class="token function">getBeanName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	registry<span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> definitionHolder<span class="token punctuation">.</span><span class="token function">getBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// Register aliases for bean name, if any.</span>
	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> aliases <span class="token operator">=</span> definitionHolder<span class="token punctuation">.</span><span class="token function">getAliases</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>aliases <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> alias <span class="token operator">:</span> aliases<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			registry<span class="token punctuation">.</span><span class="token function">registerAlias</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> alias<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>æºç 149è¡Œï¼š</strong> å°† beanNameã€BeanDefinitionï¼Œä¸€åŒäº¤ç»™æœ€åçš„æ³¨å†Œä¸­å¿ƒï¼Œæœ€åè¿™ä¸ªå°±æ˜¯ DefaultListableBeanFactory</li></ul><h3 id="_12-defaultlistablebeanfactory-beanæ ¸å¿ƒæ³¨å†Œä¸­å¿ƒ" tabindex="-1"><a class="header-anchor" href="#_12-defaultlistablebeanfactory-beanæ ¸å¿ƒæ³¨å†Œä¸­å¿ƒ" aria-hidden="true">#</a> 12. DefaultListableBeanFactory beanæ ¸å¿ƒæ³¨å†Œä¸­å¿ƒ</h3><blockquote><p>DefaultListableBeanFactory.java &amp; éƒ¨åˆ†ä»£ç æˆªå–</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">)</span>
		<span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
	
	<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> <span class="token string">&quot;Bean name must not be empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">,</span> <span class="token string">&quot;BeanDefinition must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span> <span class="token punctuation">(</span>beanDefinition <span class="token keyword">instanceof</span> <span class="token class-name">AbstractBeanDefinition</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">AbstractBeanDefinition</span><span class="token punctuation">)</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinitionValidationException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">.</span><span class="token function">getResourceDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span>
					<span class="token string">&quot;Validation of bean definition failed&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token class-name">BeanDefinition</span> existingDefinition <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>existingDefinition <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{</span>
		
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		
		<span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token comment">// Still in startup registration phase</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionNames<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>manualSingletonNames<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>frozenBeanDefinitionNames <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>existingDefinition <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token function">containsSingleton</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">resetBeanDefinition</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>æºç 853è¡Œï¼š</strong> è¿™å°±æ˜¯æœ€ç»ˆæˆ‘ä»¬å°† xml ä¸­çš„é…ç½®ä¿¡æ¯æ³¨å†Œåˆ°äº†é…ç½®ä¸­å¿ƒï¼ŒbeanDefinitionMapï¼ŒåŒæ—¶è¿˜ä¼šå†™å…¥åˆ° beanDefinitionNames</p></li><li><p>çœ‹ä¸‹æœ€ç»ˆçš„æ³¨å…¥ç»“æœï¼Œå—¯ï¼æˆ‘ä»¬çš„ç›—å¢“æŒ–åˆ°äº†ä¸€ç‚¹å®ç‰©ï¼›</p><p><img src="https://bugstack.cn/assets/images/pic-content/2019/11/itstack-demo-code-spring-04.png" alt="å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ &amp; beanæ³¨å†Œç»“æœ"></p></li></ul><h2 id="äº”ã€ç»¼ä¸Šæ€»ç»“" tabindex="-1"><a class="header-anchor" href="#äº”ã€ç»¼ä¸Šæ€»ç»“" aria-hidden="true">#</a> äº”ã€ç»¼ä¸Šæ€»ç»“</h2><ul><li>é™ˆç‰æ¥¼çš„ç›—å¢“(æºç åˆ†æ)ï¼Œåˆæ­¥ç¡®å®šäº†è·¯çº¿ã€å¢“å®¤ã€å¹²æ‰äº†èœˆèš£ï¼Œä»Šå¤©å¤§å®¶èƒœåˆ©è€Œå½’ï¼Œå¼€å§‹æ”¶æ‹¾æ•´ç†è£…å¤‡</li><li>æºç åˆ†æçœŸçš„å°±åƒç›—å¢“ä¸€æ ·ï¼Œåˆ†æå‰ä¸€åˆ‡éƒ½æ˜¯é™Œç”Ÿçš„ï¼Œä¸€ééçš„åˆ†æåä¼šä»é‡Œé¢ä¸æ–­çš„è·å–å®è—ï¼Œè¿™ä¸ªå®è—çš„å¤šå°‘å–å†³ä½ å¯¹ä»–çš„æŒ–æ˜æ·±åº¦</li><li>æœ¬æ¬¡åªæ˜¯ç®€å•çš„åˆ†æäº†ä¸€ä¸ª xml ä¸­é…ç½®çš„ bean æ³¨å†Œçš„è¿‡ç¨‹ï¼Œæ­¤æ—¶è¿˜æ²¡æœ‰çœŸæ­£çš„ç”Ÿæˆ beanï¼Œç­‰ä¸‹ç¯‡æ–‡ç« ç»§ç»­åˆ†æ</li></ul>`,103);function v(m,b){const a=e("ExternalLinkIcon");return p(),o("div",null,[u,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),k,s("åšå®¢ï¼š"),n("a",r,[s("https://bugstack.cn"),c(a)])]),d])}const g=t(l,[["render",v],["__file","2020-01-08-_yuanmafenxi_xiangdaomuyiyangfenxiSpringshizenmechushihuaxmlbingzhucebeande.html.vue"]]);export{g as default};
