import{_ as p,r as c,o,c as l,a as n,b as a,d as e,e as t}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"é¢ç»æ‰‹å†Œ-Â·-ç¬¬25ç¯‡ã€Šjvmå†…å­˜æ¨¡å‹æ€»ç»“-æœ‰å„ç‰ˆæœ¬jdkå¯¹æ¯”ã€æœ‰å…ƒç©ºé—´oomç›‘æ§æ¡ˆä¾‹ã€æœ‰javaç‰ˆè™šæ‹Ÿæœº-ç»¼åˆå­¦ä¹ æ›´å®¹æ˜“-ã€‹",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#é¢ç»æ‰‹å†Œ-Â·-ç¬¬25ç¯‡ã€Šjvmå†…å­˜æ¨¡å‹æ€»ç»“-æœ‰å„ç‰ˆæœ¬jdkå¯¹æ¯”ã€æœ‰å…ƒç©ºé—´oomç›‘æ§æ¡ˆä¾‹ã€æœ‰javaç‰ˆè™šæ‹Ÿæœº-ç»¼åˆå­¦ä¹ æ›´å®¹æ˜“-ã€‹","aria-hidden":"true"},"#"),a(" é¢ç»æ‰‹å†Œ Â· ç¬¬25ç¯‡ã€ŠJVMå†…å­˜æ¨¡å‹æ€»ç»“ï¼Œæœ‰å„ç‰ˆæœ¬JDKå¯¹æ¯”ã€æœ‰å…ƒç©ºé—´OOMç›‘æ§æ¡ˆä¾‹ã€æœ‰Javaç‰ˆè™šæ‹Ÿæœºï¼Œç»¼åˆå­¦ä¹ æ›´å®¹æ˜“ï¼ã€‹")],-1),r=n("br",null,null,-1),k={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=t(`<blockquote><p>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„</p></blockquote><h2 id="ä¸€ã€å‰è¨€" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‰è¨€" aria-hidden="true">#</a> ä¸€ã€å‰è¨€</h2><p><code>çœ‹äº†ä¸€ç¯‡æ–‡ç« 30å²æœ‰å¤šéš¾ï¼</code></p><p>æ¯ç¯‡æ–‡ç« çš„å¼€ç¯‡æ€»å–œæ¬¢å†™ä¸€äº›ï¼Œä»ä¸ªäººè§†è§’çœ‹è¿™ä¸ªä¸–ç•Œçš„æ„Ÿæ‚Ÿã€‚</p><p>æœ€è¿‘çœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œ<code>30å²æœ‰å¤šéš¾</code>ã€‚æ–‡ä¸­çš„ä¸€äº›ä¸»äººå…¬å¥½åƒåœ¨å­¦ä¸šã€å·¥ä½œã€ç”Ÿæ´»ã€çˆ±æƒ…ç­‰æ–¹é¢éƒ½è¿‡çš„éƒ½ä¸å¦‚æ„ã€‚è¦ä¸æ˜¯é”™è¿‡è¿™ï¼Œè¦ä¸æ˜¯èµ°é”™é‚£ã€‚æ€»ç»“æ¥çœ‹ï¼Œå°±åƒæ˜¯å¾ˆå€’éœ‰çš„ä¸€ç¾¤å€’éœ‰è›‹å„¿åœ¨è·Ÿç”Ÿæ´»å¯¹å¹²ï¼</p><p>ä½†å…¶å®æ¯ä¸ªäººå¯èƒ½éƒ½é‡åˆ°è¿‡ç”Ÿæ´»ä¸­æœ€éš¾çš„æ—¶å€™ï¼Œæˆ–æ—©æˆ–æ™šã€‚å°±åƒæˆ‘åˆšæ¯•ä¸šä¸ä¹…æ—¶ä¸€è¿ä¸²é‡åˆ°ï¼›<code>å†¬å¤©é‡Œä¸¢è¿‡ç¬¬ä¸€éƒ¨æ‰‹æœº</code>ã€<code>ä¿®ä¸€ä¸ªè¿›äº†æ°´çš„ç”µè„‘</code>ã€<code>ç§Ÿçš„æˆ¿å­ç¬¬ä¸€æ¬¡è¢«éª—</code>ï¼Œä¸€è¿ä¸²ä¸‹æ¥å¤´ä¸€æ¬¡è¦èµ¶åœ¨å·¥èµ„æ²¡å‘çš„æ—¶å€™ï¼Œé€‰æ‹©å°‘åƒæ—©é¥­è¿˜æ˜¯åˆé¥­ï¼Œçœ‹çœ‹èƒ½æ‰›è¿‡å»é‚£é¡¿ã€‚</p><p>å“ˆå“ˆå“ˆå“ˆå“ˆï¼Œç°åœ¨æƒ³æƒ³è¿˜æŒºæœ‰æ„æ€çš„ï¼Œä¸è¿‡è¿™äº›ä¹±é­çš„äº‹å¾ˆå¤šæ˜¯è‡ªå·±çš„æ„è¯†å’Œèƒ½åŠ›ä¸è¶³æ—¶åšå‡ºçš„é”™è¯¯é€‰æ‹©è€Œå¯¼è‡´çš„ã€‚</p><p>äººé‚£ï¼Œæƒ³å¼€è½¦å°±è¦è€ƒé©¾ç…§ï¼Œæƒ³èµ°è¿œå°±è¦æœ‰èƒ½åŠ›ã€‚å¤šæå‡è®¤çŸ¥ï¼Œå¤šæ‹“å®½çœ¼ç•Œï¼<code>ç”Ÿæ´»çš„æ„ä¹‰å°±æ˜¯ä¸æ–­çš„æ›´æ–°è‡ªå·±ï¼</code></p><h2 id="äºŒã€é¢è¯•é¢˜" tabindex="-1"><a class="header-anchor" href="#äºŒã€é¢è¯•é¢˜" aria-hidden="true">#</a> äºŒã€é¢è¯•é¢˜</h2><p><code>è°¢é£æœºï¼Œå°è®°ï¼</code>ï¼Œå†¬é£å¹ã€æˆ˜é¼“æ“‚ã€‚è¢«çªé‡Œï¼Œè°æ€•è°ã€‚</p><p><strong>è°¢é£æœº</strong>ï¼šæ­ªï¼Ÿå¤§å“¥ï¼Œä½ åœ¨å—ï¼Ÿ</p><p><strong>é¢è¯•å®˜</strong>ï¼šå’‹äº†ï¼Œå¤§å‘¨æœ«çš„ï¼Œè¿™ä¹ˆæ—©æ‰“ç”µè¯ï¼ï¼Ÿ</p><p><strong>è°¢é£æœº</strong>ï¼šæˆ‘æ¢¦è§ï¼Œæˆ‘å»è°·æ­Œå†™JVMäº†ï¼Œç»™ä½ ä»¬å…¬å¸ç”¨ï¼Œä¹‹åè¹¦äº†ï¼Œè®©æˆ‘èµ·æ¥æ”¹bugï¼</p><p><strong>é¢è¯•å®˜</strong>ï¼šå•Šï¼ï¼Ÿå•Šï¼Œé‚£æˆ‘é—®ä½ ï¼ŒJDK 1.8 ä¸ JDK 1.7 åœ¨è¿è¡Œæ—¶æ•°æ®åŒºçš„è®¾è®¡ä¸Šï¼Œä½ éƒ½æ€ä¹ˆåšçš„ä¼˜åŒ–ç­–ç•¥çš„ï¼Ÿ</p><p><strong>è°¢é£æœº</strong>ï¼šæˆ‘æ²¡å†™è¿™ï¼Œæˆ‘ä¸çŸ¥é“ï¼</p><p><strong>é¢è¯•å®˜</strong>ï¼šæ“¦ã€‚ã€‚ã€‚</p><h2 id="ä¸‰ã€-jdk1-6ã€jdk1-7ã€jdk1-8-å†…å­˜æ¨¡å‹æ¼”å˜" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€-jdk1-6ã€jdk1-7ã€jdk1-8-å†…å­˜æ¨¡å‹æ¼”å˜" aria-hidden="true">#</a> ä¸‰ã€ JDK1.6ã€JDK1.7ã€JDK1.8 å†…å­˜æ¨¡å‹æ¼”å˜</h2><p><img src="https://bugstack.cn/assets/images/2020/interview/interview-25-1.png" alt="å›¾ 25-1  JDK1.6ã€JDK1.7ã€JDK1.8ï¼Œå†…å­˜æ¨¡å‹æ¼”å˜"></p><p>å¦‚å›¾ 25-1 æ˜¯ JDK 1.6ã€1.7ã€1.8 çš„å†…å­˜æ¨¡å‹æ¼”å˜è¿‡ç¨‹ï¼Œå…¶å®è¿™ä¸ªå†…å­˜æ¨¡å‹å°±æ˜¯ JVM è¿è¡Œæ—¶æ•°æ®åŒºä¾ç…§JVMè™šæ‹Ÿæœºè§„èŒƒçš„å…·ä½“å®ç°è¿‡ç¨‹ã€‚</p><p>åœ¨å›¾ 25-1 ä¸­å„ä¸ªç‰ˆæœ¬çš„è¿­ä»£éƒ½æ˜¯ä¸ºäº†æ›´å¥½çš„é€‚åº”CPUæ€§èƒ½æå‡ï¼Œæœ€å¤§é™åº¦æå‡çš„JVMè¿è¡Œæ•ˆç‡ã€‚è¿™äº›ç‰ˆæœ¬çš„JVMå†…å­˜æ¨¡å‹ä¸»è¦æœ‰ä»¥ä¸‹å·®å¼‚ï¼š</p><ul><li>JDK 1.6ï¼šæœ‰æ°¸ä¹…ä»£ï¼Œé™æ€å˜é‡å­˜æ”¾åœ¨æ°¸ä¹…ä»£ä¸Šã€‚</li><li>JDK 1.7ï¼šæœ‰æ°¸ä¹…ä»£ï¼Œä½†å·²ç»æŠŠå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡ï¼Œå­˜æ”¾åœ¨å †ä¸Šã€‚é€æ¸çš„å‡å°‘æ°¸ä¹…ä»£çš„ä½¿ç”¨ã€‚</li><li>JDK 1.8ï¼šæ— æ°¸ä¹…ä»£ï¼Œè¿è¡Œæ—¶å¸¸é‡æ± ã€ç±»å¸¸é‡æ± ï¼Œéƒ½ä¿å­˜åœ¨å…ƒæ•°æ®åŒºï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„<code>å…ƒç©ºé—´</code>ã€‚ä½†å­—ç¬¦ä¸²å¸¸é‡æ± ä»ç„¶å­˜æ”¾åœ¨å †ä¸Šã€‚</li></ul><h2 id="å››ã€å†…å­˜æ¨¡å‹å„åŒºåŸŸä»‹ç»" tabindex="-1"><a class="header-anchor" href="#å››ã€å†…å­˜æ¨¡å‹å„åŒºåŸŸä»‹ç»" aria-hidden="true">#</a> å››ã€å†…å­˜æ¨¡å‹å„åŒºåŸŸä»‹ç»</h2><h3 id="_1-ç¨‹åºè®¡æ•°å™¨" tabindex="-1"><a class="header-anchor" href="#_1-ç¨‹åºè®¡æ•°å™¨" aria-hidden="true">#</a> 1. ç¨‹åºè®¡æ•°å™¨</h3><ul><li>è¾ƒå°çš„å†…å­˜ç©ºé—´ã€çº¿ç¨‹ç§æœ‰ï¼Œè®°å½•å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç è¡Œå·ã€‚</li><li>å¦‚æœæ‰§è¡Œ Java æ–¹æ³•ï¼Œè®¡æ•°å™¨è®°å½•è™šæ‹Ÿæœºå­—èŠ‚ç å½“å‰æŒ‡ä»¤çš„åœ°å€ï¼Œæœ¬åœ°æ–¹æ³•åˆ™ä¸ºç©ºã€‚</li><li>è¿™ä¸€å—åŒºåŸŸæ²¡æœ‰ä»»ä½• OutOfMemoryError å®šä¹‰ã€‚</li></ul><p><strong>ä»¥ä¸Š</strong>ï¼Œå°±æ˜¯å…³äºç¨‹åºè®¡æ•°å™¨çš„å®šä¹‰ï¼Œå¦‚æœè¿™æ ·çœ‹æ²¡æœ‰æ„Ÿè§‰ï¼Œæˆ‘ä»¬ä¸¾ä¸€ä¸ªä¾‹å­ã€‚</p><p>å®šä¹‰ä¸€æ®µ Java æ–¹æ³•çš„ä»£ç ï¼Œè¿™æ®µä»£ç æ˜¯è®¡ç®—åœ†å½¢çš„å‘¨é•¿ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">float</span> <span class="token function">circumference</span><span class="token punctuation">(</span><span class="token keyword">float</span> r<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">float</span> pi <span class="token operator">=</span> <span class="token number">3.14f</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> area <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> pi <span class="token operator">*</span> r<span class="token punctuation">;</span>
        <span class="token keyword">return</span> area<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œå¦‚å›¾ 25-2 æ˜¯è¿™æ®µä»£ç çš„åœ¨è™šæ‹Ÿæœºä¸­çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå·¦ä¾§æ˜¯å®ƒçš„ç¨‹åºè®¡æ•°å™¨å¯¹åº”çš„è¡Œå·ã€‚</p><p><img src="https://bugstack.cn/assets/images/2020/interview/interview-25-2.png" alt="å›¾ 25-2 ç¨‹åºè®¡æ•°å™¨"></p><ul><li>è¿™äº›è¡Œå·æ¯ä¸€ä¸ªéƒ½ä¼šå¯¹åº”ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œæ˜¯å‹æ ˆè¿˜æ˜¯å¼¹å‡ºæˆ–æ˜¯æ‰§è¡Œè®¡ç®—ã€‚</li><li>ä¹‹æ‰€ä»¥è¯´æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå› ä¸ºå¦‚æœä¸æ˜¯ç§æœ‰çš„ï¼Œé‚£ä¹ˆæ•´ä¸ªè®¡ç®—è¿‡ç¨‹æœ€ç»ˆçš„ç»“æœä¹Ÿå°†é”™è¯¯ã€‚</li></ul><h3 id="_2-javaè™šæ‹Ÿæœºæ ˆ" tabindex="-1"><a class="header-anchor" href="#_2-javaè™šæ‹Ÿæœºæ ˆ" aria-hidden="true">#</a> 2. Javaè™šæ‹Ÿæœºæ ˆ</h3><ul><li>æ¯ä¸€ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶ï¼Œéƒ½ä¼šåˆ›å»ºå‡ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜æ”¾å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ã€çº¿ç¨‹ç­‰ä¿¡æ¯ã€‚</li><li>æ–¹æ³•ä»è°ƒç”¨åˆ°æ‰§è¡Œå®Œæˆï¼Œéƒ½å¯¹åº”ç€æ ˆå¸§ä»è™šæ‹Ÿæœºä¸­å…¥æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ã€‚</li><li>æœ€ç»ˆï¼Œæ ˆå¸§ä¼šéšç€æ–¹æ³•çš„åˆ›å»ºåˆ°ç»“æŸè€Œé”€æ¯ã€‚</li></ul><p>å¯èƒ½è¿™ä¹ˆåªä»å®šä¹‰çœ‹ä¸Šå»ä»ç„¶æ²¡æœ‰ä»€ä¹ˆæ„Ÿè§‰ï¼Œæˆ‘ä»¬å†æ‰¾ä¸€ä¸ªä¾‹å­ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªå…³äº<code>æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆFibonacci sequenceï¼‰</code>æ±‚å€¼çš„ä¾‹å­ï¼Œæˆ‘ä»¬é€šè¿‡æ–æ³¢é‚£å¥‘æ•°åˆ—åœ¨è™šæ‹Ÿæœºä¸­çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæ¥ä½“ä¼šJavaè™šæ‹Ÿæœºæ ˆçš„ç”¨é€”ã€‚</p><blockquote><p>æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆFibonacci sequenceï¼‰ï¼Œåˆç§°é»„é‡‘åˆ†å‰²æ•°åˆ—ã€å› æ•°å­¦å®¶åˆ—æ˜‚çº³å¤šÂ·æ–æ³¢é‚£å¥‘ï¼ˆLeonardoda Fibonacciï¼‰ä»¥å…”å­ç¹æ®–ä¸ºä¾‹å­è€Œå¼•å…¥ï¼Œæ•…åˆç§°ä¸ºâ€œå…”å­æ•°åˆ—â€ï¼ŒæŒ‡çš„æ˜¯è¿™æ ·ä¸€ä¸ªæ•°åˆ—ï¼š1ã€1ã€2ã€3ã€5ã€8ã€13ã€21ã€34ã€â€¦â€¦åœ¨æ•°å­¦ä¸Šï¼Œæ–æ³¢çº³å¥‘æ•°åˆ—ä»¥å¦‚ä¸‹è¢«ä»¥é€’æ¨çš„æ–¹æ³•å®šä¹‰ï¼šF(1)=1ï¼ŒF(2)=1, F(n)=F(n-1)+F(n-2)ï¼ˆn&gt;=3ï¼ŒnâˆˆN*ï¼‰åœ¨ç°ä»£ç‰©ç†ã€å‡†æ™¶ä½“ç»“æ„ã€åŒ–å­¦ç­‰é¢†åŸŸï¼Œæ–æ³¢çº³å¥‘æ•°åˆ—éƒ½æœ‰ç›´æ¥çš„åº”ç”¨ï¼Œä¸ºæ­¤ï¼Œç¾å›½æ•°å­¦ä¼šä»1963å¹´èµ·å‡ºç‰ˆäº†ä»¥ã€Šæ–æ³¢çº³å¥‘æ•°åˆ—å­£åˆŠã€‹ä¸ºåçš„ä¸€ä»½æ•°å­¦æ‚å¿—ï¼Œç”¨äºä¸“é—¨åˆŠè½½è¿™æ–¹é¢çš„ç ”ç©¶æˆæœã€‚</p></blockquote><p><img src="https://bugstack.cn/assets/images/2020/interview/interview-25-3.png" alt="å›¾ 25-3 æ–æ³¢é‚£å¥‘æ•°åˆ—åœ¨è™šæ‹Ÿæœºæ ˆä¸­çš„æ‰§è¡Œè¿‡ç¨‹"></p><ul><li>æ•´ä¸ªè¿™æ®µæµç¨‹ï¼Œå°±æ˜¯æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›ã€‚åœ¨è°ƒç”¨è¿‡ç¨‹ç”³è¯·äº†æ“ä½œæ•°æ ˆçš„æ·±åº¦å’Œå±€éƒ¨å˜é‡çš„å¤§å°ã€‚</li><li>ä»¥åŠç›¸åº”çš„ä¿¡æ¯ä»å„ä¸ªåŒºåŸŸè·å–å¹¶æ“ä½œï¼Œå…¶å®ä¹Ÿå°±æ˜¯å…¥æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ã€‚</li></ul><h3 id="_3-æœ¬åœ°æ–¹æ³•æ ˆ" tabindex="-1"><a class="header-anchor" href="#_3-æœ¬åœ°æ–¹æ³•æ ˆ" aria-hidden="true">#</a> 3. æœ¬åœ°æ–¹æ³•æ ˆ</h3><ul><li>æœ¬åœ°æ–¹æ³•æ ˆä¸Javaè™šæ‹Ÿæœºæ ˆä½œç”¨ç±»ä¼¼ï¼Œå”¯ä¸€ä¸åŒçš„å°±æ˜¯æœ¬åœ°æ–¹æ³•æ ˆæ‰§è¡Œçš„æ˜¯Nativeæ–¹æ³•ï¼Œè€Œè™šæ‹Ÿæœºæ ˆæ˜¯ä¸ºJVMæ‰§è¡ŒJavaæ–¹æ³•æœåŠ¡çš„ã€‚</li><li>å¦å¤–ï¼Œä¸ Java è™šæ‹Ÿæœºæ ˆä¸€æ ·ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šæŠ›å‡º StackOverflowError å’Œ OutOfMemoryError å¼‚å¸¸ã€‚</li><li>JDK1.8 HotSpotè™šæ‹Ÿæœºç›´æ¥å°±æŠŠæœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚</li></ul><p><em>å…³äºæœ¬åœ°æ–¹æ³•æ ˆåœ¨ä»¥ä¸Šçš„ä¾‹å­å·²ç»æ¶‰åŠäº†è¿™éƒ¨åˆ†å†…å®¹ï¼Œè¿™é‡Œå°±ä¸åœ¨èµ˜è¿°äº†ã€‚</em></p><h3 id="_4-å †å’Œå…ƒç©ºé—´" tabindex="-1"><a class="header-anchor" href="#_4-å †å’Œå…ƒç©ºé—´" aria-hidden="true">#</a> 4. å †å’Œå…ƒç©ºé—´</h3><p><img src="https://bugstack.cn/assets/images/2020/interview/interview-25-4.png" alt="å›¾ 25-4 Java å †åŒºåŸŸåˆ’åˆ†"></p><ul><li>JDK 1.8 JVM çš„å†…å­˜ç»“æ„ä¸»è¦ç”±ä¸‰å¤§å—ç»„æˆï¼šå †å†…å­˜ã€å…ƒç©ºé—´å’Œæ ˆï¼ŒJava å †æ˜¯å†…å­˜ç©ºé—´å æ®æœ€å¤§çš„ä¸€å—åŒºåŸŸã€‚</li><li>Java å †ï¼Œç”±å¹´è½»ä»£å’Œå¹´è€ä»£ç»„æˆï¼Œåˆ†åˆ«å æ®1/3å’Œ2/3ã€‚</li><li>è€Œå¹´è½»ä»£åˆåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œ<strong>Eden</strong>ã€<strong>From Survivor</strong>ã€<strong>To Survivor</strong>ï¼Œå æ®æ¯”ä¾‹ä¸º8:1:1ï¼Œå¯è°ƒã€‚</li><li>å¦å¤–è¿™é‡Œæˆ‘ä»¬ç‰¹æ„ç”»å‡ºäº†å…ƒç©ºé—´ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥å†…å­˜åŒºåŸŸã€‚åœ¨ JDK 1.8 ä¹‹åå°±ä¸åœ¨å †ä¸Šåˆ†é…æ–¹æ³•åŒºäº†ã€‚</li><li><strong>å…ƒç©ºé—´</strong>ä»è™šæ‹ŸæœºJavaå †ä¸­è½¬ç§»åˆ°æœ¬åœ°å†…å­˜ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç©ºé—´çš„å¤§å°ä»…å—æœ¬åœ°å†…å­˜çš„é™åˆ¶ï¼Œè¯´ç™½äº†ä¹Ÿå°±æ˜¯ä»¥åä¸ä¼šå› ä¸ºæ°¸ä¹…ä»£ç©ºé—´ä¸å¤Ÿè€ŒæŠ›å‡ºOOMå¼‚å¸¸å‡ºç°äº†ã€‚<em>jdk1.8ä»¥å‰ç‰ˆæœ¬çš„ classå’ŒJARåŒ…æ•°æ®å­˜å‚¨åœ¨ PermGenä¸‹é¢ ï¼ŒPermGen å¤§å°æ˜¯å›ºå®šçš„ï¼Œè€Œä¸”é¡¹ç›®ä¹‹é—´æ— æ³•å…±ç”¨ï¼Œå…¬æœ‰çš„ classï¼Œæ‰€ä»¥æ¯”è¾ƒå®¹æ˜“å‡ºç°OOMå¼‚å¸¸ã€‚</em></li><li>å‡çº§ JDK 1.8åï¼Œå…ƒç©ºé—´é…ç½®å‚æ•°ï¼Œ<code>-XX:MetaspaceSize=512M XX:MaxMetaspaceSize=1024M</code>ã€‚æ•™ä½ ä¸ªå°æŠ€å·§é€šè¿‡jpsã€jinfoæŸ¥çœ‹å…ƒç©ºé—´ï¼Œå¦‚ä¸‹ï¼š <ul><li><img src="https://bugstack.cn/assets/images/2020/interview/interview-25-4-1.png" alt="é€šè¿‡å‘½ä»¤æŸ¥çœ‹å…ƒç©ºé—´"></li><li>é€šè¿‡jinfoæŸ¥çœ‹é»˜è®¤MetaspaceSizeå¤§å°ï¼ˆçº¦20Mï¼‰,MaxMetaspaceSizeæ¯”è¾ƒå¤§ã€‚</li></ul></li></ul>`,43),m=n("strong",null,"å…¶ä»–ï¼šå…³äº JDK1.8 å…ƒç©ºé—´çš„ä»‹ç»ï¼š",-1),v={href:"http://openjdk.java.net/jeps/122",target:"_blank",rel:"noopener noreferrer"},b=t(`<h3 id="_5-å¸¸é‡æ± " tabindex="-1"><a class="header-anchor" href="#_5-å¸¸é‡æ± " aria-hidden="true">#</a> 5. å¸¸é‡æ± </h3><ul><li>ä» JDK 1.7å¼€å§‹æŠŠå¸¸é‡æ± ä»æ°¸ä¹…ä»£ä¸­å‰¥ç¦»ï¼Œç›´åˆ° JDK1.8 å»æ‰äº†æ°¸ä¹…ä»£ã€‚è€Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸€ç›´æ”¾åœ¨å †ç©ºé—´ï¼Œç”¨äºå­˜å‚¨å­—ç¬¦ä¸²å¯¹è±¡ï¼Œæˆ–æ˜¯å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ã€‚</li></ul><h2 id="äº”ã€æ‰‹æ’¸è™šæ‹Ÿæœº-å†…å­˜æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#äº”ã€æ‰‹æ’¸è™šæ‹Ÿæœº-å†…å­˜æ¨¡å‹" aria-hidden="true">#</a> äº”ã€æ‰‹æ’¸è™šæ‹Ÿæœº(å†…å­˜æ¨¡å‹)</h2><p>å…¶å®ä»¥ä¸Šçš„å†…å®¹ï¼Œå·²ç»å®Œæ•´çš„ä»‹ç»äº†JVMè™šæ‹Ÿæœºçš„å†…å­˜æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯è¿è¡Œæ—¶æ•°æ®åŒºçš„ç»“æ„ã€‚ä½†æ˜¯è¿™ä¸œè¥¿çœ‹å®Œå¯èƒ½å°±å¿˜è®°äº†ï¼Œå› ä¸ºç¼ºå°‘ä¸€ä¸ªå¯äº²æ‰‹æ“ä½œçš„ä»£ç ã€‚</p><p><strong>æ‰€ä»¥</strong>ï¼Œè¿™é‡Œæˆ‘ç»™å¤§å®¶ç”¨Javaä»£ç å†™ä¸€æ®µå…³äºæ•°æ®æ§½ã€æ ˆå¸§ã€å±€éƒ¨å˜é‡ã€è™šæ‹Ÿæœºæ ˆä»¥åŠå †çš„ä»£ç ç»“æ„ï¼Œè®©å¤§å®¶æ›´å¥½çš„åŠ æ·±å¯¹è™šæ‹Ÿæœºå†…å­˜æ¨¡å‹çš„å°è±¡ã€‚</p><h3 id="_1-å·¥ç¨‹ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1-å·¥ç¨‹ç»“æ„" aria-hidden="true">#</a> 1. å·¥ç¨‹ç»“æ„</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>è¿è¡Œæ—¶æ•°æ®åŒº
â”œâ”€â”€ heap
â”‚   â”œâ”€â”€ constantpool
â”‚   â”œâ”€â”€ methodarea
â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">Class</span><span class="token punctuation">.</span>java
â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ClassMember</span><span class="token punctuation">.</span>java
â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">Field</span><span class="token punctuation">.</span>java
â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">Method</span><span class="token punctuation">.</span>java
â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">MethodDescriptor</span><span class="token punctuation">.</span>java
â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">MethodDescriptorParser</span><span class="token punctuation">.</span>java
â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">MethodLookup</span><span class="token punctuation">.</span>java
â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">Object</span><span class="token punctuation">.</span>java
â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">Slots</span><span class="token punctuation">.</span>java
â”‚   â”‚   â””â”€â”€ <span class="token class-name">StringPool</span><span class="token punctuation">.</span>java
â”‚   â””â”€â”€ <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span>java
â”œâ”€â”€ <span class="token class-name">Frame</span><span class="token punctuation">.</span>java
â”œâ”€â”€ <span class="token class-name">JvmStack</span><span class="token punctuation">.</span>java
â”œâ”€â”€ <span class="token class-name">LocalVars</span><span class="token punctuation">.</span>java
â”œâ”€â”€ <span class="token class-name">OperandStack</span><span class="token punctuation">.</span>java
â”œâ”€â”€ <span class="token class-name">Slot</span><span class="token punctuation">.</span>java
â””â”€â”€ <span class="token class-name">Thread</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šè¿™éƒ¨åˆ†å°±æ˜¯ä½¿ç”¨Javaå®ç°çš„éƒ¨åˆ†JVMè™šæ‹ŸæœºåŠŸèƒ½ï¼Œè¿™éƒ¨åˆ†ä¸»è¦åŒ…æ‹¬å¦‚ä¸‹å†…å®¹ï¼š</p><ul><li>Frameï¼Œæ ˆå¸§</li><li>JvmStackï¼Œè™šæ‹Ÿæœºæ ˆ</li><li>LocalVarsï¼Œå±€éƒ¨å˜é‡</li><li>OperandStackï¼Œæ“ä½œæ•°æ ˆ</li><li>Slotï¼Œæ•°æ®æ§½</li><li>Threadï¼Œçº¿ç¨‹</li><li>heapï¼Œå †ï¼Œé‡Œé¢åŒ…æ‹¬å¸¸é‡æ± å’Œæ–¹æ³•åŒº</li></ul><h3 id="_2-é‡ç‚¹ä»£ç " tabindex="-1"><a class="header-anchor" href="#_2-é‡ç‚¹ä»£ç " aria-hidden="true">#</a> 2. é‡ç‚¹ä»£ç </h3><p><strong>æ“ä½œæ•°æ ˆ OperandStack</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OperandStack</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Slot</span><span class="token punctuation">[</span><span class="token punctuation">]</span> slots<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">OperandStack</span><span class="token punctuation">(</span><span class="token keyword">int</span> maxStack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>maxStack <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            slots <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Slot</span><span class="token punctuation">[</span>maxStack<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> maxStack<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                slots<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Slot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è™šæ‹Ÿæœºæ ˆ OperandStack</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JvmStack</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> maxSize<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Frame</span> _top<span class="token punctuation">;</span>
    
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ ˆå¸§ Frame</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Frame</span> <span class="token punctuation">{</span>

    <span class="token comment">//stack is implemented as linked list</span>
    <span class="token class-name">Frame</span> lower<span class="token punctuation">;</span>

    <span class="token comment">//å±€éƒ¨å˜é‡è¡¨</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalVars</span> localVars<span class="token punctuation">;</span>

    <span class="token comment">//æ“ä½œæ•°æ ˆ</span>
    <span class="token keyword">private</span> <span class="token class-name">OperandStack</span> operandStack<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Thread</span> thread<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Method</span> method<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> nextPC<span class="token punctuation">;</span>
 
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,16),h=n("li",null,"å…³äºä»£ç ç»“æ„çœ‹åˆ°è¿™æœ‰ç‚¹æ„Ÿè§‰äº†å—ï¼Ÿ",-1),g=n("li",null,"Slotæ•°æ®æ§½ï¼Œå°±æ˜¯ä¸€ä¸ªæ•°ç»„ç»“æ„ï¼Œç”¨äºå­˜æ”¾æ•°æ®çš„ã€‚",-1),j=n("li",null,"æ“ä½œæ•°æ ˆã€å±€éƒ¨å˜é‡è¡¨ï¼Œéƒ½æ˜¯ä½¿ç”¨æ•°æ®æ§½è¿›è¡Œå…¥æ ˆå…¥æ ˆæ“ä½œã€‚",-1),f=n("li",null,[a("åœ¨æ ˆå¸§é‡Œï¼Œå¯ä»¥çœ‹åˆ°è¿æ¥ã€å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€æ–¹æ³•ã€çº¿ç¨‹ç­‰ï¼Œé‚£ä¹ˆæ–‡ä¸­è¯´åˆ°çš„å½“æœ‰ä¸€ä¸ªæ–°çš„"),n("code",null,"æ¯ä¸€ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶ï¼Œéƒ½ä¼šåˆ›å»ºå‡ºä¸€ä¸ªæ ˆå¸§"),a("ï¼Œæ˜¯ä¸å°±å¯¹äº†ä¸Šï¼Œå¯ä»¥çœŸçš„ç†è§£äº†ã€‚")],-1),_=n("code",null,"ç”¨Javaå®ç°JVMæºç ",-1),w={href:"https://github.com/fuzhengwei/itstack-demo-jvm",target:"_blank",rel:"noopener noreferrer"},y=t(`<h2 id="å…­ã€jconsoleç›‘æµ‹å…ƒç©ºé—´æº¢å‡º" tabindex="-1"><a class="header-anchor" href="#å…­ã€jconsoleç›‘æµ‹å…ƒç©ºé—´æº¢å‡º" aria-hidden="true">#</a> å…­ã€jconsoleç›‘æµ‹å…ƒç©ºé—´æº¢å‡º</h2><p>ä¸æ˜¯è¯´ JDK 1.8 çš„å†…å­˜æ¨¡å‹æŠŠæ°¸ä¹…ä»£ä¸‹æ‰ï¼Œæ¢ä¸Š<code>å…ƒç©ºé—´</code>äº†å—ï¼Ÿä½†ä¸æµ‹è¯•ä¸‹ï¼Œå°±æ„Ÿå—ä¸åˆ°å‘€ï¼Œæ²¡æœ‰è¯æ®ï¼</p><p>æ‰€æœ‰å…³äºä»£ç é€»è¾‘çš„å­¦ä¹ ï¼Œéƒ½éœ€è¦æœ‰æ•°æ®åŸºç¡€å’Œè¯æ˜è¿‡ç¨‹ï¼Œè¿™æ ·æ‰èƒ½æœ‰æ·±åˆ»çš„å°è±¡ã€‚èµ°ç€ï¼Œå¸¦ä½ æŠŠå…ƒç©ºé—´å¹²æ»¡ï¼Œè®©å®ƒOOMï¼</p><h3 id="_1-æ‰¾æ®µæŒç»­åˆ›å»ºå¤§å¯¹è±¡çš„ä»£ç " tabindex="-1"><a class="header-anchor" href="#_1-æ‰¾æ®µæŒç»­åˆ›å»ºå¤§å¯¹è±¡çš„ä»£ç " aria-hidden="true">#</a> 1. æ‰¾æ®µæŒç»­åˆ›å»ºå¤§å¯¹è±¡çš„ä»£ç </h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">ClassLoadingMXBean</span> loadingBean <span class="token operator">=</span> <span class="token class-name">ManagementFactory</span><span class="token punctuation">.</span><span class="token function">getClassLoadingMXBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span><span class="token class-name">MetaSpaceOomMock</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setCallbackTypes</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">Dispatcher</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">MethodInterceptor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setCallbackFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CallbackFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">Method</span> method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>enhancer<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> loadingBean<span class="token punctuation">.</span><span class="token function">getTotalLoadedClassCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> loadingBean<span class="token punctuation">.</span><span class="token function">getLoadedClassCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> loadingBean<span class="token punctuation">.</span><span class="token function">getUnloadedClassCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ç½‘ä¸Šæ‰¾äº†ä¸€æ®µåŸºäºCGLIBçš„ï¼Œä½ å¯ä»¥å†™ä¸€äº›å…¶ä»–çš„ã€‚</li><li><code>Thread.sleep(5000);</code>ï¼Œç¡ä¸€ä¼šï¼Œæ–¹ä¾¿æˆ‘ä»¬ç‚¹æ£€æµ‹ï¼Œè¦ä¸ç¨‹åºå¤ªå¿«å°±å¼‚å¸¸äº†ã€‚</li></ul><h3 id="_2-è°ƒæ•´å…ƒç©ºé—´å¤§å°" tabindex="-1"><a class="header-anchor" href="#_2-è°ƒæ•´å…ƒç©ºé—´å¤§å°" aria-hidden="true">#</a> 2. è°ƒæ•´å…ƒç©ºé—´å¤§å°</h3><p>é»˜è®¤æƒ…å†µä¸‹å…ƒç©ºé—´å¤ªå¤§äº†ï¼Œä¸æ–¹ä¾¿æµ‹è¯•å‡ºç»“æœï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå®ƒè°ƒçš„å°ä¸€ç‚¹ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">MetaspaceSize</span><span class="token operator">=</span><span class="token number">8</span>m
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">MaxMetaspaceSize</span><span class="token operator">=</span><span class="token number">80</span>m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-è®¾ç½®ç›‘æ§å‚æ•°" tabindex="-1"><a class="header-anchor" href="#_3-è®¾ç½®ç›‘æ§å‚æ•°" aria-hidden="true">#</a> 3. è®¾ç½®ç›‘æ§å‚æ•°</h3><p>åŸºäº jconsole ç›‘æ§ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸‹å‚æ•°ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">-</span><span class="token class-name">Djava</span><span class="token punctuation">.</span>rmi<span class="token punctuation">.</span>server<span class="token punctuation">.</span>hostname<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
<span class="token operator">-</span><span class="token class-name">Dcom</span><span class="token punctuation">.</span>sun<span class="token punctuation">.</span>management<span class="token punctuation">.</span>jmxremote
<span class="token operator">-</span><span class="token class-name">Dcom</span><span class="token punctuation">.</span>sun<span class="token punctuation">.</span>management<span class="token punctuation">.</span>jmxremote<span class="token punctuation">.</span>port<span class="token operator">=</span><span class="token number">7397</span>
<span class="token operator">-</span><span class="token class-name">Dcom</span><span class="token punctuation">.</span>sun<span class="token punctuation">.</span>management<span class="token punctuation">.</span>jmxremote<span class="token punctuation">.</span>ssl<span class="token operator">=</span><span class="token boolean">false</span>
<span class="token operator">-</span><span class="token class-name">Dcom</span><span class="token punctuation">.</span>sun<span class="token punctuation">.</span>management<span class="token punctuation">.</span>jmxremote<span class="token punctuation">.</span>authenticate<span class="token operator">=</span><span class="token boolean">false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-æµ‹è¯•è¿è¡Œ" tabindex="-1"><a class="header-anchor" href="#_4-æµ‹è¯•è¿è¡Œ" aria-hidden="true">#</a> 4. æµ‹è¯•è¿è¡Œ</h3><h4 id="_4-1-é…ç½®å‚æ•°" tabindex="-1"><a class="header-anchor" href="#_4-1-é…ç½®å‚æ•°" aria-hidden="true">#</a> 4.1 é…ç½®å‚æ•°</h4><p><strong>ä»¥ä¸Šçš„æµ‹è¯•å‚æ•°</strong>ï¼Œé…ç½®åˆ°IDEAä¸­è¿è¡Œç¨‹åºé‡Œå°±å¯ä»¥ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://bugstack.cn/assets/images/2020/interview/interview-25-5.png" alt="å›¾ 25-5 è®¾ç½®ç¨‹åºè¿è¡Œå‚æ•°ï¼Œç›‘æ§OOM"></p><p>å¦å¤–ï¼Œjconsole å¯ä»¥é€šè¿‡ IDEA æä¾›çš„ Terminal å¯åŠ¨ï¼Œç›´æ¥è¾“å…¥ <code>jconsole</code>ï¼Œå›è½¦å³å¯ã€‚</p><h4 id="_4-2-æµ‹è¯•ç»“æœ" tabindex="-1"><a class="header-anchor" href="#_4-2-æµ‹è¯•ç»“æœ" aria-hidden="true">#</a> 4.2 æµ‹è¯•ç»“æœ</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>interview<span class="token punctuation">.</span></span>MetaSpaceOomMock</span>$$<span class="token class-name">EnhancerByCGLIB</span>$$bd2bb16e999099900
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>interview<span class="token punctuation">.</span></span>MetaSpaceOomMock</span>$$<span class="token class-name">EnhancerByCGLIB</span>$$<span class="token number">9</span>c774e64999199910
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>interview<span class="token punctuation">.</span></span>MetaSpaceOomMock</span>$$<span class="token class-name">EnhancerByCGLIB</span>$$cac97732999299920
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>interview<span class="token punctuation">.</span></span>MetaSpaceOomMock</span>$$<span class="token class-name">EnhancerByCGLIB</span>$$<span class="token number">91</span>c6a15a999399930
<span class="token class-name">Exception</span> in thread <span class="token string">&quot;main&quot;</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>IllegalStateException</span><span class="token operator">:</span> <span class="token class-name">Unable</span> <span class="token keyword">to</span> <span class="token namespace">load</span> cache item
	at <span class="token class-name"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>LoadingCache</span><span class="token punctuation">.</span><span class="token function">createEntry</span><span class="token punctuation">(</span><span class="token class-name">LoadingCache</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">79</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>LoadingCache</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">LoadingCache</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>AbstractClassGenerator</span>$<span class="token class-name">ClassLoaderData</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">AbstractClassGenerator</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">119</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>AbstractClassGenerator</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">AbstractClassGenerator</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">294</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span>Enhancer</span><span class="token punctuation">.</span><span class="token function">createHelper</span><span class="token punctuation">(</span><span class="token class-name">Enhancer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">480</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span>Enhancer</span><span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token class-name">Enhancer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">337</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>interview<span class="token punctuation">.</span></span>MetaSpaceOomMock</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">MetaSpaceOomMock</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
<span class="token class-name">Caused</span> by<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>OutOfMemoryError</span><span class="token operator">:</span> <span class="token class-name">Metaspace</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Class</span><span class="token punctuation">.</span><span class="token function">forName0</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">348</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ReflectUtils</span><span class="token punctuation">.</span><span class="token function">defineClass</span><span class="token punctuation">(</span><span class="token class-name">ReflectUtils</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">467</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>AbstractClassGenerator</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token class-name">AbstractClassGenerator</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">339</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span>Enhancer</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token class-name">Enhancer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">492</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>AbstractClassGenerator</span>$<span class="token class-name">ClassLoaderData</span>$<span class="token number">3.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">AbstractClassGenerator</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">96</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>AbstractClassGenerator</span>$<span class="token class-name">ClassLoaderData</span>$<span class="token number">3.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">AbstractClassGenerator</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">94</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>LoadingCache</span>$<span class="token number">2.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token class-name">LoadingCache</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">54</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>FutureTask</span><span class="token punctuation">.</span>run$$$<span class="token function">capture</span><span class="token punctuation">(</span><span class="token class-name">FutureTask</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">266</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>FutureTask</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">FutureTask</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>LoadingCache</span><span class="token punctuation">.</span><span class="token function">createEntry</span><span class="token punctuation">(</span><span class="token class-name">LoadingCache</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">61</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">6</span> more
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¦çš„å°±æ˜¯è¿™å¥ï¼Œjava.lang.OutOfMemoryError: Metaspaceï¼Œå…ƒç©ºé—´OOMï¼Œè¯æ˜ JDK1.8 å·²ç»å»æ‰æ°¸ä¹…ä»£ï¼Œæ¢ä½å…ƒç©ºé—´ã€‚</li></ul><h4 id="_4-3-ç›‘æ§æˆªå›¾" tabindex="-1"><a class="header-anchor" href="#_4-3-ç›‘æ§æˆªå›¾" aria-hidden="true">#</a> 4.3 ç›‘æ§æˆªå›¾</h4><p><img src="https://bugstack.cn/assets/images/2020/interview/interview-25-6.png" alt="å›¾ 25-6 jconsoleç›‘æµ‹å…ƒç©ºé—´æº¢å‡º"></p><ul><li>å›¾ 25-6ï¼Œå°±æ˜¯ç›‘æµ‹ç¨‹åºOOMæ—¶çš„å…ƒç©ºé—´è¡¨ç°ã€‚è¿™å›å¯¹è¿™ä¸ªå…ƒç©ºé—´å°±æœ‰æ„Ÿè§‰äº†å§ï¼</li></ul><h2 id="ä¸ƒã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€æ€»ç»“" aria-hidden="true">#</a> ä¸ƒã€æ€»ç»“</h2><ul><li>æœ¬æ–‡ä» JDK å„ä¸ªç‰ˆæœ¬å…³äºå†…å­˜æ¨¡å‹ç»“æ„çš„æ¼”å˜ï¼Œæ¥äº†è§£å„ä¸ªåŒºåŸŸï¼ŒåŒ…æ‹¬ï¼šç¨‹åºè®¡æ•°å™¨ã€Java è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€å †å’Œå…ƒç©ºé—´ã€‚å¹¶äº†è§£ä» JDK 1.8 å¼€å§‹å»æ‰æ–¹æ³•åŒºå¼•å…¥å…ƒç©ºé—´çš„æ ¸å¿ƒç›®çš„å’Œä½œç”¨ã€‚</li><li>åœ¨é€šè¿‡æ‰‹æ’¸JVMä»£ç çš„æ–¹å¼è®©å¤§å®¶å¯¹è¿è¡Œæ—¶æ•°æ®åŒºæœ‰ä¸€ä¸ªæ•´ä½“çš„è®¤çŸ¥ï¼Œä¹Ÿé€šè¿‡è¿™æ ·çš„æ–¹å¼è®©å¤§å®¶å¯¹å­¦ä¹ è¿™éƒ¨åˆ†çŸ¥è¯†æœ‰ä¸€ä¸ªæŠ“æ‰‹ã€‚</li><li>æœ€åæˆ‘ä»¬é€šè¿‡ jconsole æ£€æµ‹å…ƒç©ºé—´æº¢å‡ºçš„æ•´ä¸ªè¿‡ç¨‹ï¼Œæ¥å­¦ä»¥è‡´ç”¨ï¼Œçœ‹çœ‹å…ƒç©ºé—´åˆ°åº•åœ¨è§£å†³ä»€ä¹ˆé—®é¢˜ä»¥åŠæ€ä¹ˆæµ‹è¯•ã€‚</li></ul>`,25);function M(x,J){const s=c("ExternalLinkIcon");return o(),l("div",null,[u,n("p",null,[a("ä½œè€…ï¼šå°å‚…å“¥ "),r,a("åšå®¢ï¼š"),n("a",k,[a("https://bugstack.cn"),e(s)])]),d,n("p",null,[m,a(" Move part of the contents of the permanent generation in Hotspot to the Java heap and the remainder to native memory. "),n("a",v,[a("http://openjdk.java.net/jeps/122"),e(s)])]),b,n("ul",null,[h,g,j,f,n("li",null,[a("å¦‚æœä½ å¯¹JVMçš„å®ç°æ„Ÿå…´è¶£ï¼Œå¯ä»¥é˜…è¯»"),_,a("ï¼š"),n("a",w,[a("https://github.com/fuzhengwei/itstack-demo-jvm"),e(s)])])]),y])}const S=p(i,[["render",M],["__file","2021-01-06-mianjingshouce Â· di25pianã€ŠJVMnacunmoxingzongjieï¼ŒyougebanbenJDKduibiã€youyuankongjianOOMjiankonganliã€youJavabanxunijiï¼Œzonghexuexigengrongyiï¼ã€‹.html.vue"]]);export{S as default};
