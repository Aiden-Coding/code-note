import{_ as p,r as o,o as c,c as i,a as n,b as s,d as t,e}from"./app-3RcBQnkC.js";const l={},u=n("h1",{id:"ã€Šspring-æ‰‹æ’¸ä¸“æ ã€‹ç¬¬-8-ç« -é¾™è¡Œæœ‰é£-å‘è™šæ‹Ÿæœºæ³¨å†Œé’©å­-å®ç°beanå¯¹è±¡çš„åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ã€Šspring-æ‰‹æ’¸ä¸“æ ã€‹ç¬¬-8-ç« -é¾™è¡Œæœ‰é£-å‘è™šæ‹Ÿæœºæ³¨å†Œé’©å­-å®ç°beanå¯¹è±¡çš„åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•","aria-hidden":"true"},"#"),s(" ã€ŠSpring æ‰‹æ’¸ä¸“æ ã€‹ç¬¬ 8 ç« ï¼šé¾™è¡Œæœ‰é£ï¼Œå‘è™šæ‹Ÿæœºæ³¨å†Œé’©å­ï¼Œå®ç°Beanå¯¹è±¡çš„åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•")],-1),r=n("br",null,null,-1),k={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=n("br",null,null,-1),v={href:"https://mp.weixin.qq.com/s/eQIg3Fd2oUeRLdSrRSGVPw",target:"_blank",rel:"noopener noreferrer"},m=e('<blockquote><p>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„</p></blockquote><h2 id="ä¸€ã€å‰è¨€" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‰è¨€" aria-hidden="true">#</a> ä¸€ã€å‰è¨€</h2><p><code>æœ‰ä»€ä¹ˆæ–¹å¼ï¼Œèƒ½ç»™ä»£ç ç•™æ¡æ´»è·¯ï¼Ÿ</code></p><p><img src="https://bugstack.cn/assets/images/spring/spring-8-01.png" alt=""></p><p>æœ‰äººè¯´ï¼šäººäººéƒ½æ˜¯äº§å“ç»ç†ï¼Œé‚£ä½ çŸ¥é“å—ï¼Œäººäººä¹Ÿéƒ½å¯ä»¥æ˜¯ç å†œç¨‹åºå‘˜ï¼å°±åƒï¼š</p><ul><li>ç¼–ç¨‹å°±æ˜¯ï¼›å®šä¹‰å±æ€§ã€åˆ›å»ºæ–¹æ³•ã€è°ƒç”¨å±•ç¤º</li><li>Java å’Œ PHP å°±åƒç”·äººå’Œå¥³äººï¼Œå‰è€…åœ¨ä¹æ¶æ„åŒ–æ¨¡å—åï¼Œåè€…åœ¨ä¹é‚£ä¸ªé¢œè‰²æˆ‘å–œæ¬¢</li><li>ç”¨å¿ƒå†™ï¼Œä½†ä¸è¦ä¸åšæ ¼å¼åŒ–</li><li>åˆæ¬¡å’Œäº§å“å¯¹æ¥çš„ä¸‰ä¸ªå®ï¼šç –å¤´ã€é“é”¹ã€èœåˆ€ï¼Œåˆ†åˆ«ä¿è¯æœ‰ç”¨ã€å¯ç”¨ã€å¥½ç”¨</li><li>ä»ä¸€è¡Œä»£ç åˆ°ä¸€å¨ä»£ç ï¼Œå¼€å‘è¶Šæ¥è¶Šéš¾ï¼Œå£å’ä¹Ÿè¶Šæ¥è¶Šé«˜</li></ul><hr><p>å…¶å®å­¦ä¼šå†™ä»£ç å¹¶ä¸éš¾ï¼Œä½†å­¦ä¼šå†™å¥½ä»£ç å´å¾ˆéš¾ã€‚ä»æ˜“é˜…è¯»ä¸Šæ¥è¯´ä½ çš„ä»£ç è¦æœ‰å‡†ç¡®çš„å‘½åå’Œæ¸…æ™°çš„æ³¨é‡Šã€ä»æ˜“ä½¿ç”¨ä¸Šæ¥è¯´ä½ çš„ä»£ç è¦å…·å¤‡è®¾è®¡æ¨¡å¼çš„åŒ…è£…è®©å¯¹å¤–çš„æœåŠ¡è°ƒç”¨æ›´ç®€å•ã€ä»æ˜“æ‰©å±•ä¸Šæ¥è¯´ä½ çš„ä»£ç è¦åšå¥½ä¸šåŠ¡å’ŒåŠŸèƒ½çš„å®ç°åˆ†å±‚ã€‚åœ¨æ˜“é˜…è¯»ã€æ˜“ä½¿ç”¨ã€æ˜“æ‰©å±•ä»¥åŠæ›´å¤šç¼–ç è§„èŒƒçš„çº¦æŸä¸‹ï¼Œè¿˜éœ€è¦åœ¨å¼€å‘å®Œæˆä¸Šçº¿åçš„äº¤ä»˜ç»“æœä¸Šæ»¡è¶³ï¼›é«˜å¯ç”¨ã€é«˜æ€§èƒ½ã€é«˜å¹¶å‘ï¼Œä¸æ­¤åŒæ—¶ä½ è¿˜ä¼šæ¥åˆ°ç°æœ‰é¡¹ç›®ä¸­å±‚å‡ºä¸ç©·æ¥è‡ªäº§å“ç»ç†æ–°å¢çš„éœ€æ±‚ã€‚</p><p><strong>ğŸ™æ€ä¹ˆåŠï¼ŸçŸ¥é“ä½ åœ¨ç ç –ï¼Œä¸çŸ¥é“ä½ åœ¨ç›–å“ªä¸ªçŒªåœˆï¼</strong></p><p>å°±ç®—ç çš„ç –æ˜¯ç›–çš„çŒªåœˆï¼Œä¹Ÿå¾—å› ä¸ºçŒªå¤šæ‰©é¢ç§¯ã€æ”¹æ°´æ§½ã€åŠ é¥²æ–™å‘€ï¼Œæ‰€ä»¥æ ¹æœ¬æ²¡æ³•ä¿è¯ä½ å†™å®Œçš„ä»£ç å°±ä¸ä¼šåŠ éœ€æ±‚ã€‚é‚£ä¹ˆæ–°åŠ çš„éœ€æ±‚å¦‚æœæ˜¯ä»¥ç ´åäº†ä½ åŸæœ‰çš„å°è£…äº†éå¸¸å®Œç¾500è¡Œçš„ <code>ifelse</code> å’‹åŠï¼Œæ‹†äº†é‡ç›–å—ï¼Ÿ</p>',10),b={href:"https://u.jd.com/qPnzanP",target:"_blank",rel:"noopener noreferrer"},g={href:"https://bugstack.cn/itstack/spring.html",target:"_blank",rel:"noopener noreferrer"},h=e(`<h2 id="äºŒã€ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#äºŒã€ç›®æ ‡" aria-hidden="true">#</a> äºŒã€ç›®æ ‡</h2><p>å½“æˆ‘ä»¬çš„ç±»åˆ›å»ºçš„ Bean å¯¹è±¡ï¼Œäº¤ç»™ Spring å®¹å™¨ç®¡ç†ä»¥åï¼Œè¿™ä¸ªç±»å¯¹è±¡å°±å¯ä»¥è¢«èµ‹äºˆæ›´å¤šçš„ä½¿ç”¨èƒ½åŠ›ã€‚å°±åƒæˆ‘ä»¬åœ¨ä¸Šä¸€ç« èŠ‚å·²ç»ç»™ç±»å¯¹è±¡æ·»åŠ äº†ä¿®æ”¹æ³¨å†ŒBeanå®šä¹‰æœªå®ä¾‹åŒ–å‰çš„å±æ€§ä¿¡æ¯ä¿®æ”¹å’Œåˆå§‹åŒ–è¿‡ç¨‹ä¸­çš„å‰ç½®å’Œåç½®å¤„ç†ï¼Œè¿™äº›é¢å¤–èƒ½åŠ›çš„å®ç°ï¼Œéƒ½å¯ä»¥è®©æˆ‘ä»¬å¯¹ç°æœ‰å·¥ç¨‹ä¸­çš„ç±»å¯¹è±¡åšç›¸åº”çš„æ‰©å±•å¤„ç†ã€‚</p><p>é‚£ä¹ˆé™¤æ­¤ä¹‹å¤–æˆ‘ä»¬è¿˜å¸Œæœ›å¯ä»¥åœ¨ Bean åˆå§‹åŒ–è¿‡ç¨‹ï¼Œæ‰§è¡Œä¸€äº›æ“ä½œã€‚æ¯”å¦‚å¸®æˆ‘ä»¬åšä¸€äº›æ•°æ®çš„åŠ è½½æ‰§è¡Œï¼Œé“¾æ¥æ³¨å†Œä¸­å¿ƒæš´éœ²RPCæ¥å£ä»¥åŠåœ¨Webç¨‹åºå…³é—­æ—¶æ‰§è¡Œé“¾æ¥æ–­å¼€ï¼Œå†…å­˜é”€æ¯ç­‰æ“ä½œã€‚<em>å¦‚æœè¯´æ²¡æœ‰Springæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ„é€ å‡½æ•°ã€é™æ€æ–¹æ³•ä»¥åŠæ‰‹åŠ¨è°ƒç”¨çš„æ–¹å¼å®ç°ï¼Œä½†è¿™æ ·çš„å¤„ç†æ–¹å¼ç»ˆç©¶ä¸å¦‚æŠŠè¯¸å¦‚æ­¤ç±»çš„æ“ä½œéƒ½äº¤ç»™ Spring å®¹å™¨æ¥ç®¡ç†æ›´åŠ åˆé€‚ã€‚</em> å› æ­¤ä½ ä¼šçœ‹åˆ°åˆ° spring.xml ä¸­æœ‰å¦‚ä¸‹æ“ä½œï¼š</p><p><img src="https://bugstack.cn/assets/images/spring/spring-8-02.png" alt=""></p><ul><li>éœ€è¦æ»¡è¶³ç”¨æˆ·å¯ä»¥åœ¨ xml ä¸­é…ç½®åˆå§‹åŒ–å’Œé”€æ¯çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®ç°ç±»çš„æ–¹å¼å¤„ç†ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ä½¿ç”¨ Spring æ—¶ç”¨åˆ°çš„ InitializingBean, DisposableBean ä¸¤ä¸ªæ¥å£ã€‚ -å…¶å®è¿˜å¯ä»¥æœ‰ä¸€ç§æ˜¯æ³¨è§£çš„æ–¹å¼å¤„ç†åˆå§‹åŒ–æ“ä½œï¼Œä¸è¿‡ç›®å‰è¿˜æ²¡æœ‰å®ç°åˆ°æ³¨è§£çš„é€»è¾‘ï¼Œåç»­å†å®Œå–„æ­¤ç±»åŠŸèƒ½ã€‚</li></ul><h2 id="ä¸‰ã€è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€è®¾è®¡" aria-hidden="true">#</a> ä¸‰ã€è®¾è®¡</h2><p>å¯èƒ½é¢å¯¹åƒ Spring è¿™æ ·åºå¤§çš„æ¡†æ¶ï¼Œå¯¹å¤–æš´éœ²çš„æ¥å£å®šä¹‰ä½¿ç”¨æˆ–è€…xmlé…ç½®ï¼Œå®Œæˆçš„ä¸€ç³»åˆ—æ‰©å±•æ€§æ“ä½œï¼Œéƒ½è®© Spring æ¡†æ¶çœ‹ä¸Šå»å¾ˆç¥ç§˜ã€‚å…¶å®å¯¹äºè¿™æ ·åœ¨ Bean å®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­é¢å¤–æ·»åŠ çš„å¤„ç†æ“ä½œï¼Œæ— éå°±æ˜¯é¢„å…ˆæ‰§è¡Œäº†ä¸€ä¸ªå®šä¹‰å¥½çš„æ¥å£æ–¹æ³•æˆ–è€…æ˜¯åå°„è°ƒç”¨ç±»ä¸­xmlä¸­é…ç½®çš„æ–¹æ³•ï¼Œæœ€ç»ˆä½ åªè¦æŒ‰ç…§æ¥å£å®šä¹‰å®ç°ï¼Œå°±ä¼šæœ‰ Spring å®¹å™¨åœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­è¿›è¡Œè°ƒç”¨è€Œå·²ã€‚æ•´ä½“è®¾è®¡ç»“æ„å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://bugstack.cn/assets/images/spring/spring-8-03.png" alt=""></p><ul><li>åœ¨ spring.xml é…ç½®ä¸­æ·»åŠ  <code>init-methodã€destroy-method</code> ä¸¤ä¸ªæ³¨è§£ï¼Œåœ¨é…ç½®æ–‡ä»¶åŠ è½½çš„è¿‡ç¨‹ä¸­ï¼ŒæŠŠæ³¨è§£é…ç½®ä¸€å¹¶å®šä¹‰åˆ° BeanDefinition çš„å±æ€§å½“ä¸­ã€‚è¿™æ ·åœ¨ initializeBean åˆå§‹åŒ–æ“ä½œçš„å·¥ç¨‹ä¸­ï¼Œå°±å¯ä»¥é€šè¿‡åå°„çš„æ–¹å¼æ¥è°ƒç”¨é…ç½®åœ¨ Bean å®šä¹‰å±æ€§å½“ä¸­çš„æ–¹æ³•ä¿¡æ¯äº†ã€‚å¦å¤–å¦‚æœæ˜¯æ¥å£å®ç°çš„æ–¹å¼ï¼Œé‚£ä¹ˆç›´æ¥å¯ä»¥é€šè¿‡ Bean å¯¹è±¡è°ƒç”¨å¯¹åº”æ¥å£å®šä¹‰çš„æ–¹æ³•å³å¯ï¼Œ<code>((InitializingBean) bean).afterPropertiesSet()</code>ï¼Œä¸¤ç§æ–¹å¼è¾¾åˆ°çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</li><li>é™¤äº†åœ¨åˆå§‹åŒ–åšçš„æ“ä½œå¤–ï¼Œ<code>destroy-method</code> å’Œ <code>DisposableBean</code> æ¥å£çš„å®šä¹‰ï¼Œéƒ½ä¼šåœ¨ Bean å¯¹è±¡åˆå§‹åŒ–å®Œæˆé˜¶æ®µï¼Œæ‰§è¡Œæ³¨å†Œé”€æ¯æ–¹æ³•çš„ä¿¡æ¯åˆ° DefaultSingletonBeanRegistry ç±»ä¸­çš„ disposableBeans å±æ€§é‡Œï¼Œè¿™æ˜¯ä¸ºäº†åç»­ç»Ÿä¸€è¿›è¡Œæ“ä½œã€‚<em>è¿™é‡Œè¿˜æœ‰ä¸€æ®µé€‚é…å™¨çš„ä½¿ç”¨ï¼Œå› ä¸ºåå°„è°ƒç”¨å’Œæ¥å£ç›´æ¥è°ƒç”¨ï¼Œæ˜¯ä¸¤ç§æ–¹å¼ã€‚æ‰€ä»¥éœ€è¦ä½¿ç”¨é€‚é…å™¨è¿›è¡ŒåŒ…è£…ï¼Œä¸‹æ–‡ä»£ç è®²è§£ä¸­å‚è€ƒ DisposableBeanAdapter çš„å…·ä½“å®ç°</em> -å…³äºé”€æ¯æ–¹æ³•éœ€è¦åœ¨è™šæ‹Ÿæœºæ‰§è¡Œå…³é—­ä¹‹å‰è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ç”¨åˆ°ä¸€ä¸ªæ³¨å†Œé’©å­çš„æ“ä½œï¼Œå¦‚ï¼š<code>Runtime.getRuntime().addShutdownHook(new Thread(() -&gt; System.out.println(&quot;closeï¼&quot;)));</code> <em>è¿™æ®µä»£ç ä½ å¯ä»¥æ‰§è¡Œæµ‹è¯•</em>ï¼Œå¦å¤–ä½ å¯ä»¥ä½¿ç”¨æ‰‹åŠ¨è°ƒç”¨ ApplicationContext.close æ–¹æ³•å…³é—­å®¹å™¨ã€‚</li></ul><h2 id="å››ã€å®ç°" tabindex="-1"><a class="header-anchor" href="#å››ã€å®ç°" aria-hidden="true">#</a> å››ã€å®ç°</h2><h3 id="_1-å·¥ç¨‹ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1-å·¥ç¨‹ç»“æ„" aria-hidden="true">#</a> 1. å·¥ç¨‹ç»“æ„</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>small<span class="token operator">-</span>spring<span class="token operator">-</span>step<span class="token operator">-</span><span class="token number">07</span>
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework
    â”‚           â”œâ”€â”€ beans
    â”‚           â”‚   â”œâ”€â”€ factory
    â”‚           â”‚   â”‚   â”œâ”€â”€ config
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AutowireCapableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanDefinition</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanFactoryPostProcessor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanPostProcessor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanReference</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ConfigurableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ <span class="token class-name">SingletonBeanRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractBeanDefinitionReader</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanDefinitionReader</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanDefinitionRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">CglibSubclassingInstantiationStrategy</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DefaultListableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DefaultSingletonBeanRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DisposableBeanAdapter</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">InstantiationStrategy</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ <span class="token class-name">SimpleInstantiationStrategy</span><span class="token punctuation">.</span>java  
    â”‚           â”‚   â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ <span class="token class-name">XmlBeanDefinitionReader</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ConfigurableListableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DisposableBean</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">HierarchicalBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">InitializingBean</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">ListableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">BeansException</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">PropertyValue</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">PropertyValues</span><span class="token punctuation">.</span>java 
    â”‚           â”œâ”€â”€ context
    â”‚           â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractRefreshableApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractXmlApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ core<span class="token punctuation">.</span>io
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ClassPathResource</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">DefaultResourceLoader</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">FileSystemResource</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">Resource</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ResourceLoader</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">UrlResource</span><span class="token punctuation">.</span>java
    â”‚           â””â”€â”€ utils
    â”‚               â””â”€â”€ <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span>java
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test
                â”œâ”€â”€ bean
                â”‚   â”œâ”€â”€ <span class="token class-name">UserDao</span><span class="token punctuation">.</span>java
                â”‚   â””â”€â”€ <span class="token class-name">UserService</span><span class="token punctuation">.</span>java
                â””â”€â”€ <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å·¥ç¨‹æºç </strong>ï¼š<code>å…¬ä¼—å·ã€Œbugstackè™«æ´æ ˆã€ï¼Œå›å¤ï¼šSpring ä¸“æ ï¼Œè·å–å®Œæ•´æºç </code></p><p>Spring åº”ç”¨ä¸Šä¸‹æ–‡å’Œå¯¹Beanå¯¹è±¡æ‰©å±•æœºåˆ¶çš„ç±»å…³ç³»ï¼Œå¦‚å›¾ 8-4</p><p><img src="https://bugstack.cn/assets/images/spring/spring-8-04.png" alt="å›¾ 8-4"></p><ul><li>ä»¥ä¸Šæ•´ä¸ªç±»å›¾ç»“æ„æè¿°å‡ºæ¥çš„å°±æ˜¯æœ¬æ¬¡æ–°å¢ Bean å®ä¾‹åŒ–è¿‡ç¨‹ä¸­çš„åˆå§‹åŒ–æ–¹æ³•å’Œé”€æ¯æ–¹æ³•ã€‚</li><li>å› ä¸ºæˆ‘ä»¬ä¸€å…±å®ç°äº†ä¸¤ç§æ–¹å¼çš„åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•ï¼Œxmlé…ç½®å’Œå®šä¹‰æ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œæ—¢æœ‰ InitializingBeanã€DisposableBean ä¹Ÿæœ‰éœ€è¦ XmlBeanDefinitionReader åŠ è½½ spring.xml é…ç½®ä¿¡æ¯åˆ° BeanDefinition ä¸­ã€‚</li><li>å¦å¤–æ¥å£ ConfigurableBeanFactory å®šä¹‰äº† destroySingletons é”€æ¯æ–¹æ³•ï¼Œå¹¶ç”± AbstractBeanFactory ç»§æ‰¿çš„çˆ¶ç±» DefaultSingletonBeanRegistry å®ç° ConfigurableBeanFactory æ¥å£å®šä¹‰çš„ destroySingletons æ–¹æ³•ã€‚<em>è¿™ç§æ–¹å¼çš„è®¾è®¡å¯èƒ½æ•°ç¨‹åºå‘˜æ˜¯æ²¡æœ‰ç”¨è¿‡çš„ï¼Œéƒ½æ˜¯ç”¨çš„è°å®ç°æ¥å£è°å®Œæˆå®ç°ç±»ï¼Œè€Œä¸æ˜¯æŠŠå®ç°æ¥å£çš„æ“ä½œåˆäº¤ç»™ç»§æ‰¿çš„çˆ¶ç±»å¤„ç†ã€‚æ‰€ä»¥è¿™å—è¿˜æ˜¯è›®æœ‰æ„æ€çš„ï¼Œæ˜¯ä¸€ç§ä¸é”™çš„éš”ç¦»åˆ†å±‚æœåŠ¡çš„è®¾è®¡æ–¹å¼</em></li><li>æœ€åå°±æ˜¯å…³äºå‘è™šæ‹Ÿæœºæ³¨å†Œé’©å­ï¼Œä¿è¯åœ¨è™šæ‹Ÿæœºå…³é—­ä¹‹å‰ï¼Œæ‰§è¡Œé”€æ¯æ“ä½œã€‚<code>Runtime.getRuntime().addShutdownHook(new Thread(() -&gt; System.out.println(&quot;closeï¼&quot;)));</code></li></ul><h3 id="_2-å®šä¹‰åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•çš„æ¥å£" tabindex="-1"><a class="header-anchor" href="#_2-å®šä¹‰åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•çš„æ¥å£" aria-hidden="true">#</a> 2. å®šä¹‰åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•çš„æ¥å£</h3><p><strong>cn.bugstack.springframework.beans.factory.InitializingBean</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">InitializingBean</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * Bean å¤„ç†äº†å±æ€§å¡«å……åè°ƒç”¨
     * 
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>cn.bugstack.springframework.beans.factory.DisposableBean</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DisposableBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>InitializingBeanã€DisposableBeanï¼Œä¸¤ä¸ªæ¥å£æ–¹æ³•è¿˜æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ï¼Œåœ¨ä¸€äº›éœ€è¦ç»“åˆ Spring å®ç°çš„ç»„ä»¶ä¸­ï¼Œç»å¸¸ä¼šä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•æ¥åšä¸€äº›å‚æ•°çš„åˆå§‹åŒ–å’Œé”€æ¯æ“ä½œã€‚æ¯”å¦‚æ¥å£æš´æ¼ã€æ•°æ®åº“æ•°æ®è¯»å–ã€é…ç½®æ–‡ä»¶åŠ è½½ç­‰ç­‰ã€‚</li></ul><h3 id="_3-beanå±æ€§å®šä¹‰æ–°å¢åˆå§‹åŒ–å’Œé”€æ¯" tabindex="-1"><a class="header-anchor" href="#_3-beanå±æ€§å®šä¹‰æ–°å¢åˆå§‹åŒ–å’Œé”€æ¯" aria-hidden="true">#</a> 3. Beanå±æ€§å®šä¹‰æ–°å¢åˆå§‹åŒ–å’Œé”€æ¯</h3><p><strong>cn.bugstack.springframework.beans.factory.config.BeanDefinition</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanDefinition</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Class</span> beanClass<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">PropertyValues</span> propertyValues<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> initMethodName<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">String</span> destroyMethodName<span class="token punctuation">;</span>
    
    <span class="token comment">// ...get/set</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨ BeanDefinition æ–°å¢åŠ äº†ä¸¤ä¸ªå±æ€§ï¼šinitMethodNameã€destroyMethodNameï¼Œè¿™ä¸¤ä¸ªå±æ€§æ˜¯ä¸ºäº†åœ¨ spring.xml é…ç½®çš„ Bean å¯¹è±¡ä¸­ï¼Œå¯ä»¥é…ç½® <code>init-method=&quot;initDataMethod&quot; destroy-method=&quot;destroyDataMethod&quot;</code> æ“ä½œï¼Œæœ€ç»ˆå®ç°æ¥å£çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚<em>åªä¸è¿‡ä¸€ä¸ªæ˜¯æ¥å£æ–¹æ³•çš„ç›´æ¥è°ƒç”¨ï¼Œå¦å¤–æ˜¯ä¸€ä¸ªåœ¨é…ç½®æ–‡ä»¶ä¸­è¯»å–åˆ°æ–¹æ³•åå°„è°ƒç”¨</em></li></ul><p><strong>cn.bugstack.springframework.beans.factory.xml.XmlBeanDefinitionReader</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XmlBeanDefinitionReader</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractBeanDefinitionReader</span> <span class="token punctuation">{</span>

    <span class="token comment">//Constructor</span>

    <span class="token comment">//å…¶ä»–æ–¹æ³•</span>
    
    <span class="token comment">//doLoadBeanDefinitionsä¸­å¢åŠ å¯¹init-methodã€destroy-methodçš„è¯»å–</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doLoadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">{</span>
        <span class="token class-name">Document</span> doc <span class="token operator">=</span> <span class="token class-name">XmlUtil</span><span class="token punctuation">.</span><span class="token function">readXML</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Element</span> root <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getDocumentElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">NodeList</span> childNodes <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">getChildNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> childNodes<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>childNodes<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Element</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;bean&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>childNodes<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNodeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">Element</span> bean <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> childNodes<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> id <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> name <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> className <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">//å¢åŠ å¯¹init-methodã€destroy-methodçš„è¯»å–</span>
            <span class="token class-name">String</span> initMethod <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;init-method&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> destroyMethodName <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;destroy-method&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> beanName <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">?</span> id <span class="token operator">:</span> name<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                beanName <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">lowerFirst</span><span class="token punctuation">(</span>clazz<span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">BeanDefinition</span> beanDefinition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinition</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">//é¢å¤–è®¾ç½®åˆ°beanDefinitionä¸­</span>
            beanDefinition<span class="token punctuation">.</span><span class="token function">setInitMethodName</span><span class="token punctuation">(</span>initMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>
            beanDefinition<span class="token punctuation">.</span><span class="token function">setDestroyMethodName</span><span class="token punctuation">(</span>destroyMethodName<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> bean<span class="token punctuation">.</span><span class="token function">getChildNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>bean<span class="token punctuation">.</span><span class="token function">getChildNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Element</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;property&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>bean<span class="token punctuation">.</span><span class="token function">getChildNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNodeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//è§£ææ ‡ç­¾ï¼šproperty</span>
                <span class="token class-name">Element</span> property <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> bean<span class="token punctuation">.</span><span class="token function">getChildNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> attrName <span class="token operator">=</span> property<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> attrValue <span class="token operator">=</span> property<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> attrRef <span class="token operator">=</span> property<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;ref&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Object</span> value <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>attrRef<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">BeanReference</span><span class="token punctuation">(</span>attrRef<span class="token punctuation">)</span> <span class="token operator">:</span> attrValue<span class="token punctuation">;</span>
                <span class="token class-name">PropertyValue</span> propertyValue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PropertyValue</span><span class="token punctuation">(</span>attrName<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                beanDefinition<span class="token punctuation">.</span><span class="token function">getPropertyValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addPropertyValue</span><span class="token punctuation">(</span>propertyValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeansException</span><span class="token punctuation">(</span><span class="token string">&quot;Duplicate beanName[&quot;</span><span class="token operator">+</span>beanName<span class="token operator">+</span><span class="token string">&quot;] is not allowed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span>beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Beanå±æ€§å®šä¹‰å¢åŠ åˆå§‹åŒ–å’Œé”€æ¯åï¼Œè¿˜éœ€è¦åœ¨<code>XmlBeanDefinitionReader</code>ç±»ä¸­ï¼Œå¢åŠ å¯¹æ–°å¢å±æ€§çš„è¯»å–ï¼Œå¹¶æ·»åŠ åˆ°BeanDefinitionä¸­</li></ul><h3 id="_4-æ‰§è¡Œ-bean-å¯¹è±¡çš„åˆå§‹åŒ–æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_4-æ‰§è¡Œ-bean-å¯¹è±¡çš„åˆå§‹åŒ–æ–¹æ³•" aria-hidden="true">#</a> 4. æ‰§è¡Œ Bean å¯¹è±¡çš„åˆå§‹åŒ–æ–¹æ³•</h3><p><strong>cn.bugstack.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractAutowireCapableBeanFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractBeanFactory</span> <span class="token keyword">implements</span> <span class="token class-name">AutowireCapableBeanFactory</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">InstantiationStrategy</span> instantiationStrategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CglibSubclassingInstantiationStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">createBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> bean <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            bean <span class="token operator">=</span> <span class="token function">createBeanInstance</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ç»™ Bean å¡«å……å±æ€§</span>
            <span class="token function">applyPropertyValues</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ‰§è¡Œ Bean çš„åˆå§‹åŒ–æ–¹æ³•å’Œ BeanPostProcessor çš„å‰ç½®å’Œåç½®å¤„ç†æ–¹æ³•</span>
            bean <span class="token operator">=</span> <span class="token function">initializeBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeansException</span><span class="token punctuation">(</span><span class="token string">&quot;Instantiation of bean failed&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// ...</span>

        <span class="token function">addSingleton</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">initializeBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. æ‰§è¡Œ BeanPostProcessor Before å¤„ç†</span>
        <span class="token class-name">Object</span> wrappedBean <span class="token operator">=</span> <span class="token function">applyBeanPostProcessorsBeforeInitialization</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ‰§è¡Œ Bean å¯¹è±¡çš„åˆå§‹åŒ–æ–¹æ³•</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">invokeInitMethods</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> wrappedBean<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeansException</span><span class="token punctuation">(</span><span class="token string">&quot;Invocation of init method of bean[&quot;</span> <span class="token operator">+</span> beanName <span class="token operator">+</span> <span class="token string">&quot;] failed&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 2. æ‰§è¡Œ BeanPostProcessor After å¤„ç†</span>
        wrappedBean <span class="token operator">=</span> <span class="token function">applyBeanPostProcessorsAfterInitialization</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> wrappedBean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">invokeInitMethods</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. å®ç°æ¥å£ InitializingBean</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">InitializingBean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">InitializingBean</span><span class="token punctuation">)</span> bean<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 2. é…ç½®ä¿¡æ¯ init-method {åˆ¤æ–­æ˜¯ä¸ºäº†é¿å…äºŒæ¬¡æ‰§è¡Œé”€æ¯}</span>
        <span class="token class-name">String</span> initMethodName <span class="token operator">=</span> beanDefinition<span class="token punctuation">.</span><span class="token function">getInitMethodName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>initMethodName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Method</span> initMethod <span class="token operator">=</span> beanDefinition<span class="token punctuation">.</span><span class="token function">getBeanClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>initMethodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> initMethod<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeansException</span><span class="token punctuation">(</span><span class="token string">&quot;Could not find an init method named &#39;&quot;</span> <span class="token operator">+</span> initMethodName <span class="token operator">+</span> <span class="token string">&quot;&#39; on bean with name &#39;&quot;</span> <span class="token operator">+</span> beanName <span class="token operator">+</span> <span class="token string">&quot;&#39;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            initMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æŠ½è±¡ç±» AbstractAutowireCapableBeanFactory ä¸­çš„ createBean æ˜¯ç”¨æ¥åˆ›å»º Bean å¯¹è±¡çš„æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­æˆ‘ä»¬ä¹‹å‰å·²ç»æ‰©å±•äº† BeanFactoryPostProcessorã€BeanPostProcessor æ“ä½œï¼Œè¿™é‡Œæˆ‘ä»¬ç»§ç»­å®Œå–„æ‰§è¡Œ Bean å¯¹è±¡çš„åˆå§‹åŒ–æ–¹æ³•çš„å¤„ç†åŠ¨ä½œã€‚</li><li>åœ¨æ–¹æ³• invokeInitMethods ä¸­ï¼Œä¸»è¦åˆ†ä¸ºä¸¤å—æ¥æ‰§è¡Œå®ç°äº† InitializingBean æ¥å£çš„æ“ä½œï¼Œå¤„ç† afterPropertiesSet æ–¹æ³•ã€‚å¦å¤–ä¸€ä¸ªæ˜¯åˆ¤æ–­é…ç½®ä¿¡æ¯ init-method æ˜¯å¦å­˜åœ¨ï¼Œæ‰§è¡Œåå°„è°ƒç”¨ initMethod.invoke(bean)ã€‚è¿™ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥åœ¨ Bean å¯¹è±¡åˆå§‹åŒ–è¿‡ç¨‹ä¸­è¿›è¡Œå¤„ç†åŠ è½½ Bean å¯¹è±¡ä¸­çš„åˆå§‹åŒ–æ“ä½œï¼Œè®©ä½¿ç”¨è€…å¯ä»¥é¢å¤–æ–°å¢åŠ è‡ªå·±æƒ³è¦çš„åŠ¨ä½œã€‚</li></ul><h3 id="_5-å®šä¹‰é”€æ¯æ–¹æ³•é€‚é…å™¨-æ¥å£å’Œé…ç½®" tabindex="-1"><a class="header-anchor" href="#_5-å®šä¹‰é”€æ¯æ–¹æ³•é€‚é…å™¨-æ¥å£å’Œé…ç½®" aria-hidden="true">#</a> 5. å®šä¹‰é”€æ¯æ–¹æ³•é€‚é…å™¨(æ¥å£å’Œé…ç½®)</h3><p><strong>cn.bugstack.springframework.beans.factory.support.DisposableBeanAdapter</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DisposableBeanAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">DisposableBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> bean<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> beanName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> destroyMethodName<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DisposableBeanAdapter</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bean <span class="token operator">=</span> bean<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>beanName <span class="token operator">=</span> beanName<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>destroyMethodName <span class="token operator">=</span> beanDefinition<span class="token punctuation">.</span><span class="token function">getDestroyMethodName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. å®ç°æ¥å£ DisposableBean</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">DisposableBean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">DisposableBean</span><span class="token punctuation">)</span> bean<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 2. é…ç½®ä¿¡æ¯ destroy-method {åˆ¤æ–­æ˜¯ä¸ºäº†é¿å…äºŒæ¬¡æ‰§è¡Œé”€æ¯}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>destroyMethodName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">DisposableBean</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;destroy&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>destroyMethodName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Method</span> destroyMethod <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>destroyMethodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> destroyMethod<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeansException</span><span class="token punctuation">(</span><span class="token string">&quot;Couldn&#39;t find a destroy method named &#39;&quot;</span> <span class="token operator">+</span> destroyMethodName <span class="token operator">+</span> <span class="token string">&quot;&#39; on bean with name &#39;&quot;</span> <span class="token operator">+</span> beanName <span class="token operator">+</span> <span class="token string">&quot;&#39;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            destroyMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¯èƒ½ä½ ä¼šæƒ³è¿™é‡Œæ€ä¹ˆæœ‰ä¸€ä¸ªé€‚é…å™¨çš„ç±»å‘¢ï¼Œå› ä¸ºé”€æ¯æ–¹æ³•æœ‰ä¸¤ç§ç”šè‡³å¤šç§æ–¹å¼ï¼Œç›®å‰æœ‰<code>å®ç°æ¥å£ DisposableBean</code>ã€<code>é…ç½®ä¿¡æ¯ destroy-method</code>ï¼Œä¸¤ç§æ–¹å¼ã€‚è€Œè¿™ä¸¤ç§æ–¹å¼çš„é”€æ¯åŠ¨ä½œæ˜¯ç”± AbstractApplicationContext åœ¨æ³¨å†Œè™šæ‹Ÿæœºé’©å­åçœ‹ï¼Œè™šæ‹Ÿæœºå…³é—­å‰æ‰§è¡Œçš„æ“ä½œåŠ¨ä½œã€‚</li><li>é‚£ä¹ˆåœ¨é”€æ¯æ‰§è¡Œæ—¶ä¸å¤ªå¸Œæœ›è¿˜å¾—å…³æ³¨éƒ½é”€æ¯é‚£äº›ç±»å‹çš„æ–¹æ³•ï¼Œå®ƒçš„ä½¿ç”¨ä¸Šæ›´å¸Œæœ›æ˜¯æœ‰ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£è¿›è¡Œé”€æ¯ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ–°å¢äº†é€‚é…ç±»ï¼Œåšç»Ÿä¸€å¤„ç†ã€‚</li></ul><h3 id="_6-åˆ›å»ºbeanæ—¶æ³¨å†Œé”€æ¯æ–¹æ³•å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#_6-åˆ›å»ºbeanæ—¶æ³¨å†Œé”€æ¯æ–¹æ³•å¯¹è±¡" aria-hidden="true">#</a> 6. åˆ›å»ºBeanæ—¶æ³¨å†Œé”€æ¯æ–¹æ³•å¯¹è±¡</h3><p><strong>cn.bugstack.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractAutowireCapableBeanFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractBeanFactory</span> <span class="token keyword">implements</span> <span class="token class-name">AutowireCapableBeanFactory</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">InstantiationStrategy</span> instantiationStrategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CglibSubclassingInstantiationStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">createBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> bean <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            bean <span class="token operator">=</span> <span class="token function">createBeanInstance</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ç»™ Bean å¡«å……å±æ€§</span>
            <span class="token function">applyPropertyValues</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ‰§è¡Œ Bean çš„åˆå§‹åŒ–æ–¹æ³•å’Œ BeanPostProcessor çš„å‰ç½®å’Œåç½®å¤„ç†æ–¹æ³•</span>
            bean <span class="token operator">=</span> <span class="token function">initializeBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeansException</span><span class="token punctuation">(</span><span class="token string">&quot;Instantiation of bean failed&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// æ³¨å†Œå®ç°äº† DisposableBean æ¥å£çš„ Bean å¯¹è±¡</span>
        <span class="token function">registerDisposableBeanIfNecessary</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">addSingleton</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">registerDisposableBeanIfNecessary</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">DisposableBean</span> <span class="token operator">||</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">.</span><span class="token function">getDestroyMethodName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">registerDisposableBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DisposableBeanAdapter</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨åˆ›å»º Bean å¯¹è±¡çš„å®ä¾‹çš„æ—¶å€™ï¼Œéœ€è¦æŠŠé”€æ¯æ–¹æ³•ä¿å­˜èµ·æ¥ï¼Œæ–¹ä¾¿åç»­æ‰§è¡Œé”€æ¯åŠ¨ä½œè¿›è¡Œè°ƒç”¨ã€‚</li><li>é‚£ä¹ˆè¿™ä¸ªé”€æ¯æ–¹æ³•çš„å…·ä½“æ–¹æ³•ä¿¡æ¯ï¼Œä¼šè¢«æ³¨å†Œåˆ° DefaultSingletonBeanRegistry ä¸­æ–°å¢åŠ çš„ <code>Map&lt;String, DisposableBean&gt; disposableBeans</code> å±æ€§ä¸­å»ï¼Œå› ä¸ºè¿™ä¸ªæ¥å£çš„æ–¹æ³•æœ€ç»ˆå¯ä»¥è¢«ç±» AbstractApplicationContext çš„ close æ–¹æ³•é€šè¿‡ <code>getBeanFactory().destroySingletons()</code> è°ƒç”¨ã€‚</li><li>åœ¨æ³¨å†Œé”€æ¯æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šæ ¹æ®æ˜¯æ¥å£ç±»å‹å’Œé…ç½®ç±»å‹ç»Ÿä¸€äº¤ç»™ DisposableBeanAdapter é”€æ¯é€‚é…å™¨ç±»æ¥åšç»Ÿä¸€å¤„ç†ã€‚<em>å®ç°äº†æŸä¸ªæ¥å£çš„ç±»å¯ä»¥è¢« instanceof åˆ¤æ–­æˆ–è€…å¼ºè½¬åè°ƒç”¨æ¥å£æ–¹æ³•</em></li></ul><h3 id="_7-è™šæ‹Ÿæœºå…³é—­é’©å­æ³¨å†Œè°ƒç”¨é”€æ¯æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_7-è™šæ‹Ÿæœºå…³é—­é’©å­æ³¨å†Œè°ƒç”¨é”€æ¯æ–¹æ³•" aria-hidden="true">#</a> 7. è™šæ‹Ÿæœºå…³é—­é’©å­æ³¨å†Œè°ƒç”¨é”€æ¯æ–¹æ³•</h3><p><strong>cn.bugstack.springframework.context.ConfigurableApplicationContext</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token keyword">extends</span> <span class="token class-name">ApplicationContext</span> <span class="token punctuation">{</span>

    <span class="token keyword">void</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">registerShutdownHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨ ConfigurableApplicationContext æ¥å£ä¸­å®šä¹‰æ³¨å†Œè™šæ‹Ÿæœºé’©å­çš„æ–¹æ³• <code>registerShutdownHook</code> å’Œæ‰‹åŠ¨æ‰§è¡Œå…³é—­çš„æ–¹æ³• <code>close</code>ã€‚</li></ul><p><strong>cn.bugstack.springframework.context.support.AbstractApplicationContext</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractApplicationContext</span> <span class="token keyword">extends</span> <span class="token class-name">DefaultResourceLoader</span> <span class="token keyword">implements</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token punctuation">{</span>

    <span class="token comment">// ...</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerShutdownHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addShutdownHook</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">::</span><span class="token function">close</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">destroySingletons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™é‡Œä¸»è¦ä½“ç°äº†å…³äºæ³¨å†Œé’©å­å’Œå…³é—­çš„æ–¹æ³•å®ç°ï¼Œä¸Šæ–‡æåˆ°è¿‡çš„ <code>Runtime.getRuntime().addShutdownHook</code>ï¼Œå¯ä»¥å°è¯•éªŒè¯ã€‚åœ¨ä¸€äº›ä¸­é—´ä»¶å’Œç›‘æ§ç³»ç»Ÿçš„è®¾è®¡ä¸­ä¹Ÿå¯ä»¥ç”¨å¾—åˆ°ï¼Œæ¯”å¦‚ç›‘æµ‹æœåŠ¡å™¨å®•æœºï¼Œæ‰§è¡Œå¤‡æœºå¯åŠ¨æ“ä½œã€‚</li></ul><h2 id="äº”ã€æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#äº”ã€æµ‹è¯•" aria-hidden="true">#</a> äº”ã€æµ‹è¯•</h2><h3 id="_1-äº‹å…ˆå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#_1-äº‹å…ˆå‡†å¤‡" aria-hidden="true">#</a> 1. äº‹å…ˆå‡†å¤‡</h3><p><strong>cn.bugstack.springframework.test.bean.UserDao</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDao</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> hashMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initDataMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œï¼šinit-method&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;10002&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;å…«æ¯æ°´&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;10003&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;é˜¿æ¯›&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroyDataMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œï¼šdestroy-method&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hashMap<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">queryUserName</span><span class="token punctuation">(</span><span class="token class-name">String</span> uId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> hashMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>uId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>cn.bugstack.springframework.test.bean.UserService</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token keyword">implements</span> <span class="token class-name">InitializingBean</span><span class="token punctuation">,</span> <span class="token class-name">DisposableBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> uId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> company<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> location<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œï¼šUserService.destroy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œï¼šUserService.afterPropertiesSet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...get/set</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>UserDaoï¼Œä¿®æ”¹äº†ä¹‹å‰ä½¿ç”¨ static é™æ€å—åˆå§‹åŒ–æ•°æ®çš„æ–¹å¼ï¼Œæ”¹ä¸ºæä¾› initDataMethod å’Œ destroyDataMethod ä¸¤ä¸ªæ›´ä¼˜é›…çš„æ“ä½œæ–¹å¼è¿›è¡Œå¤„ç†ã€‚</li><li>UserServiceï¼Œä»¥å®ç°æ¥å£ InitializingBean, DisposableBean çš„ä¸¤ä¸ªæ–¹æ³• destroy()ã€afterPropertiesSet()ï¼Œå¤„ç†ç›¸åº”çš„åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•çš„åŠ¨ä½œã€‚<em>afterPropertiesSetï¼Œæ–¹æ³•åå­—å¾ˆå¥½ï¼Œåœ¨å±æ€§è®¾ç½®åæ‰§è¡Œ</em></li></ul><h3 id="_2-é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> 2. é…ç½®æ–‡ä»¶</h3><p><strong>åŸºç¡€é…ç½®ï¼Œæ— BeanFactoryPostProcessorã€BeanPostProcessorï¼Œå®ç°ç±»</strong></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.springframework.test.bean.UserDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">init-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>initDataMethod<span class="token punctuation">&quot;</span></span> <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>destroyDataMethod<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.springframework.test.bean.UserService<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10001<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>company<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>è…¾è®¯<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>location<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>æ·±åœ³<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userDao<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>é…ç½®æ–‡ä»¶ä¸­ä¸»è¦æ˜¯æ–°å¢äº†ï¼Œ<code>init-method=&quot;initDataMethod&quot; destroy-method=&quot;destroyDataMethod&quot;</code>ï¼Œè¿™æ ·ä¸¤ä¸ªé…ç½®ã€‚ä»æºç çš„å­¦ä¹ ä¸­å¯ä»¥çŸ¥é“ï¼Œè¿™ä¸¤ä¸ªé…ç½®æ˜¯ä¸ºäº†åŠ å…¥åˆ° BeanDefinition å®šä¹‰ç±»ä¹‹åå†™å…¥åˆ°ç±» DefaultListableBeanFactory ä¸­çš„ beanDefinitionMap å±æ€§ä¸­å»ã€‚</li></ul><h3 id="_3-å•å…ƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-å•å…ƒæµ‹è¯•" aria-hidden="true">#</a> 3. å•å…ƒæµ‹è¯•</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_xml</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.åˆå§‹åŒ– BeanFactory</span>
    <span class="token class-name">ClassPathXmlApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:spring.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    applicationContext<span class="token punctuation">.</span><span class="token function">registerShutdownHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      

    <span class="token comment">// 2. è·å–Beanå¯¹è±¡è°ƒç”¨æ–¹æ³•</span>
    <span class="token class-name">UserService</span> userService <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">,</span> <span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> result <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">queryUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•ç»“æœï¼š&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æµ‹è¯•æ–¹æ³•ä¸­æ–°å¢åŠ äº†ä¸€ä¸ªï¼Œæ³¨å†Œé’©å­çš„åŠ¨ä½œã€‚<code>applicationContext.registerShutdownHook();</code></li></ul><p><strong>æµ‹è¯•ç»“æœ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>æ‰§è¡Œï¼šinit<span class="token operator">-</span>method
æ‰§è¡Œï¼š<span class="token class-name">UserService</span><span class="token punctuation">.</span>afterPropertiesSet
æµ‹è¯•ç»“æœï¼šå°å‚…å“¥<span class="token punctuation">,</span>è…¾è®¯<span class="token punctuation">,</span>æ·±åœ³
æ‰§è¡Œï¼š<span class="token class-name">UserService</span><span class="token punctuation">.</span>destroy
æ‰§è¡Œï¼šdestroy<span class="token operator">-</span>method

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä»æµ‹è¯•ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„æ–°å¢åŠ çš„åˆå§‹å’Œé”€æ¯æ–¹æ³•å·²ç»å¯ä»¥å¦‚æœŸè¾“å‡ºç»“æœäº†ã€‚</li></ul><h2 id="å…­ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#å…­ã€æ€»ç»“" aria-hidden="true">#</a> å…­ã€æ€»ç»“</h2><ul><li>æœ¬æ–‡ä¸»è¦å®Œæˆäº†å…³äºåˆå§‹å’Œé”€æ¯åœ¨ä½¿ç”¨æ¥å£å®šä¹‰ <code>implements InitializingBean, DisposableBean</code> å’Œåœ¨spring.xmlä¸­é…ç½® <code>init-method=&quot;initDataMethod&quot; destroy-method=&quot;destroyDataMethod&quot;</code> çš„ä¸¤ç§å…·ä½“åœ¨ <code>AbstractAutowireCapableBeanFactory</code> å®Œæˆåˆå§‹æ–¹æ³•å’Œ <code>AbstractApplicationContext</code> å¤„ç†é”€æ¯åŠ¨ä½œçš„å…·ä½“å®ç°è¿‡ç¨‹ã€‚</li><li>é€šè¿‡æœ¬æ–‡çš„å®ç°å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°ç›®å‰è¿™ä¸ª Spring æ¡†æ¶å¯¹ Bean çš„æ“ä½œè¶Šæ¥è¶Šå®Œå–„äº†ï¼Œå¯æ‰©å±•æ€§ä¹Ÿä¸æ–­çš„å¢å¼ºã€‚ä½ æ—¢å¯ä»¥åœ¨Beanæ³¨å†Œå®Œæˆå®ä¾‹åŒ–å‰è¿›è¡Œ BeanFactoryPostProcessor æ“ä½œï¼Œä¹Ÿå¯ä»¥åœ¨Beanå®ä¾‹åŒ–è¿‡ç¨‹ä¸­æ‰§è¡Œå‰ç½®å’Œåç½®æ“ä½œï¼Œç°åœ¨åˆå¯ä»¥æ‰§è¡ŒBeançš„åˆå§‹åŒ–æ–¹æ³•å’Œé”€æ¯æ–¹æ³•ã€‚æ‰€ä»¥ä¸€ä¸ªç®€å•çš„Beanå¯¹è±¡ï¼Œå·²ç»è¢«èµ‹äºˆäº†å„ç§æ‰©å±•èƒ½åŠ›ã€‚</li><li>åœ¨å­¦ä¹ å’ŒåŠ¨æ‰‹å®è·µ Spring æ¡†æ¶å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œç‰¹åˆ«è¦æ³¨æ„çš„æ˜¯å®ƒå¯¹æ¥å£å’ŒæŠ½è±¡ç±»çš„æŠŠæ¡å’Œä½¿ç”¨ï¼Œå°¤å…¶é‡åˆ°ç±»ä¼¼ï¼ŒAç»§æ‰¿Bå®ç°Cæ—¶ï¼ŒCçš„æ¥å£æ–¹æ³•ç”±Aç»§æ‰¿çš„çˆ¶ç±»Bå®ç°ï¼Œè¿™æ ·çš„æ“ä½œéƒ½è›®æœ‰æ„æ€çš„ã€‚ä¹Ÿæ˜¯å¯ä»¥å¤ç”¨åˆ°é€šå¸¸çš„ä¸šåŠ¡ç³»ç»Ÿå¼€å‘ä¸­è¿›è¡Œå¤„ç†ä¸€äº›å¤æ‚é€»è¾‘çš„åŠŸèƒ½åˆ†å±‚ï¼Œåšåˆ°ç¨‹åºçš„å¯æ‰©å±•ã€æ˜“ç»´æŠ¤ç­‰ç‰¹æ€§ã€‚</li></ul><h2 id="ä¸ƒã€ä¼˜ç§€ä½œä¸š" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€ä¼˜ç§€ä½œä¸š" aria-hidden="true">#</a> ä¸ƒã€ä¼˜ç§€ä½œä¸š</h2>`,68),f={href:"https://t.zsxq.com/05uFuFyZv",target:"_blank",rel:"noopener noreferrer"},y={href:"https://t.zsxq.com/05MFeyNnq",target:"_blank",rel:"noopener noreferrer"},w={href:"https://t.zsxq.com/07fUsGksF",target:"_blank",rel:"noopener noreferrer"},B={href:"https://t.zsxq.com/07TERLkE7",target:"_blank",rel:"noopener noreferrer"},q={href:"https://t.zsxq.com/07bvUo57L",target:"_blank",rel:"noopener noreferrer"},x={href:"https://t.zsxq.com/08RcFtX8f",target:"_blank",rel:"noopener noreferrer"},S={href:"https://t.zsxq.com/08la8B8lf",target:"_blank",rel:"noopener noreferrer"},D={href:"https://t.zsxq.com/08ntSyZsk",target:"_blank",rel:"noopener noreferrer"},j={href:"https://t.zsxq.com/09ALmVSwy",target:"_blank",rel:"noopener noreferrer"},_={href:"https://t.zsxq.com/09ZM4qr33",target:"_blank",rel:"noopener noreferrer"},N={href:"https://t.zsxq.com/0a7g0rNuW",target:"_blank",rel:"noopener noreferrer"};function A(C,M){const a=o("ExternalLinkIcon");return c(),i("div",null,[u,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),r,s("åšå®¢ï¼š"),n("a",k,[s("https://bugstack.cn"),t(a)]),d,s("åŸæ–‡ï¼š"),n("a",v,[s("https://mp.weixin.qq.com/s/eQIg3Fd2oUeRLdSrRSGVPw"),t(a)])]),m,n("p",null,[s("å…„å˜šï¼Œç»™ä»£ç ç•™æ¡æ´»è·¯å§ï¼ä½ çš„ä»£ç ç”¨ä¸Šäº†å®šä¹‰æ¥å£å—ã€æ¥å£ç»§æ‰¿æ¥å£å—ã€æ¥å£ç”±æŠ½è±¡ç±»å®ç°å—ã€ç±»ç»§æ‰¿çš„ç±»å®ç°äº†æ¥å£æ–¹æ³•å—ï¼Œè€Œè¿™äº›æ“ä½œéƒ½æ˜¯ä¸ºäº†è®©ä½ çš„ç¨‹åºé€»è¾‘åšåˆ°åˆ†å±‚ã€åˆ†åŒºã€åˆ†å—ï¼ŒæŠŠæ ¸å¿ƒé€»è¾‘å±‚å’Œä¸šåŠ¡å°è£…å±‚åšå¥½éš”ç¦»ï¼Œå½“æœ‰ä¸šåŠ¡å˜åŒ–æ—¶å€™ï¼Œåªéœ€è¦åšåœ¨ä¸šåŠ¡å±‚å®Œæˆè£…é…ï¼Œè€Œåº•å±‚çš„æ ¸å¿ƒé€»è¾‘æœåŠ¡å¹¶ä¸éœ€è¦é¢‘ç¹å˜åŒ–ï¼Œå®ƒä»¬æ‰€å¢åŠ çš„æ¥å£ä¹Ÿæ›´åŸå­åŒ–ï¼Œä¸å…·å¤‡ä¸šåŠ¡è¯­æ„ã€‚æ‰€ä»¥è¿™æ ·çš„å®ç°æ–¹å¼æ‰èƒ½ç»™ä½ çš„ä»£ç ç•™æ¡æ´»è·¯ã€‚"),n("em",null,[s("å¦‚æœè¿˜ä¸æ˜¯å¤ªç†è§£ï¼Œå¯ä»¥å¤šçœ‹çœ‹"),n("a",b,[s("ã€Šé‡å­¦Javaè®¾è®¡æ¨¡å¼ã€‹"),t(a)]),s("å’Œç°åœ¨ç¼–å†™çš„"),n("a",g,[s("ã€Šæ‰‹æ’¸Springã€‹"),t(a)]),s("ï¼Œè¿™é‡Œé¢éƒ½æœ‰å¤§é‡çš„è®¾è®¡æ¨¡å¼åº”ç”¨å®è·µ")])]),h,n("ul",null,[n("li",null,[n("a",f,[s("InitializingBeanå’ŒBeanPostProcessor ä½œç”¨åŸŸæ¢³ç† @W"),t(a)])]),n("li",null,[n("a",y,[s("ä¹‹å‰ç‰¹åœ°ç©ºäº†ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•å‡ºæ¥ï¼Œè¿™ç« å°±æ˜¯æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ä»¥åŠé”€æ¯åŠŸèƒ½ @Chin"),t(a)])]),n("li",null,[n("a",w,[s("å®šä¹‰ã€æ‰§è¡Œåˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³• @liuc"),t(a)])]),n("li",null,[n("a",B,[s("springç¬¬8èŠ‚ï¼Œå¯¹springè¶Šæ¥è¶Šæ¸…æ™°äº† @èµ›åšä¸çœŸ"),t(a)])]),n("li",null,[n("a",q,[s("åœ¨Shutdowné’©å­è§¦å‘æ—¶ï¼Œè§¦å‘closeæ–¹æ³•ï¼Œéå†DisposableBean Mapï¼Œæ‰§è¡Œdestoryæ–¹æ³•ã€‚ @å‚…å“¥åæ´ä¼šä¼šé•¿"),t(a)])]),n("li",null,[n("a",x,[s("å®ç° Bean çš„åˆå§‹åŒ–ï¼Œå¯ä»¥ç”¨æ¥æå‰åŠ è½½æ•°æ®ç­‰ã€‚@Homage"),t(a)])]),n("li",null,[n("a",S,[s("æ„ŸçŸ¥å¯¹è±¡å®¹å™¨ç¬”è®° @å‚…å“¥åæ´ä¼šä¼šé•¿"),t(a)])]),n("li",null,[n("a",D,[s("åœ¨ Bean åˆå§‹åŒ–æ—¶ï¼Œéœ€è¦æ‰§è¡Œä¸€äº›å¦‚æ•°æ®åŠ è½½ã€è¿æ¥æ³¨å†Œä¸­å¿ƒæš´éœ² RPC è§£è€¦ç­‰æ“ä½œ @æ°´ä¸­ææœˆ"),t(a)])]),n("li",null,[n("a",j,[s("åœ¨å®ä¾‹åŒ–å¯¹è±¡å®Œæˆï¼Œå±æ€§å¡«å……åï¼Œå¯¹è±¡çš„å‰ç½®å¤„ç†ä¹‹å‰è¿›è¡Œæ„ŸçŸ¥å®¹å™¨åˆ¤æ–­ @Liuliuliu"),t(a)])]),n("li",null,[n("a",_,[s("æœ¬ç« èŠ‚ä¸»è¦æ˜¯è¿›ä¸€æ­¥æ‰©å±•å¯¹Beançš„æ“ä½œï¼Œä¸»è¦æ˜¯æä¾›Beanåˆå§‹åŒ–å’Œé”€æ¯çš„æ–¹æ³• @åœ¨ä¹æœˆ"),t(a)])]),n("li",null,[n("a",N,[s("è¡¥å……beançš„ç”Ÿå‘½å‘¨æœŸå¤„ç† @æ­¢æ°´"),t(a)])])])])}const I=p(l,[["render",A],["__file","2021-06-23-di8zhangï¼šlongxingyoufengï¼Œxiangxunijizhucegouziï¼ŒshixianBeanduixiangdechushihuahexiaohuifangfa.html.vue"]]);export{I as default};
