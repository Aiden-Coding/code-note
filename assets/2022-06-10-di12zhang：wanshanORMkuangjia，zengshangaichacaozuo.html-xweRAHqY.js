import{_ as e,r as p,o as c,c as o,a as n,b as s,d as t,e as l}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"ã€Šmybatis-æ‰‹æ’¸ä¸“æ ã€‹ç¬¬12ç« -å®Œå–„ormæ¡†æ¶-å¢åˆ æ”¹æŸ¥æ“ä½œ",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ã€Šmybatis-æ‰‹æ’¸ä¸“æ ã€‹ç¬¬12ç« -å®Œå–„ormæ¡†æ¶-å¢åˆ æ”¹æŸ¥æ“ä½œ","aria-hidden":"true"},"#"),s(" ã€ŠMybatis æ‰‹æ’¸ä¸“æ ã€‹ç¬¬12ç« ï¼šå®Œå–„ORMæ¡†æ¶ï¼Œå¢åˆ æ”¹æŸ¥æ“ä½œ")],-1),r=n("br",null,null,-1),k={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=n("br",null,null,-1),m={href:"https://mp.weixin.qq.com/s/_-LYA6uZhB7GQ-50C0IZYA",target:"_blank",rel:"noopener noreferrer"},v=n("blockquote",null,[n("p",null,"æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„")],-1),b=n("iframe",{id:"B-Video",src:"//player.bilibili.com/player.html?aid=430236300&bvid=BV1eG411G7fk&cid=823607781&page=1",scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",width:"100%",height:"480"}," ",-1),g=l(`<h2 id="ä¸€ã€å‰è¨€" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‰è¨€" aria-hidden="true">#</a> ä¸€ã€å‰è¨€</h2><p><code>æ—¶é—´å†å¤šä¸€ä»¶äº‹æƒ…ä¹Ÿä¸å¯èƒ½åšçš„å®Œç¾ï¼Œä½†æ€»æœ‰æ—¶é—´åšå®Œä¸€ä»¶äº‹æƒ…ï¼</code></p><p>åœ¨æˆ‘ä»¬çš„ç”Ÿæ´»ä¸­ï¼Œè¦ç»å†å¾ˆå¤šé‡è¦çš„é˜¶æ®µï¼ŒåŒ…æ‹¬ï¼›é«˜è€ƒã€æ±‚å©šã€é¢è¯•ã€è¿°èŒï¼Œåœ¨æ‰€æœ‰äº‹æƒ…å‘ç”Ÿä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½åœ¨åšç€å¤§é‡çš„å‡†å¤‡ï¼Œç”šè‡³åƒä¸ºäº†é«˜è€ƒçš„è¿™æ ·çš„æ—¶é—´ç‚¹ï¼Œè¦å‡†å¤‡å¥½å‡ å¹´ã€‚å¯å³ä½¿æœ‰è¿™æ ·çš„å¤§é‡çš„å‡†å¤‡æ—¶é—´ï¼Œæˆ‘ä»¬å‡ ä¹ä¹Ÿæ²¡æœ‰åŠæ³•æŠŠæœ€ç»ˆçš„ç»“æœåšåˆ°å®Œç¾ï¼Œåªèƒ½æ˜¯æŠŠç»“æœåšå®Œã€‚<em>æ²¡æœ‰é—æ†¾çš„äººç”Ÿï¼Œæ‰æ˜¯é—æ†¾ï¼</em></p><p>å…¶å®æˆ‘ä»¬çš„ç³»ç»Ÿè®¾è®¡å¼€å‘ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œç³»ç»Ÿè¶Šåšè¶Šå¤æ‚ï¼ŒåŠŸèƒ½è¶Šåšè¶Šå¤šï¼Œä½†äººçš„æ™ºåŠ›æ˜¯æœ‰ä¸Šé™çš„ï¼Œæ°¸è¿œæ— æ³•å®Œå…¨è¯„ä¼°æœªå‘ç”Ÿçš„äº‹æƒ…ã€‚æ‰€ä»¥å¯¹äºä¸€ä¸ªå¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæˆ‘ä»¬å‡ ä¹æ°¸è¿œä¸å¯èƒ½æ‰¾åˆ°å¹¶ä¿®å¤æ‰€æœ‰çš„ bugï¼Œæœ‰æ—¶å€™è§£å†³æ–¹æ³•ä¹Ÿä¸æ˜¯å®Œå…¨æ‰¾å‡ºæ‰€æœ‰é—®é¢˜å¹¶æ¶ˆç­ï¼Œè€Œæ˜¯èƒ½å®¹å¿éƒ¨åˆ†å°é—®é¢˜ï¼Œå¹¶åœ¨è¿™äº›é—®é¢˜å‘ç”Ÿæ—¶å¯ä»¥è‡ªåŠ¨æ¢å¤ï¼Œåšåˆ°æœ€ç»ˆè¡¥å¿å¤„ç†ã€‚è€Œè¿™æ ·çš„è®¾è®¡ä¹Ÿç§°ä¸ºé«˜å¯ç”¨å’Œå¼¹æ€§è®¾è®¡ã€‚</p><h2 id="äºŒã€ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#äºŒã€ç›®æ ‡" aria-hidden="true">#</a> äºŒã€ç›®æ ‡</h2><p>å‰é¢å„ä¸ªç« èŠ‚çš„å†…å®¹ï¼Œæ¸è¿›å¼çš„é€æ­¥ä¸ºæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªåŸºæœ¬çš„æ¡†æ¶ç»“æ„ï¼Œèƒ½æ»¡è¶³æˆ‘ä»¬å¯¹ä¸€ä¸ª DAO æ–¹æ³•çš„æŸ¥è¯¢æ“ä½œï¼Œä»¥åŠå¤„ç†å¯¹åº”çš„å‚æ•°å’Œè¿”å›ç»“æœã€‚</p><p>é‚£ä¹ˆç›®å‰è¿™ä¸ªæ¡†æ¶ä¸­æ‰€æä¾›çš„ SQL å¤„ç†ä»…æœ‰ä¸€ä¸ª select æŸ¥è¯¢æ“ä½œï¼Œè¿˜æ²¡æœ‰å…¶ä»–æˆ‘ä»¬æ—¥å¸¸å¸¸ç”¨çš„ insertã€updateã€deleteï¼Œä»¥åŠ select æŸ¥è¯¢è¿”å›çš„é›†åˆç±»å‹æ•°æ®ã€‚</p><p>å…¶å®è¿™ä¸€éƒ¨åˆ†æ–°å¢å¤„ç† SQL çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯åœ¨ SqlSession éœ€è¦å®šä¹‰æ–°çš„æ¥å£ï¼Œé€šçŸ¥è®©è¿™äº›æ¥å£è¢«æ˜ å°„å™¨ç±»æ–¹æ³• MapperMethod è¿›è¡Œè°ƒç”¨å¤„ç†ã€‚å¦‚å›¾ 12-1 æ‰€ç¤º SqlSession å®šä¹‰æ“ä½œSQLæ–¹æ³•</p><p><img src="https://bugstack.cn/images/article/spring/mybatis-220610-01.png" alt="å›¾ 12-1  SqlSession å®šä¹‰æ“ä½œSQLæ–¹æ³• "></p><ul><li>ç»“åˆç€æˆ‘ä»¬ç›®å‰æ¡†æ¶çš„å¼€å‘ç»“æ„ï¼Œå¯¹äºæ‰©å±• <code>insert/update/delete</code> è¿™éƒ¨åˆ†åŠŸèƒ½æ¥è¯´ï¼Œå¹¶ä¸ä¼šå¤ªå¤æ‚çš„ã€‚å› ä¸ºä» XML å¯¹æ–¹æ³•çš„è§£æã€å‚æ•°çš„å¤„ç†ã€ç»“æœçš„å°è£…ï¼Œéƒ½å·²ç»æ˜¯æˆå‹çš„ç»“æ„ã€‚è€Œæˆ‘ä»¬åªæ˜¯å¯¹æŠŠè¿™éƒ¨åˆ†æ–°å¢é€»è¾‘ä»å‰åˆ°åä¸²è”åˆ° ORM æ¡†æ¶ä¸­å°±å¯ä»¥å®ç°å¯¹æ•°æ®åº“çš„æ–°å¢ã€ä¿®æ”¹å’Œåˆ é™¤æ“ä½œäº†ã€‚</li><li>æ‰€ä»¥è¯»è€…åœ¨é˜…è¯»è¿™éƒ¨åˆ†ä»£ç çš„æ—¶å€™ï¼Œå¯ä»¥ç»“åˆ XMLMapperBuilder æ–°å¢è§£æ <code>insert/update/delete</code> å’Œ SqlSession è°ƒç”¨æ‰§è¡Œå…¥å£è¿›è¡Œä»£ç è°ƒè¯•ï¼Œè¿™æ ·å°±èƒ½ä¸²è”å‡ºæ•´ä¸ªåŠŸèƒ½é“¾è·¯äº†ã€‚</li></ul><h2 id="ä¸‰ã€è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€è®¾è®¡" aria-hidden="true">#</a> ä¸‰ã€è®¾è®¡</h2><p>å‡å®šè¿™å°±æ˜¯ä½ æ­£åœ¨æ‰¿æ¥çš„ä¸šåŠ¡åŠŸèƒ½éœ€æ±‚ï¼Œä½ è¦åœ¨ç°åœ¨æœ‰çš„æ¡†æ¶ä¸­å®Œæˆå¯¹ <code>insert/update/delete</code> æ–¹æ³•çš„æ‰©å±•ã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ä½ éœ€è¦æ€è€ƒï¼Œå“ªé‡Œæ˜¯è¿™ä¸ªæµç¨‹çš„å¼€å§‹ï¼Œä¹‹åä»æµç¨‹çš„å¼€å§‹è¿›è¡Œæ¢³ç†ã€‚</p><p>é‚£ä¹ˆè¿™é‡Œæ˜¾è€Œæ˜“è§ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆè§£å†³çš„æ˜¯å¯¹ XML çš„è§£æï¼Œç”±äºä¹‹å‰åœ¨ ORM æ¡†æ¶çš„å¼€å‘ä¸­ï¼Œä»…æ˜¯å¤„ç†äº† select çš„ SQL ä¿¡æ¯ï¼Œç°åœ¨åˆ™éœ€è¦æŠŠ <code>insert/update/delete</code> çš„è¯­å¥ä¹ŸæŒ‰ç…§è§£æ select çš„æ–¹å¼è¿›è¡Œå¤„ç†ã€‚å¦‚å›¾ 12-2 æ‰€ç¤ºï¼Œæ–°å¢è§£æå†…å®¹</p><p><img src="https://bugstack.cn/images/article/spring/mybatis-220610-02.png" alt="å›¾ 12-2 æ–°å¢è§£æå†…å®¹"></p><p>åœ¨æ·»åŠ äº†è§£ææ–°ç±»å‹ SQL æ“ä½œå‰æä¸‹ï¼Œåç»­ DefaultSqlSession ä¸­æ–°å¢çš„æ‰§è¡Œ SQL æ–¹æ³• insert/update/delete å°±å¯ä»¥é€šè¿‡ Configuration é…ç½®é¡¹æ‹¿åˆ°å¯¹åº”çš„æ˜ å°„å™¨è¯­å¥ï¼Œå¹¶æ‰§è¡Œåç»­çš„å¤„ç†æµç¨‹ã€‚å…·ä½“è®¾è®¡ï¼Œå¦‚å›¾ 12-3 æ‰€ç¤ºï¼Œè§£æXML å¹¶å¤„ç† SQL è¯­å¥</p><p><img src="https://bugstack.cn/images/article/spring/mybatis-220610-03.png" alt="å›¾ 12-3 è§£æXML å¹¶å¤„ç† SQL è¯­å¥"></p><ul><li>åœ¨æ‰§è¡Œ <code>sqlSession.getMapper(IUserDao.class)</code> è·å– Mapper ä»¥åï¼Œåç»­çš„æµç¨‹ä¼šä¾æ¬¡ä¸²è”åˆ°æ˜ å°„å™¨å·¥å‚ã€æ˜ å°„å™¨ï¼Œä»¥åŠè·å–å¯¹åº”çš„æ˜ å°„å™¨æ–¹æ³•ï¼Œä» MapperMethod æ˜ å°„å™¨æ–¹æ³•å¼€å§‹ï¼Œè°ƒç”¨çš„å°±æ˜¯ DefaultSqlSession äº†ã€‚</li><li>é‚£ä¹ˆè¿™é‡Œè¦æ³¨æ„ï¼Œé™¤äº†æˆ‘ä»¬å·²ç»å¼€å‘å®Œçš„ DefaultSqlSession#select æ–¹æ³•ï¼Œå…¶ä»–å®šä¹‰çš„ insertã€deleteã€updateï¼Œéƒ½æ˜¯è°ƒç”¨å†…éƒ¨çš„ update æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯ Mybatis ORM æ¡†æ¶å¯¹æ­¤ç±»è¯­å¥å¤„ç†çš„ä¸€ä¸ªåŒ…è£…ã€‚å› ä¸ºé™¤äº† select æ–¹æ³•ï¼Œinsertã€deleteã€updateï¼Œéƒ½æ˜¯å…±æ€§å¤„ç†é€»è¾‘ï¼Œæ‰€ä»¥å¯ä»¥è¢«åŒ…è£…æˆä¸€ä¸ªé€»è¾‘æ¥å¤„ç†ã€‚</li></ul><h2 id="å››ã€å®ç°" tabindex="-1"><a class="header-anchor" href="#å››ã€å®ç°" aria-hidden="true">#</a> å››ã€å®ç°</h2><h3 id="_1-å·¥ç¨‹ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1-å·¥ç¨‹ç»“æ„" aria-hidden="true">#</a> 1. å·¥ç¨‹ç»“æ„</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>mybatis<span class="token operator">-</span>step<span class="token operator">-</span><span class="token number">11</span>
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis
    â”‚           â”œâ”€â”€ binding
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">MapperMethod</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">MapperProxy</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">MapperProxyFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">MapperRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ builder
    â”‚           â”‚   â”œâ”€â”€ xml
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">XMLConfigBuilder</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">XMLMapperBuilder</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">XMLStatementBuilder</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">BaseBuilder</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">MapperBuilderAssistant</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ParameterExpression</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">SqlSourceBuilder</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">StaticSqlSource</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ datasource
    â”‚           â”œâ”€â”€ executor
    â”‚           â”‚   â”œâ”€â”€ parameter
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">ParameterHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ result
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DefaultResultContext</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">DefaultResultHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ resultset
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DefaultResultSetHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">ResultSetHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">ResultSetWrapper</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ statement
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BaseStatementHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">PreparedStatementHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">SimpleStatementHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">StatementHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">BaseExecutor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">Executor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">SimpleExecutor</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ io
    â”‚           â”œâ”€â”€ mapping
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">BoundSql</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">Environment</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">MappedStatement</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ParameterMapping</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ResultMap</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ResultMapping</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">SqlCommandType</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">SqlSource</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ parsing
    â”‚           â”œâ”€â”€ reflection
    â”‚           â”œâ”€â”€ scripting
    â”‚           â”‚   â”œâ”€â”€ defaults
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DefaultParameterHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">RawSqlSource</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ xmltags
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DynamicContext</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">MixedSqlNode</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">SqlNode</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">StaticTextSqlNode</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">XMLLanguageDriver</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">XMLScriptBuilder</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">LanguageDriver</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">LanguageDriverRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ session
    â”‚           â”‚   â”œâ”€â”€ defaults
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DefaultSqlSession</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">DefaultSqlSessionFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">Configuration</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ResultContext</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ResultHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">RowBounds</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">SqlSession</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">SqlSessionFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">TransactionIsolationLevel</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ transaction
    â”‚           â””â”€â”€ type
    â””â”€â”€ test
        â”œâ”€â”€ java
        â”‚   â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span>dao
        â”‚       â”œâ”€â”€ dao
        â”‚       â”‚   â””â”€â”€ <span class="token class-name">IUserDao</span><span class="token punctuation">.</span>java
        â”‚       â”œâ”€â”€ po
        â”‚       â”‚   â””â”€â”€ <span class="token class-name">User</span><span class="token punctuation">.</span>java
        â”‚       â””â”€â”€ <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
        â””â”€â”€ resources
            â”œâ”€â”€ mapper
            â”‚   â””â”€â”€<span class="token class-name">User_Mapper</span><span class="token punctuation">.</span>xml
            â””â”€â”€ mybatis<span class="token operator">-</span>config<span class="token operator">-</span>datasource<span class="token punctuation">.</span>xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å·¥ç¨‹æºç </strong>ï¼š<code>å…¬ä¼—å·ã€Œbugstackè™«æ´æ ˆã€ï¼Œå›å¤ï¼šæ‰‹å†™Mybatisï¼Œè·å–å®Œæ•´æºç </code></p><p>å®Œå–„ORMæ¡†æ¶ï¼Œå¢åˆ æ”¹æŸ¥æ“ä½œæ ¸å¿ƒç±»å…³ç³»ï¼Œå¦‚å›¾ 12-4 æ‰€ç¤º</p><p><img src="https://bugstack.cn/images/article/spring/mybatis-220610-04.png" alt="å›¾ 12-4 å®Œå–„ORMæ¡†æ¶ï¼Œå¢åˆ æ”¹æŸ¥æ“ä½œæ ¸å¿ƒç±»å…³ç³»"></p><ul><li>é¦–å…ˆåœ¨ XML æ˜ å°„å™¨æ„å»ºå™¨ä¸­ï¼Œæ‰©å±• XMLMapperBuilder#configurationElement æ–¹æ³•ï¼Œæ·»åŠ å¯¹ insert/update/delete çš„è§£ææ“ä½œã€‚è¿™éƒ¨åˆ†ä¸éœ€è¦å¤ªå¤šçš„å¤„ç†ï¼Œåªè¦æ·»åŠ ä¸Šè§£æç±»å‹ï¼Œå°±èƒ½æ»¡è¶³å½“å‰ç« èŠ‚çš„è¯‰æ±‚ã€‚åŒæ ·è¿™é‡Œçš„è§£æä¿¡æ¯éƒ½ä¼šå­˜æ”¾åˆ° Configuration é…ç½®é¡¹çš„æ˜ å°„è¯­å¥Mapé›†åˆ mappedStatements ä¸­ï¼Œä¾›åç»­ DefaultSqlSession æ‰§è¡ŒSQLè·å–é…ç½®ä¿¡æ¯æ—¶ä½¿ç”¨ã€‚</li><li>æ¥ä¸‹æ¥æ˜¯å¯¹ MapperMethod æ˜ å°„å™¨æ–¹æ³•çš„æ”¹é€ ï¼Œåœ¨å‰é¢ç« èŠ‚æˆ‘ä»¬åªæ˜¯å¤„ç†äº† MapperMethod#execute ä¸­ SELECT ç±»å‹çš„è¯­å¥ï¼Œè¿™ä¸€ç« èŠ‚éœ€è¦åœ¨è¿™é‡Œæ‰©å±• INSERTã€DELETEã€UPDATEï¼ŒåŒæ—¶è¿˜éœ€è¦å¯¹ SELECT è¿›è¡Œæ‰©å±•æŸ¥è¯¢å‡ºå¤šä¸ªç»“æœé›†çš„æ–¹æ³•ã€‚</li><li>æ‰€éœ€è¦æ‰©å±•çš„è¿™äº›ä¿¡æ¯ï¼Œéƒ½æ˜¯æœ‰ DefaultSqlSession è°ƒç”¨æ‰§è¡Œå™¨ Executor è¿›è¡Œå¤„ç†çš„ï¼Œè¿™é‡Œä½ ä¼šçœ‹åˆ° Executor ä¸­åªæœ‰ update è¿™ä¸ªæ–°å¢æ–¹æ³•ï¼Œå¹¶æ²¡æœ‰ insertã€deleteï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæ–¹æ³•ä¹Ÿæ˜¯è°ƒç”¨çš„ update è¿›è¡Œå¤„ç†çš„ã€‚</li><li>ä»¥ä¸Šè¿™äº›å†…å®¹å®ç°å®Œæˆåï¼Œæ‰€æœ‰æ–°å¢æ–¹æ³•çš„è°ƒç”¨ï¼Œéƒ½ä¼šæŒ‰ç…§å‰é¢ç« èŠ‚å®ç°çš„è¯­å¥æ‰§è¡Œã€å‚æ•°å¤„ç†ã€ç»“æœå°è£…ç­‰æ­¥éª¤ï¼ŒæŠŠæµç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå¹¶è¿”å›æœ€ç»ˆçš„ç»“æœã€‚</li></ul><h3 id="_2-æ‰©å±•è§£æå…ƒç´ " tabindex="-1"><a class="header-anchor" href="#_2-æ‰©å±•è§£æå…ƒç´ " aria-hidden="true">#</a> 2. æ‰©å±•è§£æå…ƒç´ </h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å…ˆè§£å†³æ–°å¢ SQL ç±»å‹çš„ XML è¯­å¥ï¼ŒæŠŠ insertã€updateã€deleteï¼Œå‡ ç§ç±»å‹çš„ SQL è§£æå®Œæˆåï¼Œå­˜æ”¾åˆ° Configuration é…ç½®é¡¹çš„æ˜ å°„å™¨è¯­å¥ä¸­ã€‚</p><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.builder.xml.XMLMapperBuilder</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XMLMapperBuilder</span> <span class="token keyword">extends</span> <span class="token class-name">BaseBuilder</span> <span class="token punctuation">{</span>

    <span class="token comment">// çœç•¥éƒ¨åˆ†æœªæ”¹å˜ä»£ç ï¼Œå¯å‚è€ƒå¯¹åº”çš„æºç å­¦ä¹ ...</span>

    <span class="token comment">// é…ç½®mapperå…ƒç´ </span>
    <span class="token comment">// &lt;mapper namespace=&quot;org.mybatis.example.BlogMapper&quot;&gt;</span>
    <span class="token comment">//   &lt;select id=&quot;selectBlog&quot; parameterType=&quot;int&quot; resultType=&quot;Blog&quot;&gt;</span>
    <span class="token comment">//    select * from Blog where id = #{id}</span>
    <span class="token comment">//   &lt;/select&gt;</span>
    <span class="token comment">// &lt;/mapper&gt;</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">configurationElement</span><span class="token punctuation">(</span><span class="token class-name">Element</span> element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.é…ç½®namespace</span>
        <span class="token class-name">String</span> namespace <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">&quot;namespace&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>namespace<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Mapper&#39;s namespace cannot be empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        builderAssistant<span class="token punctuation">.</span><span class="token function">setCurrentNamespace</span><span class="token punctuation">(</span>namespace<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2.é…ç½®select|insert|update|delete</span>
        <span class="token function">buildStatementFromContext</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">elements</span><span class="token punctuation">(</span><span class="token string">&quot;select&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                element<span class="token punctuation">.</span><span class="token function">elements</span><span class="token punctuation">(</span><span class="token string">&quot;insert&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                element<span class="token punctuation">.</span><span class="token function">elements</span><span class="token punctuation">(</span><span class="token string">&quot;update&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                element<span class="token punctuation">.</span><span class="token function">elements</span><span class="token punctuation">(</span><span class="token string">&quot;delete&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// é…ç½®select|insert|update|delete</span>
    <span class="token annotation punctuation">@SafeVarargs</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">buildStatementFromContext</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Element</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> lists<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Element</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">:</span> lists<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Element</span> element <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">final</span> <span class="token class-name">XMLStatementBuilder</span> statementParser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLStatementBuilder</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> builderAssistant<span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>
                statementParser<span class="token punctuation">.</span><span class="token function">parseStatementNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä¸å‰é¢ç« èŠ‚ç›¸æ¯”ï¼Œè¿™é‡Œæ”¹é€  buildStatementFromContext æ–¹æ³•çš„å…¥å‚ç±»å‹ä¸º list çš„é›†åˆï¼Œä¹Ÿå°±æ˜¯å¤„ç†æ‰€ä¼ é€’åˆ°æ–¹æ³•ä¸­çš„æ‰€æœ‰è¯­å¥çš„é›†åˆã€‚</li><li>ä¹‹ååœ¨ XMLMapperBuilder#configurationElement è°ƒç”¨å±‚ï¼Œä¼ é€’ <code>element.elements(&quot;select&quot;)ã€element.elements(&quot;insert&quot;)ã€element.elements(&quot;update&quot;)ã€element.elements(&quot;delete&quot;)</code> å››ä¸ªç±»å‹çš„æ–¹æ³•ï¼Œå°±å¯ä»¥æŠŠé…ç½®åˆ° Mapper XML ä¸­çš„ä¸åŒ SQL è§£æå­˜æ”¾èµ·æ¥äº†ã€‚</li></ul><h3 id="_3-æ–°å¢æ‰§è¡Œæ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_3-æ–°å¢æ‰§è¡Œæ–¹æ³•" aria-hidden="true">#</a> 3. æ–°å¢æ‰§è¡Œæ–¹æ³•</h3><p>åœ¨ Mybatis çš„ ORM æ¡†æ¶ä¸­ï¼ŒDefaultSqlSession ä¸­æœ€ç»ˆçš„ SQL æ‰§è¡Œéƒ½ä¼šè°ƒç”¨åˆ° Executor æ‰§è¡Œå™¨çš„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹å…³äºæ‰§è¡Œå™¨ä¸­æ–°å¢æ–¹æ³•çš„å˜åŒ–ã€‚</p><h4 id="_3-1-updateæ¥å£å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_3-1-updateæ¥å£å®šä¹‰" aria-hidden="true">#</a> 3.1 updateæ¥å£å®šä¹‰</h4><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.executor.Executor</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Executor</span> <span class="token punctuation">{</span>

    <span class="token class-name">ResultHandler</span> <span class="token constant">NO_RESULT_HANDLER</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">MappedStatement</span> ms<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">MappedStatement</span> ms<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span> rowBounds<span class="token punctuation">,</span> <span class="token class-name">ResultHandler</span> resultHandler<span class="token punctuation">,</span> <span class="token class-name">BoundSql</span> boundSql<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>
		
		<span class="token comment">// ...çœç•¥éƒ¨åˆ†ä»£ç </span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>update æ˜¯ Executor æ‰§è¡Œæ¥å£æ–°å¢çš„æ–¹æ³•ï¼Œåœ¨è¿™æ¬¡åŠŸèƒ½æ‰©å±•ä¸­ï¼ŒExecutor æ‰§è¡Œå™¨ä¹Ÿå°±åªå¢åŠ äº†è¿™ä¹ˆä¸€ä¸ª update æ–¹æ³•ã€‚å› ä¸ºå…¶ä»–ä¸¤ä¸ªæ–¹æ³• insertã€delete çš„è°ƒç”¨ï¼Œä¹Ÿéƒ½æ˜¯è°ƒç”¨ update å°±å¤Ÿäº†ï¼Œæ‰€ä»¥è¿™é‡Œ Mybatis å¹¶æ²¡æœ‰åœ¨æ‰§è¡Œå™¨ä¸­å®šä¹‰æ–°çš„æ–¹æ³•ã€‚</li></ul><h4 id="_3-3-updateæ¥å£å®ç°" tabindex="-1"><a class="header-anchor" href="#_3-3-updateæ¥å£å®ç°" aria-hidden="true">#</a> 3.3 updateæ¥å£å®ç°</h4><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.executor.SimpleExecutor</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleExecutor</span> <span class="token keyword">extends</span> <span class="token class-name">BaseExecutor</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">SimpleExecutor</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> configuration<span class="token punctuation">,</span> <span class="token class-name">Transaction</span> transaction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">doUpdate</span><span class="token punctuation">(</span><span class="token class-name">MappedStatement</span> ms<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Statement</span> stmt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> ms<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ–°å»ºä¸€ä¸ª StatementHandler</span>
            <span class="token class-name">StatementHandler</span> handler <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">newStatementHandler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å‡†å¤‡è¯­å¥</span>
            stmt <span class="token operator">=</span> <span class="token function">prepareStatement</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// StatementHandler.update</span>
            <span class="token keyword">return</span> handler<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token function">closeStatement</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">doQuery</span><span class="token punctuation">(</span><span class="token class-name">MappedStatement</span> ms<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span> rowBounds<span class="token punctuation">,</span> <span class="token class-name">ResultHandler</span> resultHandler<span class="token punctuation">,</span> <span class="token class-name">BoundSql</span> boundSql<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Statement</span> stmt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> ms<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ–°å»ºä¸€ä¸ª StatementHandler</span>
            <span class="token class-name">StatementHandler</span> handler <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">newStatementHandler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å‡†å¤‡è¯­å¥</span>
            stmt <span class="token operator">=</span> <span class="token function">prepareStatement</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è¿”å›ç»“æœ</span>
            <span class="token keyword">return</span> handler<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>stmt<span class="token punctuation">,</span> resultHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token function">closeStatement</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>SimpleExecutor#doUpdate æ–¹æ³•æ˜¯ BaseExecutor æŠ½è±¡ç±»å®ç° Executor#update æ¥å£åï¼Œå®šä¹‰çš„æŠ½è±¡æ–¹æ³•ã€‚</li><li>è¿™ä¸ªæŠ½è±¡æ–¹æ³•ä¸­ï¼Œå’Œ doQuery æ–¹æ³•å‡ ä¹ç±»ä¼¼ï¼Œéƒ½æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ StatementHandler è¯­å¥å¤„ç†å™¨ï¼Œä¹‹åå‡†å¤‡è¯­å¥ï¼Œæ‰§è¡Œå¤„ç†ã€‚</li><li>ä½†è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼ŒdoUpdate åˆ›å»º StatementHandler è¯­å¥å¤„ç†å™¨çš„æ—¶å€™ï¼Œæ˜¯æ²¡æœ‰ resultHandlerã€boundSql ä¸¤ä¸ªå‚æ•°çš„ï¼Œæ‰€ä»¥åœ¨åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯éœ€è¦å¯¹æœ‰å¿…è¦ä½¿ç”¨çš„ boundSql è¿›è¡Œåˆ¤æ–­å¤„ç†çš„ã€‚<em>è¿™éƒ¨åˆ†å†…å®¹ä¸»è¦ä½“ç°åœ¨ BaseStatementHandler çš„æ„é€ å‡½æ•°ä¸­ï¼Œå…³äº boundSql çš„åˆ¤æ–­å’Œå®ä¾‹åŒ–å¤„ç†</em></li></ul><h4 id="_3-4-è¯­å¥å¤„ç†å™¨å®ç°" tabindex="-1"><a class="header-anchor" href="#_3-4-è¯­å¥å¤„ç†å™¨å®ç°" aria-hidden="true">#</a> 3.4 è¯­å¥å¤„ç†å™¨å®ç°</h4><p>è¯­å¥å¤„ç†å™¨çš„å®ç°ï¼Œä¸»è¦å˜åŒ–åœ¨ BaseStatementHandler çš„æ„é€ å‡½æ•°ä¸­æ·»åŠ äº† boundSql çš„åˆå§‹åŒ–ï¼Œä»£ç å¦‚ä¸‹ï¼›</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseStatementHandler</span> <span class="token keyword">implements</span> <span class="token class-name">StatementHandler</span> <span class="token punctuation">{</span>

		<span class="token comment">// ... çœç•¥éƒ¨åˆ†ä»£ç </span>
    <span class="token keyword">protected</span> <span class="token class-name">BoundSql</span> boundSql<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">BaseStatementHandler</span><span class="token punctuation">(</span><span class="token class-name">Executor</span> executor<span class="token punctuation">,</span> <span class="token class-name">MappedStatement</span> mappedStatement<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameterObject<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span> rowBounds<span class="token punctuation">,</span> <span class="token class-name">ResultHandler</span> resultHandler<span class="token punctuation">,</span> <span class="token class-name">BoundSql</span> boundSql<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      
        <span class="token comment">// æ–°å¢åˆ¤æ–­ï¼Œå› ä¸º update ä¸ä¼šä¼ å…¥ boundSql å‚æ•°ï¼Œæ‰€ä»¥è¿™é‡Œè¦åšåˆå§‹åŒ–å¤„ç†</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>boundSql <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            boundSql <span class="token operator">=</span> mappedStatement<span class="token punctuation">.</span><span class="token function">getBoundSql</span><span class="token punctuation">(</span>parameterObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸ºåªæœ‰è·å–äº† BoundSql çš„å‚æ•°ï¼Œæ‰èƒ½æ–¹ä¾¿çš„æ‰§è¡Œåç»­å¯¹ SQL å¤„ç†çš„æ“ä½œã€‚æ‰€ä»¥åœ¨æ‰§è¡Œ update æ–¹æ³•ï¼Œæ²¡æœ‰ä¼ å…¥ BoundSql çš„æ—¶å€™ï¼Œåˆ™éœ€è¦è¿™é‡Œè¿›è¡Œåˆ¤æ–­ä»¥åŠè‡ªå·±è·å–çš„å¤„ç†æ“ä½œã€‚æ¥ä¸‹æ¥æ˜¯å¯¹æŠ½è±¡ç±»çš„å®ç°ï¼Œå…·ä½“çš„å¤„ç† update æ–¹æ³•ã€‚</p><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.executor.statement.PreparedStatementHandler</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PreparedStatementHandler</span> <span class="token keyword">extends</span> <span class="token class-name">BaseStatementHandler</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Statement</span> statement<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">PreparedStatement</span> ps <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span><span class="token punctuation">)</span> statement<span class="token punctuation">;</span>
        ps<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ps<span class="token punctuation">.</span><span class="token function">getUpdateCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Statement</span> statement<span class="token punctuation">,</span> <span class="token class-name">ResultHandler</span> resultHandler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">PreparedStatement</span> ps <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span><span class="token punctuation">)</span> statement<span class="token punctuation">;</span>
        ps<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resultSetHandler<span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleResultSets</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ... çœç•¥éƒ¨åˆ†ä»£ç </span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨ PreparedStatementHandler é¢„å¤„ç†è¯­å¥å¤„ç†å™¨ä¸­ï¼Œå®ç°äº† update æ–¹æ³•ï¼Œç›¸å¯¹äº query æ–¹æ³•çš„å®ç°ï¼Œå…¶å®åªæ˜¯ç›¸å½“äº JDBC æ“ä½œæ•°æ®åº“è¿”å›ç»“æœé›†çš„å˜åŒ–ï¼Œupdate å¤„ç†è¦è¿”å› SQL çš„æ“ä½œå½±å“äº†å¤šå°‘æ¡æ•°æ®çš„æ•°é‡ã€‚</li></ul><h3 id="_4-sqlsession-å®šä¹‰å’Œå®ç°crudæ¥å£" tabindex="-1"><a class="header-anchor" href="#_4-sqlsession-å®šä¹‰å’Œå®ç°crudæ¥å£" aria-hidden="true">#</a> 4. SqlSession å®šä¹‰å’Œå®ç°CRUDæ¥å£</h3><p>åœ¨ SqlSession ä¸­éœ€è¦æ–°å¢å‡ºå¤„ç†æ•°æ®åº“çš„æ¥å£ï¼ŒåŒ…æ‹¬ï¼šselectListã€insertã€updateã€deleteï¼Œè¿™é‡Œæˆ‘ä»¬æ¥çœ‹ä¸‹ DefaultSqlSession å¯¹ SqlSession æ¥å£æ–¹æ³•çš„å…·ä½“å®ç°ã€‚</p><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.session.defaults.DefaultSqlSession</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultSqlSession</span> <span class="token keyword">implements</span> <span class="token class-name">SqlSession</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">DefaultSqlSession</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Configuration</span> configuration<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DefaultSqlSession</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> configuration<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>configuration <span class="token operator">=</span> configuration<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>executor <span class="token operator">=</span> executor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token class-name">String</span> statement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>statement<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token class-name">String</span> statement<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token function">selectList</span><span class="token punctuation">(</span>statement<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Expected one result (or null) to be returned by selectOne(), but found: &quot;</span> <span class="token operator">+</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectList</span><span class="token punctuation">(</span><span class="token class-name">String</span> statement<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡ŒæŸ¥è¯¢ statementï¼š{} parameterï¼š{}&quot;</span><span class="token punctuation">,</span> statement<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MappedStatement</span> ms <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">getMappedStatement</span><span class="token punctuation">(</span>statement<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> executor<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">,</span> <span class="token class-name">Executor</span><span class="token punctuation">.</span><span class="token constant">NO_RESULT_HANDLER</span><span class="token punctuation">,</span> ms<span class="token punctuation">.</span><span class="token function">getSqlSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBoundSql</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Error querying database.  Cause: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">String</span> statement<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åœ¨ Mybatis ä¸­ insert è°ƒç”¨çš„æ˜¯ update</span>
        <span class="token keyword">return</span> <span class="token function">update</span><span class="token punctuation">(</span>statement<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">String</span> statement<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MappedStatement</span> ms <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">getMappedStatement</span><span class="token punctuation">(</span>statement<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> executor<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Error updating database.  Cause: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> statement<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">update</span><span class="token punctuation">(</span>statement<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
		
		<span class="token comment">// ... çœç•¥éƒ¨åˆ†ä»£ç </span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨ DefaultSqlSession çš„å…·ä½“å®ç°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œupdate æ–¹æ³•è°ƒç”¨äº†å…·ä½“çš„æ‰§è¡Œå™¨å°è£…æˆæ–¹æ³•ä»¥åï¼Œinsertã€delete éƒ½æ˜¯è°ƒç”¨çš„è¿™ä¸ª update æ–¹æ³•è¿›è¡Œæ“ä½œçš„ã€‚<em>æ¥å£å®šä¹‰çš„æ˜¯å•ä¸€æ‰§è¡Œï¼Œæ¥å£å®ç°æ˜¯åšäº†é€‚é…å°è£…</em></li><li>å¦å¤–è¿™é‡Œå•ç‹¬æä¾›äº† selectList æ–¹æ³•ï¼Œæ‰€ä»¥æŠŠä¹‹å‰åœ¨ selectOne å…³äº executor.query çš„æ‰§è¡Œå¤„ç†ï¼Œéƒ½è¿ç§»åˆ° selectList æ–¹æ³•ä¸­ã€‚ä¹‹ååœ¨ selectOne ä¸­è°ƒç”¨ selectList æ–¹æ³•ï¼Œå¹¶ç»™å‡ºç›¸åº”çš„åˆ¤æ–­å¤„ç†ã€‚</li></ul><h3 id="_5-æ˜ å°„å™¨å‘½ä»¤æ‰§è¡Œè°ƒåº¦" tabindex="-1"><a class="header-anchor" href="#_5-æ˜ å°„å™¨å‘½ä»¤æ‰§è¡Œè°ƒåº¦" aria-hidden="true">#</a> 5. æ˜ å°„å™¨å‘½ä»¤æ‰§è¡Œè°ƒåº¦</h3><p>ä»¥ä¸Šè¿™äº›æ‰€å®ç°çš„è¯­å¥æ‰§è¡Œå™¨ã€SqlSession åŒ…è£…ï¼Œæœ€ç»ˆéƒ½ä¼šäº¤ç»™ MapperMethod æ˜ å°„å™¨æ–¹æ³•æ ¹æ®ä¸åŒçš„ SQL å‘½ä»¤è°ƒç”¨ä¸åŒçš„ SqlSession æ–¹æ³•è¿›è¡Œæ‰§è¡Œã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapperMethod</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SqlCommand</span> command<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">MethodSignature</span> method<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MapperMethod</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> mapperInterface<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Configuration</span> configuration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>command <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlCommand</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> mapperInterface<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>method <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MethodSignature</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">SqlSession</span> sqlSession<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token constant">INSERT</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token class-name">Object</span> param <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">convertArgsToSqlCommandParam</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                result <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">case</span> <span class="token constant">DELETE</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token class-name">Object</span> param <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">convertArgsToSqlCommandParam</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                result <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">case</span> <span class="token constant">UPDATE</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token class-name">Object</span> param <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">convertArgsToSqlCommandParam</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                result <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">case</span> <span class="token constant">SELECT</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token class-name">Object</span> param <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">convertArgsToSqlCommandParam</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span>returnsMany<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    result <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    result <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Unknown execution method for: &quot;</span> <span class="token operator">+</span> command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// çœç•¥ SQLæŒ‡ä»¤å’Œæ–¹æ³•å‰é¢ä»£ç å—ï¼Œå¯ä»¥å‚è€ƒæºç </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>æ˜ å°„å™¨æ–¹æ³• MapperMethod#execute ä¼šæ ¹æ®ä¸åŒçš„ SqlCommand æŒ‡ä»¤è°ƒç”¨åˆ°ä¸åŒçš„æ–¹æ³•ä¸Šå»ï¼ŒINSERTã€DELETEã€UPDATE åˆ†åˆ«æŒ‰ç…§å¯¹åº”çš„æ–¹æ³•è°ƒç”¨å³å¯ã€‚è¿™é‡Œ SELECT è¿›è¡Œäº†æ‰©å±•ï¼Œå› ä¸ºéœ€è¦æŒ‰ç…§ä¸åŒçš„æ–¹æ³•å‡ºå‚ç±»å‹ï¼Œè°ƒç”¨ä¸åŒçš„æ–¹æ³•ï¼Œä¸»è¦æ˜¯ selectListã€selectOne çš„åŒºåˆ«ã€‚</p></li><li><p>å¦å¤–è¿™é‡Œ method.returnsMany æ¥è‡ªäº MapperMethod.MethodSignature æ–¹æ³•ç­¾åä¸­è¿›è¡Œé€šè¿‡ï¼Œè¿”å›ç±»å‹è¿›è¡Œè·å–çš„ï¼Œä»£ç å¦‚å›¾ 12-5 æ‰€ç¤ºã€‚</p><p><img src="https://bugstack.cn/images/article/spring/mybatis-220610-05.png" alt="å›¾ 12-5 æ–¹æ³•ç­¾åè·å–æ–¹æ³•çš„è¿”å›å‚æ•°ç±»å‹"></p></li></ul><h2 id="äº”ã€æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#äº”ã€æµ‹è¯•" aria-hidden="true">#</a> äº”ã€æµ‹è¯•</h2><h3 id="_1-äº‹å…ˆå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#_1-äº‹å…ˆå‡†å¤‡" aria-hidden="true">#</a> 1. äº‹å…ˆå‡†å¤‡</h3><h4 id="_1-1-åˆ›å»ºåº“è¡¨" tabindex="-1"><a class="header-anchor" href="#_1-1-åˆ›å»ºåº“è¡¨" aria-hidden="true">#</a> 1.1 åˆ›å»ºåº“è¡¨</h4><p>åˆ›å»ºä¸€ä¸ªæ•°æ®åº“åç§°ä¸º mybatis å¹¶åœ¨åº“ä¸­åˆ›å»ºè¡¨ user ä»¥åŠæ·»åŠ æµ‹è¯•æ•°æ®ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span>
    <span class="token keyword">USER</span>
    <span class="token punctuation">(</span>
        id <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;è‡ªå¢ID&#39;</span><span class="token punctuation">,</span>
        userId <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;ç”¨æˆ·ID&#39;</span><span class="token punctuation">,</span>
        userHead <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;ç”¨æˆ·å¤´åƒ&#39;</span><span class="token punctuation">,</span>
        createTime <span class="token keyword">TIMESTAMP</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;åˆ›å»ºæ—¶é—´&#39;</span><span class="token punctuation">,</span>
        updateTime <span class="token keyword">TIMESTAMP</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;æ›´æ–°æ—¶é—´&#39;</span><span class="token punctuation">,</span>
        userName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
    
<span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">user</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> userId<span class="token punctuation">,</span> userHead<span class="token punctuation">,</span> createTime<span class="token punctuation">,</span> updateTime<span class="token punctuation">,</span> userName<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;10001&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1_04&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;2022-04-13 00:00:00&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;2022-04-13 00:00:00&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;å°å‚…å“¥&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-2-é…ç½®æ•°æ®æº" tabindex="-1"><a class="header-anchor" href="#_1-2-é…ç½®æ•°æ®æº" aria-hidden="true">#</a> 1.2 é…ç½®æ•°æ®æº</h4><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>JDBC<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POOLED<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driver<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.mysql.jdbc.Driver<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://127.0.0.1:3306/mybatis?useUnicode=true&amp;characterEncoding=utf8<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>é€šè¿‡ <code>mybatis-config-datasource.xml</code> é…ç½®æ•°æ®æºä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šdriverã€urlã€usernameã€password</li><li>åœ¨è¿™é‡Œ dataSource å¯ä»¥æŒ‰éœ€é…ç½®æˆ DRUIDã€UNPOOLED å’Œ POOLED è¿›è¡Œæµ‹è¯•éªŒè¯ã€‚</li></ul><h4 id="_1-3-é…ç½®mapper" tabindex="-1"><a class="header-anchor" href="#_1-3-é…ç½®mapper" aria-hidden="true">#</a> 1.3 é…ç½®Mapper</h4><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queryUserInfoById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.Long<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.mybatis.test.po.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    SELECT id, userId, userName, userHead
    FROM user
    where id = #{id}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queryUserInfo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.mybatis.test.po.User<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.mybatis.test.po.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    SELECT id, userId, userName, userHead
    FROM user
    where id = #{id} and userId = #{userId}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queryUserInfoList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.mybatis.test.po.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    SELECT id, userId, userName, userHead
    FROM user
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>updateUserInfo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.mybatis.test.po.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    UPDATE user
    SET userName = #{userName}
    WHERE id = #{id}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>insertUserInfo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.mybatis.test.po.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   INSERT INTO user
   (userId, userName, userHead, createTime, updateTime)
   VALUES (#{userId}, #{userName}, #{userHead}, now(), now())
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>deleteUserInfoByUserId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.String<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    DELETE FROM user WHERE userId = #{userId}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æœ¬ç« èŠ‚å·²ç»æŠŠ ORM æ¡†æ¶çš„åŸºæœ¬åŠŸèƒ½å…¨éƒ¨å¼€å‘å®Œæˆäº†ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥åˆ†åˆ«é…ç½®æµ‹è¯•ä¸åŒç±»å‹çš„ SQL è¯­å¥ï¼ŒåŒ…æ‹¬ï¼šinsertã€deleteã€updateã€select</li></ul><h3 id="_2-å•å…ƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-å•å…ƒæµ‹è¯•" aria-hidden="true">#</a> 2. å•å…ƒæµ‹è¯•</h3><p><strong>IUserDao</strong> é…ç½®ç›¸åº”çš„æ–¹æ³•ï¼Œä¸ Mapper XML åŒ¹é…ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IUserDao</span> <span class="token punctuation">{</span>

    <span class="token class-name">User</span> <span class="token function">queryUserInfoById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">User</span> <span class="token function">queryUserInfo</span><span class="token punctuation">(</span><span class="token class-name">User</span> req<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryUserInfoList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token function">updateUserInfo</span><span class="token punctuation">(</span><span class="token class-name">User</span> req<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">insertUserInfo</span><span class="token punctuation">(</span><span class="token class-name">User</span> req<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token function">deleteUserInfoByUserId</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-1-æ’å…¥æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-1-æ’å…¥æµ‹è¯•" aria-hidden="true">#</a> 2.1 æ’å…¥æµ‹è¯•</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_insertUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. è·å–æ˜ å°„å™¨å¯¹è±¡</span>
    <span class="token class-name">IUserDao</span> userDao <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">IUserDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2. æµ‹è¯•éªŒè¯</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token string">&quot;10002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token string">&quot;å°ç™½&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setUserHead</span><span class="token punctuation">(</span><span class="token string">&quot;1_05&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userDao<span class="token punctuation">.</span><span class="token function">insertUserInfo</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•ç»“æœï¼š{}&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Insert OK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3. æäº¤äº‹åŠ¡</span>
    sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•ç»“æœ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">14</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">25.166</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>s<span class="token punctuation">.</span>d<span class="token punctuation">.</span></span>DefaultParameterHandler</span> <span class="token operator">-</span> æ ¹æ®æ¯ä¸ª<span class="token class-name">ParameterMapping</span>ä¸­çš„<span class="token class-name">TypeHandler</span>è®¾ç½®å¯¹åº”çš„å‚æ•°ä¿¡æ¯ valueï¼š<span class="token string">&quot;10002&quot;</span>
<span class="token number">14</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">25.166</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>s<span class="token punctuation">.</span>d<span class="token punctuation">.</span></span>DefaultParameterHandler</span> <span class="token operator">-</span> æ ¹æ®æ¯ä¸ª<span class="token class-name">ParameterMapping</span>ä¸­çš„<span class="token class-name">TypeHandler</span>è®¾ç½®å¯¹åº”çš„å‚æ•°ä¿¡æ¯ valueï¼š<span class="token string">&quot;å°ç™½&quot;</span>
<span class="token number">14</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">25.166</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>s<span class="token punctuation">.</span>d<span class="token punctuation">.</span></span>DefaultParameterHandler</span> <span class="token operator">-</span> æ ¹æ®æ¯ä¸ª<span class="token class-name">ParameterMapping</span>ä¸­çš„<span class="token class-name">TypeHandler</span>è®¾ç½®å¯¹åº”çš„å‚æ•°ä¿¡æ¯ valueï¼š<span class="token string">&quot;1_05&quot;</span>
<span class="token number">14</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">25.171</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token class-name">Insert</span> <span class="token constant">OK</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/images/article/spring/mybatis-220610-06.png" alt=""></p><ul><li>ä»æµ‹è¯•æ—¥å¿—ä¿¡æ¯å’Œæ•°æ®åº“çš„æˆªå›¾ï¼Œå¯ä»¥çœ‹åˆ°æ•°æ®å·²ç»æ’å…¥åˆ°æ•°æ®åº“ï¼ŒéªŒè¯é€šè¿‡ã€‚</li><li>å¦å¤–è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬æ‰§è¡Œå®Œ SQL ä»¥åï¼Œè¿˜æ‰§è¡ŒåŠ›ä¸€æ¬¡ sqlSession.commit(); è¿™æ˜¯å› ä¸ºåœ¨ DefaultSqlSessionFactory#openSession å¼€å¯ Session åˆ›å»ºäº‹åŠ¡å·¥å‚çš„æ—¶å€™ï¼Œä¼ å…¥ç»™äº‹åŠ¡å·¥å‚æ„é€ å‡½æ•°çš„äº‹åŠ¡æ˜¯å¦è‡ªåŠ¨æäº¤ä¸º false æ‰€ä»¥è¿™é‡Œå°±éœ€è¦æˆ‘ä»¬è‡ªå·±å»æ‰‹åŠ¨æäº¤äº‹åŠ¡ï¼Œå¦åˆ™æ˜¯ä¸ä¼šæ’å…¥åˆ°æ•°æ®åº“çš„ã€‚ä¸‹é¢å‡ ä¸ªæµ‹è¯•ä¹Ÿæ˜¯åŒæ ·çš„å¤„ç†æ–¹å¼ã€‚</li></ul><h4 id="_2-2-æŸ¥è¯¢æµ‹è¯•-å¤šæ¡æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_2-2-æŸ¥è¯¢æµ‹è¯•-å¤šæ¡æ•°æ®" aria-hidden="true">#</a> 2.2 æŸ¥è¯¢æµ‹è¯•(å¤šæ¡æ•°æ®)</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_queryUserInfoList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. è·å–æ˜ å°„å™¨å¯¹è±¡</span>
    <span class="token class-name">IUserDao</span> userDao <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">IUserDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. æµ‹è¯•éªŒè¯ï¼šå¯¹è±¡å‚æ•°</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userDao<span class="token punctuation">.</span><span class="token function">queryUserInfoList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•ç»“æœï¼š{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•ç»“æœ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">14</span><span class="token operator">:</span><span class="token number">50</span><span class="token operator">:</span><span class="token number">19.063</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_04&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">&quot;userHead&quot;</span><span class="token operator">:</span><span class="token string">&quot;1_05&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userId&quot;</span><span class="token operator">:</span><span class="token string">&quot;10002&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°ç™½&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ç°åœ¨æˆ‘ä»¬å†æŸ¥è¯¢ç»“æœçš„æ—¶å€™ï¼Œå°±å¯ä»¥æŸ¥è¯¢åˆ°2æ¡è®°å½•çš„é›†åˆäº†ï¼Œè¿™è¯´æ˜æˆ‘ä»¬æ·»åŠ çš„ MapperMethod#execute è°ƒç”¨ <code>sqlSession.selectList(command.getName(), param);</code> æ˜¯æµ‹è¯•é€šè¿‡çš„ã€‚è¯»è€…ä¼™ä¼´ä¹Ÿå¯ä»¥æ ¹æ®è¿™ä¸ªæµ‹è¯•çš„ä»£ç ï¼Œè¿›è¡Œæ–­æ‰è°ƒè¯•ã€‚</li></ul><h4 id="_2-3-ä¿®æ”¹æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-3-ä¿®æ”¹æµ‹è¯•" aria-hidden="true">#</a> 2.3 ä¿®æ”¹æµ‹è¯•</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_updateUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. è·å–æ˜ å°„å™¨å¯¹è±¡</span>
    <span class="token class-name">IUserDao</span> userDao <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">IUserDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. æµ‹è¯•éªŒè¯</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> userDao<span class="token punctuation">.</span><span class="token function">updateUserInfo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string">&quot;10001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;å®å½“çŒ«&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•ç»“æœï¼š{}&quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3. æäº¤äº‹åŠ¡</span>
    sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•ç»“æœ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">14</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">09.550</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>s<span class="token punctuation">.</span>d<span class="token punctuation">.</span></span>DefaultParameterHandler</span> <span class="token operator">-</span> æ ¹æ®æ¯ä¸ª<span class="token class-name">ParameterMapping</span>ä¸­çš„<span class="token class-name">TypeHandler</span>è®¾ç½®å¯¹åº”çš„å‚æ•°ä¿¡æ¯ valueï¼š<span class="token string">&quot;å®å½“çŒ«&quot;</span>
<span class="token number">14</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">09.550</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>s<span class="token punctuation">.</span>d<span class="token punctuation">.</span></span>DefaultParameterHandler</span> <span class="token operator">-</span> æ ¹æ®æ¯ä¸ª<span class="token class-name">ParameterMapping</span>ä¸­çš„<span class="token class-name">TypeHandler</span>è®¾ç½®å¯¹åº”çš„å‚æ•°ä¿¡æ¯ valueï¼š<span class="token number">1</span>
<span class="token number">14</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">09.553</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/images/article/spring/mybatis-220610-07.png" alt=""></p><ul><li>è¿™é‡Œæµ‹è¯•éªŒè¯æŠŠID=1çš„ç”¨æˆ·ï¼ŒuserName ä¿®æ”¹ä¸º å®å½“çŒ«ï¼Œé€šè¿‡æµ‹è¯•æ—¥å¿—å’Œæ•°æ®åº“æˆªå›¾ï¼Œå¯ä»¥çœ‹å‡ºï¼Œæµ‹è¯•å·²ç»é€šè¿‡ã€‚</li></ul><h4 id="_2-4-åˆ é™¤æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-4-åˆ é™¤æµ‹è¯•" aria-hidden="true">#</a> 2.4 åˆ é™¤æµ‹è¯•</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_deleteUserInfoByUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. è·å–æ˜ å°„å™¨å¯¹è±¡</span>
    <span class="token class-name">IUserDao</span> userDao <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">IUserDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. æµ‹è¯•éªŒè¯</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> userDao<span class="token punctuation">.</span><span class="token function">deleteUserInfoByUserId</span><span class="token punctuation">(</span><span class="token string">&quot;10002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•ç»“æœï¼š{}&quot;</span><span class="token punctuation">,</span> count <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3. æäº¤äº‹åŠ¡</span>
    sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•ç»“æœ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">14</span><span class="token operator">:</span><span class="token number">57</span><span class="token operator">:</span><span class="token number">39.536</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>b<span class="token punctuation">.</span>m<span class="token punctuation">.</span>s<span class="token punctuation">.</span>d<span class="token punctuation">.</span></span>DefaultParameterHandler</span> <span class="token operator">-</span> æ ¹æ®æ¯ä¸ª<span class="token class-name">ParameterMapping</span>ä¸­çš„<span class="token class-name">TypeHandler</span>è®¾ç½®å¯¹åº”çš„å‚æ•°ä¿¡æ¯ valueï¼š<span class="token string">&quot;10002&quot;</span>
<span class="token number">14</span><span class="token operator">:</span><span class="token number">57</span><span class="token operator">:</span><span class="token number">39.539</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token boolean">true</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/images/article/spring/mybatis-220610-08.png" alt=""></p><ul><li>è¿™é‡Œæˆ‘ä»¬æŠŠæ•°æ®åº“è¡¨ä¸­ userId = â€œ10002â€ çš„ç”¨æˆ·åˆ é™¤æ‰ï¼Œé€šè¿‡æµ‹è¯•æ—¥å¿—å’Œæ•°æ®åº“æˆªå›¾ï¼Œå¯ä»¥çœ‹å‡ºæµ‹è¯•é€šè¿‡ã€‚</li></ul><h2 id="å…­ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#å…­ã€æ€»ç»“" aria-hidden="true">#</a> å…­ã€æ€»ç»“</h2><ul><li>åˆ°æœ¬ç« èŠ‚æˆ‘ä»¬å°±æŠŠ Mybatis çš„å…¨éƒ¨ä¸»å¹²æµç¨‹ä¸²è”å®ç°å®Œæˆäº†ï¼Œå¯ä»¥æ‰§è¡Œå¯¹æ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œè¯»è€…ä¼™ä¼´ä¹Ÿå¯ä»¥å‘ç°ï¼Œæœ¬ç« èŠ‚åœ¨åŸæœ‰çš„å†…å®¹ä¸‹ï¼Œè¿›è¡Œæ‰©å±•çš„æ—¶å€™ä¹Ÿæ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œç”šè‡³ä¸è¦å¤šå¤§çš„ä»£ç æ”¹åŠ¨ã€‚è¿™ä¸»è¦ä¹Ÿå¾—ç›Šäºæ¡†æ¶åœ¨è®¾è®¡å®ç°è¿‡ç¨‹ä¸­ï¼Œåˆç†è¿ç”¨è®¾è®¡åŸåˆ™å’Œè®¾è®¡æ¨¡å¼çš„å¥½å¤„ã€‚</li><li>è¯»è€…åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥è°ƒè¯•æºç ä¸­çš„ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚åƒäº‹åŠ¡æ˜¯å¦è‡ªåŠ¨æäº¤ï¼ŒæŸ¥è¯¢å‡ºæ¥çš„å‚æ•°æ˜¯å¦å¯ä»¥æ·»åŠ å…¶ä»–ç±»å‹ï¼Œåœ¨å¢åˆ æ”¹æŸ¥ä¸­ï¼Œæ˜¯å¦è¿˜æœ‰å…¶ä»–æƒ…å†µçš„å¤„ç†ã€‚è¿™äº›å°çš„åŠŸèƒ½ç‚¹ï¼Œéƒ½å¯ä»¥è¿›è¡Œæ·»åŠ ç»ƒä¹ ï¼Œå¦‚æœä½ èƒ½æ­£ç¡®çš„æ·»åŠ å¹¶èµ°å®Œæµç¨‹éªŒè¯å…¬å›½ï¼Œé‚£ä¹ˆè¯´æ˜ä½ æ˜¯çœŸçš„å­¦ä¹ ä¼šäº†ã€‚</li><li>åœ¨æœ¬ç« èŠ‚å…¨éƒ¨åŸºç¡€åŠŸèƒ½é“¾è·¯ä¸²è”å®Œæ¯•ä»¥åï¼Œå…³äº Mybatis çš„æ¡†æ¶ä¸­ï¼Œè¿˜æœ‰ä¸€äº›é¢å¤–æ‰©å±•çš„çŸ¥è¯†ç‚¹ï¼Œæ¯”å¦‚ï¼šæ’å…¥æ—¶è¿”å›å½“å‰IDã€Map ç±»å‹æ˜ å°„ã€ä¸€çº§äºŒçº§ç¼“å­˜ã€æ’ä»¶æ¨¡å—ç­‰ï¼Œåç»­çš„ç« èŠ‚ä¸­æˆ‘ä»¬ä¼šæ‰¾ä¸€äº›æœ‰ä»£è¡¨æ€§çš„å†…å®¹ï¼Œè¿›è¡Œæ‰©å±•å¼€å‘å­¦ä¹ ã€‚è¯»è€…ä¼™ä¼´ä¹Ÿå¯ä»¥æŒ‰ç…§ç›®å‰çš„æ¡†æ¶ç»“æ„ï¼Œè‡ªè¡Œæ·»åŠ è¿™å†™æ¨¡å—è¿›è¡Œç»ƒä¹ å­¦ä¹ ã€‚</li></ul><h2 id="ä¸ƒã€ä¼˜ç§€ä½œä¸š" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€ä¼˜ç§€ä½œä¸š" aria-hidden="true">#</a> ä¸ƒã€ä¼˜ç§€ä½œä¸š</h2>`,95),q={href:"https://t.zsxq.com/07MVb6aqz",target:"_blank",rel:"noopener noreferrer"},y={href:"https://t.zsxq.com/09u8LJtrZ",target:"_blank",rel:"noopener noreferrer"},h={href:"https://t.zsxq.com/11hc2GWF4",target:"_blank",rel:"noopener noreferrer"};function f(S,w){const a=p("ExternalLinkIcon");return c(),o("div",null,[u,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),r,s("åšå®¢ï¼š"),n("a",k,[s("https://bugstack.cn"),t(a)]),d,s("åŸæ–‡ï¼š"),n("a",m,[s("https://mp.weixin.qq.com/s/_-LYA6uZhB7GQ-50C0IZYA"),t(a)])]),v,b,g,n("ul",null,[n("li",null,[n("a",q,[s("ä¸²è”ç°åœ¨æ‰€æœ‰çš„ä¸»å¹²æµç¨‹ @æ¨æ¨å¾—äº¿ğŸ™‰"),t(a)])]),n("li",null,[n("a",y,[s("åŸºäºå‰é¢å„ç« èŠ‚çš„è§£æMAPPER_XMLã€å¤„ç†å‚æ•°ã€å°è£…ç»“æœï¼Œå¢åŠ insertã€updateã€deleteä»¥åŠselectè¿”å›é›†åˆçš„æ“ä½œ @liuc"),t(a)])]),n("li",null,[n("a",h,[s("å®Œå–„ORMæ¡†æ¶ï¼Œå¢åˆ æ”¹æŸ¥æ“ä½œ @ADé’™å¥¶"),t(a)])])])])}const j=e(i,[["render",f],["__file","2022-06-10-di12zhangï¼šwanshanORMkuangjiaï¼Œzengshangaichacaozuo.html.vue"]]);export{j as default};
