import{_ as n,r as h,o as g,c as o,a as r,b as a,d as e,e as A}from"./app-3RcBQnkC.js";const d="/code-note/assets/database-split-horizon-jBxY-zgC.png",i="data:image/png;base64,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",s={},p=A('<h1 id="为什么要分库分表-设计高并发系统的时候-数据库层面该如何设计-用过哪些分库分表中间件-不同的分库分表中间件都有什么优点和缺点-你们具体是如何对数据库如何进行垂直拆分或水平拆分的" tabindex="-1"><a class="header-anchor" href="#为什么要分库分表-设计高并发系统的时候-数据库层面该如何设计-用过哪些分库分表中间件-不同的分库分表中间件都有什么优点和缺点-你们具体是如何对数据库如何进行垂直拆分或水平拆分的" aria-hidden="true">#</a> 为什么要分库分表（设计高并发系统的时候，数据库层面该如何设计）？用过哪些分库分表中间件？不同的分库分表中间件都有什么优点和缺点？你们具体是如何对数据库如何进行垂直拆分或水平拆分的？</h1><h2 id="面试官心理分析" tabindex="-1"><a class="header-anchor" href="#面试官心理分析" aria-hidden="true">#</a> 面试官心理分析</h2><p>其实这块肯定是扯到<strong>高并发</strong>了，因为分库分表一定是为了<strong>支撑高并发、数据量大</strong>两个问题的。而且现在说实话，尤其是互联网类的公司面试，基本上都会来这么一下，分库分表如此普遍的技术问题，不问实在是不行，而如果你不知道那也实在是说不过去！</p><h2 id="面试题剖析" tabindex="-1"><a class="header-anchor" href="#面试题剖析" aria-hidden="true">#</a> 面试题剖析</h2><h3 id="为什么要分库分表-设计高并发系统的时候-数据库层面该如何设计" tabindex="-1"><a class="header-anchor" href="#为什么要分库分表-设计高并发系统的时候-数据库层面该如何设计" aria-hidden="true">#</a> 为什么要分库分表？（设计高并发系统的时候，数据库层面该如何设计？）</h3><p>说白了，分库分表是两回事儿，大家可别搞混了，可能是光分库不分表，也可能是光分表不分库，都有可能。</p><p>我先给大家抛出来一个场景。</p><p>假如我们现在是一个小创业公司（或者是一个 BAT 公司刚兴起的一个新部门），现在注册用户就 20 万，每天活跃用户就 1 万，每天单表数据量就 1000，然后高峰期每秒钟并发请求最多就 10 个。我的天，就这种系统，随便找一个有几年工作经验的，然后带几个刚培训出来的，随便干干都可以。</p><p>结果没想到我们运气居然这么好，碰上个 CEO 带着我们走上了康庄大道，业务发展迅猛，过了几个月，注册用户数达到了 2000 万！每天活跃用户数 100 万！每天单表数据量 10 万条！高峰期每秒最大请求达到 1000！同时公司还顺带着融资了两轮，进账了几个亿人民币啊！公司估值达到了惊人的几亿美金！这是小独角兽的节奏！</p><p>好吧，没事，现在大家感觉压力已经有点大了，为啥呢？因为每天多 10 万条数据，一个月就多 300 万条数据，现在咱们单表已经几百万数据了，马上就破千万了。但是勉强还能撑着。高峰期请求现在是 1000，咱们线上部署了几台机器，负载均衡搞了一下，数据库撑 1000QPS 也还凑合。但是大家现在开始感觉有点担心了，接下来咋整呢......</p><p>再接下来几个月，我的天，CEO 太牛逼了，公司用户数已经达到 1 亿，公司继续融资几十亿人民币啊！公司估值达到了惊人的几十亿美金，成为了国内今年最牛逼的明星创业公司！天，我们太幸运了。</p><p>但是我们同时也是不幸的，因为此时每天活跃用户数上千万，每天单表新增数据多达 50 万，目前一个表总数据量都已经达到了两三千万了！扛不住啊！数据库磁盘容量不断消耗掉！高峰期并发达到惊人的 <code>5000~8000</code> ！别开玩笑了，哥。我跟你保证，你的系统支撑不到现在，已经挂掉了！</p><p>好吧，所以你看到这里差不多就理解分库分表是怎么回事儿了，实际上这是跟着你的公司业务发展走的，你公司业务发展越好，用户就越多，数据量越大，请求量越大，那你单个数据库一定扛不住。</p><h4 id="分表" tabindex="-1"><a class="header-anchor" href="#分表" aria-hidden="true">#</a> 分表</h4><p>比如你单表都几千万数据了，你确定你能扛住么？绝对不行，<strong>单表数据量太大</strong>，会极大影响你的 sql <strong>执行的性能</strong>，到了后面你的 sql 可能就跑的很慢了。一般来说，就以我的经验来看，单表到几百万的时候，性能就会相对差一些了，你就得分表了。</p><p>分表是啥意思？就是把一个表的数据放到多个表中，然后查询的时候你就查一个表。比如按照用户 id 来分表，将一个用户的数据就放在一个表中。然后操作的时候你对一个用户就操作那个表就好了。这样可以控制每个表的数据量在可控的范围内，比如每个表就固定在 200 万以内。</p><h4 id="分库" tabindex="-1"><a class="header-anchor" href="#分库" aria-hidden="true">#</a> 分库</h4><p>分库是啥意思？就是你一个库一般我们经验而言，最多支撑到并发 2000，一定要扩容了，而且一个健康的单库并发值你最好保持在每秒 1000 左右，不要太大。那么你可以将一个库的数据拆分到多个库中，访问的时候就访问一个库好了。</p><p>这就是所谓的<strong>分库分表</strong>，为啥要分库分表？你明白了吧。</p><table><thead><tr><th>#</th><th>分库分表前</th><th>分库分表后</th></tr></thead><tbody><tr><td>并发支撑情况</td><td>MySQL 单机部署，扛不住高并发</td><td>MySQL 从单机到多机，能承受的并发增加了多倍</td></tr><tr><td>磁盘使用情况</td><td>MySQL 单机磁盘容量几乎撑满</td><td>拆分为多个库，数据库服务器磁盘使用率大大降低</td></tr><tr><td>SQL 执行性能</td><td>单表数据量太大，SQL 越跑越慢</td><td>单表数据量减少，SQL 执行效率明显提升</td></tr></tbody></table><h3 id="用过哪些分库分表中间件-不同的分库分表中间件都有什么优点和缺点" tabindex="-1"><a class="header-anchor" href="#用过哪些分库分表中间件-不同的分库分表中间件都有什么优点和缺点" aria-hidden="true">#</a> 用过哪些分库分表中间件？不同的分库分表中间件都有什么优点和缺点？</h3><p>这个其实就是看看你了解哪些分库分表的中间件，各个中间件的优缺点是啥？然后你用过哪些分库分表的中间件。</p><p>比较常见的包括：</p><ul><li>Cobar</li><li>TDDL</li><li>Atlas</li><li>Sharding-jdbc</li><li>Mycat</li></ul><h4 id="cobar" tabindex="-1"><a class="header-anchor" href="#cobar" aria-hidden="true">#</a> Cobar</h4><p>阿里 b2b 团队开发和开源的，属于 proxy 层方案，就是介于应用服务器和数据库服务器之间。应用程序通过 JDBC 驱动访问 Cobar 集群，Cobar 根据 SQL 和分库规则对 SQL 做分解，然后分发到 MySQL 集群不同的数据库实例上执行。早些年还可以用，但是最近几年都没更新了，基本没啥人用，差不多算是被抛弃的状态吧。而且不支持读写分离、存储过程、跨库 join 和分页等操作。</p><h4 id="tddl" tabindex="-1"><a class="header-anchor" href="#tddl" aria-hidden="true">#</a> TDDL</h4><p>淘宝团队开发的，属于 client 层方案。支持基本的 crud 语法和读写分离，但不支持 join、多表查询等语法。目前使用的也不多，因为还依赖淘宝的 diamond 配置管理系统。</p><h4 id="atlas" tabindex="-1"><a class="header-anchor" href="#atlas" aria-hidden="true">#</a> Atlas</h4><p>360 开源的，属于 proxy 层方案，以前是有一些公司在用的，但是确实有一个很大的问题就是社区最新的维护都在 5 年前了。所以，现在用的公司基本也很少了。</p><h4 id="sharding-jdbc" tabindex="-1"><a class="header-anchor" href="#sharding-jdbc" aria-hidden="true">#</a> Sharding-jdbc</h4>',31),c={href:"https://shardingsphere.apache.org",target:"_blank",rel:"noopener noreferrer"},l=r("code",null,"ShardingSphere",-1),B={href:"https://shardingsphere.apache.org",target:"_blank",rel:"noopener noreferrer"},Q=r("code",null,"ShardingSphere",-1),S=r("code",null,"4.0.0-RC1",-1),C=r("strong",null,"可以选择的方案",-1),E=A('<h4 id="mycat" tabindex="-1"><a class="header-anchor" href="#mycat" aria-hidden="true">#</a> Mycat</h4><p>基于 Cobar 改造的，属于 proxy 层方案，支持的功能非常完善，而且目前应该是非常火的而且不断流行的数据库中间件，社区很活跃，也有一些公司开始在用了。但是确实相比于 Sharding jdbc 来说，年轻一些，经历的锤炼少一些。</p><h4 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h4><p>综上，现在其实建议考量的，就是 Sharding-jdbc 和 Mycat，这两个都可以去考虑使用。</p><p>Sharding-jdbc 这种 client 层方案的<strong>优点在于不用部署，运维成本低，不需要代理层的二次转发请求，性能很高</strong>，但是如果遇到升级啥的需要各个系统都重新升级版本再发布，各个系统都需要<strong>耦合</strong> Sharding-jdbc 的依赖；</p><p>Mycat 这种 proxy 层方案的<strong>缺点在于需要部署</strong>，自己运维一套中间件，运维成本高，但是<strong>好处在于对于各个项目是透明的</strong>，如果遇到升级之类的都是自己中间件那里搞就行了。</p><p>通常来说，这两个方案其实都可以选用，但是我个人建议中小型公司选用 Sharding-jdbc，client 层方案轻便，而且维护成本低，不需要额外增派人手，而且中小型公司系统复杂度会低一些，项目也没那么多；但是中大型公司最好还是选用 Mycat 这类 proxy 层方案，因为可能大公司系统和项目非常多，团队很大，人员充足，那么最好是专门弄个人来研究和维护 Mycat，然后大量项目直接透明使用即可。</p><h3 id="你们具体是如何对数据库如何进行垂直拆分或水平拆分的" tabindex="-1"><a class="header-anchor" href="#你们具体是如何对数据库如何进行垂直拆分或水平拆分的" aria-hidden="true">#</a> 你们具体是如何对数据库如何进行垂直拆分或水平拆分的？</h3><p><strong>水平拆分</strong>的意思，就是把一个表的数据给弄到多个库的多个表里去，但是每个库的表结构都一样，只不过每个库表放的数据是不同的，所有库表的数据加起来就是全部数据。水平拆分的意义，就是将数据均匀放更多的库里，然后用多个库来扛更高的并发，还有就是用多个库的存储容量来进行扩容。</p><p><img src="'+d+'" alt="database-split-horizon"></p><p><strong>垂直拆分</strong>的意思，就是<strong>把一个有很多字段的表给拆分成多个表</strong>，<strong>或者是多个库上去</strong>。每个库表的结构都不一样，每个库表都包含部分字段。一般来说，会<strong>将较少的访问频率很高的字段放到一个表里去</strong>，然后<strong>将较多的访问频率很低的字段放到另外一个表里去</strong>。因为数据库是有缓存的，你访问频率高的行字段越少，就可以在缓存里缓存更多的行，性能就越好。这个一般在表层面做的较多一些。</p><p><img src="'+i+'" alt="database-split-vertically"></p><p>这个其实挺常见的，不一定我说，大家很多同学可能自己都做过，把一个大表拆开，订单表、订单支付表、订单商品表。</p><p>还有<strong>表层面的拆分</strong>，就是分表，将一个表变成 N 个表，就是<strong>让每个表的数据量控制在一定范围内</strong>，保证 SQL 的性能。否则单表数据量越大，SQL 性能就越差。一般是 200 万行左右，不要太多，但是也得看具体你怎么操作，也可能是 500 万，或者是 100 万。你的 SQL 越复杂，就最好让单表行数越少。</p><p>好了，无论分库还是分表，上面说的那些数据库中间件都是可以支持的。就是基本上那些中间件可以做到你分库分表之后，<strong>中间件可以根据你指定的某个字段值</strong>，比如说 userid，<strong>自动路由到对应的库上去，然后再自动路由到对应的表里去</strong>。</p><p>你就得考虑一下，你的项目里该如何分库分表？一般来说，垂直拆分，你可以在表层面来做，对一些字段特别多的表做一下拆分；水平拆分，你可以说是并发承载不了，或者是数据量太大，容量承载不了，你给拆了，按什么字段来拆，你自己想好；分表，你考虑一下，你如果哪怕是拆到每个库里去，并发和容量都 ok 了，但是每个库的表还是太大了，那么你就分表，将这个表分开，保证每个表的数据量并不是很大。</p><p>而且这儿还有两种<strong>分库分表的方式</strong>：</p><ul><li>一种是按照 range 来分，就是每个库一段连续的数据，这个一般是按比如<strong>时间范围</strong>来的，但是这种一般较少用，因为很容易产生热点问题，大量的流量都打在最新的数据上了。</li><li>或者是按照某个字段 hash 一下均匀分散，这个较为常用。</li></ul><p>range 来分，好处在于说，扩容的时候很简单，因为你只要预备好，给每个月都准备一个库就可以了，到了一个新的月份的时候，自然而然，就会写新的库了；缺点，但是大部分的请求，都是访问最新的数据。实际生产用 range，要看场景。</p><p>hash 分发，好处在于说，可以平均分配每个库的数据量和请求压力；坏处在于说扩容起来比较麻烦，会有一个数据迁移的过程，之前的数据需要重新计算 hash 值重新分配到不同的库或表。</p>',20);function J(M,b){const t=h("ExternalLinkIcon");return g(),o("div",null,[p,r("p",null,[a("当当开源的，属于 client 层方案，是"),r("a",c,[l,a(),e(t)]),a("的 client 层方案，"),r("a",B,[Q,a(),e(t)]),a("还提供 proxy 层的方案 Sharding-Proxy。确实之前用的还比较多一些，因为 SQL 语法支持也比较多，没有太多限制，而且截至 2019.4，已经推出到了 "),S,a(" 版本，支持分库分表、读写分离、分布式 id 生成、柔性事务（最大努力送达型事务、TCC 事务）。而且确实之前使用的公司会比较多一些（这个在官网有登记使用的公司，可以看到从 2017 年一直到现在，是有不少公司在用的），目前社区也还一直在开发和维护，还算是比较活跃，个人认为算是一个现在也"),C,a("。")]),E])}const K=n(s,[["render",J],["__file","database-shard.html.vue"]]);export{K as default};
