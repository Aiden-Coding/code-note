import{_ as t,r as p,o as e,c,a as n,b as s,d as o,e as l}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"nettyæ¡ˆä¾‹-netty4-1åŸºç¡€å…¥é—¨ç¯‡åäºŒã€Šç®€å•å®ç°ä¸€ä¸ªåŸºäºnettyæ­å»ºçš„httpæœåŠ¡ã€‹",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#nettyæ¡ˆä¾‹-netty4-1åŸºç¡€å…¥é—¨ç¯‡åäºŒã€Šç®€å•å®ç°ä¸€ä¸ªåŸºäºnettyæ­å»ºçš„httpæœåŠ¡ã€‹","aria-hidden":"true"},"#"),s(" nettyæ¡ˆä¾‹ï¼Œnetty4.1åŸºç¡€å…¥é—¨ç¯‡åäºŒã€Šç®€å•å®ç°ä¸€ä¸ªåŸºäºNettyæ­å»ºçš„HttpæœåŠ¡ã€‹")],-1),k=n("br",null,null,-1),r={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=l(`<blockquote><p>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„</p></blockquote><h2 id="å‰è¨€ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#å‰è¨€ä»‹ç»" aria-hidden="true">#</a> å‰è¨€ä»‹ç»</h2><p>Nettyä¸ä»…å¯ä»¥æ­å»ºSocketæœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ­å»ºHttpã€HttpsæœåŠ¡ã€‚æœ¬ç« èŠ‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„å…¥é—¨æ¡ˆä¾‹ï¼Œæ¥äº†è§£Nettyæ­å»ºçš„HttpæœåŠ¡ï¼Œåœ¨æˆ‘ä»¬åç»­çš„Nettyç½‘å…³æœåŠ¡ä¸­ä¼šä½¿ç”¨åˆ°è¿™æ ·çš„åŠŸèƒ½ç‚¹ã€‚</p><p>è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼ŒHyperText Transfer Protocol)æ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®ã€‚</p><blockquote><p>åœ¨åç«¯å¼€å‘ä¸­æ¥è§¦HTTPåè®®çš„æ¯”è¾ƒå¤šï¼Œç›®å‰å¤§éƒ¨åˆ†éƒ½æ˜¯åŸºäºServletå®¹å™¨å®ç°çš„HttpæœåŠ¡ï¼Œå¾€å¾€æœ‰ä¸€äº›æ ¸å¿ƒå­ç³»ç»Ÿå¯¹æ€§èƒ½çš„è¦æ±‚éå¸¸é«˜ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥è€ƒè™‘é‡‡ç”¨NIOçš„ç½‘ç»œæ¨¡å‹æ¥å®ç°HTTPæœåŠ¡ï¼Œä»¥æ­¤æé«˜æ€§èƒ½å’Œååé‡ï¼ŒNettyé™¤äº†å¼€å‘ç½‘ç»œåº”ç”¨éå¸¸æ–¹ä¾¿ï¼Œè¿˜å†…ç½®äº†HTTPç›¸å…³çš„ç¼–è§£ç å™¨ï¼Œè®©ç”¨æˆ·å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¼€å‘å‡ºé«˜æ€§èƒ½çš„HTTPåè®®çš„æœåŠ¡ï¼ŒSpring Webfluxé»˜è®¤æ˜¯ä½¿ç”¨çš„Nettyã€‚</p></blockquote><h2 id="ç¯å¢ƒå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#ç¯å¢ƒå‡†å¤‡" aria-hidden="true">#</a> ç¯å¢ƒå‡†å¤‡</h2><ol><li>jdk1.8ã€jdk1.7ä»¥ä¸‹åªèƒ½éƒ¨åˆ†æ”¯æŒnettyã€‘</li><li>Netty4.1.36.Finalã€netty3.x 4.x 5æ¯æ¬¡çš„å˜åŒ–è¾ƒå¤§ï¼Œæ¥å£ç±»åä¹Ÿéšç€å˜åŒ–ã€‘</li><li>Postmanæ¥å£è°ƒè¯•å™¨ï¼Œå¯ä»¥ä»ç½‘ä¸Šä¸‹è½½ä¹Ÿå¯ä»¥è”ç³»æˆ‘ï¼Œå¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ | å…³æ³¨å›å¤ä½ çš„é‚®ç®±</li></ol><h2 id="ä»£ç ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä»£ç ç¤ºä¾‹" aria-hidden="true">#</a> ä»£ç ç¤ºä¾‹</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>netty<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">12</span>
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>netty
    â”‚           â””â”€â”€ server    	
    â”‚               â”œâ”€â”€ <span class="token class-name">MyChannelInitializer</span><span class="token punctuation">.</span>java
    â”‚               â”œâ”€â”€ <span class="token class-name">MyClientHandler</span><span class="token punctuation">.</span>java
    â”‚               â””â”€â”€ <span class="token class-name">NettyServer</span><span class="token punctuation">.</span>java
    â””â”€â”€ test
         â””â”€â”€ java
             â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>test
                 â””â”€â”€ <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>server/MyChannelInitializer.java | æ·»åŠ äº†Httpçš„å¤„ç†åè®®</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * è™«æ´æ ˆï¼šhttps://bugstack.cn
 * å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ  ï½›è·å–å­¦ä¹ æºç ï½
 * Create by fuzhengwei on 2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyChannelInitializer</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ•°æ®è§£ç æ“ä½œ</span>
        channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpResponseEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ•°æ®ç¼–ç æ“ä½œ</span>
        channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpRequestDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åœ¨ç®¡é“ä¸­æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„æ¥æ”¶æ•°æ®å®ç°æ–¹æ³•</span>
        channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>server/MyClientHandler.java | æ¨¡ç‰ˆä»£ç åŸºæœ¬æ²¡å˜ï¼Œå’Œå…¶ä»–çš„ä»£ç ç±»ä¼¼</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * è™«æ´æ ˆï¼šhttps://bugstack.cn
 * å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ  ï½›è·å–å­¦ä¹ æºç ï½
 * Create by fuzhengwei on 2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">DefaultHttpRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">DefaultHttpRequest</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;URI:&quot;</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token keyword">instanceof</span> <span class="token class-name">HttpContent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">LastHttpContent</span> httpContent <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LastHttpContent</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
            <span class="token class-name">ByteBuf</span> byteData <span class="token operator">=</span> httpContent<span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>byteData <span class="token keyword">instanceof</span> <span class="token class-name">EmptyByteBuf</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//æ¥æ”¶msgæ¶ˆæ¯</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> msgByte <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>byteData<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                byteData<span class="token punctuation">.</span><span class="token function">readBytes</span><span class="token punctuation">(</span>msgByte<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>msgByte<span class="token punctuation">,</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">String</span> sendMsg <span class="token operator">=</span> <span class="token string">&quot;å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆï¼Œæ¬¢è¿æ‚¨çš„å…³æ³¨&amp;è·å–æºç ï¼ä¸å¹³å‡¡çš„å²æœˆç»ˆç©¶æ¥è‡ªä½ æ¯æ—¥ä¸åœæ­‡çš„åˆ»è‹¦æ‹¼æï¼Œæ¯ä¸€æ¬¡çœŸæ­£æˆé•¿éƒ½å› çœ‹æ¸…è„šä¸‹è·¯è€ŒæŠ‰æ‹©å‡ºçš„ç”Ÿæ´»ã€‚æ„¿ä½ æˆ‘ï¼›æ‰¿é‡æœéœï¼Œå¹´å°‘æ­£æ°ï¼Œæ•´è£…æˆé©¬ï¼Œåˆ»å°é£åã€‚\\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;åšå®¢æ ˆï¼šhttps://bugstack.cn\\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;å†…å®¹ä»‹ç»ï¼šæœ¬å…¬ä¼—å·ä¼šæ¯å¤©å®šæ—¶æ¨é€ç§‘æŠ€èµ„æ–™ï¼›ä¸“é¢˜ã€æºç ã€ä¹¦ç±ã€è§†é¢‘ã€å’¨è¯¢ã€é¢è¯•ã€ç¯å¢ƒç­‰æ–¹é¢å†…å®¹ã€‚å°¤å…¶åœ¨æŠ€æœ¯ä¸“é¢˜æ–¹é¢ä¼šæä¾›æ›´å¤šçš„åŸåˆ›å†…å®¹ï¼Œè®©æ›´å¤šçš„ç¨‹åºå‘˜å¯ä»¥ä»æœ€åŸºç¡€å¼€å§‹äº†è§£åˆ°æŠ€æœ¯å…¨è²Œï¼Œç›®å‰å·²ç»å¯¹å¤–æä¾›çš„æœ‰ï¼›ã€Šæ‰‹å†™RPCæ¡†æ¶ã€‹ã€ã€Šç”¨Javaå®ç°JVMã€‹ã€ã€ŠåŸºäºJavaAgentçš„å…¨é“¾è·¯ç›‘æ§ã€‹ã€ã€ŠNettyæ¡ˆä¾‹ã€‹ç­‰ä¸“é¢˜ã€‚\\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;è·å–æºç ï¼š\\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;å…³æ³¨ï½›bugstackè™«æ´æ ˆï½å…¬ä¼—å·è·å–æºç ï¼Œå›å¤&lt;ç”¨Javaå®ç°jvmæºç &gt;\\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;å…³æ³¨ï½›bugstackè™«æ´æ ˆï½å…¬ä¼—å·è·å–æºç ï¼Œå›å¤&lt;nettyæºç &gt;\\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;å…³æ³¨ï½›bugstackè™«æ´æ ˆï½å…¬ä¼—å·è·å–æºç ï¼Œå›å¤&lt;rpcæºç &gt;\\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;å…³æ³¨ï½›bugstackè™«æ´æ ˆï½å…¬ä¼—å·è·å–æºç ï¼Œå›å¤&lt;åŸºäºJavaAgentçš„å…¨é“¾è·¯ç›‘æ§&gt;&quot;</span><span class="token punctuation">;</span>

        <span class="token class-name">FullHttpResponse</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultFullHttpResponse</span><span class="token punctuation">(</span>
                <span class="token class-name">HttpVersion</span><span class="token punctuation">.</span><span class="token constant">HTTP_1_1</span><span class="token punctuation">,</span>
                <span class="token class-name">HttpResponseStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">,</span>
                <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">wrappedBuffer</span><span class="token punctuation">(</span>sendMsg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaderNames</span><span class="token punctuation">.</span><span class="token constant">CONTENT_TYPE</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaderNames</span><span class="token punctuation">.</span><span class="token constant">CONTENT_LENGTH</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaderNames</span><span class="token punctuation">.</span><span class="token constant">CONNECTION</span><span class="token punctuation">,</span> <span class="token class-name">HttpHeaderValues</span><span class="token punctuation">.</span><span class="token constant">KEEP_ALIVE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelReadComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cause<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>server/NettyServer.java | æ¨¡ç‰ˆä»£ç åŸºæœ¬æ²¡å˜ï¼Œå’Œå…¶ä»–çš„ä»£ç ç±»ä¼¼</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * è™«æ´æ ˆï¼šhttps://bugstack.cn
 * å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ  ï½›è·å–å­¦ä¹ æºç ï½
 * Create by fuzhengwei on 2019
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyServer</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">NettyServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bing</span><span class="token punctuation">(</span><span class="token number">7397</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">bing</span><span class="token punctuation">(</span><span class="token keyword">int</span> port<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//é…ç½®æœåŠ¡ç«¯NIOçº¿ç¨‹ç»„</span>
        <span class="token class-name">EventLoopGroup</span> parentGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//NioEventLoopGroup extends MultithreadEventLoopGroup Math.max(1, SystemPropertyUtil.getInt(&quot;io.netty.eventLoopThreads&quot;, NettyRuntime.availableProcessors() * 2));</span>
        <span class="token class-name">EventLoopGroup</span> childGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">ServerBootstrap</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            b<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>parentGroup<span class="token punctuation">,</span> childGroup<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token comment">//éé˜»å¡æ¨¡å¼</span>
                    <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span><span class="token constant">SO_BACKLOG</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">childOption</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span><span class="token constant">SO_KEEPALIVE</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyChannelInitializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ChannelFuture</span> f <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;itstack-demo-netty server start done. {å…³æ³¨å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆï¼Œè·å–æºç }&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            f<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            childGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            parentGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æµ‹è¯•ç»“æœ" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•ç»“æœ" aria-hidden="true">#</a> æµ‹è¯•ç»“æœ</h2><blockquote><p>å¯åŠ¨NettyServer</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>netty server start done<span class="token punctuation">.</span> <span class="token punctuation">{</span>å…³æ³¨å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆï¼Œè·å–æºç <span class="token punctuation">}</span>
<span class="token constant">URI</span><span class="token operator">:</span><span class="token operator">/</span>
<span class="token class-name">DefaultHttpRequest</span><span class="token punctuation">(</span>decodeResult<span class="token operator">:</span> success<span class="token punctuation">,</span> version<span class="token operator">:</span> <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span><span class="token punctuation">)</span>
<span class="token constant">GET</span> <span class="token operator">/</span> <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>
cache<span class="token operator">-</span>control<span class="token operator">:</span> no<span class="token operator">-</span>cache
<span class="token class-name">Postman</span><span class="token operator">-</span><span class="token class-name">Token</span><span class="token operator">:</span> <span class="token number">28f</span><span class="token number">37d</span>fb<span class="token operator">-</span>bb5a<span class="token operator">-</span><span class="token number">4</span>cb2<span class="token operator">-</span>ae7a<span class="token operator">-</span><span class="token number">87</span>cf6cda900c
<span class="token class-name">User</span><span class="token operator">-</span><span class="token class-name">Agent</span><span class="token operator">:</span> <span class="token class-name">PostmanRuntime</span><span class="token operator">/</span><span class="token number">7.6</span><span class="token number">.0</span>
<span class="token class-name">Accept</span><span class="token operator">:</span> <span class="token operator">*</span><span class="token comment">/*
Host: localhost:7397
accept-encoding: gzip, deflate
content-type: multipart/form-data; boundary=--------------------------359056973355668947377349
content-length: 226
Connection: keep-alive
----------------------------359056973355668947377349
Content-Disposition: form-data; name=&quot;msg&quot;

å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ | æ¬¢è¿å…³æ³¨å¹¶è·å–æºç ï¼
----------------------------359056973355668947377349--


Process finished with exit code -1
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Postmanè®¿é—®ï¼›http://localhost:7397 å¹¶è®¾ç½®å‚æ•°</p></blockquote><p><img src="https://bugstack.cn/assets/images/pic-content/2019/09/netty-1-12-1.png" alt=""></p><p>å¾®ä¿¡æœç´¢ã€Œ<strong>bugstackè™«æ´æ ˆ</strong>ã€å…¬ä¼—å·ï¼Œå…³æ³¨åå›å¤ã€Œ<strong>Nettyä¸“é¢˜æ¡ˆä¾‹</strong>ã€è·å–æœ¬æ–‡æºç &amp;æ›´å¤šåŸåˆ›ä¸“é¢˜æ¡ˆä¾‹ï¼</p>`,21);function v(m,b){const a=p("ExternalLinkIcon");return e(),c("div",null,[u,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),k,s("åšå®¢ï¼š"),n("a",r,[s("https://bugstack.cn"),o(a)])]),d])}const h=t(i,[["render",v],["__file","2019-08-15-nettyanliï¼Œnetty4.1jichurumenpianshierã€ŠjiandanshixianyigejiyuNettydajiandeHttpfuwuã€‹.html.vue"]]);export{h as default};
