import{_ as p,r as o,o as c,c as l,a as n,b as s,d as t,e}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"é¢ç»æ‰‹å†Œ-Â·-ç¬¬19ç¯‡ã€Šthread-start-å®ƒæ˜¯æ€ä¹ˆè®©çº¿ç¨‹å¯åŠ¨çš„å‘¢-ã€‹",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#é¢ç»æ‰‹å†Œ-Â·-ç¬¬19ç¯‡ã€Šthread-start-å®ƒæ˜¯æ€ä¹ˆè®©çº¿ç¨‹å¯åŠ¨çš„å‘¢-ã€‹","aria-hidden":"true"},"#"),s(" é¢ç»æ‰‹å†Œ Â· ç¬¬19ç¯‡ã€ŠThread.start() ï¼Œå®ƒæ˜¯æ€ä¹ˆè®©çº¿ç¨‹å¯åŠ¨çš„å‘¢ï¼Ÿã€‹")],-1),r=n("br",null,null,-1),d={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},k=e(`<blockquote><p>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„</p></blockquote><h2 id="ä¸€ã€å‰è¨€" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‰è¨€" aria-hidden="true">#</a> ä¸€ã€å‰è¨€</h2><p><code>æœ‰å¥è¯ï¼šæ­£å› ä¸ºä½ ä¼˜ç§€ï¼Œæ‰€ä»¥éš¾ä»¥å“è¶Šï¼</code></p><p>åˆšå¼€å§‹å¬è¿™å¥è¯è¿˜åœ¨ä¸Šå­¦ï¼Œæ—¢ä¸å“è¶Šã€ä¹Ÿä¸ä¼˜ç§€ï¼Œç”šè‡³å¯èƒ½è¿˜æœ‰ç‚¹ç¬¨ï¼ä½†çªç„¶ä»æŸæ¬¡çˆ¬åˆ°ç­çº§çš„å‰å‡ ååï¼Œå¼€å§‹å–œæ¬¢ä¸Šäº†è¿™ç§æ„Ÿè§‰ï¼ŒåŸæ¥å‰é¢çš„é£æ™¯æ˜¯å¦‚æ­¤ç¿çƒ‚ğŸ˜œï¼</p><p>ä¼˜ç§€å’Œå“è¶Šå·®çš„ä¸æ˜¯ä¸€ä¸ªç­‰çº§ï¼Œå½“ä½ æ„Ÿè§‰è‡ªå·±ä¼˜ç§€åï¼Œè¿˜èƒ½ä¿æŒç©ºç“¶çš„å¿ƒæ€å¼€å§‹ï¼Œæ‰èƒ½é€æ­¥çš„åƒå“è¶Šè¿ˆè¿›ï¼Œå¹¶æ¼«æ¼«é•¿ï¼</p><p>æ˜¯ä¸å°æ—¶å€™æ›´å®¹æ˜“å­¦ä¼šæ›´å¤šçš„çŸ¥è¯†ï¼Œä½†è¶Šå¤§è¶Šç¬¨äº†ï¼äººå¯èƒ½å¾ˆå®¹æ˜“è¢«è‡ªå·±çš„å¹´çºªå¤§äº†ï¼Œå½“æˆé•¿è€…ã€‚å´å¾ˆå°‘èƒ½ä¿æŒä¸€ä¸ªä½å§¿æ€è°¦å‘çš„å¿ƒæ€ï¼Œä¸æ–­çš„å­¦ä¹ ã€‚<code>æ‰€ä»¥æœ€å</code>ï¼Œæ”¾ä¸ä¸‹è‡ªå·±ï¼Œä¹Ÿæ‹¾ä¸èµ·èƒ½åŠ›ã€‚</p><p>å–œæ¬¢ä¸€å¥è¯ï¼Œ<code>è“æ˜¯å¤©çš„é¢œè‰²ã€çº¢æ˜¯ç«çš„è±¡å¾ï¼Œæˆ‘ä¸å­¦å¤§æµ·æŠ„è¢­å¤©çš„è“ã€ä¹Ÿä¸å­¦æ™šéœæ¨¡æ‹Ÿç«çš„çº¢ã€‚æˆ‘å°±æ˜¯æˆ‘ï¼Œç”Ÿå‘½æ˜¯æˆ‘çš„ã€å‘½è¿æ˜¯æˆ‘çš„</code>ã€‚<strong>å¥èº«ä¹Ÿæ˜¯ä½ çš„ã€å­¦ä¹ ä¹Ÿæ˜¯ä½ çš„</strong>ï¼Œåªè¦ä½ æœ‰ä¸€ä¸ªå¥½å¿ƒæ€ï¼Œè‡ªç„¶ä¼šèµ°åˆ°å‰é¢å“è¶Šé‚£é‡Œï¼</p><h2 id="äºŒã€é¢è¯•é¢˜" tabindex="-1"><a class="header-anchor" href="#äºŒã€é¢è¯•é¢˜" aria-hidden="true">#</a> äºŒã€é¢è¯•é¢˜</h2><p><code>è°¢é£æœºï¼Œå°è®°ï¼</code> <em>ç å¾·</em>ï¼Œå¹´è½»äººå†™ä»£ç å¥½çŒ–ç‹‚ï¼Œä¸éµå®ˆè§„èŒƒè¿˜å–·æˆ‘ï¼Œä½ è¦<code>è€—å­å°¾æ±</code>ï¼è°¢é£æœºéª‚éª‚å’§å’§çš„ä¸‹ç­åï¼Œæ‰¾é¢è¯•å®˜èŠå¿ƒå¾—ã€‚</p><p><strong>è°¢é£æœº</strong>ï¼šæˆ‘æ„Ÿè§‰å¤©å¤©å°±åƒæ´»åœ¨ç²ªå †ï¼Œä»£ç éƒ½æ˜¯ä¹±ç³Ÿç³Ÿï¼Œæˆ‘æœ‰å¿ƒæ— åŠ›ï¼</p><p><strong>é¢è¯•å®˜</strong>ï¼šæ€ä¹ˆï¼Œæƒ³è·³æ§½äº†ï¼Ÿ</p><p><strong>è°¢é£æœº</strong>ï¼šæƒ³å»å†™ä»£ç æœ‰è§„èŒƒçš„å…¬å¸ï¼Œæƒ³æå‡ï¼</p><p><strong>é¢è¯•å®˜</strong>ï¼šå—¯ï¼ç¡®å®ï¼Œæœ‰äº›å¤§å…¬å¸çš„ä»£ç è´¨é‡è¦å¥½ä¸€äº›ã€‚ä½†æ˜¯ä½ ä¹Ÿè¦è‡ªèº«èƒ½åŠ›å¼ºçš„ã€‚</p><p><strong>è°¢é£æœº</strong>ï¼šæ˜¯çš„ï¼Œæˆ‘ä¸€ç›´åœ¨åŠªåŠ›å­¦ä¹ ï¼å‡†å¤‡è·‘è·¯ï¼</p><p><strong>é¢è¯•å®˜</strong>ï¼šé‚£æˆ‘é¡ºä¾¿è€ƒä½ ä¸ªé¢˜ï¼Œçœ‹çœ‹ä½ è¿›å¤§å‚çš„å‡ ç‡å¤§ä¸ã€‚<code>å—¯... Java çº¿ç¨‹å¦‚ä½•å¯åŠ¨çš„ï¼Ÿ</code></p><p><strong>è°¢é£æœº</strong>ï¼šå¦‚ä½•å¯åŠ¨çš„ï¼Ÿ<code>start</code> å¯åŠ¨çš„ï¼</p><p><strong>é¢è¯•å®˜</strong>ï¼šè¿˜æœ‰å—ï¼Ÿ</p><p><strong>è°¢é£æœº</strong>ï¼šå—¯...ï¼Œæ²¡äº†ï¼</p><p><strong>é¢è¯•å®˜</strong>ï¼šå—¯ï¼Œå¯èƒ½<code>ä¼šä¸ä¸ä¼š</code>è¿™ä¸€ä¸ªé¢˜å¹¶ä¸ä¼šè®©ä½ ä»£ç æœ‰å¤šç‰›ã€æœ‰å¤šå¥½ï¼Œä½†æ˜¯ä½ çš„æŠ€æœ¯æ ˆæ·±åº¦å’Œå¹¿åº¦ï¼Œå†³å®šä½ çš„ç¼–ç¨‹èŒä¸šç”Ÿæ¶¯æ˜¯å¦æœ‰ä¸€æ¡åº·åº„å¤§é“ã€‚è¿˜æ˜¯è¦å¤šåŠªåŠ›ï¼</p><h2 id="ä¸‰ã€çº¿ç¨‹å¯åŠ¨åˆ†æ" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€çº¿ç¨‹å¯åŠ¨åˆ†æ" aria-hidden="true">#</a> ä¸‰ã€çº¿ç¨‹å¯åŠ¨åˆ†æ</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// todo</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å’³å’³</strong>ï¼ŒJava çš„çº¿ç¨‹åˆ›å»ºå’Œå¯åŠ¨éå¸¸ç®€å•ï¼Œä½†å¦‚æœé—®<code>ä¸€ä¸ªçº¿ç¨‹æ˜¯æ€ä¹ˆå¯åŠ¨èµ·æ¥çš„</code>å¾€å¾€å¹¶ä¸æ¸…æ¥šï¼Œç”šè‡³ä¸çŸ¥é“ä¸ºä»€ä¹ˆå¯åŠ¨æ—¶æ˜¯<code>è°ƒç”¨start()</code>ï¼Œè€Œä¸æ˜¯<code>è°ƒç”¨run()</code>æ–¹æ³•å‘¢ï¼Ÿ</p><p><strong>é‚£ä¹ˆ</strong>ï¼Œä¸ºäº†è®©å¤§å®¶æœ‰ä¸€ä¸ªæ›´ç›´è§‚çš„è®¤çŸ¥ï¼Œæˆ‘ä»¬å…ˆç«™åœ¨ä¸Šå¸è§†è§’ã€‚æŠŠè¿™æ®µ Java çš„çº¿ç¨‹ä»£ç ï¼Œåˆ° JDK æ–¹æ³•ä½¿ç”¨ï¼Œä»¥åŠ JVM çš„ç›¸åº”å¤„ç†è¿‡ç¨‹ï¼Œå±•ç¤ºç»™å¤§å®¶ï¼Œä»¥æ–¹ä¾¿æˆ‘ä»¬åç»­é€æ­¥åˆ†æã€‚</p><p><img src="https://bugstack.cn/assets/images/2020/interview/interview-19-1.png" alt="å›¾ 19-1 çº¿ç¨‹å¯åŠ¨åˆ†æ"></p><p><strong>ä»¥ä¸Š</strong>ï¼Œå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹å¯åŠ¨çš„æ•´ä½“è¿‡ç¨‹åˆ†æï¼Œä¼šæ¶‰åŠåˆ°å¦‚ä¸‹çŸ¥è¯†ç‚¹ï¼š</p><ul><li>çº¿ç¨‹çš„å¯åŠ¨ä¼šæ¶‰åŠåˆ°æœ¬åœ°æ–¹æ³•ï¼ˆJNIï¼‰çš„è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯é‚£éƒ¨åˆ† C++ ç¼–å†™çš„ä»£ç ã€‚</li><li>JVM çš„å®ç°ä¸­ä¼šæœ‰ä¸åŒæ“ä½œç³»ç»Ÿå¯¹çº¿ç¨‹çš„ç»Ÿä¸€å¤„ç†ï¼Œæ¯”å¦‚ï¼šWinã€Linuxã€Unixã€‚</li><li>çº¿ç¨‹çš„å¯åŠ¨ä¼šæ¶‰åŠåˆ°çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ï¼ˆRUNNABLEï¼‰ï¼Œä»¥åŠå”¤é†’æ“ä½œï¼Œæ‰€ä»¥æœ€ç»ˆä¼šæœ‰å›è°ƒæ“ä½œã€‚<em>ä¹Ÿå°±æ˜¯è°ƒç”¨æˆ‘ä»¬çš„ run() æ–¹æ³•</em></li></ul><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¼€å§‹é€æ­¥åˆ†ææ¯ä¸€æ­¥æºç çš„æ‰§è¡Œå†…å®¹ï¼Œä»è€Œäº†è§£çº¿ç¨‹å¯åŠ¨è¿‡ç¨‹ã€‚</p><h2 id="å››ã€çº¿ç¨‹å¯åŠ¨è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#å››ã€çº¿ç¨‹å¯åŠ¨è¿‡ç¨‹" aria-hidden="true">#</a> å››ã€çº¿ç¨‹å¯åŠ¨è¿‡ç¨‹</h2><h3 id="_1-thread-start-uml-å›¾" tabindex="-1"><a class="header-anchor" href="#_1-thread-start-uml-å›¾" aria-hidden="true">#</a> 1. Thread start UML å›¾</h3><p><img src="https://bugstack.cn/assets/images/2020/interview/interview-19-2.png" alt="å›¾ 19-2 Thread start UML å›¾"></p><p>å¦‚å›¾ 19-2 æ˜¯çº¿ç¨‹çš„å¯åŠ¨è¿‡ç¨‹æ—¶åºå›¾ï¼Œæ•´ä½“çš„é“¾è·¯è¾ƒé•¿ï¼Œä¼šæ¶‰åŠåˆ° JVM çš„æ“ä½œã€‚æ ¸å¿ƒæºç å¦‚ä¸‹ï¼š</p>`,31),v=n("code",null,"Thread.c",-1),h={href:"https://github.com/unofficial-openjdk/openjdk/blob/jdk/jdk/src/java.base/share/native/libjava/Thread.c",target:"_blank",rel:"noopener noreferrer"},m=n("code",null,"jvm.cpp",-1),_={href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/prims/jvm.cpp",target:"_blank",rel:"noopener noreferrer"},b=n("code",null,"thread.cpp",-1),g={href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/runtime/thread.cpp",target:"_blank",rel:"noopener noreferrer"},f=n("code",null,"os.cpp",-1),j={href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/runtime/os.hpp",target:"_blank",rel:"noopener noreferrer"},y=n("code",null,"os_linux.cpp",-1),w={href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/os/linux/vm/os_linux.cpp",target:"_blank",rel:"noopener noreferrer"},J=n("code",null,"os_windows.cpp",-1),T={href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/os/windows/vm/os_windows.cpp",target:"_blank",rel:"noopener noreferrer"},q=n("code",null,"vmSymbols.hpp",-1),x={href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/classfile/vmSymbols.hpp",target:"_blank",rel:"noopener noreferrer"},M=e(`<h3 id="_2-java-å±‚é¢-thread-å¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#_2-java-å±‚é¢-thread-å¯åŠ¨" aria-hidden="true">#</a> 2. Java å±‚é¢ Thread å¯åŠ¨</h3><h4 id="_2-1-start-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_2-1-start-æ–¹æ³•" aria-hidden="true">#</a> 2.1 start() æ–¹æ³•</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// todo</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// JDK æºç </span>
<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>threadStatus <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalThreadStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    group<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> started <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">start0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        started <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>started<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                group<span class="token punctuation">.</span><span class="token function">threadStartFailed</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ignore<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>çº¿ç¨‹å¯åŠ¨æ–¹æ³• <code>start()</code>ï¼Œåœ¨å®ƒçš„æ–¹æ³•è‹±æ–‡æ³¨é‡Šä¸­å·²ç»æŠŠæ ¸å¿ƒå†…å®¹æè¿°å‡ºæ¥ã€‚<code>Causes this thread to begin execution; the Java Virtual Machine calls the run method of this thread.</code> è¿™æ®µè¯çš„æ„æ€æ˜¯ï¼šç”± JVM è°ƒç”¨æ­¤çº¿ç¨‹çš„ run æ–¹æ³•ï¼Œä½¿çº¿ç¨‹å¼€å§‹æ‰§è¡Œã€‚<em>å…¶å®è¿™å°±æ˜¯ä¸€ä¸ª JVM çš„å›è°ƒè¿‡ç¨‹ï¼Œä¸‹æ–‡æºç åˆ†æä¸­ä¼šè®²åˆ°</em></li><li>å¦å¤– <code>start()</code> æ˜¯ä¸€ä¸ª <code>synchronized</code> æ–¹æ³•ï¼Œä½†ä¸ºäº†é¿å…å¤šæ¬¡è°ƒç”¨ï¼Œåœ¨æ–¹æ³•ä¸­ä¼šç”±çº¿ç¨‹çŠ¶æ€åˆ¤æ–­ã€‚<code>threadStatus != 0</code>ã€‚</li><li><code>group.add(this)</code>ï¼Œæ˜¯æŠŠå½“å‰çº¿ç¨‹åŠ å…¥åˆ°çº¿ç¨‹ç»„ï¼ŒThreadGroupã€‚</li><li><code>start0()</code>ï¼Œæ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œé€šè¿‡ JNI æ–¹å¼è°ƒç”¨æ‰§è¡Œã€‚è¿™ä¸€æ­¥çš„æ“ä½œæ‰æ˜¯å¯åŠ¨çº¿ç¨‹çš„æ ¸å¿ƒæ­¥éª¤ã€‚</li></ul><h4 id="_2-2-start0-æœ¬åœ°æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_2-2-start0-æœ¬åœ°æ–¹æ³•" aria-hidden="true">#</a> 2.2 start0() æœ¬åœ°æ–¹æ³•</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// æœ¬åœ°æ–¹æ³• start0</span>
<span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">start0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ³¨å†Œæœ¬åœ°æ–¹æ³•</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Thread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token comment">/* Make sure registerNatives is the first thing &lt;clinit&gt; does. */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">registerNatives</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token function">registerNatives</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>start0()</code>ï¼Œæ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œç”¨äºå¯åŠ¨çº¿ç¨‹ã€‚</li><li><code>registerNatives()</code>ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ç”¨äºæ³¨å†Œçº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦çš„ä¸€äº›æœ¬åœ°æ–¹æ³•ï¼Œæ¯”å¦‚ï¼š<code>start0</code>ã€<code>isAlive</code>ã€<code>yield</code>ã€<code>sleep</code>ã€<code>interrupt0</code>ç­‰ã€‚</li></ul><p><strong>registerNatives</strong>ï¼Œæœ¬åœ°æ–¹æ³•å®šä¹‰åœ¨ <code>Thread.c</code> ä¸­ï¼Œä»¥ä¸‹æ˜¯å®šä¹‰çš„æ ¸å¿ƒæºç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token class-name">JNINativeMethod</span> methods<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span><span class="token string">&quot;start0&quot;</span><span class="token punctuation">,</span>           <span class="token string">&quot;()V&quot;</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token class-name">JVM_StartThread</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;stop0&quot;</span><span class="token punctuation">,</span>            <span class="token string">&quot;(&quot;</span> <span class="token constant">OBJ</span> <span class="token string">&quot;)V&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token class-name">JVM_StopThread</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;isAlive&quot;</span><span class="token punctuation">,</span>          <span class="token string">&quot;()Z&quot;</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token class-name">JVM_IsThreadAlive</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;suspend0&quot;</span><span class="token punctuation">,</span>         <span class="token string">&quot;()V&quot;</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token class-name">JVM_SuspendThread</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;resume0&quot;</span><span class="token punctuation">,</span>          <span class="token string">&quot;()V&quot;</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token class-name">JVM_ResumeThread</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;setPriority0&quot;</span><span class="token punctuation">,</span>     <span class="token string">&quot;(I)V&quot;</span><span class="token punctuation">,</span>       <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token class-name">JVM_SetThreadPriority</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;yield&quot;</span><span class="token punctuation">,</span>            <span class="token string">&quot;()V&quot;</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token class-name">JVM_Yield</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;sleep&quot;</span><span class="token punctuation">,</span>            <span class="token string">&quot;(J)V&quot;</span><span class="token punctuation">,</span>       <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token class-name">JVM_Sleep</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;currentThread&quot;</span><span class="token punctuation">,</span>    <span class="token string">&quot;()&quot;</span> <span class="token constant">THD</span><span class="token punctuation">,</span>     <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token class-name">JVM_CurrentThread</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;interrupt0&quot;</span><span class="token punctuation">,</span>       <span class="token string">&quot;()V&quot;</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token class-name">JVM_Interrupt</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;holdsLock&quot;</span><span class="token punctuation">,</span>        <span class="token string">&quot;(&quot;</span> <span class="token constant">OBJ</span> <span class="token string">&quot;)Z&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token class-name">JVM_HoldsLock</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;getThreads&quot;</span><span class="token punctuation">,</span>        <span class="token string">&quot;()[&quot;</span> <span class="token constant">THD</span><span class="token punctuation">,</span>   <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token class-name">JVM_GetAllThreads</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;dumpThreads&quot;</span><span class="token punctuation">,</span>      <span class="token string">&quot;([&quot;</span> <span class="token constant">THD</span> <span class="token string">&quot;)[[&quot;</span> <span class="token constant">STE</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token class-name">JVM_DumpThreads</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;setNativeName&quot;</span><span class="token punctuation">,</span>    <span class="token string">&quot;(&quot;</span> <span class="token constant">STR</span> <span class="token string">&quot;)V&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token class-name">JVM_SetNativeThreadName</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,9),V=n("strong",null,"æºç ",-1),L={href:"https://github.com/unofficial-openjdk/openjdk/blob/jdk/jdk/src/java.base/share/native/libjava/Thread.c",target:"_blank",rel:"noopener noreferrer"},S=n("li",null,[s("ä»å®šä¹‰ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ"),n("code",null,"start0"),s(" æ–¹æ³•ä¼šæ‰§è¡Œ "),n("code",null,"&JVM_StartThread"),s(" æ–¹æ³•ï¼Œæœ€ç»ˆç”± JVM å±‚é¢å¯åŠ¨çº¿ç¨‹ã€‚")],-1),N=n("h3",{id:"_3-jvm-åˆ›å»ºçº¿ç¨‹",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_3-jvm-åˆ›å»ºçº¿ç¨‹","aria-hidden":"true"},"#"),s(" 3. JVM åˆ›å»ºçº¿ç¨‹")],-1),B=n("h4",{id:"_3-1-jvm-startthread",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_3-1-jvm-startthread","aria-hidden":"true"},"#"),s(" 3.1 JVM_StartThread")],-1),I=n("strong",null,"æºç ",-1),E={href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/prims/jvm.cpp",target:"_blank",rel:"noopener noreferrer"},A=e(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">JVM_ENTRY</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">,</span> <span class="token class-name">JVM_StartThread</span><span class="token punctuation">(</span><span class="token class-name">JNIEnv</span><span class="token operator">*</span> env<span class="token punctuation">,</span> jobject jthread<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token class-name">JVMWrapper</span><span class="token punctuation">(</span><span class="token string">&quot;JVM_StartThread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">JavaThread</span> <span class="token operator">*</span>native_thread <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  
  <span class="token comment">// åˆ›å»ºçº¿ç¨‹</span>
  native_thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JavaThread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>thread_entry<span class="token punctuation">,</span> sz<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å¯åŠ¨çº¿ç¨‹</span>
  <span class="token class-name">Thread</span><span class="token operator">::</span><span class="token function">start</span><span class="token punctuation">(</span>native_thread<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token constant">JVM_END</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™éƒ¨åˆ†ä»£ç æ¯”è¾ƒå¤šï¼Œä½†æ ¸å¿ƒå†…å®¹ä¸»è¦æ˜¯<code>åˆ›å»ºçº¿ç¨‹</code>å’Œ<code>å¯åŠ¨çº¿ç¨‹</code>ï¼Œå¦å¤– <code>&amp;thread_entry</code> ä¹Ÿæ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</li></ul><p><strong>thread_entryï¼Œçº¿ç¨‹å…¥å£</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">thread_entry</span><span class="token punctuation">(</span><span class="token class-name">JavaThread</span><span class="token operator">*</span> thread<span class="token punctuation">,</span> <span class="token constant">TRAPS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">HandleMark</span> <span class="token function">hm</span><span class="token punctuation">(</span><span class="token constant">THREAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Handle</span> <span class="token function">obj</span><span class="token punctuation">(</span><span class="token constant">THREAD</span><span class="token punctuation">,</span> thread<span class="token operator">-&gt;</span><span class="token function">threadObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">JavaValue</span> <span class="token function">result</span><span class="token punctuation">(</span><span class="token constant">T_VOID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">JavaCalls</span><span class="token operator">::</span><span class="token function">call_virtual</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result<span class="token punctuation">,</span>
                          obj<span class="token punctuation">,</span>
                          <span class="token class-name">KlassHandle</span><span class="token punctuation">(</span><span class="token constant">THREAD</span><span class="token punctuation">,</span> <span class="token class-name">SystemDictionary</span><span class="token operator">::</span><span class="token class-name">Thread_klass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          vmSymbols<span class="token operator">::</span><span class="token function">run_method_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          vmSymbols<span class="token operator">::</span><span class="token function">void_method_signature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token constant">THREAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>é‡ç‚¹</strong>ï¼Œåœ¨åˆ›å»ºçº¿ç¨‹å¼•å…¥è¿™ä¸ªçº¿ç¨‹å…¥å£çš„æ–¹æ³•æ—¶ï¼Œ<code>thread_entry</code> ä¸­åŒ…æ‹¬äº† Java çš„å›è°ƒå‡½æ•° <code>JavaCalls::call_virtual</code>ã€‚è¿™ä¸ªå›è°ƒå‡½æ•°ä¼šç”± JVM è°ƒç”¨ã€‚</p><p><strong>vmSymbols::run_method_name()</strong>ï¼Œå°±æ˜¯é‚£ä¸ªè¢«å›è°ƒçš„æ–¹æ³•ï¼Œæºç å¦‚ä¸‹ï¼š</p>`,6),D=n("strong",null,"æºç ",-1),O={href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/classfile/vmSymbols.hpp",target:"_blank",rel:"noopener noreferrer"},R=e(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>#define <span class="token function">VM_SYMBOLS_DO</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> do_alias<span class="token punctuation">)</span>
<span class="token function">template</span><span class="token punctuation">(</span>run_method_name<span class="token punctuation">,</span> <span class="token string">&quot;run&quot;</span><span class="token punctuation">)</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™ä¸ª <code>run</code> å°±æ˜¯æˆ‘ä»¬çš„ Java ç¨‹åºä¸­ä¼šè¢«è°ƒç”¨çš„ run æ–¹æ³•ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­æŒ‰ç…§ä»£ç æ‰§è¡Œé“¾è·¯ï¼Œå¯»æ‰¾åˆ°è¿™ä¸ªè¢«å›è°ƒçš„æ–¹æ³•åœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨çš„ã€‚</li></ul><h4 id="_3-2-javathread" tabindex="-1"><a class="header-anchor" href="#_3-2-javathread" aria-hidden="true">#</a> 3.2 JavaThread</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>native_thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JavaThread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>thread_entry<span class="token punctuation">,</span> sz<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ <code>JavaThread</code> çš„æºç æ‰§è¡Œå†…å®¹ã€‚</p>`,5),U=n("strong",null,"æºç ",-1),C={href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/runtime/thread.cpp",target:"_blank",rel:"noopener noreferrer"},z=e(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">JavaThread</span><span class="token operator">::</span><span class="token class-name">JavaThread</span><span class="token punctuation">(</span><span class="token class-name">ThreadFunction</span> entry_point<span class="token punctuation">,</span> size_t stack_sz<span class="token punctuation">)</span> <span class="token operator">:</span>
  <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
#<span class="token keyword">if</span> <span class="token constant">INCLUDE_ALL_GCS</span>
  <span class="token punctuation">,</span> <span class="token function">_satb_mark_queue</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_satb_mark_queue_set<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">_dirty_card_queue</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_dirty_card_queue_set<span class="token punctuation">)</span>
#endif <span class="token comment">// INCLUDE_ALL_GCS</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">TraceThreadEvents</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tty<span class="token operator">-&gt;</span><span class="token function">print_cr</span><span class="token punctuation">(</span><span class="token string">&quot;creating thread %p&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  _jni_attach_state <span class="token operator">=</span> _not_attaching_via_jni<span class="token punctuation">;</span>
  <span class="token function">set_entry_point</span><span class="token punctuation">(</span>entry_point<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Create the native thread itself.</span>
  <span class="token comment">// %note runtime_23</span>
  os<span class="token operator">::</span><span class="token class-name">ThreadType</span> thr_type <span class="token operator">=</span> os<span class="token operator">::</span><span class="token function">java_thread</span><span class="token punctuation">;</span>
  thr_type <span class="token operator">=</span> entry_point <span class="token operator">==</span> <span class="token operator">&amp;</span>compiler_thread_entry <span class="token operator">?</span> os<span class="token operator">::</span><span class="token function">compiler_thread</span> <span class="token operator">:</span>os<span class="token operator">::</span><span class="token function">java_thread</span><span class="token punctuation">;</span>
  os<span class="token operator">::</span><span class="token function">create_thread</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> thr_type<span class="token punctuation">,</span> stack_sz<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>ThreadFunction entry_point</code>ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸Šé¢çš„ <code>thread_entry</code> æ–¹æ³•ã€‚</li><li><code>size_t stack_sz</code>ï¼Œè¡¨ç¤ºè¿›ç¨‹ä¸­å·²æœ‰çš„çº¿ç¨‹ä¸ªæ•°ã€‚</li><li><strong>è¿™ä¸¤ä¸ªå‚æ•°</strong>ï¼Œéƒ½ä¼šä¼ é€’ç»™ <code>os::create_thread</code> æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºçº¿ç¨‹ä½¿ç”¨ã€‚</li></ul><h4 id="_3-3-os-create-thread" tabindex="-1"><a class="header-anchor" href="#_3-3-os-create-thread" aria-hidden="true">#</a> 3.3 os::create_thread</h4><p><strong>æºç </strong>ï¼š</p>`,4),H=n("code",null,"os_linux.cpp",-1),Z={href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/os/linux/vm/os_linux.cpp",target:"_blank",rel:"noopener noreferrer"},G=n("code",null,"os_windows.cpp",-1),P={href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/os/windows/vm/os_windows.cpp",target:"_blank",rel:"noopener noreferrer"},W=e(`<p><code>ä¼—æ‰€å‘¨çŸ¥ï¼ŒJVM æ˜¯ä¸ªå•¥ï¼</code>ï¼Œæ‰€ä»¥å®ƒçš„ OS æœåŠ¡å®ç°ï¼ŒLiunx è¿˜æœ‰ Windows ç­‰ï¼Œéƒ½ä¼šå®ç°çº¿ç¨‹çš„åˆ›å»ºé€»è¾‘ã€‚<em>è¿™æœ‰ç‚¹åƒé€‚é…å™¨æ¨¡å¼</em></p><p><strong>os_linux -&gt; os::create_thread</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>bool os<span class="token operator">::</span><span class="token function">create_thread</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token operator">*</span> thread<span class="token punctuation">,</span> <span class="token class-name">ThreadType</span> thr_type<span class="token punctuation">,</span> size_t stack_size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">assert</span><span class="token punctuation">(</span>thread<span class="token operator">-&gt;</span><span class="token function">osthread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">&quot;caller responsible&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Allocate the OSThread object</span>
  <span class="token class-name">OSThread</span><span class="token operator">*</span> osthread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSThread</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Initial state is ALLOCATED but not INITIALIZED</span>
  osthread<span class="token operator">-&gt;</span><span class="token function">set_state</span><span class="token punctuation">(</span><span class="token constant">ALLOCATED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  pthread_t tid<span class="token punctuation">;</span>
  <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>attr<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span> java_start<span class="token punctuation">,</span> thread<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>osthread-&gt;set_state(ALLOCATED)</code>ï¼Œåˆå§‹åŒ–å·²åˆ†é…çš„çŠ¶æ€ï¼Œä½†æ­¤æ—¶å¹¶æ²¡æœ‰åˆå§‹åŒ–ã€‚</li><li><code>pthread_create</code>ï¼Œæ˜¯ç±»Unixæ“ä½œç³»ç»Ÿï¼ˆUnixã€Linuxã€Mac OS Xç­‰ï¼‰çš„åˆ›å»ºçº¿ç¨‹çš„å‡½æ•°ã€‚</li><li><code>java_start</code>ï¼Œé‡ç‚¹å…³æ³¨ç±»ï¼Œæ˜¯å®é™…åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•ã€‚</li></ul><h4 id="_3-4-java-start" tabindex="-1"><a class="header-anchor" href="#_3-4-java-start" aria-hidden="true">#</a> 3.4 java_start</h4>`,5),Y=n("strong",null,"æºç ",-1),F={href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/os/linux/vm/os_linux.cpp",target:"_blank",rel:"noopener noreferrer"},K=e(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">java_start</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> <span class="token operator">*</span>thread<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// çº¿ç¨‹ID</span>
  <span class="token keyword">int</span> pid <span class="token operator">=</span> os<span class="token operator">::</span><span class="token function">current_process_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// è®¾ç½®çº¿ç¨‹</span>
  <span class="token class-name">ThreadLocalStorage</span><span class="token operator">::</span><span class="token function">set_thread</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// è®¾ç½®çº¿ç¨‹çŠ¶æ€ï¼šINITIALIZED åˆå§‹åŒ–å®Œæˆ</span>
  osthread<span class="token operator">-&gt;</span><span class="token function">set_state</span><span class="token punctuation">(</span><span class="token constant">INITIALIZED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// å”¤é†’æ‰€æœ‰çº¿ç¨‹</span>
  sync<span class="token operator">-&gt;</span><span class="token function">notify_all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">// å¾ªç¯ï¼Œåˆå§‹åŒ–çŠ¶æ€ï¼Œåˆ™ä¸€è‡´ç­‰å¾… wait</span>
 <span class="token keyword">while</span> <span class="token punctuation">(</span>osthread<span class="token operator">-&gt;</span><span class="token function">get_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">INITIALIZED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sync<span class="token operator">-&gt;</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token class-name">Mutex</span><span class="token operator">::</span><span class="token function">_no_safepoint_check_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

  <span class="token comment">// ç­‰å¾…å”¤é†’åï¼Œæ‰§è¡Œ run æ–¹æ³•</span>
  thread<span class="token operator">-&gt;</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>JVM è®¾ç½®çº¿ç¨‹çŠ¶æ€ï¼ŒINITIALIZED åˆå§‹åŒ–å®Œæˆã€‚</li><li><code>sync-&gt;notify_all()</code>ï¼Œå”¤é†’æ‰€æœ‰çº¿ç¨‹ã€‚</li><li><code>osthread-&gt;get_state() == INITIALIZED</code>ï¼Œwhile å¾ªç¯ç­‰å¾…</li><li><code>thread-&gt;run()</code>ï¼Œæ˜¯ç­‰å¾…çº¿ç¨‹å”¤é†’åï¼Œä¹Ÿå°±æ˜¯çŠ¶æ€å˜æ›´åï¼Œæ‰èƒ½æ‰§è¡Œåˆ°ã€‚<em>è¿™åœ¨æˆ‘ä»¬çš„çº¿ç¨‹æ‰§è¡ŒUMLå›¾ä¸­ï¼Œä¹Ÿæœ‰æ‰€ä½“ç°</em></li></ul><h3 id="_4-jvm-å¯åŠ¨çº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#_4-jvm-å¯åŠ¨çº¿ç¨‹" aria-hidden="true">#</a> 4. JVM å¯åŠ¨çº¿ç¨‹</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">JVM_ENTRY</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">,</span> <span class="token class-name">JVM_StartThread</span><span class="token punctuation">(</span><span class="token class-name">JNIEnv</span><span class="token operator">*</span> env<span class="token punctuation">,</span> jobject jthread<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token class-name">JVMWrapper</span><span class="token punctuation">(</span><span class="token string">&quot;JVM_StartThread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">JavaThread</span> <span class="token operator">*</span>native_thread <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  
  <span class="token comment">// åˆ›å»ºçº¿ç¨‹</span>
  native_thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JavaThread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>thread_entry<span class="token punctuation">,</span> sz<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å¯åŠ¨çº¿ç¨‹</span>
  <span class="token class-name">Thread</span><span class="token operator">::</span><span class="token function">start</span><span class="token punctuation">(</span>native_thread<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token constant">JVM_END</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>JVM_StartThread</code> ä¸­æœ‰ä¸¤æ­¥ï¼Œåˆ›å»ºï¼ˆ<code>new JavaThread</code>ï¼‰ã€å¯åŠ¨ï¼ˆ<code>Thread::start</code>ï¼‰ã€‚åˆ›å»ºçš„è¿‡ç¨‹èŠå®Œäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬èŠå¯åŠ¨ã€‚</li></ul><h4 id="_4-1-thread-start" tabindex="-1"><a class="header-anchor" href="#_4-1-thread-start" aria-hidden="true">#</a> 4.1 Thread::start</h4>`,6),X=n("strong",null,"æºç ",-1),Q={href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/runtime/thread.cpp",target:"_blank",rel:"noopener noreferrer"},$=e(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token class-name">Thread</span><span class="token operator">::</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token operator">*</span> thread<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span> thread<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">DisableStartThread</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>thread<span class="token operator">-&gt;</span><span class="token function">is_Java_thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      java_lang_Thread<span class="token operator">::</span><span class="token function">set_thread_status</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">JavaThread</span><span class="token operator">*</span><span class="token punctuation">)</span>thread<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">threadObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                          java_lang_Thread<span class="token operator">::</span><span class="token constant">RUNNABLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ä¸åŒçš„ OS ä¼šæœ‰ä¸åŒçš„å¯åŠ¨ä»£ç é€»è¾‘</span>
    os<span class="token operator">::</span><span class="token function">start_thread</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¦‚æœæ²¡æœ‰ç¦ç”¨çº¿ç¨‹ <code>DisableStartThread</code> å¹¶ä¸”æ˜¯ Java çº¿ç¨‹ <code>thread-&gt;is_Java_thread()</code>ï¼Œé‚£ä¹ˆè®¾ç½®çº¿ç¨‹çŠ¶æ€ä¸º <code>RUNNABLE</code>ã€‚</li><li><code>os::start_thread(thread)</code>ï¼Œè°ƒç”¨çº¿ç¨‹å¯åŠ¨æ–¹æ³•ã€‚<em>ä¸åŒçš„ OS ä¼šæœ‰ä¸åŒçš„å¯åŠ¨ä»£ç é€»è¾‘</em></li></ul><h4 id="_4-2-os-start-thread-thread" tabindex="-1"><a class="header-anchor" href="#_4-2-os-start-thread-thread" aria-hidden="true">#</a> 4.2 os::start_thread(thread)</h4>`,3),nn=n("strong",null,"æºç ",-1),sn={href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/runtime/os.hpp",target:"_blank",rel:"noopener noreferrer"},an=e(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">void</span> os<span class="token operator">::</span><span class="token function">start_thread</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token operator">*</span> thread<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// guard suspend/resume</span>
  <span class="token class-name">MutexLockerEx</span> <span class="token function">ml</span><span class="token punctuation">(</span>thread<span class="token operator">-&gt;</span><span class="token class-name">SR_lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Mutex</span><span class="token operator">::</span><span class="token function">_no_safepoint_check_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">OSThread</span><span class="token operator">*</span> osthread <span class="token operator">=</span> thread<span class="token operator">-&gt;</span><span class="token function">osthread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  osthread<span class="token operator">-&gt;</span><span class="token function">set_state</span><span class="token punctuation">(</span><span class="token constant">RUNNABLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pd_start_thread</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>osthread-&gt;set_state(RUNNABLE)</code>ï¼Œè®¾ç½®çº¿ç¨‹çŠ¶æ€ <code>RUNNABLE</code></li><li><code>pd_start_thread(thread)</code>ï¼Œå¯åŠ¨çº¿ç¨‹ï¼Œè¿™ä¸ªå°±ç”±å„ä¸ª OS å®ç°ç±»ï¼Œå®ç°å„è‡ªç³»ç»Ÿçš„å¯åŠ¨æ–¹æ³•äº†ã€‚<em>æ¯”å¦‚ï¼Œwindowsç³»ç»Ÿå’ŒLinuxç³»ç»Ÿçš„ä»£ç æ˜¯å®Œå…¨ä¸åŒçš„ã€‚</em></li></ul><h4 id="_4-3-pd-start-thread-thread" tabindex="-1"><a class="header-anchor" href="#_4-3-pd-start-thread-thread" aria-hidden="true">#</a> 4.3 pd_start_thread(thread)</h4>`,3),tn=n("strong",null,"æºç ",-1),en={href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/os/linux/vm/os_linux.cpp",target:"_blank",rel:"noopener noreferrer"},pn=e(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">void</span> os<span class="token operator">::</span><span class="token function">pd_start_thread</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token operator">*</span> thread<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">OSThread</span> <span class="token operator">*</span> osthread <span class="token operator">=</span> thread<span class="token operator">-&gt;</span><span class="token function">osthread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">assert</span><span class="token punctuation">(</span>osthread<span class="token operator">-&gt;</span><span class="token function">get_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">INITIALIZED</span><span class="token punctuation">,</span> <span class="token string">&quot;just checking&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Monitor</span><span class="token operator">*</span> sync_with_child <span class="token operator">=</span> osthread<span class="token operator">-&gt;</span><span class="token function">startThread_lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">MutexLockerEx</span> <span class="token function">ml</span><span class="token punctuation">(</span>sync_with_child<span class="token punctuation">,</span> <span class="token class-name">Mutex</span><span class="token operator">::</span><span class="token function">_no_safepoint_check_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sync_with_child<span class="token operator">-&gt;</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™éƒ¨åˆ†ä»£ç  <code>notify()</code> æœ€å…³é”®ï¼Œå®ƒå¯ä»¥å”¤é†’çº¿ç¨‹ã€‚</li><li>çº¿ç¨‹å”¤é†’åï¼Œ<code>3.4 ä¸­çš„ thread-&gt;run();</code> å°±å¯ä»¥ç»§ç»­æ‰§è¡Œäº†ã€‚</li></ul><h3 id="_5-jvm-çº¿ç¨‹å›è°ƒ" tabindex="-1"><a class="header-anchor" href="#_5-jvm-çº¿ç¨‹å›è°ƒ" aria-hidden="true">#</a> 5. JVM çº¿ç¨‹å›è°ƒ</h3><h4 id="_5-1-thread-run-javathread-run" tabindex="-1"><a class="header-anchor" href="#_5-1-thread-run-javathread-run" aria-hidden="true">#</a> 5.1 thread-&gt;run()[JavaThread::run()]</h4>`,4),on=n("strong",null,"æºç ",-1),cn={href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/runtime/thread.cpp",target:"_blank",rel:"noopener noreferrer"},ln=e(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// The first routine called by a new Java thread</span>
<span class="token keyword">void</span> <span class="token class-name">JavaThread</span><span class="token operator">::</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... åˆå§‹åŒ–çº¿ç¨‹æ“ä½œ</span>
  
  <span class="token function">thread_main_inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>os_linux.cpp ç±»ä¸­çš„ java_start é‡Œçš„ thread-&gt;run()ï¼Œæœ€ç»ˆè°ƒç”¨çš„å°±æ˜¯ thread.cpp çš„ JavaThread::run() æ–¹æ³•ã€‚</li><li>è¿™éƒ¨åˆ†è¿˜éœ€è¦ç»§ç»­å¾€ä¸‹çœ‹ï¼Œ<code>thread_main_inner();</code> æ–¹æ³•ã€‚</li></ul><h4 id="_5-2-thread-main-inner" tabindex="-1"><a class="header-anchor" href="#_5-2-thread-main-inner" aria-hidden="true">#</a> 5.2 thread_main_inner</h4>`,3),un=n("strong",null,"æºç ",-1),rn={href:"https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/runtime/thread.cpp",target:"_blank",rel:"noopener noreferrer"},dn=e(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token class-name">JavaThread</span><span class="token operator">::</span><span class="token function">thread_main_inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">has_pending_exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
      <span class="token operator">!</span>java_lang_Thread<span class="token operator">::</span><span class="token function">is_stillborn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">threadObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">ResourceMark</span> <span class="token function">rm</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">set_native_thread_name</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">get_thread_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">HandleMark</span> <span class="token function">hm</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">entry_point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">DTRACE_THREAD_PROBE</span><span class="token punctuation">(</span>stop<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  delete <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™é‡Œæœ‰ä½ ç†Ÿæ‚‰çš„è®¾ç½®çš„çº¿ç¨‹åç§°ï¼Œ<code>this-&gt;set_native_thread_name(this-&gt;get_thread_name())</code>ã€‚</li><li><code>this-&gt;entry_point()</code>ï¼Œå®é™…è°ƒç”¨çš„å°±æ˜¯ 3.1 ä¸­çš„ thread_entry æ–¹æ³•ã€‚</li><li><code>thread_entry</code>ï¼Œæ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨åˆ° <code>JavaCalls::call_virtual</code> é‡Œçš„<code>vmSymbols::run_method_name()</code>ã€‚ä¹Ÿå°±æ˜¯ run() æ–¹æ³•ï¼Œè‡³æ­¤çº¿ç¨‹å¯åŠ¨å®Œæˆã€‚<em>ç»ˆäºä¸²å›æ¥äº†ï¼</em></li></ul><h2 id="äº”ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#äº”ã€æ€»ç»“" aria-hidden="true">#</a> äº”ã€æ€»ç»“</h2><ul><li>çº¿ç¨‹çš„å¯åŠ¨è¿‡ç¨‹æ¶‰åŠåˆ°äº† JVM çš„å‚ä¸ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰è®¤çœŸäº†è§£è¿‡ï¼Œç¡®å®å¾ˆéš¾ä»ä¸€ä¸ªæœ¬åœ°æ–¹æ³•äº†è§£çš„å¦‚æ­¤é€å½»ã€‚</li><li>æ•´ä¸ªæºç åˆ†æå¯ä»¥ç»“åˆç€ä»£ç è°ƒç”¨UMLæ—¶åºå›¾è¿›è¡Œå­¦ä¹ ï¼ŒåŸºæœ¬æ ¸å¿ƒè¿‡ç¨‹åŒ…æ‹¬ï¼š<code>Java åˆ›å»ºçº¿ç¨‹å’Œå¯åŠ¨</code>ã€<code>è°ƒç”¨æœ¬åœ°æ–¹æ³• start0()</code>ã€<code>JVM ä¸­ JVM_StartThread çš„åˆ›å»ºå’Œå¯åŠ¨</code>ã€<code>è®¾ç½®çº¿ç¨‹çŠ¶æ€ç­‰å¾…è¢«å”¤é†’</code>ã€<code>æ ¹æ®ä¸åŒçš„OSå¯åŠ¨çº¿ç¨‹å¹¶å”¤é†’</code>ã€<code>æœ€åå›è°ƒ run() æ–¹æ³•å¯åŠ¨ Java çº¿ç¨‹</code>ã€‚</li><li>æœ‰æ—¶å€™å¯èƒ½åªæ˜¯ä¸€æ­¥å¾ˆç®€å•çš„æ–¹æ³•ï¼Œä¹Ÿä¼šæœ‰å®ƒçš„æ·±å…¥ä¹‹å¤„ï¼Œå½“çœŸçš„æ‡‚äº†ä»¥åï¼Œå°±ä¸ç”¨æ­»è®°ç¡¬èƒŒã€‚<em>å¦‚æœéœ€è¦è·å¾—ä»¥ä¸Šé«˜æ¸…å¤§å›¾ï¼Œå¯ä»¥æ·»åŠ å°å‚…å“¥å¾®ä¿¡(<code>fustack</code>)ï¼Œå¤‡æ³¨ï¼šThreadå¤§å›¾</em></li></ul>`,4);function kn(vn,hn){const a=o("ExternalLinkIcon");return c(),l("div",null,[u,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),r,s("åšå®¢ï¼š"),n("a",d,[s("https://bugstack.cn"),t(a)])]),k,n("ol",null,[n("li",null,[v,s("ï¼š"),n("a",h,[s("https://github.com/unofficial-openjdk/openjdk/blob/jdk/jdk/src/java.base/share/native/libjava/Thread.c"),t(a)])]),n("li",null,[m,s("ï¼š"),n("a",_,[s("https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/prims/jvm.cpp"),t(a)])]),n("li",null,[b,s("ï¼š"),n("a",g,[s("https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/runtime/thread.cpp"),t(a)])]),n("li",null,[f,s("ï¼š"),n("a",j,[s("https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/runtime/os.hpp"),t(a)])]),n("li",null,[y,s("ï¼š"),n("a",w,[s("https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/os/linux/vm/os_linux.cpp"),t(a)])]),n("li",null,[J,s("ï¼š"),n("a",T,[s("https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/os/windows/vm/os_windows.cpp"),t(a)])]),n("li",null,[q,s("ï¼š"),n("a",x,[s("https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/classfile/vmSymbols.hpp"),t(a)])])]),M,n("ul",null,[n("li",null,[V,s("ï¼š"),n("a",L,[s("https://github.com/unofficial-openjdk/openjdk/blob/jdk/jdk/src/java.base/share/native/libjava/Thread.c"),t(a)])]),S]),N,B,n("p",null,[I,s("ï¼š"),n("a",E,[s("https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/prims/jvm.cpp"),t(a)])]),A,n("p",null,[D,s("ï¼š"),n("a",O,[s("https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/classfile/vmSymbols.hpp"),t(a)])]),R,n("p",null,[U,s("ï¼š"),n("a",C,[s("https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/runtime/thread.cpp"),t(a)])]),z,n("ul",null,[n("li",null,[H,s("ï¼š"),n("a",Z,[s("https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/os/linux/vm/os_linux.cpp"),t(a)])]),n("li",null,[G,s("ï¼š"),n("a",P,[s("https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/os/windows/vm/os_windows.cpp"),t(a)])])]),W,n("p",null,[Y,s("ï¼š"),n("a",F,[s("https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/os/linux/vm/os_linux.cpp"),t(a)])]),K,n("p",null,[X,s("ï¼š"),n("a",Q,[s("https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/runtime/thread.cpp"),t(a)])]),$,n("p",null,[nn,s("ï¼š"),n("a",sn,[s("https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/runtime/os.hpp"),t(a)])]),an,n("p",null,[tn,s("ï¼š"),n("a",en,[s("https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/os/linux/vm/os_linux.cpp"),t(a)])]),pn,n("p",null,[on,s("ï¼š"),n("a",cn,[s("https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/runtime/thread.cpp"),t(a)])]),ln,n("p",null,[un,s("ï¼š"),n("a",rn,[s("https://github.com/JetBrains/jdk8u_hotspot/blob/master/src/share/vm/runtime/thread.cpp"),t(a)])]),dn])}const _n=p(i,[["render",kn],["__file","2020-11-25-mianjingshouce Â· di19pianã€ŠThread.start() ï¼Œtashizenmerangxianchengqidongdeneï¼Ÿã€‹.html.vue"]]);export{_n as default};
