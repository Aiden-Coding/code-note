import{_ as e,r as o,o as c,c as l,a as n,b as s,d as t,e as p}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"mybatis-ä½¿ç”¨æ•™ç¨‹å’Œæ’ä»¶å¼€å‘",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#mybatis-ä½¿ç”¨æ•™ç¨‹å’Œæ’ä»¶å¼€å‘","aria-hidden":"true"},"#"),s(" MyBatis ä½¿ç”¨æ•™ç¨‹å’Œæ’ä»¶å¼€å‘")],-1),k=n("br",null,null,-1),r={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=n("blockquote",null,[n("p",null,"æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„")],-1),m=n("iframe",{id:"B-Video",src:"//player.bilibili.com/player.html?aid=955906479&bvid=BV1DW4y1o7Vd&cid=1198523013&page=1",scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",width:"100%",height:"480"}," ",-1),v=n("p",null,"æœ¬æ–‡çš„å®—æ—¨åœ¨äºé€šè¿‡ç®€å•å¹²å‡€å®è·µçš„æ–¹å¼æ•™ä¼šè¯»è€…ï¼Œä½¿ç”¨ SpringBoot é…ç½® MyBatis å¹¶å®Œæˆå¯¹æ’å…¥ã€æ‰¹é‡æ’å…¥ã€ä¿®æ”¹ã€æŸ¥è¯¢ä»¥åŠæ³¨è§£äº‹åŠ¡å’Œç¼–ç¨‹äº‹åŠ¡çš„ä½¿ç”¨ï¼Œé€šè¿‡æ‰©å±•æ’ä»¶å¼€å‘å¯¹ç½®é¡¶å­—æ®µè¿›è¡ŒåŠ è§£å¤„ç†ã€‚",-1),b=n("p",null,"æ­¤å¤–æœ¬æ–‡ä¹Ÿé€šè¿‡æ­¤æ¡ˆä¾‹ï¼Œæ¸—é€è®²è§£ DDD æ¨¡å‹ä¸­çš„èšåˆå¯¹è±¡ã€å®ä½“å¯¹è±¡å’Œå€¼å¯¹è±¡åœ¨é¢†åŸŸæ¨¡å‹ä¸­çš„å®è·µã€‚",-1),y=n("p",null,"æœ¬æ–‡æ¶‰åŠçš„å·¥ç¨‹ï¼š",-1),g={href:"https://gitcode.net/KnowledgePlanet/road-map/xfg-dev-tech-mybatis",target:"_blank",rel:"noopener noreferrer"},f={href:"https://gitcode.net/KnowledgePlanet/road-map/xfg-dev-tech-mybatis/-/blob/master/road-map.sql",target:"_blank",rel:"noopener noreferrer"},h=p('<h2 id="ä¸€ã€æ¡ˆä¾‹èƒŒæ™¯" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€æ¡ˆä¾‹èƒŒæ™¯" aria-hidden="true">#</a> ä¸€ã€æ¡ˆä¾‹èƒŒæ™¯</h2><p><code>è¯´ä¸€åƒé“ä¸€ä¸‡ï¼Œç»™å°å¡æ‹‰ç±³å†™çš„æ•™ç¨‹ï¼Œå¾—ç®€å•è¿˜å¥½çœ‹ï¼</code></p><p>ä¸ºäº†æ›´å¥½çš„æŠŠ MyBatis å¸¸ç”¨çš„å„é¡¹åŠŸèƒ½ä½“ç°çš„æ¸…æ™°æ˜äº†ï¼Œå°å‚…å“¥è¿™é‡Œè®¾å®šäº†å…¬å¸é›‡å‘˜å’Œå¯¹åº”è–ªé…¬å…³ç³»çš„ä¸€ä¸ªå¼€å‘åœºæ™¯ã€‚</p><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-mybatis-01.png?raw=true" width="750px"></div><ul><li>é¦–å…ˆï¼Œé›‡å‘˜å‘˜å·¥å’Œå¯¹åº”çš„è–ªèµ„å¾…é‡ï¼Œæ˜¯ä¸€ä¸ª1v1çš„å…³ç³»ã€‚</li><li>ä¹‹åï¼Œè–ªèµ„è¡¨ä¸è°ƒè–ªè¡¨ï¼Œæ˜¯ä¸€ä¸ª1vnçš„å…³ç³»ã€‚æ¯æ¬¡æ™‹å‡ã€æ™®è°ƒï¼Œéƒ½ä¼šæœ‰ä¸€æ¡å¯¹åº”çš„è°ƒè–ªè®°å½•ã€‚</li><li>æœ€åï¼Œæœ‰äº†è¿™æ ·3ä¸ªè¡¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆå¥½çš„å®Œæˆï¼Œå‘˜å·¥çš„æ’å…¥ã€æ‰¹é‡æ’å…¥ï¼Œå’Œäº‹åŠ¡æ“ä½œè°ƒè–ªã€‚</li></ul><h2 id="äºŒã€é¢†åŸŸæ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#äºŒã€é¢†åŸŸæ¨¡å‹" aria-hidden="true">#</a> äºŒã€é¢†åŸŸæ¨¡å‹</h2>',6),S=n("strong",null,"æ¨¡å‹å®šä¹‰",-1),q={href:"https://bugstack.cn/md/road-map/ddd.html",target:"_blank",rel:"noopener noreferrer"},w={href:"https://bugstack.cn/md/road-map/ddd.html",target:"_blank",rel:"noopener noreferrer"},A=p(`<div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-mybatis-02.png?raw=true" width="650px"></div><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-mybatis-03.png?raw=true" width="450px"></div><p>æ­¤åœºæ™¯çš„ä¸šåŠ¡ç”¨äºå¯¹æŒ‡å®šçš„ç”¨æˆ·è¿›è¡Œ<strong>æ™‹å‡åŠ è–ªè°ƒå¹…</strong>ï¼Œä½†å› ä¸ºåŠ è–ªä¼šéœ€è¦æ“ä½œ3ä¸ªè¡¨ï¼ŒåŒ…æ‹¬ï¼›é›‡å‘˜è¡¨ - ä¿®æ”¹ä¸ªäººTitleã€è–ªèµ„è¡¨ - ä¿®æ”¹è–ªé…¬ã€è°ƒè–ªè®°å½•è¡¨ - æ¯ä¸€æ¬¡åŠ è–ªéƒ½å†™ä¸€æ¡è®°å½•ã€‚</p><h3 id="_1-model" tabindex="-1"><a class="header-anchor" href="#_1-model" aria-hidden="true">#</a> 1. model</h3><h4 id="_1-1-å€¼å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#_1-1-å€¼å¯¹è±¡" aria-hidden="true">#</a> 1.1 å€¼å¯¹è±¡</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">EmployeePostVO</span> <span class="token punctuation">{</span>

    <span class="token function">T1</span><span class="token punctuation">(</span><span class="token string">&quot;T-1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;åˆçº§å·¥ç¨‹å¸ˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">T2</span><span class="token punctuation">(</span><span class="token string">&quot;T-2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;åˆçº§å·¥ç¨‹å¸ˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">T3</span><span class="token punctuation">(</span><span class="token string">&quot;T-3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ä¸­çº§å·¥ç¨‹å¸ˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">T4</span><span class="token punctuation">(</span><span class="token string">&quot;T-4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ä¸­çº§å·¥ç¨‹å¸ˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">T5</span><span class="token punctuation">(</span><span class="token string">&quot;T-5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;é«˜çº§å·¥ç¨‹å¸ˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">T6</span><span class="token punctuation">(</span><span class="token string">&quot;T-6&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;é«˜çº§å·¥ç¨‹å¸ˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">T7</span><span class="token punctuation">(</span><span class="token string">&quot;T-7&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æ¶æ„å¸ˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">T8</span><span class="token punctuation">(</span><span class="token string">&quot;T-8&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æ¶æ„å¸ˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> desc<span class="token punctuation">;</span>

		<span class="token comment">// çœç•¥éƒ¨åˆ†</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å½“ä¸€ä¸ªå®ä½“å¯¹è±¡ä¸­çš„ä¸€ä¸ªå€¼ï¼Œæ˜¯æœ‰å¤šä¸ªèŒƒå›´æ—¶å€™ï¼Œåˆ™éœ€è¦å®šä¹‰å‡ºå€¼å¯¹è±¡ã€‚ç”±äºæ­¤ç±»çš„å€¼å¯¹è±¡æ›´è´´è¿‘äºå½“å‰çš„åœºæ™¯ä¸šåŠ¡ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä¼šè¢«å®šä¹‰ä¸ºå…±ç”¨çš„æšä¸¾ã€‚å¦‚æ­¤æ­¤ç±»å€¼èŒƒå›´ï¼Œéƒ½ä¼šè¢«å®šä¹‰ä¸ºå€¼å¯¹è±¡ã€‚</li></ul><h4 id="_1-2-å®ä½“å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#_1-2-å®ä½“å¯¹è±¡" aria-hidden="true">#</a> 1.2 å®ä½“å¯¹è±¡</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmployeeEntity</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/** é›‡å‘˜çº§åˆ« */</span>
    <span class="token keyword">private</span> <span class="token class-name">EmployeePostVO</span> employeeLevel<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/** é›‡å‘˜å²—ä½Title */</span>
    <span class="token keyword">private</span> <span class="token class-name">EmployeePostVO</span> employeeTitle<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmployeeSalaryAdjustEntity</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/** æ€»é¢è°ƒè–ª */</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> adjustTotalAmount<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/** åŸºç¡€è°ƒè–ª */</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> adjustBaseAmount<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/** ç»©æ•ˆè°ƒè–ª */</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> adjustMeritAmount<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å®ä½“å¯¹è±¡æ˜¯å¯¹æ•°æ®åº“å¯¹è±¡çš„æŠ½è±¡ï¼Œå¤§å¤šæ•°æ—¶å€™æ˜¯ 1:1 çš„å…³ç³»ç»“æ„ï¼Œåœ¨ä¸€äº›å¤æ‚çš„æ¨¡å‹åœºæ™¯ä¸­ä¼šæ˜¯1:nçš„ç»“æ„ã€‚</li></ul><h4 id="_1-3-èšåˆå¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#_1-3-èšåˆå¯¹è±¡" aria-hidden="true">#</a> 1.3 èšåˆå¯¹è±¡</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdjustSalaryApplyOrderAggregate</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/** é›‡å‘˜ç¼–å· */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> employeeNumber<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/** è°ƒè–ªå•å· */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderId<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/** é›‡å‘˜å®ä½“ */</span>
    <span class="token keyword">private</span> <span class="token class-name">EmployeeEntity</span> employeeEntity<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/** é›‡å‘˜å®ä½“ */</span>
    <span class="token keyword">private</span> <span class="token class-name">EmployeeSalaryAdjustEntity</span> employeeSalaryAdjustEntity<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>èšåˆå¯¹è±¡æ˜¯å¯¹å®ä½“å¯¹è±¡å’Œå€¼å¯¹è±¡çš„å°è£…ï¼Œä»£è¡¨ç€ä¸€ç±»ä¸šåŠ¡çš„èšåˆã€‚é€šå¸¸æ˜¯ä½œä¸º service æœåŠ¡å±‚ä¸­å…¥å‚å‡ºç°ã€‚</li></ul><h3 id="_2-repository" tabindex="-1"><a class="header-anchor" href="#_2-repository" aria-hidden="true">#</a> 2. repository</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ISalaryAdjustRepository</span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> <span class="token function">adjustSalary</span><span class="token punctuation">(</span><span class="token class-name">AdjustSalaryApplyOrderAggregate</span> adjustSalaryApplyOrderAggregate<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä»“å‚¨åœ¨ DDD ä¸­çš„è®¾è®¡ï¼Œæ˜¯ä¸€ç§ä¾èµ–å€’ç½®å…³ç³»ï¼Œç”± domain å®šä¹‰æ¥å£ï¼Œä¹‹åç”±å¼•å…¥ domain åŒ…çš„åŸºå±‚å±‚ infrastructure å®ç°åŠŸèƒ½ã€‚</li><li>æ­¤å¤–ï¼Œå› ä¸ºæ˜¯ä¾èµ–å€’ç½®ï¼Œæ‰€ä»¥å¤©ç„¶çš„éš”ç¦»äº† PO æ•°æ®åº“æŒä¹…åŒ–å¯¹è±¡ï¼Œä¸ä¼šè¢«å¯¹å¤–ä½¿ç”¨ã€‚è¿™ä¸ªè®¾è®¡æ˜¯éå¸¸å·§å¦™çš„ã€‚å½“æˆ‘ä»¬ä»ç»“æ„ä¸Šå®šä¹‰äº†åŸåˆ™ï¼Œå°±ä¸ä¼šæœ‰äººä¹±å¼•ç”¨å¯¹è±¡äº†ã€‚</li></ul><h3 id="_3-service" tabindex="-1"><a class="header-anchor" href="#_3-service" aria-hidden="true">#</a> 3. service</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ISalaryAdjustApplyService</span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> <span class="token function">execSalaryAdjust</span><span class="token punctuation">(</span><span class="token class-name">AdjustSalaryApplyOrderAggregate</span> adjustSalaryApplyOrderAggregate<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å½“å‰åœºæ™¯ç®€å•ï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–çš„è®¾è®¡æ¨¡å¼ä½¿ç”¨ã€‚ä½†å¦‚æœæ˜¯å¤æ‚åœºæ™¯ï¼Œå¿…é¡»è€ƒè™‘è®¾è®¡æ¨¡å¼ï¼Œå¦åˆ™ä»£ç éƒ½å†™åˆ° SalaryAdjustApplyService å®ç°ç±»é‡Œï¼Œé‚£ä¹ˆå°†éå¸¸éš¾ç»´æŠ¤ã€‚</li><li>ä¸è¦åªæ˜¯æŠŠèšåˆå¯¹è±¡å½“å……è¡€æ¨¡å‹ï¼Œä½ çš„å……è¡€ç»“æ„æ˜¯æ•´ä¸ª domain ä¸‹çš„æ¯ä¸€ä¸ªé¢†åŸŸåŒ…ï¼Œä¹Ÿå°±æ˜¯è®©è¿™é‡Œçš„çŠ¶æ€ä¸è¡Œä¸ºçœ‹åšä¸ºä¸€æ•´ä¸ªç»“æ„ã€‚</li></ul><p>ğŸ“¢ <strong>ç»¼ä¸Š</strong>ï¼Œæœ‰äº†è¿™æ ·çš„æ¨¡å‹ç»“æ„è®¾è®¡å®šä¹‰ï¼Œç›¸ä¿¡ä½ ä¹Ÿå¯ä»¥å¾ˆå¥½çš„æ‹†åˆ†è‡ªå·±çš„ä¸šåŠ¡å¯¹è±¡å¹¶å®Œæˆé¢†åŸŸåŠŸèƒ½å®ç°äº†ã€‚</p><h2 id="ä¸‰ã€é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> ä¸‰ã€é…ç½®æ–‡ä»¶</h2><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-mybatis-04.png?raw=true" width="950px"></div><ul><li>å·¥ç¨‹ä¸­å…³äº MyBatis çš„ä½¿ç”¨ï¼Œåœ¨ xfg-dev-tech-app ä¸‹è¿›è¡Œç»Ÿä¸€é…ç½®ã€‚å› ä¸ºæ‰€æœ‰é…ç½®ä¿¡æ¯éƒ½æ”¾åˆ°ä¸€èµ·ï¼Œæ¯”è¾ƒæ–¹ä¾¿ç®¡ç†ï¼Œä¹Ÿåˆ©äºçº¿ä¸Šä¸Šçº¿åï¼Œæå–é…ç½®æ–‡ä»¶ã€‚</li></ul><h2 id="å››ã€åŠŸèƒ½å®ç°" tabindex="-1"><a class="header-anchor" href="#å››ã€åŠŸèƒ½å®ç°" aria-hidden="true">#</a> å››ã€åŠŸèƒ½å®ç°</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»ä¸€äº›å…³äº MyBatis çš„ä½¿ç”¨åŠŸèƒ½ï¼Œä½†ä½ å¯ä»¥å¸¦ç€ DDD çš„æ€æƒ³æ¥çœ‹è¿™äº›å†…å®¹å®ç°æ—¶æ‰€åœ¨çš„ä½ç½®ï¼Œè¿™ä¼šè®©ä½ ä¸åªæ˜¯å­¦ä¹  MyBatis ä¹Ÿèƒ½å­¦ä¼šä¸€äº› DDD çš„è®¾è®¡ã€‚</p><h3 id="_1-æ’å…¥-æ‰¹é‡æ’å…¥" tabindex="-1"><a class="header-anchor" href="#_1-æ’å…¥-æ‰¹é‡æ’å…¥" aria-hidden="true">#</a> 1. æ’å…¥&amp;æ‰¹é‡æ’å…¥</h3><p><strong>æºç </strong>ï¼š<code>cn.bugstack.xfg.dev.tech.infrastructure.dao.IEmployeeDAO</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IEmployeeDAO</span> <span class="token punctuation">{</span>

    <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">EmployeePO</span> employee<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">insertList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EmployeePO</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">EmployeePO</span> employeePO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">EmployeePO</span> <span class="token function">queryEmployeeByEmployNumber</span><span class="token punctuation">(</span><span class="token class-name">String</span> employNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>xml</strong>ï¼š<code>employee_mapper.xml</code></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>insert<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.xfg.dev.tech.infrastructure.po.EmployeePO<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    INSERT INTO employee(employee_number, employee_name, employee_level, employee_title, create_time, update_time)
    VALUES(#{employeeNumber}, #{employeeName}, #{employeeLevel}, #{employeeTitle}, now(), now())
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>insertList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.util.List<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    INSERT INTO employee(employee_number, employee_name, employee_level, employee_title, create_time, update_time)
    VALUES
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>,<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        (#{item.employeeNumber}, #{item.employeeName}, #{item.employeeLevel}, #{item.employeeTitle}, now(), now())
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä½¿ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼æ¯”è¾ƒå¥½ç»´æŠ¤ï¼Œå½“ç„¶å¦‚æœä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨ MyBatis æä¾›çš„æ³¨è§£æ–¹å¼ï¼Œå®Œæˆæ•°æ®çš„æ“ä½œã€‚</li></ul><h3 id="_2-äº‹åŠ¡-æ³¨è§£ç¼–ç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-äº‹åŠ¡-æ³¨è§£ç¼–ç¨‹" aria-hidden="true">#</a> 2. äº‹åŠ¡&amp;æ³¨è§£ç¼–ç¨‹</h3><p>Spring æä¾›çš„äº‹åŠ¡åˆ†ä¸ºæ³¨è§£äº‹åŠ¡å’Œç¼–ç¨‹äº‹åŠ¡ï¼Œç¼–ç¨‹äº‹åŠ¡å¯ä»¥æ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚</p><p>Spring Boot äº‹åŠ¡ç®¡ç†çš„çº§åˆ«å¯ä»¥é€šè¿‡ <code>@Transactional</code> æ³¨è§£çš„ <code>isolation</code> å±æ€§è¿›è¡Œé…ç½®ã€‚å¸¸è§çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ol><li><code>DEFAULT</code>ï¼šä½¿ç”¨åº•å±‚æ•°æ®åº“çš„é»˜è®¤éš”ç¦»çº§åˆ«ã€‚MySQL é»˜è®¤ä¸º <code>REPEATABLE READ</code>ï¼ŒOracle é»˜è®¤ä¸º <code>READ COMMITTED</code>ã€‚</li><li><code>READ_UNCOMMITTED</code>ï¼šæœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–æœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»é—®é¢˜ã€‚</li><li><code>READ_COMMITTED</code>ï¼šå…è®¸è¯»å–å·²ç»æäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯ä»¥é¿å…è„è¯»é—®é¢˜ï¼Œä½†å¯èƒ½ä¼šå‡ºç°ä¸å¯é‡å¤è¯»å’Œå¹»è¯»é—®é¢˜ã€‚</li><li><code>REPEATABLE_READ</code>ï¼šä¿è¯åŒä¸€äº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®æ—¶ï¼Œç»“æœå§‹ç»ˆä¸€è‡´ï¼Œå¯ä»¥é¿å…è„è¯»å’Œä¸å¯é‡å¤è¯»é—®é¢˜ï¼Œä½†å¯èƒ½ä¼šå‡ºç°å¹»è¯»é—®é¢˜ã€‚</li><li><code>SERIALIZABLE</code>ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå¯ä»¥é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»é—®é¢˜ï¼Œä½†ä¼šå½±å“å¹¶å‘æ€§èƒ½ã€‚</li></ol><p>åœ¨ Spring Boot ä¸­ï¼Œé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸º <code>DEFAULT</code>ã€‚å¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œå»ºè®®ä½¿ç”¨é»˜è®¤éš”ç¦»çº§åˆ«ã€‚</p><p>SpringBoot äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºå¯ä»¥é€šè¿‡ <code>@Transactional</code> æ³¨è§£çš„ <code>propagation</code> å±æ€§è¿›è¡Œé…ç½®ã€‚å¸¸ç”¨çš„ä¼ æ’­è¡Œä¸ºæœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ol><li><code>Propagation.REQUIRED</code>ï¼šé»˜è®¤çš„ä¼ æ’­è¡Œä¸ºï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦åˆ™æ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼›</li><li><code>Propagation.SUPPORTS</code>ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦åˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œï¼›</li><li><code>Propagation.MANDATORY</code>ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼›</li><li><code>Propagation.REQUIRES_NEW</code>ï¼šæ— è®ºå½“å‰æ˜¯å¦å­˜åœ¨äº‹åŠ¡ï¼Œéƒ½ä¼šæ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™å°†å½“å‰äº‹åŠ¡æŒ‚èµ·ï¼›</li><li><code>Propagation.NOT_SUPPORTED</code>ï¼šä»¥éäº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™å°†å½“å‰äº‹åŠ¡æŒ‚èµ·ï¼›</li><li><code>Propagation.NEVER</code>ï¼šä»¥éäº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼›</li><li><code>Propagation.NESTED</code>ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨è¯¥äº‹åŠ¡çš„åµŒå¥—äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå¦åˆ™æ–°å»ºä¸€ä¸ªäº‹åŠ¡ã€‚åµŒå¥—äº‹åŠ¡æ˜¯ç‹¬ç«‹äºå¤–éƒ¨äº‹åŠ¡çš„ï¼Œä½†æ˜¯å¦‚æœå¤–éƒ¨äº‹åŠ¡å›æ»šï¼Œåˆ™åµŒå¥—äº‹åŠ¡ä¹Ÿä¼šå›æ»šã€‚</li></ol><p>é™¤äº†ä¼ æ’­è¡Œä¸ºï¼Œ<code>@Transactional</code> æ³¨è§£è¿˜å¯ä»¥é…ç½®å…¶ä»–å±æ€§ï¼Œä¾‹å¦‚éš”ç¦»çº§åˆ«ã€è¶…æ—¶æ—¶é—´ã€åªè¯»ç­‰ã€‚</p><h4 id="_2-1-æ³¨è§£äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#_2-1-æ³¨è§£äº‹åŠ¡" aria-hidden="true">#</a> 2.1 æ³¨è§£äº‹åŠ¡</h4><p><strong>æºç </strong>ï¼š<code>cn.bugstack.xfg.dev.tech.infrastructure.repository.SalaryAdjustRepository</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> timeout <span class="token operator">=</span> <span class="token number">350</span><span class="token punctuation">,</span> propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span><span class="token constant">REQUIRED</span><span class="token punctuation">,</span> isolation <span class="token operator">=</span> <span class="token class-name">Isolation</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">adjustSalary</span><span class="token punctuation">(</span><span class="token class-name">AdjustSalaryApplyOrderAggregate</span> adjustSalaryApplyOrderAggregate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> employeeNumber <span class="token operator">=</span> adjustSalaryApplyOrderAggregate<span class="token punctuation">.</span><span class="token function">getEmployeeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> orderId <span class="token operator">=</span> adjustSalaryApplyOrderAggregate<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">EmployeeEntity</span> employeeEntity <span class="token operator">=</span> adjustSalaryApplyOrderAggregate<span class="token punctuation">.</span><span class="token function">getEmployeeEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">EmployeeSalaryAdjustEntity</span> employeeSalaryAdjustEntity <span class="token operator">=</span> adjustSalaryApplyOrderAggregate<span class="token punctuation">.</span><span class="token function">getEmployeeSalaryAdjustEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">EmployeePO</span> employeePO <span class="token operator">=</span> <span class="token class-name">EmployeePO</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">employeeNumber</span><span class="token punctuation">(</span>employeeNumber<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">employeeLevel</span><span class="token punctuation">(</span>employeeEntity<span class="token punctuation">.</span><span class="token function">getEmployeeLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">employeeTitle</span><span class="token punctuation">(</span>employeeEntity<span class="token punctuation">.</span><span class="token function">getEmployeeTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ›´æ–°å²—ä½</span>
    employeeDAO<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>employeePO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">EmployeeSalaryPO</span> employeeSalaryPO <span class="token operator">=</span> <span class="token class-name">EmployeeSalaryPO</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">employeeNumber</span><span class="token punctuation">(</span>employeeNumber<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">salaryTotalAmount</span><span class="token punctuation">(</span>employeeSalaryAdjustEntity<span class="token punctuation">.</span><span class="token function">getAdjustTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">salaryMeritAmount</span><span class="token punctuation">(</span>employeeSalaryAdjustEntity<span class="token punctuation">.</span><span class="token function">getAdjustMeritAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">salaryBaseAmount</span><span class="token punctuation">(</span>employeeSalaryAdjustEntity<span class="token punctuation">.</span><span class="token function">getAdjustBaseAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ›´æ–°è–ªé…¬</span>
    employeeSalaryDAO<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>employeeSalaryPO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">EmployeeSalaryAdjustPO</span> employeeSalaryAdjustPO <span class="token operator">=</span> <span class="token class-name">EmployeeSalaryAdjustPO</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">employeeNumber</span><span class="token punctuation">(</span>employeeNumber<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">adjustOrderId</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">adjustTotalAmount</span><span class="token punctuation">(</span>employeeSalaryAdjustEntity<span class="token punctuation">.</span><span class="token function">getAdjustTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">adjustBaseAmount</span><span class="token punctuation">(</span>employeeSalaryAdjustEntity<span class="token punctuation">.</span><span class="token function">getAdjustMeritAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">adjustMeritAmount</span><span class="token punctuation">(</span>employeeSalaryAdjustEntity<span class="token punctuation">.</span><span class="token function">getAdjustBaseAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å†™å…¥æµæ°´</span>
    employeeSalaryAdjustDAO<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>employeeSalaryAdjustPO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> orderId<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™ä¸ªäº‹åŠ¡æ‰€åšçš„å†…å®¹ï¼Œå°±æ˜¯å‰é¢å°å‚…å“¥æåˆ°çš„è°ƒæ•´è–ªèµ„çš„å¤„ç†ã€‚å®ƒçš„å…·ä½“æ“ä½œå°±æ˜¯æ”¾åˆ°ä»“å‚¨å±‚å®ç°ã€‚</li><li>æ³¨æ„äº‹åŠ¡æ³¨è§£çš„é…ç½®ã€‚</li></ul><h4 id="_2-2-ç¼–ç¨‹äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#_2-2-ç¼–ç¨‹äº‹åŠ¡" aria-hidden="true">#</a> 2.2 ç¼–ç¨‹äº‹åŠ¡</h4><h5 id="_2-2-1-äº‹åŠ¡æ¨¡æ¿" tabindex="-1"><a class="header-anchor" href="#_2-2-1-äº‹åŠ¡æ¨¡æ¿" aria-hidden="true">#</a> 2.2.1 äº‹åŠ¡æ¨¡æ¿</h5><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-mybatis-05.png?raw=true" width="950px"></div><ul><li>ä½¿ç”¨ç¼–ç¨‹äº‹åŠ¡ï¼Œéœ€è¦åœ¨è¿™é‡Œåˆ›å»ºå‡ºä¸€ä¸ªäº‹åŠ¡æ¨¡æ¿ï¼Œå½“ç„¶ä½ ä¸åˆ›å»ºä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚åªä¸è¿‡è¿™æ ·ç»Ÿä¸€çš„é…ç½®ä¼šæ›´åŠ æ–¹ä¾¿ã€‚</li></ul><h5 id="_2-2-2-äº‹åŠ¡ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_2-2-2-äº‹åŠ¡ä½¿ç”¨" aria-hidden="true">#</a> 2.2.2 äº‹åŠ¡ä½¿ç”¨</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">TransactionTemplate</span> transactionTemplate<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertEmployeeInfo</span><span class="token punctuation">(</span><span class="token class-name">EmployeeInfoEntity</span> employeeInfoEntity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    transactionTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TransactionCallbackWithoutResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doInTransactionWithoutResult</span><span class="token punctuation">(</span><span class="token class-name">TransactionStatus</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">EmployeePO</span> employeePO <span class="token operator">=</span> <span class="token class-name">EmployeePO</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">employeeNumber</span><span class="token punctuation">(</span>employeeInfoEntity<span class="token punctuation">.</span><span class="token function">getEmployeeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">employeeName</span><span class="token punctuation">(</span>employeeInfoEntity<span class="token punctuation">.</span><span class="token function">getEmployeeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">employeeLevel</span><span class="token punctuation">(</span>employeeInfoEntity<span class="token punctuation">.</span><span class="token function">getEmployeeLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">employeeTitle</span><span class="token punctuation">(</span>employeeInfoEntity<span class="token punctuation">.</span><span class="token function">getEmployeeTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                employeeDAO<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>employeePO<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">EmployeeSalaryPO</span> employeeSalaryPO <span class="token operator">=</span> <span class="token class-name">EmployeeSalaryPO</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">employeeNumber</span><span class="token punctuation">(</span>employeeInfoEntity<span class="token punctuation">.</span><span class="token function">getEmployeeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">salaryTotalAmount</span><span class="token punctuation">(</span>employeeInfoEntity<span class="token punctuation">.</span><span class="token function">getSalaryTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">salaryMeritAmount</span><span class="token punctuation">(</span>employeeInfoEntity<span class="token punctuation">.</span><span class="token function">getSalaryMeritAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">salaryBaseAmount</span><span class="token punctuation">(</span>employeeInfoEntity<span class="token punctuation">.</span><span class="token function">getSalaryBaseAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                employeeSalaryDAO<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>employeeSalaryPO<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                status<span class="token punctuation">.</span><span class="token function">setRollbackOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä¹‹åå°±å¯ä»¥æ‰‹åŠ¨å¤„ç†äº‹åŠ¡äº†ï¼Œå› ä¸ºæ‰‹åŠ¨çš„å¤„ç†å¯ä»¥æ›´ç»†èŠ‚çš„æ§åˆ¶ï¼Œä¹Ÿå¯ä»¥æ ¹æ®è¿”å›çš„ç»“æœï¼Œæ‰‹åŠ¨å›æ»šã€‚è€Œä¸éå¾—å¼‚å¸¸å›æ»šã€‚</li></ul><h3 id="_3-æ’ä»¶-æ•°æ®åŠ å¯†" tabindex="-1"><a class="header-anchor" href="#_3-æ’ä»¶-æ•°æ®åŠ å¯†" aria-hidden="true">#</a> 3. æ’ä»¶&amp;æ•°æ®åŠ å¯†</h3><p>ä½¿ç”¨ MyBatis æ—¶ï¼Œä¹Ÿä¼šç»å¸¸ä¼šç”¨åˆ°æ’ä»¶å¼€å‘ã€‚å°¤å…¶æ˜¯åšä¸€äº›æ•°æ®çš„åŠ è§£å¯†ã€è·¯ç”±ã€æ—¥å¿—ç­‰ï¼Œéƒ½å¯ä»¥åŸºäºæ’ä»¶å®ç°ã€‚</p><p>é‚£ä¹ˆè¿™é‡Œå°å‚…å“¥å°±å¸¦ç€ä½ å®ç°ä¸€ä¸ªå¯¹æŒ‡å®šå­—æ®µåŠ è§£å¯†çš„å¤„ç†ï¼Œæ¯”å¦‚é›‡å‘˜çš„å§“åã€è–ªèµ„ã€çº§åˆ«æ˜¯å¯ä»¥éšè—çš„ï¼Œé¿å…è¢«æœ‰å¿ƒä¹‹äººç›—å–ã€‚</p><p><strong>æºç </strong>ï¼š<code>cn.bugstack.xfg.dev.tech.plugin.FieldEncryptionAndDecryptionMybatisPlugin</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Intercepts</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Signature</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Executor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;update&quot;</span><span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">MappedStatement</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Signature</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Executor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">MappedStatement</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">RowBounds</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">ResultHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FieldEncryptionAndDecryptionMybatisPlugin</span> <span class="token keyword">implements</span> <span class="token class-name">Interceptor</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * å¯†é’¥ï¼Œå¿…é¡»æ˜¯16ä½
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">KEY</span> <span class="token operator">=</span> <span class="token string">&quot;1898794876567654&quot;</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * åç§»é‡ï¼Œå¿…é¡»æ˜¯16ä½
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">IV</span> <span class="token operator">=</span> <span class="token string">&quot;1233214566547891&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Invocation</span> invocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> invocation<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MappedStatement</span> mappedStatement <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MappedStatement</span><span class="token punctuation">)</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> parameter <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> sqlId <span class="token operator">=</span> mappedStatement<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>parameter <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>sqlId<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;insert&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> sqlId<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;update&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> columnName <span class="token operator">=</span> <span class="token string">&quot;employeeName&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>parameter <span class="token keyword">instanceof</span> <span class="token class-name">Map</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> parameterList <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> parameter<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> obj <span class="token operator">:</span> parameterList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasField</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> columnName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">String</span> fieldValue <span class="token operator">=</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> columnName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">String</span> encryptedValue <span class="token operator">=</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>fieldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> columnName<span class="token punctuation">,</span> encryptedValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasField</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> columnName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">String</span> fieldValue <span class="token operator">=</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> columnName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span> encryptedValue <span class="token operator">=</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>fieldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> columnName<span class="token punctuation">,</span> encryptedValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Object</span> result <span class="token operator">=</span> invocation<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> sqlId<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æŸ¥è¯¢æ“ä½œï¼Œè§£å¯†</span>
            <span class="token class-name">String</span> columnName <span class="token operator">=</span> <span class="token string">&quot;employeeName&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">List</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> resultList <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> result<span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> obj <span class="token operator">:</span> resultList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasField</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> columnName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span> fieldValue <span class="token operator">=</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> columnName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>fieldValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span> decryptedValue <span class="token operator">=</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>fieldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> columnName<span class="token punctuation">,</span> decryptedValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;AES/CBC/PKCS5Padding&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> raw <span class="token operator">=</span> <span class="token constant">KEY</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SecretKeySpec</span> secretKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>raw<span class="token punctuation">,</span> <span class="token string">&quot;AES&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IvParameterSpec</span> ivParameterSpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IvParameterSpec</span><span class="token punctuation">(</span><span class="token constant">IV</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token constant">ENCRYPT_MODE</span><span class="token punctuation">,</span> secretKeySpec<span class="token punctuation">,</span> ivParameterSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encrypted <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * AESè§£å¯†
     *
     * <span class="token keyword">@param</span> <span class="token parameter">content</span> å¯†æ–‡
     * <span class="token keyword">@return</span> æ˜æ–‡
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span> å¼‚å¸¸
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;AES/CBC/PKCS5Padding&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> raw <span class="token operator">=</span> <span class="token constant">KEY</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SecretKeySpec</span> secretKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>raw<span class="token punctuation">,</span> <span class="token string">&quot;AES&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IvParameterSpec</span> ivParameterSpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IvParameterSpec</span><span class="token punctuation">(</span><span class="token constant">IV</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token constant">DECRYPT_MODE</span><span class="token punctuation">,</span> secretKeySpec<span class="token punctuation">,</span> ivParameterSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encrypted <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> original <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>original<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasField</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">String</span> fieldName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>clazz <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Field</span> field <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>fieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchFieldException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                clazz <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div align="center"><img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-mybatis-06.png?raw=true" width="850px"></div>`,56),E=n("code",null,"Intercepts",-1),j={href:"https://item.jd.com/13811216.html",target:"_blank",rel:"noopener noreferrer"},_=n("strong",null,"ã€Šæ‰‹å†™MyBatisï¼šæ¸è¿›å¼æºç å®è·µã€‹",-1),O=n("li",null,"æœ‰äº† AES çš„åŠ è§£å¯†ï¼Œå°±å¯ä»¥å¯¹æŒ‡å®šçš„å­—æ®µ employeeName å¯¹æ’å…¥æ•°æ®åº“çš„å­—æ®µè¿›è¡ŒåŠ å¯†ï¼ŒåŒæ—¶è¿˜å¯ä»¥åœ¨è¯»å–çš„æ—¶å€™è§£å¯†ã€‚",-1),T=p(`<h2 id="äº”ã€æµ‹è¯•éªŒè¯" tabindex="-1"><a class="header-anchor" href="#äº”ã€æµ‹è¯•éªŒè¯" aria-hidden="true">#</a> äº”ã€æµ‹è¯•éªŒè¯</h2><h3 id="_1-è°ƒè–ª" tabindex="-1"><a class="header-anchor" href="#_1-è°ƒè–ª" aria-hidden="true">#</a> 1. è°ƒè–ª</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_execSalaryAdjust</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AdjustSalaryApplyOrderAggregate</span> adjustSalaryApplyOrderAggregate <span class="token operator">=</span> <span class="token class-name">AdjustSalaryApplyOrderAggregate</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">employeeNumber</span><span class="token punctuation">(</span><span class="token string">&quot;10000001&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">orderId</span><span class="token punctuation">(</span><span class="token string">&quot;100908977676001&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">employeeEntity</span><span class="token punctuation">(</span><span class="token class-name">EmployeeEntity</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">employeeLevel</span><span class="token punctuation">(</span><span class="token class-name">EmployeePostVO</span><span class="token punctuation">.</span><span class="token constant">T3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">employeeTitle</span><span class="token punctuation">(</span><span class="token class-name">EmployeePostVO</span><span class="token punctuation">.</span><span class="token constant">T3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">employeeSalaryAdjustEntity</span><span class="token punctuation">(</span><span class="token class-name">EmployeeSalaryAdjustEntity</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">adjustTotalAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">adjustBaseAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">adjustMeritAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> orderId <span class="token operator">=</span> salaryAdjustApplyService<span class="token punctuation">.</span><span class="token function">execSalaryAdjust</span><span class="token punctuation">(</span>adjustSalaryApplyOrderAggregate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è°ƒè–ªæµ‹è¯• req: {} res: {}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>adjustSalaryApplyOrderAggregate<span class="token punctuation">)</span><span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">23</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">15.13</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">11.514</span> <span class="token punctuation">[</span>main            <span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name">HikariDataSource</span>       <span class="token operator">-</span> <span class="token class-name">HikariPool</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token class-name">Start</span> completed<span class="token punctuation">.</span>
<span class="token number">23</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">15.13</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">11.910</span> <span class="token punctuation">[</span>main            <span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name">ISalaryAdjustApplyServiceTest</span> <span class="token operator">-</span> è°ƒè–ªæµ‹è¯• req<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">&quot;employeeEntity&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;employeeLevel&quot;</span><span class="token operator">:</span><span class="token string">&quot;T3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;employeeTitle&quot;</span><span class="token operator">:</span><span class="token string">&quot;T3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;employeeNumber&quot;</span><span class="token operator">:</span><span class="token string">&quot;10000001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;employeeSalaryAdjustEntity&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;adjustBaseAmount&quot;</span><span class="token operator">:</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token string">&quot;adjustMeritAmount&quot;</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">&quot;adjustTotalAmount&quot;</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;orderId&quot;</span><span class="token operator">:</span><span class="token string">&quot;100908977676002&quot;</span><span class="token punctuation">}</span> res<span class="token operator">:</span> <span class="token number">100908977676002</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#_2-æŸ¥è¯¢" aria-hidden="true">#</a> 2. æŸ¥è¯¢</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_queryEmployInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">EmployeeInfoEntity</span> employeeInfoEntity <span class="token operator">=</span> employeeService<span class="token punctuation">.</span><span class="token function">queryEmployInfo</span><span class="token punctuation">(</span><span class="token string">&quot;10000001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•ç»“æœï¼š{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>employeeInfoEntity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">23</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">15.13</span><span class="token operator">:</span><span class="token number">24</span><span class="token operator">:</span><span class="token number">54.000</span> <span class="token punctuation">[</span>main            <span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name">HikariDataSource</span>       <span class="token operator">-</span> <span class="token class-name">HikariPool</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token class-name">Start</span> completed<span class="token punctuation">.</span>
<span class="token number">23</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">15.13</span><span class="token operator">:</span><span class="token number">24</span><span class="token operator">:</span><span class="token number">54.490</span> <span class="token punctuation">[</span>main            <span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name">IEmployeeServiceTest</span>   <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;employeeLevel&quot;</span><span class="token operator">:</span><span class="token string">&quot;T-3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;employeeName&quot;</span><span class="token operator">:</span><span class="token string">&quot;å°å‚…å“¥&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;employeeNumber&quot;</span><span class="token operator">:</span><span class="token string">&quot;10000001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;employeeTitle&quot;</span><span class="token operator">:</span><span class="token string">&quot;ä¸­çº§å·¥ç¨‹å¸ˆ&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;salaryBaseAmount&quot;</span><span class="token operator">:</span><span class="token number">5200.00</span><span class="token punctuation">,</span><span class="token string">&quot;salaryMeritAmount&quot;</span><span class="token operator">:</span><span class="token number">5200.00</span><span class="token punctuation">,</span><span class="token string">&quot;salaryTotalAmount&quot;</span><span class="token operator">:</span><span class="token number">5200.00</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ‰§è¡Œå®Œè°ƒè–ªåï¼Œå°±å¯ä»¥æ¥çœ‹ä¸‹è¿™ä¸ªç”¨æˆ·çš„è–ªèµ„å¾…é‡æ˜¯å¤šå°‘äº†ã€‚</li></ul>`,8);function x(P,I){const a=o("ExternalLinkIcon");return c(),l("div",null,[u,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),k,s("åšå®¢ï¼š"),n("a",r,[s("https://bugstack.cn"),t(a)])]),d,m,v,b,y,n("ul",null,[n("li",null,[s("xfg-dev-tech-mybatisï¼š"),n("a",g,[s("https://gitcode.net/KnowledgePlanet/road-map/xfg-dev-tech-mybatis"),t(a)])]),n("li",null,[s("å¯¼å…¥æµ‹è¯•åº“è¡¨ï¼š"),n("a",f,[s("road-map.sql"),t(a)])])]),h,n("p",null,[s("ğŸŒ¶ "),S,s("ï¼š"),n("a",q,[s("https://bugstack.cn/md/road-map/ddd.html"),t(a)]),s(" - ä½ å¯ä»¥å…ˆå‚è€ƒå°å‚…å“¥çš„ "),n("a",w,[s("DDD"),t(a)]),s(" ç¯‡ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½çš„ç†è§£æ¨¡å‹æ¦‚å¿µå’Œè®¾è®¡åŸåˆ™ã€‚")]),A,n("ul",null,[n("li",null,[s("é¦–å…ˆé€šè¿‡æ³¨è§£é…ç½®ï¼Œæ‹¦æˆªæŒ‡å®šèŒƒå›´å†…çš„ä¿¡æ¯ "),E,s(" ä¹‹ååœ¨ intercept æ¥å£å®ç°æ–¹æ³•ä¸­ï¼Œè·å– MappedStatement è¿™ä¸ª MyBatisçš„æ˜ å°„æ ¸å¿ƒç±»ã€‚"),n("a",j,[_,t(a)]),s(" - è·Ÿå°å‚…å“¥å­¦MyBatisï¼Œä»é›¶æ‰‹å†™æºç çº§å¤æ‚é¡¹ç›®ï¼Œæå‡æ¶æ„æ€ç»´ä¸è®¾è®¡é€»è¾‘ï¼Œé”»ç‚¼ç¼–ç èƒ½åŠ›ï¼")]),O]),T])}const B=e(i,[["render",x],["__file","mybatis.html.vue"]]);export{B as default};
