import{_ as e,r as o,o as c,c as l,a as n,b as s,d as t,e as p}from"./app-3RcBQnkC.js";const u={},i=n("h1",{id:"é‡å­¦-java-è®¾è®¡æ¨¡å¼-å®æˆ˜ä¸­ä»‹è€…æ¨¡å¼ã€ŒæŒ‰ç…§mybatisåŸç†æ‰‹å†™ormæ¡†æ¶-ç»™jdbcæ–¹å¼æ“ä½œæ•°æ®åº“å¢åŠ ä¸­ä»‹è€…åœºæ™¯ã€",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#é‡å­¦-java-è®¾è®¡æ¨¡å¼-å®æˆ˜ä¸­ä»‹è€…æ¨¡å¼ã€ŒæŒ‰ç…§mybatisåŸç†æ‰‹å†™ormæ¡†æ¶-ç»™jdbcæ–¹å¼æ“ä½œæ•°æ®åº“å¢åŠ ä¸­ä»‹è€…åœºæ™¯ã€","aria-hidden":"true"},"#"),s(" é‡å­¦ Java è®¾è®¡æ¨¡å¼ï¼šå®æˆ˜ä¸­ä»‹è€…æ¨¡å¼ã€ŒæŒ‰ç…§MybatisåŸç†æ‰‹å†™ORMæ¡†æ¶ï¼Œç»™JDBCæ–¹å¼æ“ä½œæ•°æ®åº“å¢åŠ ä¸­ä»‹è€…åœºæ™¯ã€")],-1),k=n("br",null,null,-1),r={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=n("blockquote",null,[n("p",null,"æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„")],-1),m=n("iframe",{id:"B-Video",src:"//player.bilibili.com/player.html?aid=811259799&bvid=BV1F34y1Y75j&cid=711553610&page=1",scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",width:"100%",height:"480"}," ",-1),v=p('<h2 id="ä¸€ã€å‰è¨€" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‰è¨€" aria-hidden="true">#</a> ä¸€ã€å‰è¨€</h2><p><code>åŒé¾„äººçš„å·®è·æ˜¯ä»ä»€ä¹ˆæ—¶å€™æ‹‰å¼€çš„</code></p><p>åŒæ ·çš„å¹¼å„¿å›­ã€åŒæ ·çš„å°å­¦ã€ä¸€æ ·çš„ä¹¦æœ¬ã€ä¸€æ ·çš„è¯¾å ‚ï¼Œæœ‰äººå­¦ä¹ å¥½ã€æœ‰äººå­¦ä¹ å·®ã€‚ä¸åªæ˜¯ä¸Šå­¦ï¼Œå‡ ä¹äººç”Ÿå¤„å¤„éƒ½æ˜¯èµ›é“ï¼Œå‘ä»¤æªå“èµ·çš„æ—¶åˆ»ï¼Œä¹Ÿå°±æŠŠäººç”Ÿçš„å·®è·æ‹‰å¼€ã€‚ç¼–ç¨‹å¼€å‘è¿™æ¡è·¯ä¹Ÿæ˜¯å¾ˆé•¿å¾ˆå®½ï¼Œæœ‰äººè·‘å¾—å¿«æœ‰äººè·‘å¾—æ…¢ã€‚é‚£ä¹ˆä½ æ˜¯å¦æƒ³èµ·è¿‡ï¼Œè¿™ä¸€ç‚¹ç‚¹çš„å·®è·åˆ°é¥ä¸å¯åŠçš„è·ç¦»ï¼Œæ˜¯ä»å“ªä¸€å¤©å¼€å§‹çš„ã€‚æ‘¸æ‘¸è‚šå­çš„è‚‰ï¼Œçœ‹çœ‹è¿œå¤„çš„è·¯ï¼Œåˆ«äººè®²çš„æ˜¯<code>æ•…äº‹</code>ï¼Œä½ æƒ³èµ·çš„éƒ½æ˜¯<code>äº‹æ•…</code>ã€‚</p><p><code>æ€æƒ³æ²¡æœ‰äº§å“é«˜æ‰å†™å‡ºä¸€ç‰‡çš„ifelse</code></p><p>å½“ä½ æ‰¿æ¥ä¸€ä¸ªéœ€æ±‚çš„æ—¶å€™ï¼Œæ¯”å¦‚ï¼›äº¤æ˜“ã€è®¢å•ã€è¥é”€ã€ä¿é™©ç­‰å„ç±»åœºæ™¯ã€‚å¦‚æœä½ ä¸ç†Ÿæ‚‰è¿™ä¸ªåœºæ™¯ä¸‹çš„ä¸šåŠ¡æ¨¡å¼ï¼Œä»¥åŠå°†æ¥çš„æ‹“å±•æ–¹å‘ï¼Œé‚£ä¹ˆå¾ˆéš¾è®¾è®¡å‡ºè‰¯å¥½å¯æ‰©å±•çš„ç³»ç»Ÿã€‚å†åŠ ä¸Šäº§å“åŠŸèƒ½åˆå»ºï¼Œè¯´è€æ¿è¦çš„æ€¥ï¼Œå°½å¿«ä¸Šçº¿ã€‚ä½œä¸ºç¨‹åºå‘˜çš„ä½ æ›´æ²¡æœ‰æ—¶é—´æ€è€ƒï¼Œæ•´ä½“ä¸€çœ‹ç°åœ¨çš„éœ€æ±‚ä¹Ÿä¸éš¾ï¼Œç›´æ¥ä¸Šæ‰‹å¼€å¹²(<code>ä¸€ä¸ªæ–¹æ³•ä¸¤ä¸ªifè¯­å¥</code>)ï¼Œè¿™æ ·ç¡®å®æ»¡è¶³äº†å½“å‰éœ€æ±‚ã€‚ä½†è€æ¿çš„æƒ³æ³•å¤šå‘€ï¼Œäº§å“ä¹Ÿè·Ÿç€å˜åŒ–å¿«ï¼Œåˆ°ä½ è¿™å°±æ˜¯æ”¹æ”¹æ”¹ï¼ŒåŠ åŠ åŠ ã€‚å½“ç„¶ä½ ä¹Ÿä¸å®¢æ°”ï¼Œå›é¦–æå°±æ˜¯1024ä¸ªifè¯­å¥ï¼</p><p><code>æ—¥ç§¯æœˆç´¯çš„æŠ€æœ¯æ²‰æ·€æ˜¯ä¸ºäº†åšç§¯è–„å‘</code></p><p>ç²—ç•¥çš„ä¼°ç®—è¿‡ï¼Œå¦‚æœä»ä¸Šå¤§å­¦å¼€å§‹æ¯å¤©å†™<code>200</code>è¡Œï¼Œä¸€ä¸ªæœˆæ˜¯<code>6000</code>è¡Œï¼Œä¸€å¹´ç®—10ä¸ªæœˆè¯ï¼Œå°±æ˜¯6ä¸‡è¡Œï¼Œç¬¬ä¸‰å¹´å‡ºå»å®ä¹ çš„æ˜¯æ—¶å€™å°±æœ‰<code>20</code>ä¸‡è¡Œçš„ä»£ç é‡ã€‚å¦‚æœä½ èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‰¾å·¥ä½œéš¾ï¼Ÿæœ‰æ—¶å€™å¾ˆå¤šäº‹æƒ…å°±æ˜¯é æ—¶é—´ç§¯ç´¯å‡ºæ¥çš„ï¼Œæƒ³èµ°æ·å¾„æœ‰æ—¶å€™çœŸçš„æ²¡æœ‰ã€‚ä½ çš„æŠ€æœ¯æ°´å¹³ã€ä½ çš„ä¸šåŠ¡èƒ½åŠ›ã€ä½ èº«ä¸Šçš„è‚‰ï¼Œéƒ½æ˜¯ä¸€ç‚¹ç‚¹ç§¯ç´¯ä¸‹æ¥çš„ï¼Œä¸è¦æµªè´¹çœ‹ä¼¼å¾ˆçŸ­çš„æ—¶é—´ï¼Œä¸€å¹´å¹´åšæŒä¸‹æ¥ï¼Œç•™ä¸‹å°åˆ»é’æ˜¥çš„ç—•è¿¹ï¼Œå¤šç»™è‡ªå·±æ­¦è£…ä¸Šä¸€äº›èƒ½åŠ›ã€‚</p><h2 id="äºŒã€å¼€å‘ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#äºŒã€å¼€å‘ç¯å¢ƒ" aria-hidden="true">#</a> äºŒã€å¼€å‘ç¯å¢ƒ</h2>',8),b=n("li",null,"JDK 1.8",-1),g=n("li",null,"Idea + Maven",-1),h=n("li",null,"mysql 5.1.20",-1),f=n("strong",null,"å…¬ä¼—å·",-1),q={href:"https://bugstack.cn/assets/images/qrcode.png",target:"_blank",rel:"noopener noreferrer"},y=n("code",null,"bugstackè™«æ´æ ˆ",-1),S=n("code",null,"æºç ä¸‹è½½",-1),w=p('<table><thead><tr><th>å·¥ç¨‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>itstack-demo-design-16-01</td><td>ä½¿ç”¨JDBCæ–¹å¼è¿æ¥æ•°æ®åº“</td></tr><tr><td>itstack-demo-design-16-02</td><td>æ‰‹å†™ORMæ¡†æ¶æ“ä½œæ•°æ®åº“</td></tr></tbody></table><h2 id="ä¸‰ã€ä¸­ä»‹è€…æ¨¡å¼ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€ä¸­ä»‹è€…æ¨¡å¼ä»‹ç»" aria-hidden="true">#</a> ä¸‰ã€ä¸­ä»‹è€…æ¨¡å¼ä»‹ç»</h2><p><img src="https://bugstack.cn/assets/images/2020/itstack-demo-design-16-01.png" alt="ä¸­ä»‹è€…æ¨¡å¼ï¼Œå›¾ç‰‡æ¥è‡ª refactoringguru.cn"></p>',3),x={href:"https://refactoringguru.cn/design-patterns/mediator",target:"_blank",rel:"noopener noreferrer"},T=p(`<p>ä¸­ä»‹è€…æ¨¡å¼è¦è§£å†³çš„å°±æ˜¯å¤æ‚åŠŸèƒ½åº”ç”¨ä¹‹é—´çš„é‡å¤è°ƒç”¨ï¼Œåœ¨è¿™ä¸­é—´æ·»åŠ ä¸€å±‚ä¸­ä»‹è€…åŒ…è£…æœåŠ¡ï¼Œå¯¹å¤–æä¾›ç®€å•ã€é€šç”¨ã€æ˜“æ‰©å±•çš„æœåŠ¡èƒ½åŠ›ã€‚</p><p>è¿™æ ·çš„è®¾è®¡æ¨¡å¼å‡ ä¹åœ¨æˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»å’Œå®é™…ä¸šåŠ¡å¼€å‘ä¸­éƒ½ä¼šè§åˆ°ï¼Œä¾‹å¦‚ï¼›é£æœºğŸ›¬é™è½æœ‰å°å§å§åœ¨å¡”å°å–Šè¯ã€æ— è®ºå“ªä¸ªæ–¹å‘æ¥çš„å€™è½¦éƒ½ä»ç«™å°ä¸Šä¸‹ã€å…¬å¸çš„ç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªä¸­å°ä¸“é—¨ä¸ºä½ åŒ…è£…æ‰€æœ‰æ¥å£å’Œæä¾›ç»Ÿä¸€çš„æœåŠ¡ç­‰ç­‰ï¼Œè¿™äº›éƒ½è¿ç”¨äº†ä¸­ä»‹è€…æ¨¡å¼ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ ç”¨åˆ°çš„ä¸€äº›ä¸­é—´ä»¶ï¼Œä»–ä»¬åŒ…è£…äº†åº•å±‚å¤šç§æ•°æ®åº“çš„å·®å¼‚åŒ–ï¼Œæä¾›éå¸¸ç®€å•çš„æ–¹å¼è¿›è¡Œä½¿ç”¨ã€‚</p><h2 id="å››ã€æ¡ˆä¾‹åœºæ™¯æ¨¡æ‹Ÿ" tabindex="-1"><a class="header-anchor" href="#å››ã€æ¡ˆä¾‹åœºæ™¯æ¨¡æ‹Ÿ" aria-hidden="true">#</a> å››ã€æ¡ˆä¾‹åœºæ™¯æ¨¡æ‹Ÿ</h2><p><img src="https://bugstack.cn/assets/images/2020/itstack-demo-design-16-02.png" alt="åœºæ™¯æ¨¡æ‹Ÿï¼›æ¨¡ä»¿Mybatisæ‰‹å†™ORMæ¡†æ¶"></p><p><strong>åœ¨æœ¬æ¡ˆä¾‹ä¸­æˆ‘ä»¬é€šè¿‡æ¨¡ä»¿Mybatisæ‰‹å†™ORMæ¡†æ¶ï¼Œé€šè¿‡è¿™æ ·æ“ä½œæ•°æ®åº“å­¦ä¹ ä¸­ä»‹è€…è¿ç”¨åœºæ™¯</strong></p><p>é™¤äº†è¿™æ ·çš„ä¸­é—´ä»¶å±‚ä½¿ç”¨åœºæ™¯å¤–ï¼Œå¯¹äºä¸€äº›å¤–éƒ¨æ¥å£ï¼Œä¾‹å¦‚Nç§å¥–å“æœåŠ¡ï¼Œå¯ä»¥ç”±ä¸­å°ç³»ç»Ÿè¿›è¡Œç»Ÿä¸€åŒ…è£…å¯¹å¤–æä¾›æœåŠ¡èƒ½åŠ›ã€‚ä¹Ÿæ˜¯ä¸­ä»‹è€…æ¨¡å¼çš„ä¸€ç§æ€æƒ³ä½“ç°ã€‚</p><p>åœ¨æœ¬æ¡ˆä¾‹ä¸­æˆ‘ä»¬ä¼šæŠŠjdbcå±‚è¿›è¡ŒåŒ…è£…ï¼Œè®©ç”¨æˆ·åœ¨ä½¿ç”¨æ•°æ®åº“æœåŠ¡çš„æ—¶å€™ï¼Œå¯ä»¥å’Œä½¿ç”¨mybatisä¸€æ ·ç®€å•æ–¹ä¾¿ï¼Œé€šè¿‡è¿™æ ·çš„æºç æ–¹å¼å­¦ä¹ ä¸­ä»‹è€…æ¨¡å¼ï¼Œä¹Ÿæ–¹ä¾¿å¯¹æºç çŸ¥è¯†çš„æ‹“å±•å­¦ä¹ ï¼Œå¢å¼ºçŸ¥è¯†æ ˆã€‚</p><h2 id="äº”ã€ç”¨ä¸€å¨å¨ä»£ç å®ç°" tabindex="-1"><a class="header-anchor" href="#äº”ã€ç”¨ä¸€å¨å¨ä»£ç å®ç°" aria-hidden="true">#</a> äº”ã€ç”¨ä¸€å¨å¨ä»£ç å®ç°</h2><p><code>è¿™æ˜¯ä¸€ç§å…³äºæ•°æ®åº“æ“ä½œæœ€åˆçš„æ–¹å¼</code></p><p>åŸºæœ¬ä¸Šæ¯ä¸€ä¸ªå­¦ä¹ å¼€å‘çš„äººéƒ½å­¦ä¹ è¿‡ç›´æ¥ä½¿ç”¨jdbcæ–¹å¼è¿æ¥æ•°æ®åº“ï¼Œè¿›è¡ŒCRUDæ“ä½œã€‚ä»¥ä¸‹çš„ä¾‹å­å¯ä»¥å½“åšå›å¿†ã€‚</p><h3 id="_1-å·¥ç¨‹ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1-å·¥ç¨‹ç»“æ„" aria-hidden="true">#</a> 1. å·¥ç¨‹ç»“æ„</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>design<span class="token operator">-</span><span class="token number">16</span><span class="token operator">-</span><span class="token number">01</span>
â””â”€â”€ src
    â””â”€â”€ main
        â””â”€â”€ java
            â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design
                â””â”€â”€ <span class="token class-name">JDBCUtil</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™é‡Œçš„ç±»æ¯”è¾ƒç®€å•åªåŒ…æ‹¬äº†ä¸€ä¸ªæ•°æ®åº“æ“ä½œç±»ã€‚</li></ul><h3 id="_2-ä»£ç å®ç°" tabindex="-1"><a class="header-anchor" href="#_2-ä»£ç å®ç°" aria-hidden="true">#</a> 2. ä»£ç å®ç°</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCUtil</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">JDBCUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">URL</span> <span class="token operator">=</span> <span class="token string">&quot;jdbc:mysql://127.0.0.1:3306/itstack-demo-design&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">USER</span> <span class="token operator">=</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PASSWORD</span> <span class="token operator">=</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//1. åŠ è½½é©±åŠ¨ç¨‹åº</span>
        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;com.mysql.jdbc.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2. è·å¾—æ•°æ®åº“è¿æ¥</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token constant">URL</span><span class="token punctuation">,</span> <span class="token constant">USER</span><span class="token punctuation">,</span> <span class="token constant">PASSWORD</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3. æ“ä½œæ•°æ®åº“</span>
        <span class="token class-name">Statement</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ResultSet</span> resultSet <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT id, name, age, createTime, updateTime FROM user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4. å¦‚æœæœ‰æ•°æ® resultSet.next() è¿”å›true</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>resultSet<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•ç»“æœ å§“åï¼š{} å¹´é¾„ï¼š{}&quot;</span><span class="token punctuation">,</span> resultSet<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>resultSet<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä»¥ä¸Šæ˜¯ä½¿ç”¨JDBCçš„æ–¹å¼è¿›è¡Œç›´æ¥æ“ä½œæ•°æ®åº“ï¼Œå‡ ä¹å¤§å®¶éƒ½ä½¿ç”¨è¿‡è¿™æ ·çš„æ–¹å¼ã€‚</li></ul><h3 id="_3-æµ‹è¯•ç»“æœ" tabindex="-1"><a class="header-anchor" href="#_3-æµ‹è¯•ç»“æœ" aria-hidden="true">#</a> 3. æµ‹è¯•ç»“æœ</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">15</span><span class="token operator">:</span><span class="token number">38</span><span class="token operator">:</span><span class="token number">10.919</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design<span class="token punctuation">.</span></span>JDBCUtil</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœ å§“åï¼šæ°´æ°´ å¹´é¾„ï¼š<span class="token number">18</span>
<span class="token number">15</span><span class="token operator">:</span><span class="token number">38</span><span class="token operator">:</span><span class="token number">10.922</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design<span class="token punctuation">.</span></span>JDBCUtil</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœ å§“åï¼šè±†è±† å¹´é¾„ï¼š<span class="token number">18</span>
<span class="token number">15</span><span class="token operator">:</span><span class="token number">38</span><span class="token operator">:</span><span class="token number">10.922</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design<span class="token punctuation">.</span></span>JDBCUtil</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœ å§“åï¼šèŠ±èŠ± å¹´é¾„ï¼š<span class="token number">19</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä»æµ‹è¯•ç»“æœå¯ä»¥çœ‹åˆ°è¿™é‡Œå·²ç»æŸ¥è¯¢åˆ°äº†æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚åªä¸è¿‡å¦‚æœåœ¨å…¨éƒ¨çš„ä¸šåŠ¡å¼€å‘ä¸­éƒ½è¿™æ ·å®ç°ï¼Œä¼šéå¸¸çš„éº»çƒ¦ã€‚</li></ul><h2 id="å…­ã€ä¸­ä»‹æ¨¡å¼å¼€å‘ormæ¡†æ¶" tabindex="-1"><a class="header-anchor" href="#å…­ã€ä¸­ä»‹æ¨¡å¼å¼€å‘ormæ¡†æ¶" aria-hidden="true">#</a> å…­ã€ä¸­ä»‹æ¨¡å¼å¼€å‘ORMæ¡†æ¶</h2><p>\`æ¥ä¸‹æ¥å°±ä½¿ç”¨ä¸­ä»‹æ¨¡å¼çš„æ€æƒ³å®Œæˆæ¨¡ä»¿Mybatisçš„ORMæ¡†æ¶å¼€å‘~</p><h3 id="_1-å·¥ç¨‹ç»“æ„-1" tabindex="-1"><a class="header-anchor" href="#_1-å·¥ç¨‹ç»“æ„-1" aria-hidden="true">#</a> 1. å·¥ç¨‹ç»“æ„</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>design<span class="token operator">-</span><span class="token number">16</span><span class="token operator">-</span><span class="token number">02</span>
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â”œâ”€â”€ java
    â”‚   â”‚   â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design
    â”‚   â”‚       â”œâ”€â”€ dao
    â”‚   â”‚       â”‚	â”œâ”€â”€ <span class="token class-name">ISchool</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	â””â”€â”€ <span class="token class-name">IUserDao</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”œâ”€â”€ mediator
    â”‚   â”‚       â”‚	â”œâ”€â”€ <span class="token class-name">Configuration</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	â”œâ”€â”€ <span class="token class-name">DefaultSqlSession</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	â”œâ”€â”€ <span class="token class-name">DefaultSqlSessionFactory</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	â”œâ”€â”€ <span class="token class-name">Resources</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	â”œâ”€â”€ <span class="token class-name">SqlSession</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	â”œâ”€â”€ <span class="token class-name">SqlSessionFactory</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	â”œâ”€â”€ <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â”‚	â””â”€â”€ <span class="token class-name">XNode</span><span class="token punctuation">.</span>java
    â”‚   â”‚       â””â”€â”€ po
    â”‚   â”‚         	â”œâ”€â”€ <span class="token class-name">School</span><span class="token punctuation">.</span>java
    â”‚   â”‚         	â””â”€â”€ <span class="token class-name">User</span><span class="token punctuation">.</span>java
    â”‚   â””â”€â”€ resources
    â”‚       â”œâ”€â”€ mapper
    â”‚       â”‚   â”œâ”€â”€ <span class="token class-name">School_Mapper</span><span class="token punctuation">.</span>xml
    â”‚       â”‚   â””â”€â”€ <span class="token class-name">User_Mapper</span><span class="token punctuation">.</span>xml
    â”‚       â””â”€â”€ mybatis<span class="token operator">-</span>config<span class="token operator">-</span>datasource<span class="token punctuation">.</span>xml
    â””â”€â”€ test
         â””â”€â”€ java
             â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design<span class="token punctuation">.</span>test
                 â””â”€â”€ <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¸­ä»‹è€…æ¨¡å¼æ¨¡å‹ç»“æ„</strong></p><p><img src="https://bugstack.cn/assets/images/2020/itstack-demo-design-16-03.png" alt="ä¸­ä»‹è€…æ¨¡å¼æ¨¡å‹ç»“æ„"></p><ul><li>ä»¥ä¸Šæ˜¯å¯¹ORMæ¡†æ¶å®ç°çš„æ ¸å¿ƒç±»ï¼ŒåŒ…æ‹¬äº†ï¼›åŠ è½½é…ç½®æ–‡ä»¶ã€å¯¹xmlè§£æã€è·å–æ•°æ®åº“sessionã€æ“ä½œæ•°æ®åº“ä»¥åŠç»“æœè¿”å›ã€‚</li><li>å·¦ä¸Šæ˜¯å¯¹æ•°æ®åº“çš„å®šä¹‰å’Œå¤„ç†ï¼ŒåŸºæœ¬åŒ…æ‹¬æˆ‘ä»¬å¸¸ç”¨çš„æ–¹æ³•ï¼›<code>&lt;T&gt; T selectOne</code>ã€<code>&lt;T&gt; List&lt;T&gt; selectList</code>ç­‰ã€‚</li><li>å³ä¾§è“è‰²éƒ¨åˆ†æ˜¯å¯¹æ•°æ®åº“é…ç½®çš„å¼€å¯sessionçš„å·¥å‚å¤„ç†ç±»ï¼Œè¿™é‡Œçš„å·¥å‚ä¼šæ“ä½œ<code>DefaultSqlSession</code></li><li>ä¹‹åæ˜¯çº¢è‰²åœ°æ–¹çš„<code>SqlSessionFactoryBuilder</code>ï¼Œè¿™ä¸ªç±»æ˜¯å¯¹æ•°æ®åº“æ“ä½œçš„æ ¸å¿ƒç±»ï¼›å¤„ç†å·¥å‚ã€è§£ææ–‡ä»¶ã€æ‹¿åˆ°sessionç­‰ã€‚</li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±åˆ†åˆ«ä»‹ç»å„ä¸ªç±»çš„åŠŸèƒ½å®ç°è¿‡ç¨‹ã€‚</p><h3 id="_2-ä»£ç å®ç°-1" tabindex="-1"><a class="header-anchor" href="#_2-ä»£ç å®ç°-1" aria-hidden="true">#</a> 2. ä»£ç å®ç°</h3><h4 id="_2-1-å®šä¹‰sqlsessionæ¥å£" tabindex="-1"><a class="header-anchor" href="#_2-1-å®šä¹‰sqlsessionæ¥å£" aria-hidden="true">#</a> 2.1 å®šä¹‰SqlSessionæ¥å£</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SqlSession</span> <span class="token punctuation">{</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token class-name">String</span> statement<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token class-name">String</span> statement<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectList</span><span class="token punctuation">(</span><span class="token class-name">String</span> statement<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectList</span><span class="token punctuation">(</span><span class="token class-name">String</span> statement<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™é‡Œå®šä¹‰äº†å¯¹æ•°æ®åº“æ“ä½œçš„æŸ¥è¯¢æ¥å£ï¼Œåˆ†ä¸ºæŸ¥è¯¢ä¸€ä¸ªç»“æœå’ŒæŸ¥è¯¢å¤šä¸ªç»“æœï¼ŒåŒæ—¶åŒ…æ‹¬æœ‰å‚æ•°å’Œæ²¡æœ‰å‚æ•°çš„æ–¹æ³•ã€‚</li></ul><h4 id="_2-2-sqlsessionå…·ä½“å®ç°ç±»" tabindex="-1"><a class="header-anchor" href="#_2-2-sqlsessionå…·ä½“å®ç°ç±»" aria-hidden="true">#</a> 2.2 SqlSessionå…·ä½“å®ç°ç±»</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultSqlSession</span> <span class="token keyword">implements</span> <span class="token class-name">SqlSession</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Connection</span> connection<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">XNode</span><span class="token punctuation">&gt;</span></span> mapperElement<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DefaultSqlSession</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> connection<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">XNode</span><span class="token punctuation">&gt;</span></span> mapperElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>connection <span class="token operator">=</span> connection<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mapperElement <span class="token operator">=</span> mapperElement<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token class-name">String</span> statement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">XNode</span> xNode <span class="token operator">=</span> mapperElement<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>statement<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>xNode<span class="token punctuation">.</span><span class="token function">getSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ResultSet</span> resultSet <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> objects <span class="token operator">=</span> <span class="token function">resultSet2Obj</span><span class="token punctuation">(</span>resultSet<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>xNode<span class="token punctuation">.</span><span class="token function">getResultType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> objects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectList</span><span class="token punctuation">(</span><span class="token class-name">String</span> statement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">XNode</span> xNode <span class="token operator">=</span> mapperElement<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>statement<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>xNode<span class="token punctuation">.</span><span class="token function">getSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ResultSet</span> resultSet <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">resultSet2Obj</span><span class="token punctuation">(</span>resultSet<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>xNode<span class="token punctuation">.</span><span class="token function">getResultType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

    <span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">resultSet2Obj</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> resultSet<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">ResultSetMetaData</span> metaData <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getMetaData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> columnCount <span class="token operator">=</span> metaData<span class="token punctuation">.</span><span class="token function">getColumnCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ¯æ¬¡éå†è¡Œå€¼</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>resultSet<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">T</span> obj <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> clazz<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> columnCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Object</span> value <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span> columnName <span class="token operator">=</span> metaData<span class="token punctuation">.</span><span class="token function">getColumnName</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span> setMethod <span class="token operator">=</span> <span class="token string">&quot;set&quot;</span> <span class="token operator">+</span> columnName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> columnName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Method</span> method<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Timestamp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        method <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>setMethod<span class="token punctuation">,</span> <span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        method <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>setMethod<span class="token punctuation">,</span> value<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> list<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> connection<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™é‡ŒåŒ…æ‹¬äº†æ¥å£å®šä¹‰çš„æ–¹æ³•å®ç°ï¼Œä¹Ÿå°±æ˜¯åŒ…è£…äº†jdbcå±‚ã€‚</li><li>é€šè¿‡è¿™æ ·çš„åŒ…è£…å¯ä»¥è®©å¯¹æ•°æ®åº“çš„jdbcæ“ä½œéšè—èµ·æ¥ï¼Œå¤–éƒ¨è°ƒç”¨çš„æ—¶å€™å¯¹å…¥å‚ã€å‡ºå‚éƒ½æœ‰å†…éƒ¨è¿›è¡Œå¤„ç†ã€‚</li></ul><h4 id="_2-3-å®šä¹‰sqlsessionfactoryæ¥å£" tabindex="-1"><a class="header-anchor" href="#_2-3-å®šä¹‰sqlsessionfactoryæ¥å£" aria-hidden="true">#</a> 2.3 å®šä¹‰SqlSessionFactoryæ¥å£</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SqlSessionFactory</span> <span class="token punctuation">{</span>

    <span class="token class-name">SqlSession</span> <span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¼€å¯ä¸€ä¸ª<code>SqlSession</code>ï¼Œ è¿™å‡ ä¹æ˜¯å¤§å®¶åœ¨å¹³æ—¶çš„ä½¿ç”¨ä¸­éƒ½éœ€è¦è¿›è¡Œæ“ä½œçš„å†…å®¹ã€‚è™½ç„¶ä½ çœ‹ä¸è§ï¼Œä½†æ˜¯å½“ä½ æœ‰æ•°æ®åº“æ“ä½œçš„æ—¶å€™éƒ½ä¼šè·å–æ¯ä¸€æ¬¡æ‰§è¡Œçš„<code>SqlSession</code>ã€‚</li></ul><h4 id="_2-4-sqlsessionfactoryå…·ä½“å®ç°ç±»" tabindex="-1"><a class="header-anchor" href="#_2-4-sqlsessionfactoryå…·ä½“å®ç°ç±»" aria-hidden="true">#</a> 2.4 SqlSessionFactoryå…·ä½“å®ç°ç±»</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultSqlSessionFactory</span> <span class="token keyword">implements</span> <span class="token class-name">SqlSessionFactory</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Configuration</span> configuration<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DefaultSqlSessionFactory</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> configuration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>configuration <span class="token operator">=</span> configuration<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SqlSession</span> <span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultSqlSession</span><span class="token punctuation">(</span>configuration<span class="token punctuation">.</span>connection<span class="token punctuation">,</span> configuration<span class="token punctuation">.</span>mapperElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>DefaultSqlSessionFactory</code>ï¼Œæ˜¯ä½¿ç”¨mybatisæœ€å¸¸ç”¨çš„ç±»ï¼Œè¿™é‡Œæˆ‘ä»¬ç®€å•çš„å®ç°äº†ä¸€ä¸ªç‰ˆæœ¬ã€‚</li><li>è™½ç„¶æ˜¯ç®€å•çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯åŒ…æ‹¬äº†æœ€åŸºæœ¬çš„æ ¸å¿ƒæ€è·¯ã€‚å½“å¼€å¯<code>SqlSession</code>æ—¶ä¼šè¿›è¡Œè¿”å›ä¸€ä¸ª<code>DefaultSqlSession</code></li><li>è¿™ä¸ªæ„é€ å‡½æ•°ä¸­å‘ä¸‹ä¼ é€’äº†<code>Configuration</code>é…ç½®æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­åŒ…æ‹¬ï¼›<code>Connection connection</code>ã€<code>Map&lt;String, String&gt; dataSource</code>ã€<code>Map&lt;String, XNode&gt; mapperElement</code>ã€‚å¦‚æœæœ‰ä½ é˜…è¯»è¿‡Mybatisæºç ï¼Œå¯¹è¿™ä¸ªå°±ä¸ä¼šé™Œç”Ÿã€‚</li></ul><h4 id="_2-5-sqlsessionfactorybuilderå®ç°" tabindex="-1"><a class="header-anchor" href="#_2-5-sqlsessionfactorybuilderå®ç°" aria-hidden="true">#</a> 2.5 SqlSessionFactoryBuilderå®ç°</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SqlSessionFactoryBuilder</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">DefaultSqlSessionFactory</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">Reader</span> reader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SAXReader</span> saxReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SAXReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            saxReader<span class="token punctuation">.</span><span class="token function">setEntityResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">XMLMapperEntityResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Document</span> document <span class="token operator">=</span> saxReader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputSource</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token function">parseConfiguration</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getRootElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultSqlSessionFactory</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DocumentException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Configuration</span> <span class="token function">parseConfiguration</span><span class="token punctuation">(</span><span class="token class-name">Element</span> root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configuration<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span><span class="token function">dataSource</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">&quot;//dataSource&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configuration<span class="token punctuation">.</span><span class="token function">setConnection</span><span class="token punctuation">(</span><span class="token function">connection</span><span class="token punctuation">(</span>configuration<span class="token punctuation">.</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configuration<span class="token punctuation">.</span><span class="token function">setMapperElement</span><span class="token punctuation">(</span><span class="token function">mapperElement</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">&quot;mappers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> configuration<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è·å–æ•°æ®æºé…ç½®ä¿¡æ¯</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Element</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Element</span> element <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span> content <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> o <span class="token operator">:</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Element</span> e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>
            <span class="token class-name">String</span> name <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> value <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dataSource<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Connection</span> <span class="token function">connection</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dataSource<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dataSource<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> <span class="token operator">|</span> <span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è·å–SQLè¯­å¥ä¿¡æ¯</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">XNode</span><span class="token punctuation">&gt;</span></span> <span class="token function">mapperElement</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Element</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">XNode</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Element</span> element <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span> content <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> o <span class="token operator">:</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Element</span> e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>
            <span class="token class-name">String</span> resource <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">&quot;resource&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Reader</span> reader <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsReader</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">SAXReader</span> saxReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SAXReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Document</span> document <span class="token operator">=</span> saxReader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputSource</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Element</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getRootElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//å‘½åç©ºé—´</span>
                <span class="token class-name">String</span> namespace <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">&quot;namespace&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// SELECT</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Element</span><span class="token punctuation">&gt;</span></span> selectNodes <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">&quot;select&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Element</span> node <span class="token operator">:</span> selectNodes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">String</span> id <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span> parameterType <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">&quot;parameterType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span> resultType <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">&quot;resultType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span> sql <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// ? åŒ¹é…</span>
                    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> parameter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Pattern</span> pattern <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">&quot;(#\\\\{(.*?)})&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Matcher</span> matcher <span class="token operator">=</span> pattern<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> matcher<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">String</span> g1 <span class="token operator">=</span> matcher<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">String</span> g2 <span class="token operator">=</span> matcher<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        parameter<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> g2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        sql <span class="token operator">=</span> sql<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>g1<span class="token punctuation">,</span> <span class="token string">&quot;?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token class-name">XNode</span> xNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    xNode<span class="token punctuation">.</span><span class="token function">setNamespace</span><span class="token punctuation">(</span>namespace<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    xNode<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    xNode<span class="token punctuation">.</span><span class="token function">setParameterType</span><span class="token punctuation">(</span>parameterType<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    xNode<span class="token punctuation">.</span><span class="token function">setResultType</span><span class="token punctuation">(</span>resultType<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    xNode<span class="token punctuation">.</span><span class="token function">setSql</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    xNode<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>namespace <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">,</span> xNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨è¿™ä¸ªç±»ä¸­åŒ…æ‹¬çš„æ ¸å¿ƒæ–¹æ³•æœ‰ï¼›<code>build(æ„å»ºå®ä¾‹åŒ–å…ƒç´ )</code>ã€<code>parseConfiguration(è§£æé…ç½®)</code>ã€<code>dataSource(è·å–æ•°æ®åº“é…ç½®)</code>ã€<code>connection(Map&lt;String, String&gt; dataSource) (é“¾æ¥æ•°æ®åº“)</code>ã€<code>mapperElement (è§£æsqlè¯­å¥)</code></li><li>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†åˆ«ä»‹ç»è¿™æ ·çš„å‡ ä¸ªæ ¸å¿ƒæ–¹æ³•ã€‚</li></ul><p><strong>build(æ„å»ºå®ä¾‹åŒ–å…ƒç´ )</strong></p><p>è¿™ä¸ªç±»ä¸»è¦ç”¨äºåˆ›å»ºè§£æxmlæ–‡ä»¶çš„ç±»ï¼Œä»¥åŠåˆå§‹åŒ–SqlSessionå·¥å‚ç±»<code>DefaultSqlSessionFactory</code>ã€‚å¦å¤–éœ€è¦æ³¨æ„è¿™æ®µä»£ç <code>saxReader.setEntityResolver(new XMLMapperEntityResolver());</code>ï¼Œæ˜¯ä¸ºäº†ä¿è¯åœ¨ä¸è”ç½‘çš„æ—¶å€™ä¸€æ ·å¯ä»¥è§£æxmlï¼Œå¦åˆ™ä¼šéœ€è¦ä»äº’è”ç½‘è·å–dtdæ–‡ä»¶ã€‚</p><p><strong>parseConfiguration(è§£æé…ç½®)</strong></p><p>æ˜¯å¯¹xmlä¸­çš„å…ƒç´ è¿›è¡Œè·å–ï¼Œè¿™é‡Œä¸»è¦è·å–äº†ï¼›<code>dataSource</code>ã€<code>mappers</code>ï¼Œè€Œè¿™ä¸¤ä¸ªé…ç½®ä¸€ä¸ªæ˜¯æˆ‘ä»¬æ•°æ®åº“çš„é“¾æ¥ä¿¡æ¯ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯å¯¹æ•°æ®åº“æ“ä½œè¯­å¥çš„è§£æã€‚</p><p><strong>connection(Map&lt;String, String&gt; dataSource) (é“¾æ¥æ•°æ®åº“)</strong></p><p>é“¾æ¥æ•°æ®åº“çš„åœ°æ–¹å’Œæˆ‘ä»¬å¸¸è§çš„æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼›<code>Class.forName(dataSource.get(&quot;driver&quot;));</code>ï¼Œä½†æ˜¯è¿™æ ·åŒ…è£…ä»¥åå¤–éƒ¨æ˜¯ä¸éœ€è¦çŸ¥é“å…·ä½“çš„æ“ä½œã€‚åŒæ—¶å½“æˆ‘ä»¬éœ€è¦é“¾æ¥å¤šå¥—æ•°æ®åº“çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯å¯ä»¥åœ¨è¿™é‡Œæ‰©å±•ã€‚</p><p><strong>mapperElement (è§£æsqlè¯­å¥)</strong></p><p>è¿™éƒ¨åˆ†ä»£ç å—å†…å®¹ç›¸å¯¹æ¥è¯´æ¯”è¾ƒé•¿ï¼Œä½†æ˜¯æ ¸å¿ƒçš„ç‚¹å°±æ˜¯ä¸ºäº†è§£æxmlä¸­çš„sqlè¯­å¥é…ç½®ã€‚åœ¨æˆ‘ä»¬å¹³å¸¸çš„ä½¿ç”¨ä¸­åŸºæœ¬éƒ½ä¼šé…ç½®ä¸€äº›sqlè¯­å¥ï¼Œä¹Ÿæœ‰ä¸€äº›å…¥å‚çš„å ä½ç¬¦ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹å¼è¿›è¡Œè§£ææ“ä½œã€‚</p><p>è§£æå®Œæˆçš„sqlè¯­å¥å°±æœ‰äº†ä¸€ä¸ªåç§°å’Œsqlçš„æ˜ å°„å…³ç³»ï¼Œå½“æˆ‘ä»¬è¿›è¡Œæ•°æ®åº“æ“ä½œçš„æ—¶å€™ï¼Œè¿™ä¸ªç»„ä»¶å°±å¯ä»¥é€šè¿‡æ˜ å°„å…³ç³»è·å–åˆ°å¯¹åº”sqlè¯­å¥è¿›è¡Œæ“ä½œã€‚</p><h3 id="_3-æµ‹è¯•éªŒè¯" tabindex="-1"><a class="header-anchor" href="#_3-æµ‹è¯•éªŒè¯" aria-hidden="true">#</a> 3. æµ‹è¯•éªŒè¯</h3><p>åœ¨æµ‹è¯•ä¹‹å‰éœ€è¦å¯¼å…¥sqlè¯­å¥åˆ°æ•°æ®åº“ä¸­;</p><ul><li>åº“åï¼š<code>itstack-demo-design</code></li><li>è¡¨åï¼š<code>user</code>ã€<code>school</code></li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token constant">CREATE</span> <span class="token class-name">TABLE</span> school <span class="token punctuation">(</span> id bigint <span class="token constant">NOT</span> <span class="token class-name">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span> name <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> address <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span> createTime datetime<span class="token punctuation">,</span> updateTime datetime<span class="token punctuation">,</span> <span class="token class-name">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token constant">ENGINE</span><span class="token operator">=</span><span class="token class-name">InnoDB</span> <span class="token class-name">DEFAULT</span> <span class="token constant">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
insert into school <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> address<span class="token punctuation">,</span> createTime<span class="token punctuation">,</span> updateTime<span class="token punctuation">)</span> values <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token char">&#39;åŒ—äº¬å¤§å­¦&#39;</span><span class="token punctuation">,</span> &#39;åŒ—äº¬å¸‚æµ·æ·€åŒºé¢å’Œå›­è·¯<span class="token number">5</span>å·<span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">18</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">35</span><span class="token operator">:</span><span class="token number">57</span><span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">18</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">35</span><span class="token operator">:</span><span class="token number">57</span>&#39;<span class="token punctuation">)</span><span class="token punctuation">;</span>
insert into school <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> address<span class="token punctuation">,</span> createTime<span class="token punctuation">,</span> updateTime<span class="token punctuation">)</span> values <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token char">&#39;å—å¼€å¤§å­¦&#39;</span><span class="token punctuation">,</span> &#39;ä¸­å›½å¤©æ´¥å¸‚å—å¼€åŒºå«æ´¥è·¯<span class="token number">94</span>å·<span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">18</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">35</span><span class="token operator">:</span><span class="token number">57</span><span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">18</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">35</span><span class="token operator">:</span><span class="token number">57</span>&#39;<span class="token punctuation">)</span><span class="token punctuation">;</span>
insert into school <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> address<span class="token punctuation">,</span> createTime<span class="token punctuation">,</span> updateTime<span class="token punctuation">)</span> values <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token char">&#39;åŒæµå¤§å­¦&#39;</span><span class="token punctuation">,</span> &#39;ä¸Šæµ·å¸‚å½°æ­¦è·¯<span class="token number">1</span>å·åŒæµå¤§å¦<span class="token class-name">A</span>æ¥¼<span class="token number">7</span>æ¥¼<span class="token number">7</span>åŒº<span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">18</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">35</span><span class="token operator">:</span><span class="token number">57</span><span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">18</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">35</span><span class="token operator">:</span><span class="token number">57</span>&#39;<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">CREATE</span> <span class="token class-name">TABLE</span> user <span class="token punctuation">(</span> id <span class="token function">bigint</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token class-name">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span> name <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> age <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> address <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span> entryTime datetime<span class="token punctuation">,</span> remark <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> createTime datetime<span class="token punctuation">,</span> updateTime datetime<span class="token punctuation">,</span> status <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token constant">DEFAULT</span> <span class="token char">&#39;0&#39;</span><span class="token punctuation">,</span> dateTime <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">INDEX</span> idx_name <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token constant">ENGINE</span><span class="token operator">=</span><span class="token class-name">InnoDB</span> <span class="token class-name">DEFAULT</span> <span class="token constant">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
insert into user <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> address<span class="token punctuation">,</span> entryTime<span class="token punctuation">,</span> remark<span class="token punctuation">,</span> createTime<span class="token punctuation">,</span> updateTime<span class="token punctuation">,</span> status<span class="token punctuation">,</span> dateTime<span class="token punctuation">)</span> values <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token char">&#39;æ°´æ°´&#39;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> &#39;å‰æ—çœæ¦†æ ‘å¸‚é»‘æ—é•‡å°¹å®¶æ‘<span class="token number">5</span>ç»„<span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token char">&#39;, &#39;</span>æ— <span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token char">&#39;, 0, &#39;</span><span class="token number">20200309</span>&#39;<span class="token punctuation">)</span><span class="token punctuation">;</span>
insert into user <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> address<span class="token punctuation">,</span> entryTime<span class="token punctuation">,</span> remark<span class="token punctuation">,</span> createTime<span class="token punctuation">,</span> updateTime<span class="token punctuation">,</span> status<span class="token punctuation">,</span> dateTime<span class="token punctuation">)</span> values <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token char">&#39;è±†è±†&#39;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> &#39;è¾½å®çœå¤§è¿å¸‚æ¸…æ²³æ¹¾å¸é©¬é“<span class="token number">407</span>è·¯<span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token char">&#39;, &#39;</span>æ— <span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span>&#39;<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
insert into user <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> address<span class="token punctuation">,</span> entryTime<span class="token punctuation">,</span> remark<span class="token punctuation">,</span> createTime<span class="token punctuation">,</span> updateTime<span class="token punctuation">,</span> status<span class="token punctuation">,</span> dateTime<span class="token punctuation">)</span> values <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token char">&#39;èŠ±èŠ±&#39;</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> &#39;è¾½å®çœå¤§è¿å¸‚æ¸…æ²³æ¹¾å¸é©¬é“<span class="token number">407</span>è·¯<span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token char">&#39;, &#39;</span>æ— <span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token char">&#39;, &#39;</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token char">&#39;, 0, &#39;</span><span class="token number">20200310</span>&#39;<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-åˆ›å»ºæ•°æ®åº“å¯¹è±¡ç±»" tabindex="-1"><a class="header-anchor" href="#_3-1-åˆ›å»ºæ•°æ®åº“å¯¹è±¡ç±»" aria-hidden="true">#</a> 3.1 åˆ›å»ºæ•°æ®åº“å¯¹è±¡ç±»</h4><p><strong>ç”¨æˆ·ç±»</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span>
    
    <span class="token comment">// ... get/set</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å­¦æ ¡ç±»</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">School</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span>  
  
    <span class="token comment">// ... get/set</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™ä¸¤ä¸ªç±»éƒ½éå¸¸ç®€å•ï¼Œå°±æ˜¯åŸºæœ¬çš„æ•°æ®åº“ä¿¡æ¯ã€‚</li></ul><h4 id="_3-2-åˆ›å»ºdaoåŒ…" tabindex="-1"><a class="header-anchor" href="#_3-2-åˆ›å»ºdaoåŒ…" aria-hidden="true">#</a> 3.2 åˆ›å»ºDAOåŒ…</h4><p><strong>ç”¨æˆ·Dao</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IUserDao</span> <span class="token punctuation">{</span>

     <span class="token class-name">User</span> <span class="token function">queryUserInfoById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å­¦æ ¡Dao</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ISchoolDao</span> <span class="token punctuation">{</span>

    <span class="token class-name">School</span> <span class="token function">querySchoolInfoById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> treeId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-ormé…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_3-3-ormé…ç½®æ–‡ä»¶" aria-hidden="true">#</a> 3.3 ORMé…ç½®æ–‡ä»¶</h4><p><strong>é“¾æ¥é…ç½®</strong></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>JDBC<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POOLED<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driver<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.mysql.jdbc.Driver<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://127.0.0.1:3306/itstack_demo_design?useUnicode=true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapper/User_Mapper.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapper/School_Mapper.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™ä¸ªé…ç½®ä¸æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„mybatisåŸºæœ¬æ˜¯ä¸€æ ·çš„ï¼ŒåŒ…æ‹¬äº†æ•°æ®åº“çš„è¿æ¥æ± ä¿¡æ¯ä»¥åŠéœ€è¦å¼•å…¥çš„mapperæ˜ å°„æ–‡ä»¶ã€‚</li></ul><p><strong>æ“ä½œé…ç½®(ç”¨æˆ·)</strong></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.itstack.demo.design.dao.IUserDao<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queryUserInfoById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.lang.Long<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.itstack.demo.design.po.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        SELECT id, name, age, createTime, updateTime
        FROM user
        where id = #{id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queryUserList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.itstack.demo.design.po.User<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.itstack.demo.design.po.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        SELECT id, name, age, createTime, updateTime
        FROM user
        where age = #{age}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ“ä½œé…ç½®(å­¦æ ¡)</strong></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.itstack.demo.design.dao.ISchoolDao<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>querySchoolInfoById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.itstack.demo.design.po.School<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        SELECT id, name, address, createTime, updateTime
        FROM school
        where id = #{id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-4-å•ä¸ªç»“æœæŸ¥è¯¢æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-4-å•ä¸ªç»“æœæŸ¥è¯¢æµ‹è¯•" aria-hidden="true">#</a> 3.4 å•ä¸ªç»“æœæŸ¥è¯¢æµ‹è¯•</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_queryUserInfoById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> resource <span class="token operator">=</span> <span class="token string">&quot;mybatis-config-datasource.xml&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">Reader</span> reader<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        reader <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsReader</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlSessionFactory</span> sqlMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlSession</span> session <span class="token operator">=</span> sqlMapper<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">User</span> user <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token string">&quot;org.itstack.demo.design.dao.IUserDao.queryUserInfoById&quot;</span><span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•ç»“æœï¼š{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            session<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            reader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™é‡Œçš„ä½¿ç”¨æ–¹å¼å’Œ<code>Mybatis</code>æ˜¯ä¸€æ ·çš„ï¼Œéƒ½åŒ…æ‹¬äº†ï¼›èµ„æºåŠ è½½å’Œè§£æã€<code>SqlSession</code>å·¥å‚æ„å»ºã€å¼€å¯<code>SqlSession</code>ä»¥åŠæœ€åæ‰§è¡ŒæŸ¥è¯¢æ“ä½œ<code>selectOne</code></li></ul><p><strong>æµ‹è¯•ç»“æœ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">16</span><span class="token operator">:</span><span class="token number">56</span><span class="token operator">:</span><span class="token number">51.831</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design<span class="token punctuation">.</span>demo<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">{</span><span class="token string">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token number">1576944000000</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;æ°´æ°´&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token number">1576944000000</span><span class="token punctuation">}</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä»ç»“æœä¸Šçœ‹å·²ç»æ»¡è¶³äº†æˆ‘ä»¬çš„æŸ¥è¯¢éœ€æ±‚ã€‚</li></ul><h4 id="_3-5-é›†åˆç»“æœæŸ¥è¯¢æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-5-é›†åˆç»“æœæŸ¥è¯¢æµ‹è¯•" aria-hidden="true">#</a> 3.5 é›†åˆç»“æœæŸ¥è¯¢æµ‹è¯•</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_queryUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> resource <span class="token operator">=</span> <span class="token string">&quot;mybatis-config-datasource.xml&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">Reader</span> reader<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        reader <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsReader</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlSessionFactory</span> sqlMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlSession</span> session <span class="token operator">=</span> sqlMapper<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">User</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            req<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userList <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token string">&quot;org.itstack.demo.design.dao.IUserDao.queryUserList&quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•ç»“æœï¼š{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>userList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            session<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            reader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™ä¸ªæµ‹è¯•å†…å®¹ä¸ä»¥ä¸Šåªæ˜¯æŸ¥è¯¢æ–¹æ³•æœ‰æ‰€ä¸åŒï¼›<code>session.selectList</code>ï¼Œæ˜¯æŸ¥è¯¢ä¸€ä¸ªé›†åˆç»“æœã€‚</li></ul><p><strong>æµ‹è¯•ç»“æœ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">16</span><span class="token operator">:</span><span class="token number">58</span><span class="token operator">:</span><span class="token number">13.963</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>design<span class="token punctuation">.</span>demo<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼š<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token number">1576944000000</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;æ°´æ°´&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token number">1576944000000</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token string">&quot;createTime&quot;</span><span class="token operator">:</span><span class="token number">1576944000000</span><span class="token punctuation">,</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;è±†è±†&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;updateTime&quot;</span><span class="token operator">:</span><span class="token number">1576944000000</span><span class="token punctuation">}</span><span class="token punctuation">]</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æµ‹è¯•éªŒè¯é›†åˆçš„ç»“æœä¹Ÿæ˜¯æ­£å¸¸çš„ï¼Œç›®å‰ä½ç½®æµ‹è¯•å…¨éƒ¨é€šè¿‡ã€‚</li></ul><h2 id="ä¸ƒã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€æ€»ç»“" aria-hidden="true">#</a> ä¸ƒã€æ€»ç»“</h2><ul><li>ä»¥ä¸Šé€šè¿‡ä¸­ä»‹è€…æ¨¡å¼çš„è®¾è®¡æ€æƒ³æˆ‘ä»¬æ‰‹å†™äº†ä¸€ä¸ªORMæ¡†æ¶ï¼Œéšå»äº†å¯¹æ•°æ®åº“æ“ä½œçš„å¤æ‚åº¦ï¼Œè®©å¤–éƒ¨çš„è°ƒç”¨æ–¹å¯ä»¥éå¸¸ç®€å•çš„è¿›è¡Œæ“ä½œæ•°æ®åº“ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„<code>Mybatis</code>çš„åŸå‹ï¼Œåœ¨æˆ‘ä»¬æ—¥å¸¸çš„å¼€å‘ä½¿ç”¨ä¸­ï¼Œåªéœ€è¦æŒ‰ç…§é…ç½®å³å¯éå¸¸ç®€å•çš„æ“ä½œæ•°æ®åº“ã€‚</li><li>é™¤äº†ä»¥ä¸Šè¿™ç§ç»„ä»¶æ¨¡å¼çš„å¼€å‘å¤–ï¼Œè¿˜æœ‰æœåŠ¡æ¥å£çš„åŒ…è£…ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸­ä»‹è€…æ¨¡å¼æ¥å®ç°ã€‚æ¯”å¦‚ä½ ä»¬å…¬å¸æœ‰å¾ˆå¤šçš„å¥–å“æ¥å£éœ€è¦åœ¨è¥é”€æ´»åŠ¨ä¸­å¯¹æ¥ï¼Œé‚£ä¹ˆå¯ä»¥æŠŠè¿™äº›å¥–å“æ¥å£ç»Ÿä¸€æ”¶åˆ°ä¸­å°å¼€å‘ä¸€ä¸ªå¥–å“ä¸­å¿ƒï¼Œå¯¹å¤–æä¾›æœåŠ¡ã€‚è¿™æ ·å°±ä¸éœ€è¦æ¯ä¸€ä¸ªéœ€è¦å¯¹æ¥å¥–å“çš„æ¥å£ï¼Œéƒ½å»æ‰¾å…·ä½“çš„æä¾›è€…ï¼Œè€Œæ˜¯æ‰¾ä¸­å°æœåŠ¡å³å¯ã€‚</li><li>åœ¨ä¸Šè¿°çš„å®ç°å’Œæµ‹è¯•ä½¿ç”¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§æ¨¡å¼çš„è®¾è®¡æ»¡è¶³äº†ï¼›<code>å•ä¸€èŒè´£</code>å’Œ<code>å¼€é—­åŸåˆ™</code>ï¼Œä¹Ÿå°±ç¬¦åˆäº†<code>è¿ªç±³ç‰¹åŸåˆ™</code>ï¼Œå³è¶Šå°‘äººçŸ¥é“è¶Šå¥½ã€‚å¤–éƒ¨çš„äººåªéœ€è¦æŒ‰ç…§éœ€æ±‚è¿›è¡Œè°ƒç”¨ï¼Œä¸éœ€è¦çŸ¥é“å…·ä½“çš„æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå¤æ‚çš„ä¸€é¢å·²ç»æœ‰ç»„ä»¶åˆä½œæœåŠ¡å¹³å°å¤„ç†ã€‚</li></ul>`,89);function j(_,E){const a=o("ExternalLinkIcon");return c(),l("div",null,[i,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),k,s("åšå®¢ï¼š"),n("a",r,[s("https://bugstack.cn"),t(a)])]),d,m,v,n("ol",null,[b,g,h,n("li",null,[s("æ¶‰åŠå·¥ç¨‹ä¸€ä¸ªï¼Œå¯ä»¥é€šè¿‡å…³æ³¨"),f,s("ï¼š"),n("a",q,[y,t(a)]),s("ï¼Œå›å¤"),S,s("è·å–(æ‰“å¼€è·å–çš„é“¾æ¥ï¼Œæ‰¾åˆ°åºå·18)")])]),w,n("ul",null,[n("li",null,[s("å›¾ç‰‡æ¥è‡ªï¼š"),n("a",x,[s("https://refactoringguru.cn/design-patterns/mediator"),t(a)])])]),T])}const N=e(u,[["render",j],["__file","2020-06-27-zhongxue Java shejimoshiã€Šshizhanzhongjiezhemoshiã€‹.html.vue"]]);export{N as default};
