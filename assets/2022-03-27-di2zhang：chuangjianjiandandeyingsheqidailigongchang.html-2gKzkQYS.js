import{_ as t,r as p,o as c,c as o,a as n,b as s,d as e,e as l}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"ã€Šmybatis-æ‰‹æ’¸ä¸“æ ã€‹ç¬¬2ç« -åˆ›å»ºç®€å•çš„æ˜ å°„å™¨ä»£ç†å·¥å‚",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ã€Šmybatis-æ‰‹æ’¸ä¸“æ ã€‹ç¬¬2ç« -åˆ›å»ºç®€å•çš„æ˜ å°„å™¨ä»£ç†å·¥å‚","aria-hidden":"true"},"#"),s(" ã€ŠMybatis æ‰‹æ’¸ä¸“æ ã€‹ç¬¬2ç« ï¼šåˆ›å»ºç®€å•çš„æ˜ å°„å™¨ä»£ç†å·¥å‚")],-1),r=n("br",null,null,-1),k={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=n("br",null,null,-1),m={href:"https://mp.weixin.qq.com/s/G3fZES2FvNQK8JLnd9Hx9w",target:"_blank",rel:"noopener noreferrer"},v=n("blockquote",null,[n("p",null,"æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„")],-1),b=n("iframe",{id:"B-Video",src:"//player.bilibili.com/player.html?aid=597036405&bvid=BV18B4y1X7iP&cid=732918039&page=1",scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",width:"100%",height:"480"}," ",-1),g=l(`<h2 id="ä¸€ã€å‰è¨€" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‰è¨€" aria-hidden="true">#</a> ä¸€ã€å‰è¨€</h2><p><code>ç€æ€¥å’Œå¿«ï¼Œæ˜¯æœ€å¤§çš„éšœç¢ï¼</code></p><p>æ…¢ä¸‹æ¥ï¼Œæ…¢ä¸‹æ¥ï¼Œåªæœ‰æ…¢ä¸‹æ¥ï¼Œä½ æ‰èƒ½çœ‹åˆ°æ›´å…¨çš„ä¿¡æ¯ï¼Œæ‰èƒ½å­¦åˆ°æ›´æ‰å®çš„æŠ€æœ¯ã€‚è€Œé‚£äº›æ»¡è¶³ä½ å¿«çš„çŸ­ç¯‡å†…å®¹è™½ç„¶æœ‰æ—¶å€™æ›´æŠ“çœ¼çƒï¼Œä½†ä¹Ÿå®¹æ˜“æŠŠäººåœ¨æŠ€æœ¯å­¦ä¹ ä¸Šå¸¦åï¼Œæ€»æƒ³ç€è¶Šå¿«è¶Šå¥½ã€‚</p><p>åœ¨å°å‚…å“¥ç¼–å†™æŠ€æœ¯æ–‡ç« çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šé‡åˆ°è¿™æ ·çš„æƒ…å†µï¼Œä¸å°‘è¯»è€…æ›´å–œæ¬¢çœ‹ï¼›ä¸€ä¸ªç³»åˆ—å†…å®¹çš„å¼€å¤´ã€ä¸€æ®µæˆé•¿æ•…äº‹çš„åˆ†äº«ã€ä¸€å¤©æˆä¸ºæ¶æ„çš„ç§˜ç±ã€‚å½“ç„¶æˆ‘ä¹Ÿèƒ½ç†è§£è¿™ç§å–œæ¬¢ï¼Œæ¯•ç«Ÿå¤§å¤šæ•°äººéƒ½å–œæ¬¢èµ°æ·å¾„ï¼Œå°±åƒå†¬å¤©ä¹°äº†è¿åŠ¨å¥èº«è£…å¤‡ï¼Œå¤å¤©è¿‡å»äº†è¿˜æ²¡æœ‰æ‹†å°ã€‚</p><p>å¥½äº†ï¼Œæ¥ä¸‹æ¥å’±ä»¬å¹²æ­£äº‹ï¼</p><h2 id="äºŒã€ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#äºŒã€ç›®æ ‡" aria-hidden="true">#</a> äºŒã€ç›®æ ‡</h2><p>åœ¨ä½ èƒ½é˜…è¯»è¿™ç¯‡æ–‡ç« ä¹‹æ—¶ï¼Œæˆ‘ç›¸ä¿¡ä½ å·²ç»æ˜¯ä¸€ä¸ª Mybatis ORM æ¡†æ¶å·¥å…·ä½¿ç”¨çš„ç†Ÿç»ƒå·¥äº†ï¼Œé‚£ä½ æ˜¯å¦æ¸…æ¥šè¿™ä¸ª ORM æ¡†æ¶æ˜¯æ€ä¹ˆå±è”½æˆ‘ä»¬å¯¹æ•°æ®åº“æ“ä½œçš„ç»†èŠ‚çš„ï¼Ÿ</p><p>æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨ JDBC çš„æ—¶å€™ï¼Œéœ€è¦æ‰‹åŠ¨å»ºç«‹æ•°æ®åº“é“¾æ¥ã€ç¼–ç  SQL è¯­å¥ã€æ‰§è¡Œæ•°æ®åº“æ“ä½œã€è‡ªå·±å°è£…è¿”å›ç»“æœç­‰ã€‚ä½†åœ¨ä½¿ç”¨ ORM æ¡†æ¶åï¼Œåªéœ€è¦é€šè¿‡ç®€å•é…ç½®å³å¯å¯¹å®šä¹‰çš„ DAO æ¥å£è¿›è¡Œæ•°æ®åº“çš„æ“ä½œäº†ã€‚</p><p>é‚£ä¹ˆæœ¬ç« èŠ‚æˆ‘ä»¬å°±æ¥è§£å†³ ORM æ¡†æ¶ç¬¬ä¸€ä¸ªå…³è”å¯¹è±¡æ¥å£å’Œæ˜ å°„ç±»çš„é—®é¢˜ï¼ŒæŠŠ DAO æ¥å£ä½¿ç”¨ä»£ç†ç±»ï¼ŒåŒ…è£…æ˜ å°„æ“ä½œã€‚</p><h2 id="ä¸‰ã€è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€è®¾è®¡" aria-hidden="true">#</a> ä¸‰ã€è®¾è®¡</h2><p>é€šå¸¸å¦‚æœèƒ½æ‰¾åˆ°å¤§å®¶æ‰€åœ¨äº‹æƒ…çš„å…±æ€§å†…å®¹ï¼Œå…·æœ‰ç»Ÿä¸€çš„æµç¨‹å¤„ç†ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å¯ä»¥è¢«å‡èšå’Œæç‚¼çš„ï¼Œåšæˆé€šç”¨çš„ç»„ä»¶æˆ–è€…æœåŠ¡ï¼Œè¢«æ‰€æœ‰äººè¿›è¡Œä½¿ç”¨ï¼Œå‡å°‘é‡å¤çš„äººåŠ›æŠ•å…¥ã€‚</p><p>è€Œå‚è€ƒæˆ‘ä»¬æœ€å¼€å§‹ä½¿ç”¨ JDBC çš„æ–¹å¼ï¼Œä»è¿æ¥ã€æŸ¥è¯¢ã€å°è£…ã€è¿”å›ï¼Œå…¶å®éƒ½ä¸€ä¸ªå›ºå®šçš„æµç¨‹ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹å°±å¯ä»¥è¢«æç‚¼ä»¥åŠå°è£…å’Œè¡¥å…¨å¤§å®¶æ‰€éœ€è¦çš„åŠŸèƒ½ã€‚</p><p>å½“æˆ‘ä»¬æ¥è®¾è®¡ä¸€ä¸ª ORM æ¡†æ¶çš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆè¦è€ƒè™‘æ€ä¹ˆæŠŠç”¨æˆ·å®šä¹‰çš„æ•°æ®åº“æ“ä½œæ¥å£ã€xmlé…ç½®çš„SQLè¯­å¥ã€æ•°æ®åº“ä¸‰è€…è”ç³»èµ·æ¥ã€‚å…¶å®æœ€é€‚åˆçš„æ“ä½œå°±æ˜¯ä½¿ç”¨ä»£ç†çš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œå› ä¸ºä»£ç†å¯ä»¥å°è£…ä¸€ä¸ªå¤æ‚çš„æµç¨‹ä¸ºæ¥å£å¯¹è±¡çš„å®ç°ç±»ï¼Œè®¾è®¡å¦‚å›¾ 2-1ï¼š</p><p><img src="https://bugstack.cn/images/article/spring/mybatis-220327-01.png" alt="å›¾ 2-1 ä»£ç†ç±»è®¾è®¡"></p><ul><li>é¦–å…ˆæä¾›ä¸€ä¸ªæ˜ å°„å™¨çš„ä»£ç†å®ç°ç±» <code>MapperProxy</code>ï¼Œé€šè¿‡ä»£ç†ç±»åŒ…è£…å¯¹æ•°æ®åº“çš„æ“ä½œï¼Œç›®å‰æˆ‘ä»¬æœ¬ç« èŠ‚ä¼šå…ˆæä¾›ä¸€ä¸ªç®€å•çš„åŒ…è£…ï¼Œæ¨¡æ‹Ÿå¯¹æ•°æ®åº“çš„è°ƒç”¨ã€‚</li><li>ä¹‹åå¯¹ <code>MapperProxy</code> ä»£ç†ç±»ï¼Œæä¾›å·¥å‚å®ä¾‹åŒ–æ“ä½œ MapperProxyFactory#newInstanceï¼Œä¸ºæ¯ä¸ª IDAO æ¥å£ç”Ÿæˆä»£ç†ç±»ã€‚<em>è¿™å—å…¶å®ç”¨åˆ°çš„å°±æ˜¯ä¸€ä¸ªç®€å•å·¥å‚æ¨¡å¼</em></li></ul><p><em>æ¥ä¸‹æ¥æˆ‘ä»¬å°±æŒ‰ç…§è¿™ä¸ªè®¾è®¡å®ç°ä¸€ä¸ªç®€å•çš„æ˜ å°„å™¨ä»£ç†æ“ä½œï¼Œç¼–ç è¿‡ç¨‹æ¯”è¾ƒç®€å•ã€‚å¦‚æœå¯¹ä»£ç†çŸ¥è¯†ä¸ç†Ÿæ‚‰å¯ä»¥å…ˆè¡¥å……ä¸‹ã€‚</em></p><h2 id="å››ã€å®ç°" tabindex="-1"><a class="header-anchor" href="#å››ã€å®ç°" aria-hidden="true">#</a> å››ã€å®ç°</h2><h3 id="_1-å·¥ç¨‹ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1-å·¥ç¨‹ç»“æ„" aria-hidden="true">#</a> 1. å·¥ç¨‹ç»“æ„</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>mybatis<span class="token operator">-</span>step<span class="token operator">-</span><span class="token number">01</span>
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>binding
    â”‚           â”œâ”€â”€ <span class="token class-name">MapperProxy</span><span class="token punctuation">.</span>java
    â”‚           â””â”€â”€ <span class="token class-name">MapperProxyFactory</span><span class="token punctuation">.</span>java
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span>dao
                â”œâ”€â”€ dao
                â”‚   â””â”€â”€ <span class="token class-name">IUserDao</span><span class="token punctuation">.</span>java
                â””â”€â”€ <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å·¥ç¨‹æºç </strong>ï¼š<code>å…¬ä¼—å·ã€Œbugstackè™«æ´æ ˆã€ï¼Œå›å¤ï¼šæ‰‹å†™Mybatisï¼Œè·å–å®Œæ•´æºç </code></p><p>Mybatis æ˜ å°„å™¨ä»£ç†ç±»å…³ç³»ï¼Œå¦‚å›¾ 2-2</p><p><img src="https://bugstack.cn/images/article/spring/mybatis-220327-02.png" alt="å¦‚å›¾ 2-2 ä»£ç†ç±»å…³ç³»å›¾"></p><ul><li>ç›®å‰è¿™ä¸ª Mybatis æ¡†æ¶çš„ä»£ç†æ“ä½œå®ç°çš„è¿˜åªæ˜¯æœ€æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œç›¸å½“äºæ˜¯å…‰å±è‚¡çš„å¨ƒå¨ƒï¼Œè¿˜æ²¡æœ‰æ·»åŠ è¡£æœã€‚ä¸è¿‡è¿™æ ·æ¸è¿›å¼çš„å®ç°å¯ä»¥è®©å¤§å®¶å…ˆäº†è§£åˆ°æœ€æ ¸å¿ƒçš„å†…å®¹ï¼Œåç»­æˆ‘ä»¬åœ¨é™†ç»­çš„å®Œå–„ã€‚</li><li>MapperProxy è´Ÿè´£å®ç° InvocationHandler æ¥å£çš„ invoke æ–¹æ³•ï¼Œæœ€ç»ˆæ‰€æœ‰çš„å®é™…è°ƒç”¨éƒ½ä¼šè°ƒç”¨åˆ°è¿™ä¸ªæ–¹æ³•åŒ…è£…çš„é€»è¾‘ã€‚</li><li>MapperProxyFactory æ˜¯å¯¹ MapperProxy çš„åŒ…è£…ï¼Œå¯¹å¤–æä¾›å®ä¾‹åŒ–å¯¹è±¡çš„æ“ä½œã€‚å½“æˆ‘ä»¬åé¢å¼€å§‹ç»™æ¯ä¸ªæ“ä½œæ•°æ®åº“çš„æ¥å£æ˜ å°„å™¨æ³¨å†Œä»£ç†çš„æ—¶å€™ï¼Œå°±éœ€è¦ä½¿ç”¨åˆ°è¿™ä¸ªå·¥å‚ç±»äº†ã€‚</li></ul><h3 id="_2-æ˜ å°„å™¨ä»£ç†ç±»" tabindex="-1"><a class="header-anchor" href="#_2-æ˜ å°„å™¨ä»£ç†ç±»" aria-hidden="true">#</a> 2. æ˜ å°„å™¨ä»£ç†ç±»</h3><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.binding.MapperProxy</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapperProxy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">6424540398559729838L</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> sqlSession<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> mapperInterface<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MapperProxy</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> sqlSession<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> mapperInterface<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sqlSession <span class="token operator">=</span> sqlSession<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mapperInterface <span class="token operator">=</span> mapperInterface<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getDeclaringClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;ä½ çš„è¢«ä»£ç†äº†ï¼&quot;</span> <span class="token operator">+</span> sqlSession<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>mapperInterface<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>é€šè¿‡å®ç° InvocationHandler#invoke ä»£ç†ç±»æ¥å£ï¼Œå°è£…æ“ä½œé€»è¾‘çš„æ–¹å¼ï¼Œå¯¹å¤–æ¥å£æä¾›æ•°æ®åº“æ“ä½œå¯¹è±¡ã€‚</li><li>ç›®å‰æˆ‘ä»¬è¿™é‡Œåªæ˜¯ç®€å•çš„å°è£…äº†ä¸€ä¸ª sqlSession çš„ Map å¯¹è±¡ï¼Œä½ å¯ä»¥æƒ³è±¡æˆæ‰€æœ‰çš„æ•°æ®åº“è¯­å¥æ“ä½œï¼Œéƒ½æ˜¯é€šè¿‡<code>æ¥å£åç§°+æ–¹æ³•åç§°ä½œä¸ºkey</code>ï¼Œæ“ä½œä½œä¸ºé€»è¾‘çš„æ–¹å¼è¿›è¡Œä½¿ç”¨çš„ã€‚é‚£ä¹ˆåœ¨åå°„è°ƒç”¨ä¸­åˆ™è·å–å¯¹åº”çš„æ“ä½œç›´æ¥æ‰§è¡Œå¹¶è¿”å›ç»“æœå³å¯ã€‚<em>å½“ç„¶è¿™è¿˜åªæ˜¯æœ€æ ¸å¿ƒçš„ç®€åŒ–æµç¨‹ï¼Œåç»­ä¸æ–­è¡¥å……å†…å®¹åï¼Œä¼šçœ‹åˆ°å¯¹æ•°æ®åº“çš„æ“ä½œ</em></li><li>å¦å¤–è¿™é‡Œè¦æ³¨æ„å¦‚æœæ˜¯ Object æä¾›çš„ toStringã€hashCode ç­‰æ–¹æ³•æ˜¯ä¸éœ€è¦ä»£ç†æ‰§è¡Œçš„ï¼Œæ‰€ä»¥æ·»åŠ  <code>Object.class.equals(method.getDeclaringClass())</code> åˆ¤æ–­ã€‚</li></ul><h3 id="_3-ä»£ç†ç±»å·¥å‚" tabindex="-1"><a class="header-anchor" href="#_3-ä»£ç†ç±»å·¥å‚" aria-hidden="true">#</a> 3. ä»£ç†ç±»å·¥å‚</h3><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.binding.MapperProxyFactory</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapperProxyFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> mapperInterface<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MapperProxyFactory</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> mapperInterface<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mapperInterface <span class="token operator">=</span> mapperInterface<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> sqlSession<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">MapperProxy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> mapperProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MapperProxy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">,</span> mapperInterface<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>mapperInterface<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>mapperInterface<span class="token punctuation">}</span><span class="token punctuation">,</span> mapperProxy<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å·¥å‚æ“ä½œç›¸å½“äºæŠŠä»£ç†çš„åˆ›å»ºç»™å°è£…èµ·æ¥äº†ï¼Œå¦‚æœä¸åšè¿™å±‚å°è£…ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªåˆ›å»ºä»£ç†ç±»çš„æ“ä½œï¼Œéƒ½éœ€è¦è‡ªå·±ä½¿ç”¨ <code>Proxy.newProxyInstance</code> è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆè¿™æ ·çš„æ“ä½œæ–¹å¼å°±æ˜¾å¾—æ¯”è¾ƒéº»çƒ¦äº†ã€‚</li><li>å¦å¤–å¦‚æœä½ å¯¹ä»£ç†ä¸æ˜¯å¤ªç†Ÿæ‚‰ï¼Œå¯ä»¥ç€é‡æŠŠ JDK Proxy çš„å†…å®¹åšå‡ ä¸ªæ¡ˆä¾‹è¡¥å……ä¸‹è¿™å—çš„å†…å®¹ã€‚</li></ul><h2 id="äº”ã€æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#äº”ã€æµ‹è¯•" aria-hidden="true">#</a> äº”ã€æµ‹è¯•</h2><h3 id="_1-äº‹å…ˆå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#_1-äº‹å…ˆå‡†å¤‡" aria-hidden="true">#</a> 1. äº‹å…ˆå‡†å¤‡</h3><p><strong>cn.bugstack.mybatis.test.dao.IUserDao</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IUserDao</span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> <span class="token function">queryUserName</span><span class="token punctuation">(</span><span class="token class-name">String</span> uId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Integer</span> <span class="token function">queryUserAge</span><span class="token punctuation">(</span><span class="token class-name">String</span> uId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>é¦–å…ˆæä¾›ä¸€ä¸ª DAO æ¥å£ï¼Œå¹¶å®šä¹‰2ä¸ªæ¥å£æ–¹æ³•ã€‚</li></ul><h3 id="_2-æµ‹è¯•ç”¨ä¾‹" tabindex="-1"><a class="header-anchor" href="#_2-æµ‹è¯•ç”¨ä¾‹" aria-hidden="true">#</a> 2. æµ‹è¯•ç”¨ä¾‹</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_MapperProxyFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">MapperProxyFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IUserDao</span><span class="token punctuation">&gt;</span></span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MapperProxyFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">IUserDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> sqlSession <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    sqlSession<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;cn.bugstack.mybatis.test.dao.IUserDao.queryUserName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æ¨¡æ‹Ÿæ‰§è¡Œ Mapper.xml ä¸­ SQL è¯­å¥çš„æ“ä½œï¼šæŸ¥è¯¢ç”¨æˆ·å§“å&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sqlSession<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;cn.bugstack.mybatis.test.dao.IUserDao.queryUserAge&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æ¨¡æ‹Ÿæ‰§è¡Œ Mapper.xml ä¸­ SQL è¯­å¥çš„æ“ä½œï¼šæŸ¥è¯¢ç”¨æˆ·å¹´é¾„&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IUserDao</span> userDao <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> res <span class="token operator">=</span> userDao<span class="token punctuation">.</span><span class="token function">queryUserName</span><span class="token punctuation">(</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•ç»“æœï¼š{}&quot;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨å•æµ‹ä¸­åˆ›å»º MapperProxyFactory å·¥å‚ï¼Œå¹¶æ‰‹åŠ¨ç»™ sqlSession Map èµ‹å€¼ï¼Œè¿™é‡Œçš„èµ‹å€¼ç›¸å½“äºæ¨¡æ‹Ÿæ•°æ®åº“ä¸­çš„æ“ä½œã€‚</li><li>æ¥ä¸‹æ¥å†æŠŠèµ‹å€¼ä¿¡æ¯ä¼ é€’ç»™ä»£ç†å¯¹è±¡å®ä¾‹åŒ–æ“ä½œï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æˆ‘ä»¬è°ƒç”¨å…·ä½“çš„ DAO æ–¹æ³•æ—¶ä» sqlSession ä¸­å–å€¼äº†ã€‚</li></ul><p><strong>æµ‹è¯•ç»“æœ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">17</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">41.817</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token constant">INFO</span>  <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ApiTest</span> <span class="token operator">-</span> æµ‹è¯•ç»“æœï¼šä½ çš„è¢«ä»£ç†äº†ï¼æ¨¡æ‹Ÿæ‰§è¡Œ <span class="token class-name">Mapper</span><span class="token punctuation">.</span>xml ä¸­ <span class="token constant">SQL</span> è¯­å¥çš„æ“ä½œï¼šæŸ¥è¯¢ç”¨æˆ·å§“å

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä»æµ‹è¯•ç»“æœå¯ä»¥çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬çš„æ¥å£å·²ç»è¢«ä»£ç†ç±»å®ç°äº†ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç†ç±»ä¸­è¿›è¡Œè‡ªå·±çš„æ“ä½œå°è£…ã€‚é‚£ä¹ˆåœ¨æˆ‘ä»¬åç»­å®ç°çš„æ•°æ®åº“æ“ä½œä¸­ï¼Œå°±å¯ä»¥å¯¹è¿™éƒ¨åˆ†å†…å®¹è¿›è¡Œæ‰©å±•äº†ã€‚</li></ul><h2 id="å…­ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#å…­ã€æ€»ç»“" aria-hidden="true">#</a> å…­ã€æ€»ç»“</h2><ul><li>æœ¬ç« èŠ‚æˆ‘ä»¬åˆæ­¥å¯¹ Mybatis æ¡†æ¶ä¸­çš„æ•°æ®åº“ DAO æ“ä½œæ¥å£å’Œæ˜ å°„å™¨é€šè¿‡ä»£ç†ç±»çš„æ–¹å¼è¿›è¡Œé“¾æ¥ï¼Œè¿™ä¸€æ­¥ä¹Ÿæ˜¯ ORM æ¡†æ¶é‡Œéå¸¸æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚æœ‰äº†è¿™å—çš„å†…å®¹ï¼Œå°±å¯ä»¥åœ¨ä»£ç†ç±»ä¸­è¿›è¡Œè‡ªå·±é€»è¾‘çš„æ‰©å±•äº†ã€‚</li><li>åœ¨æ¡†æ¶å®ç°æ–¹é¢å¼•å…¥ç®€å•å·¥å‚æ¨¡å¼åŒ…è£…ä»£ç†ç±»ï¼Œå±è”½åˆ›å»ºç»†èŠ‚ï¼Œè¿™äº›ä¹Ÿæ˜¯å¤§å®¶åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„è®¾è®¡æ¨¡å¼çš„ç‚¹ã€‚</li><li>ç›®å‰å†…å®¹è¿˜æ¯”è¾ƒç®€å•çš„ï¼Œå¯ä»¥æ‰‹åŠ¨æ“ä½œç»ƒä¹ ï¼Œéšç€æˆ‘ä»¬å†…å®¹çš„å¢åŠ ï¼Œä¼šæœ‰è¶Šæ¥è¶Šå¤šçš„åŒ…å’Œç±»å¼•å…¥ï¼Œå®Œå–„ ORM æ¡†æ¶åŠŸèƒ½ã€‚</li></ul><h2 id="ä¸ƒã€ä¼˜ç§€ä½œä¸š" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€ä¼˜ç§€ä½œä¸š" aria-hidden="true">#</a> ä¸ƒã€ä¼˜ç§€ä½œä¸š</h2>`,45),h={href:"https://t.zsxq.com/0662Nzr3j",target:"_blank",rel:"noopener noreferrer"},y={href:"https://t.zsxq.com/063ZvJubq",target:"_blank",rel:"noopener noreferrer"},f={href:"https://t.zsxq.com/06aei2NfA",target:"_blank",rel:"noopener noreferrer"},x={href:"https://t.zsxq.com/08DRpPAav",target:"_blank",rel:"noopener noreferrer"},_={href:"https://t.zsxq.com/08ldxyf2S",target:"_blank",rel:"noopener noreferrer"};function w(q,M){const a=p("ExternalLinkIcon");return c(),o("div",null,[u,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),r,s("åšå®¢ï¼š"),n("a",k,[s("https://bugstack.cn"),e(a)]),d,s("åŸæ–‡ï¼š"),n("a",m,[s("https://mp.weixin.qq.com/s/G3fZES2FvNQK8JLnd9Hx9w"),e(a)])]),v,b,g,n("ul",null,[n("li",null,[n("a",h,[s("ä½¿ç”¨åŠ¨æ€ä»£ç†ä¸ºæ¥å£ç”Ÿæˆä»£ç†å¯¹è±¡ @W"),e(a)])]),n("li",null,[n("a",y,[s("å­¦ä¼šåŠ¨æ€ä»£ç†çš„åŸç†åŠä½¿ç”¨ @Alpha"),e(a)])]),n("li",null,[n("a",f,[s("é€šè¿‡jdkåŠ¨æ€ä»£ç†çš„æ–¹å¼ï¼Œå°†ç”Ÿæˆä»£ç†å¯¹è±¡ @"),e(a)])]),n("li",null,[n("a",x,[s("åœ¨mybatisä¸­éƒ½æ˜¯ä½¿ç”¨Mapperæ¥å£ï¼Œç›´æ¥è°ƒç”¨æŸ¥è¯¢æ–¹æ³• @ç¬"),e(a)])]),n("li",null,[n("a",_,[s("åˆ›å»ºç®€å•çš„æ˜ å°„å™¨å·¥å‚ @liuc"),e(a)])])])])}const j=t(i,[["render",w],["__file","2022-03-27-di2zhangï¼šchuangjianjiandandeyingsheqidailigongchang.html.vue"]]);export{j as default};
