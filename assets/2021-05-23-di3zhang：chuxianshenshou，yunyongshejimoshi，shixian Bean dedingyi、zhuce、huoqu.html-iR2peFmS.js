import{_ as p,r as i,o as c,c as o,a as n,b as a,d as e,e as t}from"./app-3RcBQnkC.js";const l={},r=n("h1",{id:"ã€Šspring-æ‰‹æ’¸ä¸“æ ã€‹ç¬¬-3-ç« -åˆæ˜¾èº«æ‰‹-è¿ç”¨è®¾è®¡æ¨¡å¼-å®ç°-bean-çš„å®šä¹‰ã€æ³¨å†Œã€è·å–",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ã€Šspring-æ‰‹æ’¸ä¸“æ ã€‹ç¬¬-3-ç« -åˆæ˜¾èº«æ‰‹-è¿ç”¨è®¾è®¡æ¨¡å¼-å®ç°-bean-çš„å®šä¹‰ã€æ³¨å†Œã€è·å–","aria-hidden":"true"},"#"),a(" ã€ŠSpring æ‰‹æ’¸ä¸“æ ã€‹ç¬¬ 3 ç« ï¼šåˆæ˜¾èº«æ‰‹ï¼Œè¿ç”¨è®¾è®¡æ¨¡å¼ï¼Œå®ç° Bean çš„å®šä¹‰ã€æ³¨å†Œã€è·å–")],-1),u=n("br",null,null,-1),d={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},k=n("br",null,null,-1),b={href:"https://mp.weixin.qq.com/s/CgvQzm8B-CvQvXdxONC-lA",target:"_blank",rel:"noopener noreferrer"},v=t('<blockquote><p>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„</p></blockquote><h2 id="ä¸€ã€å‰è¨€" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‰è¨€" aria-hidden="true">#</a> ä¸€ã€å‰è¨€</h2><p><code>ä½ æ˜¯å¦èƒ½é¢„è§å¤æ‚å†…å®¹çš„è®¾è®¡é—®é¢˜ï¼Ÿ</code></p><p>è®²é“ç†ï¼Œæ— è®ºäº§å“åŠŸèƒ½æ˜¯å¦å¤æ‚ï¼Œéƒ½æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†ç¨‹åºå‘˜ä¼šå†™å‡ºä¸€å † if...else æ¥å®Œæˆå¼€å‘å¹¶<code>é¡ºåˆ©</code>ä¸Šçº¿ã€‚è¿™ä¸»è¦æ˜¯åŸå› æ²¡æ³•é¢„è§å½“å‰çš„éœ€æ±‚ï¼Œå‘å±•æ˜¯å¦é•¿è¿œã€æµé‡æ˜¯å¦åºå¤§ã€è¿­ä»£æ˜¯å¦è¿…é€Ÿï¼Œæ‰€ä»¥åœ¨è¢«å‚¬ä¿ƒä¸Šçº¿çš„æƒ…å†µï¼Œä¸å†™ if...else æ˜¯ä¸å¯èƒ½çš„ï¼</p><p>é‚£ä½ è¯´ï¼Œæ—¢ç„¶ if...else å®ç°çš„è¿™ä¹ˆå¿«ï¼Œè¿˜è€ƒè™‘æ•°æ®ç»“æ„ã€ç®—æ³•é€»è¾‘ã€è®¾è®¡æ¨¡å¼ã€ç³»ç»Ÿæ¶æ„å—ï¼Ÿå½“ç„¶è¿™åŸºæœ¬è¦çœ‹ä½ çš„é¡¹ç›®åœ¨å¯é¢„è§ä¸‹èƒ½æ´»å¤šä¹…ï¼Œå¦‚æœä¸€ä¸ªé¡¹ç›®è‡³å°‘å­˜æ´»ä¸€å¹´ï¼Œå¹¶ä¸”åœ¨è¿™ä¸€å¹´ä¸­åˆä¼šä¸æ–­çš„çš„è¿­ä»£ã€‚å°±åƒï¼›ä½ åšäº†ä¸€ä¸ªè¥é”€ä¼˜æƒ åˆ¸ç³»ç»Ÿï¼Œåœ¨å„ç§æ¡ä»¶ä¸‹å‘æ”¾å„ç§ç±»å‹çš„åˆ¸ï¼Œå¦‚æœåœ¨æœ€å¼€å§‹æ²¡æœ‰è€ƒè™‘å¥½ç³»ç»Ÿè®¾è®¡å’Œæ¶æ„æ¨¡å¼ï¼Œé‚£ä¹ˆå½“<code>æ´»åŠ¨é¢‘å‘</code>ã€<code>æµé‡æš´å¢</code>ã€<code>éœ€æ±‚è¿­ä»£</code>ä¸‹ã€æœ€åä½ å¯èƒ½ä¼šæŒ‚åœ¨ç³»ç»Ÿäº‹æ•…ä¸Šï¼</p><p>æˆ‘ä»¬åœ¨æŠŠç³»ç»Ÿè®¾è®¡çš„è§†è§’èšç„¦åˆ°å…·ä½“ä»£ç å®ç°ä¸Šï¼Œä½ ä¼šæœ‰ä»€ä¹ˆæ‰‹æ®µæ¥å®ç°ä½ æƒ³è¦çš„è®¾è®¡æ¨¡å¼å‘¢ï¼Ÿå…¶å®ç¼–ç æ–¹å¼ä¸»è¦ä¾æ‰˜äºï¼šæ¥å£å®šä¹‰ã€ç±»å®ç°æ¥å£ã€æŠ½è±¡ç±»å®ç°æ¥å£ã€ç»§æ‰¿ç±»ã€ç»§æ‰¿æŠ½è±¡ç±»ï¼Œè€Œè¿™äº›æ“ä½œæ–¹å¼å¯ä»¥å¾ˆå¥½çš„éš”ç¦»å¼€æ¯ä¸ªç±»çš„åŸºç¡€åŠŸèƒ½ã€é€šç”¨åŠŸèƒ½å’Œä¸šåŠ¡åŠŸèƒ½ï¼Œå½“ç±»çš„èŒè´£æ¸…æ™°åï¼Œä½ çš„æ•´ä¸ªè®¾è®¡ä¹Ÿä¼šå˜å¾—å®¹æ˜“æ‰©å±•å’Œè¿­ä»£ã€‚</p><p>æ¥ä¸‹æ¥åœ¨æœ¬ç« èŠ‚ç»§ç»­å®Œå–„ Spring Bean å®¹å™¨æ¡†æ¶çš„åŠŸèƒ½å¼€å‘ï¼Œåœ¨è¿™ä¸ªå¼€å‘è¿‡ç¨‹ä¸­ä¼šç”¨åˆ°è¾ƒå¤šçš„æ¥å£ã€ç±»ã€æŠ½è±¡ç±»ï¼Œå®ƒä»¬ä¹‹é—´ä¼šæœ‰ç±»çš„å®ç°ã€ç±»çš„ç»§æ‰¿ã€‚å¯ä»¥ä»”ç»†å‚è€ƒè¿™éƒ¨åˆ†å†…å®¹çš„å¼€å‘å®ç°ï¼Œè™½ç„¶å¹¶ä¸ä¼šå¾ˆå¤æ‚ï¼Œä½†è¿™ç§è®¾è®¡æ€è·¯æ˜¯å®Œå…¨å¯ä»¥å¤ç”¨åˆ°æˆ‘ä»¬è‡ªå·±çš„ä¸šåŠ¡ç³»ç»Ÿå¼€å‘ä¸­çš„ã€‚</p><h2 id="äºŒã€ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#äºŒã€ç›®æ ‡" aria-hidden="true">#</a> äºŒã€ç›®æ ‡</h2>',8),m={href:"https://bugstack.cn/md/spring/develop-spring/2021-05-20-%E7%AC%AC2%E7%AB%A0%EF%BC%9A%E5%B0%8F%E8%AF%95%E7%89%9B%E5%88%80%EF%BC%8C%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84Bean%E5%AE%B9%E5%99%A8.html",target:"_blank",rel:"noopener noreferrer"},g=n("p",null,"è¿™ä¸€æ¬¡æˆ‘ä»¬æŠŠ Bean çš„åˆ›å»ºäº¤ç»™å®¹å™¨ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬åœ¨è°ƒç”¨æ—¶å€™ä¼ é€’ä¸€ä¸ªå®ä¾‹åŒ–å¥½çš„ Bean å¯¹è±¡ï¼Œå¦å¤–è¿˜éœ€è¦è€ƒè™‘å•ä¾‹å¯¹è±¡ï¼Œåœ¨å¯¹è±¡çš„äºŒæ¬¡è·å–æ—¶æ˜¯å¯ä»¥ä»å†…å­˜ä¸­è·å–å¯¹è±¡çš„ã€‚æ­¤å¤–ä¸ä»…è¦å®ç°åŠŸèƒ½è¿˜éœ€è¦å®Œå–„åŸºç¡€å®¹å™¨æ¡†æ¶çš„ç±»ç»“æ„ä½“ï¼Œå¦åˆ™å°†æ¥å°±å¾ˆéš¾æ‰©å®¹è¿›å»å…¶ä»–çš„åŠŸèƒ½äº†ã€‚",-1),h=n("h2",{id:"ä¸‰ã€è®¾è®¡",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ä¸‰ã€è®¾è®¡","aria-hidden":"true"},"#"),a(" ä¸‰ã€è®¾è®¡")],-1),f=n("p",null,"é‰´äºæœ¬ç« èŠ‚çš„æ¡ˆä¾‹ç›®æ ‡ï¼Œæˆ‘ä»¬éœ€è¦å°† Spring Bean å®¹å™¨å®Œå–„èµ·æ¥ï¼Œé¦–å…ˆéå¸¸é‡è¦çš„ä¸€ç‚¹æ˜¯åœ¨ Bean æ³¨å†Œçš„æ—¶å€™åªæ³¨å†Œä¸€ä¸ªç±»ä¿¡æ¯ï¼Œè€Œä¸ä¼šç›´æ¥æŠŠå®ä¾‹åŒ–ä¿¡æ¯æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ã€‚é‚£ä¹ˆå°±éœ€è¦ä¿®æ”¹ BeanDefinition ä¸­çš„å±æ€§ Object ä¸º Classï¼Œæ¥ä¸‹æ¥åœ¨éœ€è¦åšçš„å°±æ˜¯åœ¨è·å– Bean å¯¹è±¡æ—¶éœ€è¦å¤„ç† Bean å¯¹è±¡çš„å®ä¾‹åŒ–æ“ä½œä»¥åŠåˆ¤æ–­å½“å‰å•ä¾‹å¯¹è±¡åœ¨å®¹å™¨ä¸­æ˜¯å¦å·²ç»ç¼“å­˜èµ·æ¥äº†ã€‚æ•´ä½“è®¾è®¡å¦‚å›¾ 3-1",-1),B=n("p",null,[n("img",{src:"https://bugstack.cn/assets/images/spring/spring-3-01.png",alt:""})],-1),y=n("code",null,"getBean(String name)",-1),_={href:"https://bugstack.cn/itstack-demo-design/2020/07/07/%E9%87%8D%E5%AD%A6-Java-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%AE%9E%E6%88%98%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F.html",target:"_blank",rel:"noopener noreferrer"},w=n("li",null,[a("é‚£ä¹ˆåœ¨ç»§æ‰¿æŠ½è±¡ç±» AbstractBeanFactory åçš„ AbstractAutowireCapableBeanFactory å°±å¯ä»¥å®ç°ç›¸åº”çš„æŠ½è±¡æ–¹æ³•äº†ï¼Œå› ä¸º AbstractAutowireCapableBeanFactory æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ‰€ä»¥å®ƒåªä¼šå®ç°å±äºè‡ªå·±çš„æŠ½è±¡æ–¹æ³•ï¼Œå…¶ä»–æŠ½è±¡æ–¹æ³•ç”±ç»§æ‰¿ AbstractAutowireCapableBeanFactory çš„ç±»å®ç°ã€‚è¿™é‡Œå°±ä½“ç°äº†ç±»å®ç°è¿‡ç¨‹ä¸­çš„å„å¸å…¶èŒï¼Œä½ åªéœ€è¦å…³å¿ƒå±äºä½ çš„å†…å®¹ï¼Œä¸æ˜¯ä½ çš„å†…å®¹ï¼Œä¸è¦å‚ä¸ã€‚"),n("em",null,"è¿™ä¸€éƒ¨åˆ†å†…å®¹æˆ‘ä»¬ä¼šåœ¨ä»£ç é‡Œæœ‰å…·ä½“çš„ä½“ç°")],-1),D=n("li",null,[a("å¦å¤–è¿™é‡Œè¿˜æœ‰å—éå¸¸é‡è¦çš„çŸ¥è¯†ç‚¹ï¼Œå°±æ˜¯å…³äºå•ä¾‹ SingletonBeanRegistry çš„æ¥å£å®šä¹‰å®ç°ï¼Œè€Œ DefaultSingletonBeanRegistry å¯¹æ¥å£å®ç°åï¼Œä¼šè¢«æŠ½è±¡ç±» AbstractBeanFactory ç»§æ‰¿ã€‚ç°åœ¨ AbstractBeanFactory å°±æ˜¯ä¸€ä¸ªéå¸¸å®Œæ•´ä¸”å¼ºå¤§çš„æŠ½è±¡ç±»äº†ï¼Œä¹Ÿèƒ½éå¸¸å¥½çš„ä½“ç°å‡ºå®ƒå¯¹æ¨¡æ¿æ¨¡å¼çš„æŠ½è±¡å®šä¹‰ã€‚"),n("em",null,"æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¸¦ç€è¿™äº›è®¾è®¡å±‚é¢çš„æ€è€ƒï¼Œå»çœ‹ä»£ç çš„å…·ä½“å®ç°ç»“æœ")],-1),S=t(`<h2 id="å››ã€å®ç°" tabindex="-1"><a class="header-anchor" href="#å››ã€å®ç°" aria-hidden="true">#</a> å››ã€å®ç°</h2><h3 id="_1-å·¥ç¨‹ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1-å·¥ç¨‹ç»“æ„" aria-hidden="true">#</a> 1. å·¥ç¨‹ç»“æ„</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>small<span class="token operator">-</span>spring<span class="token operator">-</span>step<span class="token operator">-</span><span class="token number">02</span>
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans
    â”‚           â”œâ”€â”€ factory
    â”‚           â”‚   â”œâ”€â”€ config
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanDefinition</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">SingletonBeanRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanDefinitionRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DefaultListableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">DefaultSingletonBeanRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">BeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â””â”€â”€ <span class="token class-name">BeansException</span><span class="token punctuation">.</span>java
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test
                â”œâ”€â”€ bean
                â”‚   â””â”€â”€ <span class="token class-name">UserService</span><span class="token punctuation">.</span>java
                â””â”€â”€ <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å·¥ç¨‹æºç </strong>ï¼š<code>å…¬ä¼—å·ã€Œbugstackè™«æ´æ ˆã€ï¼Œå›å¤ï¼šSpring ä¸“æ ï¼Œè·å–æºç </code></p><p>Spring Bean å®¹å™¨ç±»å…³ç³»ï¼Œå¦‚å›¾ 3-2</p><p><img src="https://bugstack.cn/assets/images/spring/spring-3-02.png" alt="å›¾ 3-2"></p><p>è™½ç„¶è¿™ä¸€ç« èŠ‚å…³äº Spring Bean å®¹å™¨çš„åŠŸèƒ½å®ç°ä¸ <code>Spring æºç </code>ä¸­è¿˜æœ‰ä¸å°‘çš„å·®è·ï¼Œä½†ä»¥ç›®å‰å®ç°ç»“æœçš„ç±»å…³ç³»å›¾æ¥çœ‹ï¼Œå…¶å®å·²ç»å…·å¤‡äº†ä¸€å®šçš„è®¾è®¡å¤æ‚æ€§ï¼Œè¿™äº›å¤æ‚çš„ç±»å…³ç³»è®¾è®¡åœ¨å„ä¸ªæ¥å£å®šä¹‰å’Œå®ç°ä»¥åŠåœ¨æŠ½è±¡ç±»ç»§æ‰¿ä¸­éƒ½æœ‰æ‰€ä½“ç°ï¼Œä¾‹å¦‚ï¼š</p><ul><li>BeanFactory çš„å®šä¹‰ç”± AbstractBeanFactory æŠ½è±¡ç±»å®ç°æ¥å£çš„ getBean æ–¹æ³•</li><li>è€Œ AbstractBeanFactory åˆç»§æ‰¿äº†å®ç°äº† SingletonBeanRegistry çš„DefaultSingletonBeanRegistry ç±»ã€‚è¿™æ · AbstractBeanFactory æŠ½è±¡ç±»å°±å…·å¤‡äº†å•ä¾‹ Bean çš„æ³¨å†ŒåŠŸèƒ½ã€‚</li><li>AbstractBeanFactory ä¸­åˆå®šä¹‰äº†ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•ï¼šgetBeanDefinition(String beanName)ã€createBean(String beanName, BeanDefinition beanDefinition) ï¼Œè€Œè¿™ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•åˆ†åˆ«ç”± DefaultListableBeanFactoryã€AbstractAutowireCapableBeanFactory å®ç°ã€‚</li><li>æœ€ç»ˆ DefaultListableBeanFactory è¿˜ä¼šç»§æ‰¿æŠ½è±¡ç±» AbstractAutowireCapableBeanFactory ä¹Ÿå°±å¯ä»¥è°ƒç”¨æŠ½è±¡ç±»ä¸­çš„ createBean æ–¹æ³•äº†ã€‚</li></ul><p>ç»¼ä¸Šè¿™ä¸€éƒ¨åˆ†çš„ç±»å…³ç³»å’Œå®ç°è¿‡ç¨‹è¿˜æ˜¯ä¼šæœ‰ä¸€äº›å¤æ‚çš„ï¼Œå› ä¸ºæ‰€æœ‰çš„å®ç°éƒ½ä»¥èŒè´£åˆ’åˆ†ã€å…±æ€§åˆ†ç¦»ä»¥åŠè°ƒç”¨å…³ç³»å®šä¹‰ä¸ºæ ‡å‡†æ­å»ºçš„ç±»å…³ç³»ã€‚<em>è¿™éƒ¨åˆ†å†…å®¹çš„å­¦ä¹ ï¼Œå¯èƒ½ä¼šä¸°å¯Œä½ åœ¨å¤æ‚ä¸šåŠ¡ç³»ç»Ÿå¼€å‘ä¸­çš„è®¾è®¡æ€è·¯ã€‚</em></p><h3 id="_2-beandefinition-å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_2-beandefinition-å®šä¹‰" aria-hidden="true">#</a> 2. BeanDefinition å®šä¹‰</h3><p><strong>cn.bugstack.springframework.beans.factory.config.BeanDefinition</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanDefinition</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Class</span> beanClass<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">BeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">Class</span> beanClass<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>beanClass <span class="token operator">=</span> beanClass<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
		<span class="token comment">// ...get/set</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨ Bean å®šä¹‰ç±»ä¸­å·²ç»æŠŠä¸Šä¸€ç« èŠ‚ä¸­çš„ Object bean æ›¿æ¢ä¸º Classï¼Œè¿™æ ·å°±å¯ä»¥æŠŠ Bean çš„å®ä¾‹åŒ–æ“ä½œæ”¾åˆ°å®¹å™¨ä¸­å¤„ç†äº†ã€‚<em>å¦‚æœä½ æœ‰ä»”ç»†é˜…è¯»è¿‡ä¸Šä¸€ç« å¹¶åšäº†ç›¸åº”çš„æµ‹è¯•ï¼Œé‚£ä¹ˆä½ ä¼šå‘ç° Bean çš„å®ä¾‹åŒ–æ“ä½œæ˜¯æ”¾åœ¨åˆå§‹åŒ–è°ƒç”¨é˜¶æ®µä¼ é€’ç»™ BeanDefinition æ„é€ å‡½æ•°çš„ã€‚</em></li></ul><h3 id="_3-å•ä¾‹æ³¨å†Œæ¥å£å®šä¹‰å’Œå®ç°" tabindex="-1"><a class="header-anchor" href="#_3-å•ä¾‹æ³¨å†Œæ¥å£å®šä¹‰å’Œå®ç°" aria-hidden="true">#</a> 3. å•ä¾‹æ³¨å†Œæ¥å£å®šä¹‰å’Œå®ç°</h3><p><strong>cn.bugstack.springframework.beans.factory.config.SingletonBeanRegistry</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SingletonBeanRegistry</span> <span class="token punctuation">{</span>

    <span class="token class-name">Object</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™ä¸ªç±»æ¯”è¾ƒç®€å•ä¸»è¦æ˜¯å®šä¹‰äº†ä¸€ä¸ªè·å–å•ä¾‹å¯¹è±¡çš„æ¥å£ã€‚</li></ul><p><strong>cn.bugstack.springframework.beans.factory.support.DefaultSingletonBeanRegistry</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultSingletonBeanRegistry</span> <span class="token keyword">implements</span> <span class="token class-name">SingletonBeanRegistry</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> singletonObjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> singletonObjects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">addSingleton</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">Object</span> singletonObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        singletonObjects<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> singletonObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨ DefaultSingletonBeanRegistry ä¸­ä¸»è¦å®ç° getSingleton æ–¹æ³•ï¼ŒåŒæ—¶å®ç°äº†ä¸€ä¸ªå—ä¿æŠ¤çš„ addSingleton æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥è¢«ç»§æ‰¿æ­¤ç±»çš„å…¶ä»–ç±»è°ƒç”¨ã€‚åŒ…æ‹¬ï¼šAbstractBeanFactory ä»¥åŠç»§æ‰¿çš„ DefaultListableBeanFactory è°ƒç”¨ã€‚</li></ul><h3 id="_4-æŠ½è±¡ç±»å®šä¹‰æ¨¡æ¿æ–¹æ³•-abstractbeanfactory" tabindex="-1"><a class="header-anchor" href="#_4-æŠ½è±¡ç±»å®šä¹‰æ¨¡æ¿æ–¹æ³•-abstractbeanfactory" aria-hidden="true">#</a> 4. æŠ½è±¡ç±»å®šä¹‰æ¨¡æ¿æ–¹æ³•(AbstractBeanFactory)</h3><p><strong>cn.bugstack.springframework.beans.factory.support.AbstractBeanFactory</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractBeanFactory</span> <span class="token keyword">extends</span> <span class="token class-name">DefaultSingletonBeanRegistry</span> <span class="token keyword">implements</span> <span class="token class-name">BeanFactory</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> bean <span class="token operator">=</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">BeanDefinition</span> beanDefinition <span class="token operator">=</span> <span class="token function">getBeanDefinition</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">createBean</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token class-name">BeanDefinition</span> <span class="token function">getBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token class-name">Object</span> <span class="token function">createBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>AbstractBeanFactory é¦–å…ˆç»§æ‰¿äº† DefaultSingletonBeanRegistryï¼Œä¹Ÿå°±å…·å¤‡äº†ä½¿ç”¨å•ä¾‹æ³¨å†Œç±»æ–¹æ³•ã€‚</li><li>æ¥ä¸‹æ¥å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯å…³äºæ¥å£ BeanFactory çš„å®ç°ï¼Œåœ¨æ–¹æ³• getBean çš„å®ç°è¿‡ç¨‹ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸»è¦æ˜¯å¯¹å•ä¾‹ Bean å¯¹è±¡çš„è·å–ä»¥åŠåœ¨è·å–ä¸åˆ°æ—¶éœ€è¦æ‹¿åˆ° Bean çš„å®šä¹‰åšç›¸åº” Bean å®ä¾‹åŒ–æ“ä½œã€‚é‚£ä¹ˆ getBean å¹¶æ²¡æœ‰è‡ªèº«çš„å»å®ç°è¿™äº›æ–¹æ³•ï¼Œè€Œæ˜¯åªå®šä¹‰äº†è°ƒç”¨è¿‡ç¨‹ä»¥åŠæä¾›äº†æŠ½è±¡æ–¹æ³•ï¼Œç”±å®ç°æ­¤æŠ½è±¡ç±»çš„å…¶ä»–ç±»åšç›¸åº”å®ç°ã€‚</li><li>åç»­ç»§æ‰¿æŠ½è±¡ç±» AbstractBeanFactory çš„ç±»æœ‰ä¸¤ä¸ªï¼ŒåŒ…æ‹¬ï¼šAbstractAutowireCapableBeanFactoryã€DefaultListableBeanFactoryï¼Œè¿™ä¸¤ä¸ªç±»åˆ†åˆ«åšäº†ç›¸åº”çš„å®ç°å¤„ç†ï¼Œæ¥ç€å¾€ä¸‹çœ‹ã€‚</li></ul><h3 id="_5-å®ä¾‹åŒ–beanç±»-abstractautowirecapablebeanfactory" tabindex="-1"><a class="header-anchor" href="#_5-å®ä¾‹åŒ–beanç±»-abstractautowirecapablebeanfactory" aria-hidden="true">#</a> 5. å®ä¾‹åŒ–Beanç±»(AbstractAutowireCapableBeanFactory)</h3><p><strong>cn.bugstack.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractAutowireCapableBeanFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractBeanFactory</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">createBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> bean <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            bean <span class="token operator">=</span> beanDefinition<span class="token punctuation">.</span><span class="token function">getBeanClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InstantiationException</span> <span class="token operator">|</span> <span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeansException</span><span class="token punctuation">(</span><span class="token string">&quot;Instantiation of bean failed&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">addSingleton</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨ AbstractAutowireCapableBeanFactory ç±»ä¸­å®ç°äº† Bean çš„å®ä¾‹åŒ–æ“ä½œ <code>newInstance</code>ï¼Œå…¶å®è¿™å—ä¼šåŸ‹ä¸‹ä¸€ä¸ªå‘ï¼Œæœ‰æ„é€ å‡½æ•°å…¥å‚çš„å¯¹è±¡æ€ä¹ˆå¤„ç†ï¼Ÿ<em>å¯ä»¥æå‰æ€è€ƒ</em></li><li>åœ¨å¤„ç†å®Œ Bean å¯¹è±¡çš„å®ä¾‹åŒ–åï¼Œç›´æ¥è°ƒç”¨ <code>addSingleton</code> æ–¹æ³•å­˜æ”¾åˆ°å•ä¾‹å¯¹è±¡çš„ç¼“å­˜ä¸­å»ã€‚</li></ul><h3 id="_6-æ ¸å¿ƒç±»å®ç°-defaultlistablebeanfactory" tabindex="-1"><a class="header-anchor" href="#_6-æ ¸å¿ƒç±»å®ç°-defaultlistablebeanfactory" aria-hidden="true">#</a> 6. æ ¸å¿ƒç±»å®ç°(DefaultListableBeanFactory)</h3><p><strong>cn.bugstack.springframework.beans.factory.support.DefaultListableBeanFactory</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultListableBeanFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAutowireCapableBeanFactory</span> <span class="token keyword">implements</span> <span class="token class-name">BeanDefinitionRegistry</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span><span class="token punctuation">&gt;</span></span> beanDefinitionMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        beanDefinitionMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">BeanDefinition</span> <span class="token function">getBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token class-name">BeanDefinition</span> beanDefinition <span class="token operator">=</span> beanDefinitionMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>beanDefinition <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeansException</span><span class="token punctuation">(</span><span class="token string">&quot;No bean named &#39;&quot;</span> <span class="token operator">+</span> beanName <span class="token operator">+</span> <span class="token string">&quot;&#39; is defined&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> beanDefinition<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>DefaultListableBeanFactory åœ¨ Spring æºç ä¸­ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„ç±»ï¼Œåœ¨æˆ‘ä»¬ç›®å‰çš„å®ç°ä¸­ä¹Ÿæ˜¯é€æ­¥è´´è¿‘äºæºç ï¼Œä¸æºç ç±»åä¿æŒä¸€è‡´ã€‚</li><li>DefaultListableBeanFactory ç»§æ‰¿äº† AbstractAutowireCapableBeanFactory ç±»ï¼Œä¹Ÿå°±å…·å¤‡äº†æ¥å£ BeanFactory å’Œ AbstractBeanFactory ç­‰ä¸€è¿ä¸²çš„åŠŸèƒ½å®ç°ã€‚<em>æ‰€ä»¥æœ‰æ—¶å€™ä½ ä¼šçœ‹åˆ°ä¸€äº›ç±»çš„å¼ºè½¬ï¼Œè°ƒç”¨æŸäº›æ–¹æ³•ï¼Œä¹Ÿæ˜¯å› ä¸ºä½ å¼ºè½¬çš„ç±»å®ç°æ¥å£æˆ–ç»§æ‰¿äº†æŸäº›ç±»ã€‚</em></li><li>é™¤æ­¤ä¹‹å¤–è¿™ä¸ªç±»è¿˜å®ç°äº†æ¥å£ BeanDefinitionRegistry ä¸­çš„ registerBeanDefinition(String beanName, BeanDefinition beanDefinition) æ–¹æ³•ï¼Œå½“ç„¶ä½ è¿˜ä¼šçœ‹åˆ°ä¸€ä¸ª getBeanDefinition çš„å®ç°ï¼Œè¿™ä¸ªæ–¹æ³•æˆ‘ä»¬æ–‡ä¸­æåˆ°è¿‡å®ƒæ˜¯æŠ½è±¡ç±» AbstractBeanFactory ä¸­å®šä¹‰çš„æŠ½è±¡æ–¹æ³•ã€‚<em>ç°åœ¨æ³¨å†ŒBeanå®šä¹‰ä¸è·å–Beanå®šä¹‰å°±å¯ä»¥åŒæ—¶ä½¿ç”¨äº†ï¼Œæ˜¯ä¸æ„Ÿè§‰è¿™ä¸ªå¥—è·¯è¿˜è›®æ·±çš„ã€‚æ¥å£å®šä¹‰äº†æ³¨å†Œï¼ŒæŠ½è±¡ç±»å®šä¹‰äº†è·å–ï¼Œéƒ½é›†ä¸­åœ¨ DefaultListableBeanFactory ä¸­çš„ beanDefinitionMap é‡Œ</em></li></ul><h2 id="äº”ã€æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#äº”ã€æµ‹è¯•" aria-hidden="true">#</a> äº”ã€æµ‹è¯•</h2><h3 id="_1-äº‹å…ˆå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#_1-äº‹å…ˆå‡†å¤‡" aria-hidden="true">#</a> 1. äº‹å…ˆå‡†å¤‡</h3><p><strong>cn.bugstack.springframework.test.bean.UserService</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">queryUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™é‡Œç®€å•å®šä¹‰äº†ä¸€ä¸ª UserService å¯¹è±¡ï¼Œæ–¹ä¾¿æˆ‘ä»¬åç»­å¯¹ Spring å®¹å™¨æµ‹è¯•ã€‚</li></ul><h3 id="_2-æµ‹è¯•ç”¨ä¾‹" tabindex="-1"><a class="header-anchor" href="#_2-æµ‹è¯•ç”¨ä¾‹" aria-hidden="true">#</a> 2. æµ‹è¯•ç”¨ä¾‹</h3><p><strong>cn.bugstack.springframework.test.ApiTest</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_BeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 1.åˆå§‹åŒ– BeanFactory</span>
    <span class="token class-name">DefaultListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultListableBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.æ³¨å†Œ bean</span>
    <span class="token class-name">BeanDefinition</span> beanDefinition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3.ç¬¬ä¸€æ¬¡è·å– bean</span>
    <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span> beanFactory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userService<span class="token punctuation">.</span><span class="token function">queryUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 4.ç¬¬äºŒæ¬¡è·å– bean from Singleton</span>
    <span class="token class-name">UserService</span> userService_singleton <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span> beanFactory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userService_singleton<span class="token punctuation">.</span><span class="token function">queryUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨æ­¤æ¬¡çš„å•å…ƒæµ‹è¯•ä¸­é™¤äº†åŒ…æ‹¬ï¼›Bean å·¥å‚ã€æ³¨å†Œ Beanã€è·å– Beanï¼Œä¸‰ä¸ªæ­¥éª¤ï¼Œè¿˜é¢å¤–å¢åŠ äº†ä¸€æ¬¡å¯¹è±¡çš„è·å–å’Œè°ƒç”¨ã€‚è¿™é‡Œä¸»è¦æµ‹è¯•éªŒè¯å•ä¾‹å¯¹è±¡çš„æ˜¯å¦æ­£ç¡®çš„å­˜æ”¾åˆ°äº†ç¼“å­˜ä¸­ã€‚</li><li>æ­¤å¤–ä¸ä¸Šä¸€ç« èŠ‚æµ‹è¯•è¿‡ç¨‹ä¸­ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬æŠŠ UserService.class ä¼ é€’ç»™äº† BeanDefinition è€Œä¸æ˜¯åƒä¸Šä¸€ç« èŠ‚é‚£æ ·ç›´æ¥ new UserService() æ“ä½œã€‚</li></ul><h3 id="_3-æµ‹è¯•ç»“æœ" tabindex="-1"><a class="header-anchor" href="#_3-æµ‹è¯•ç»“æœ" aria-hidden="true">#</a> 3. æµ‹è¯•ç»“æœ</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™é‡Œä¼šæœ‰ä¸¤æ¬¡æµ‹è¯•ä¿¡æ¯ï¼Œä¸€æ¬¡æ˜¯è·å– Bean æ—¶ç›´æ¥åˆ›å»ºçš„å¯¹è±¡ï¼Œå¦å¤–ä¸€æ¬¡æ˜¯ä»ç¼“å­˜ä¸­è·å–çš„å®ä¾‹åŒ–å¯¹è±¡ã€‚</li><li>æ­¤å¤–ä»è°ƒè¯•çš„æˆªå›¾ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ç¬¬äºŒæ¬¡è·å–å•ä¾‹å¯¹è±¡ï¼Œå·²ç»å¯ä»¥ä»å†…å­˜ä¸­è·å–äº†ï¼Œå¦‚å›¾ 3-3 <img src="https://bugstack.cn/assets/images/spring/spring-3-03.png" alt="å›¾ 3-3"></li><li>åˆ°è¿™æœ¬ç« èŠ‚çš„åŠŸèƒ½å®ç°å’Œæµ‹è¯•éªŒè¯å°±å®Œæˆäº†ï¼Œå…³äºæµ‹è¯•è¿‡ç¨‹ä¸­å¯ä»¥å†å»æ–­ç‚¹è°ƒè¯•ä¸‹å„ä¸ªé˜¶æ®µç±»çš„è°ƒç”¨ï¼Œç†Ÿæ‚‰è°ƒç”¨å…³ç³»ã€‚</li></ul><h2 id="å…­ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#å…­ã€æ€»ç»“" aria-hidden="true">#</a> å…­ã€æ€»ç»“</h2><ul><li>ç›¸å¯¹äºå‰ä¸€ç« èŠ‚å¯¹ Spring Bean å®¹å™¨çš„ç®€å•æ¦‚å¿µå®ç°ï¼Œæœ¬ç« èŠ‚ä¸­åŠ å¼ºäº†åŠŸèƒ½çš„å®Œå–„ã€‚åœ¨å®ç°çš„è¿‡ç¨‹ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ç±»çš„å…³ç³»å˜å¾—è¶Šæ¥è¶Šå¤šäº†ï¼Œå¦‚æœæ²¡æœ‰åšè¿‡ä¸€äº›ç¨å¾®å¤æ‚çš„ç³»ç»Ÿç±»ç³»ç»Ÿï¼Œé‚£ä¹ˆå³ä½¿ç°åœ¨è¿™æ ·9ä¸ªç±»æ­å‡ºæ¥çš„å®¹å™¨å·¥å‚ä¹Ÿå¯ä»¥ç»™ä½ ç»•æ™•ã€‚</li><li>åœ¨ Spring Bean å®¹å™¨çš„å®ç°ç±»ä¸­è¦é‡ç‚¹å…³æ³¨ç±»ä¹‹é—´çš„èŒè´£å’Œå…³ç³»ï¼Œå‡ ä¹æ‰€æœ‰çš„ç¨‹åºåŠŸèƒ½è®¾è®¡éƒ½ç¦»ä¸å¼€æ¥å£ã€æŠ½è±¡ç±»ã€å®ç°ã€ç»§æ‰¿ï¼Œè€Œè¿™äº›ä¸åŒç‰¹æ€§ç±»çš„ä½¿ç”¨å°±å¯ä»¥éå¸¸å¥½çš„éš”ç¦»å¼€ç±»çš„åŠŸèƒ½èŒè´£å’Œä½œç”¨èŒƒå›´ã€‚è€Œè¿™æ ·çš„çŸ¥è¯†ç‚¹ä¹Ÿæ˜¯åœ¨å­¦ä¹ æ‰‹å†™ Spring Bean å®¹å™¨æ¡†æ¶è¿‡ç¨‹éå¸¸é‡è¦çš„çŸ¥è¯†ã€‚</li><li>æœ€åè¦å¼ºè°ƒä¸€ä¸‹å…³äºæ•´ä¸ªç³»åˆ—å†…å®¹çš„å­¦ä¹ ï¼Œå¯èƒ½åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ä¼šé‡åˆ°åƒç¬¬äºŒç« èŠ‚é‚£æ ·éå¸¸ç®€å•çš„ä»£ç å®ç°ï¼Œä½†è¦åšä¸€ä¸ªæœ‰æˆé•¿çš„ç¨‹åºå‘˜è¦è®°ä½ä»£ç å®ç°åªæ˜¯æœ€åçš„è½åœ°ç»“æœï¼Œè€Œé‚£äº›è®¾è®¡ä¸Šçš„æ€è€ƒæ‰æ˜¯æœ€æœ‰ä»·å€¼çš„åœ°æ–¹ã€‚<em>å°±åƒä½ æ˜¯å¦é‡åˆ°è¿‡ï¼Œæœ‰äººè®©ä½ ç»™ä¸€ä¸ªå†…å®¹åšä¸ªæè¿°ã€æ–‡æ¡£ã€è¯´æ˜ï¼Œä½ æ€»è§‰å¾—å¤ªç®€å•äº†æ²¡ä»€ä¹ˆå¯å†™çš„ï¼Œå³ä½¿è¦åŠ¨ç¬”å†™äº†ä¹Ÿä¸çŸ¥é“è¦ä»å“ªå¼€å§‹ï¼å…¶å®è¿™äº›çŸ¥è¯†å†…å®¹éƒ½æ¥æºä½ å¯¹æ•´ä½“åŠŸèƒ½çš„ç†è§£ï¼Œè¿™å°±ä¸åªæ˜¯ä»£ç å¼€å‘è¿˜åŒ…æ‹¬äº†éœ€æ±‚ç›®æ ‡ã€æ–¹æ¡ˆè®¾è®¡ã€æŠ€æœ¯å®ç°ã€é€»è¾‘éªŒè¯ç­‰ç­‰è¿‡ç¨‹æ€§çš„å†…å®¹ã€‚æ‰€ä»¥ï¼Œä¸è¦åªæ˜¯è¢«çœ‹ä¼¼ç®€å•çš„å†…å®¹å¿½ç•¥äº†æ•´ä½“å…¨å±€è§‚ï¼Œè¦å­¦ä¼šæ”¾å¼€è§†é‡ï¼Œå¼€æ”¾å­¦ä¹ è§†è§’ã€‚</em></li></ul><h2 id="ä¸ƒã€ä¼˜ç§€ä½œä¸š" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€ä¼˜ç§€ä½œä¸š" aria-hidden="true">#</a> ä¸ƒã€ä¼˜ç§€ä½œä¸š</h2>`,47),A={href:"https://t.zsxq.com/06Q3V7mUR",target:"_blank",rel:"noopener noreferrer"},x={href:"https://t.zsxq.com/07Tyh8oBa",target:"_blank",rel:"noopener noreferrer"},F={href:"https://t.zsxq.com/07DNokn9Z",target:"_blank",rel:"noopener noreferrer"},j={href:"https://t.zsxq.com/07gFfvoRj",target:"_blank",rel:"noopener noreferrer"},E={href:"https://t.zsxq.com/07dQcfDAo",target:"_blank",rel:"noopener noreferrer"},C={href:"https://t.zsxq.com/08hhLXE5u",target:"_blank",rel:"noopener noreferrer"},q={href:"https://t.zsxq.com/08vZHndzD",target:"_blank",rel:"noopener noreferrer"},N={href:"https://t.zsxq.com/08KzGmGk7",target:"_blank",rel:"noopener noreferrer"},O={href:"https://t.zsxq.com/08Cv9nNPD",target:"_blank",rel:"noopener noreferrer"},z={href:"https://t.zsxq.com/08NJPZUbj",target:"_blank",rel:"noopener noreferrer"},R={href:"https://t.zsxq.com/09wzj469l",target:"_blank",rel:"noopener noreferrer"},L={href:"https://t.zsxq.com/09pJ2M1SU",target:"_blank",rel:"noopener noreferrer"},U={href:"https://t.zsxq.com/09HXnxvOO",target:"_blank",rel:"noopener noreferrer"},M={href:"https://t.zsxq.com/0a9YBNMl8",target:"_blank",rel:"noopener noreferrer"};function I(H,Q){const s=i("ExternalLinkIcon");return c(),o("div",null,[r,n("p",null,[a("ä½œè€…ï¼šå°å‚…å“¥ "),u,a("åšå®¢ï¼š"),n("a",d,[a("https://bugstack.cn"),e(s)]),k,a("åŸæ–‡ï¼š"),n("a",b,[a("https://mp.weixin.qq.com/s/CgvQzm8B-CvQvXdxONC-lA"),e(s)])]),v,n("p",null,[a("åœ¨ä¸Šä¸€ç« èŠ‚ "),n("a",m,[a("ã€Šå°è¯•ç‰›åˆ€ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„Beanå®¹å™¨ã€‹"),e(s)]),a(" æˆ‘ä»¬åˆæ­¥ä¾ç…§ Spring Bean å®¹å™¨çš„æ¦‚å¿µï¼Œå®ç°äº†ä¸€ä¸ªç²—ç³™ç‰ˆæœ¬çš„ä»£ç å®ç°ã€‚é‚£ä¹ˆæœ¬ç« èŠ‚æˆ‘ä»¬éœ€è¦ç»“åˆå·²å®ç°çš„ Spring Bean å®¹å™¨è¿›è¡ŒåŠŸèƒ½å®Œå–„ï¼Œå®ç° Bean å®¹å™¨å…³äº Bean å¯¹è±¡çš„æ³¨å†Œå’Œè·å–ã€‚")]),g,h,f,B,n("ul",null,[n("li",null,[a("é¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰ BeanFactory è¿™æ ·ä¸€ä¸ª Bean å·¥å‚ï¼Œæä¾› Bean çš„è·å–æ–¹æ³• "),y,a("ï¼Œä¹‹åè¿™ä¸ª Bean å·¥å‚æ¥å£ç”±æŠ½è±¡ç±» AbstractBeanFactory å®ç°ã€‚è¿™æ ·ä½¿ç”¨"),n("a",_,[a("æ¨¡æ¿æ¨¡å¼"),e(s)]),a("çš„è®¾è®¡æ–¹å¼ï¼Œå¯ä»¥ç»Ÿä¸€æ”¶å£é€šç”¨æ ¸å¿ƒæ–¹æ³•çš„è°ƒç”¨é€»è¾‘å’Œæ ‡å‡†å®šä¹‰ï¼Œä¹Ÿå°±å¾ˆå¥½çš„æ§åˆ¶äº†åç»­çš„å®ç°è€…ä¸ç”¨å…³å¿ƒè°ƒç”¨é€»è¾‘ï¼ŒæŒ‰ç…§ç»Ÿä¸€æ–¹å¼æ‰§è¡Œã€‚é‚£ä¹ˆç±»çš„ç»§æ‰¿è€…åªéœ€è¦å…³å¿ƒå…·ä½“æ–¹æ³•çš„é€»è¾‘å®ç°å³å¯ã€‚")]),w,D]),S,n("ul",null,[n("li",null,[n("a",A,[a("åˆ›å»ºç®€å•çš„Beanå®¹å™¨ @liuc"),e(s)])]),n("li",null,[n("a",x,[a("åˆ›å»ºæœ€åŸºæœ¬çš„å®¹å™¨ï¼Œå¹¶å®ç°Beançš„å®šä¹‰ï¼Œæ³¨å†Œä»¥åŠä½¿ç”¨ @Homage"),e(s)])]),n("li",null,[n("a",F,[a("æ‰‹æ’¸Springç¬¬ä¸‰ç« ï¼Œå®ç° Bean çš„å®šä¹‰ã€æ³¨å†Œã€è·å– @å‚…å“¥åæ´ä¼šä¼šé•¿"),e(s)])]),n("li",null,[n("a",j,[a("å®ç° Bean çš„å®šä¹‰ã€æ³¨å†Œã€è·å– @åˆ˜å°ç™½"),e(s)])]),n("li",null,[n("a",E,[a("springå®¹å™¨ï¼Œæ»¡è¶³beanæ³¨å†Œå’Œå–å‡ºçš„ä¸€ç§æ•°æ®ç»“æ„ï¼ˆhashmapï¼‰@è½»èˆŸæ•…äºº"),e(s)])]),n("li",null,[n("a",C,[a("å¯¹äºä¸ºä»€ä¹ˆä¼šæœ‰æŸä¸ªç±», æŸä¸ªæ¥å£è¿˜æ˜¯æœ‰ç‚¹è¿·ç³Š, é˜…è¯»äº†ä¸€ä¸‹ Spring å…³äºè¿™äº›ç±»çš„æ³¨é‡Š @å°ç”°è¦åŠªåŠ›"),e(s)])]),n("li",null,[n("a",q,[a("è€ƒè™‘å•ä¾‹ï¼ŒäºŒæ¬¡è·å–ç›´æ¥ä»å†…å­˜è·å– @æ°´ä¸­ææœˆ"),e(s)])]),n("li",null,[n("a",N,[a("åŸºäºCglibå®ç°æ„é€ å‡½æ•°çš„ç±»å®ä¾‹åŒ–ç­–ç•¥ã€ä¸Šæ‰‹æ˜¯æœ€å¿«çš„å­¦ä¹ æ–¹å¼ã€‘@å¾®é£"),e(s)])]),n("li",null,[n("a",O,[a("å­¦ä¹ äº†é€šè¿‡æ¨¡æ¿æ¨¡å¼å»å®šä¹‰Beançš„æ³¨å†Œä¸è·å–ç­–ç•¥ @åé‡Œå¹³æ¹–éœœæ»¡å¤©"),e(s)])]),n("li",null,[n("a",z,[a("å› ç¬¬äºŒç« å®ç°æ²¡è€ƒè™‘åˆ°æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œå¦‚å¸¦å‚åˆ™ä¼šæŠ¥é”™ã€‚è¿™ç« ä¸»è¦è§£å†³å¸¦å‚æ•°çš„å®ä¾‹åŒ–å¯¹è±¡åˆ›å»º @åˆ˜æºœæºœ"),e(s)])]),n("li",null,[n("a",R,[a("å¢åŠ äº†ç­–ç•¥æ¨¡å¼ï¼Œåœ¨åˆ›å»ºå¯¹è±¡æ—¶å€™æ ¹æ®ä¼ å…¥çš„å‚æ•°é€‰æ‹©æ„é€ å‡½æ•°é»˜è®¤ä½¿ç”¨Cglibçš„æ–¹å¼åˆ›å»ºå¯¹è±¡ @Liuliuliu"),e(s)])]),n("li",null,[n("a",L,[a("ç»“åˆå·¥ç¨‹ç»“æ„å’Œç»™å‡ºçš„ç±»å›¾è¿›è¡Œæ¢³ç†ç»“æ„ï¼Œç„¶åæ ¹æ®ç»“æ„é¡ºåºåˆ›å»ºç©ºç™½ç±» @åœ¨ä¹æœˆ"),e(s)])]),n("li",null,[n("a",U,[a("Beançš„å®šä¹‰ä¿¡æ¯ï¼Œspringå°±æ˜¯æ ¹æ®BeanDefinitonåˆ›å»ºBeanå¯¹è±¡ @æ­¢æ°´"),e(s)])]),n("li",null,[n("a",M,[a("å®ç°çš„ BeanFactory å°±æ˜¯ä½¿ç”¨ ConcurrentHashMap ç®€å•çš„æ³¨å†Œ bean @ææ˜Œç¥¥"),e(s)])])])])}const V=p(l,[["render",I],["__file","2021-05-23-di3zhangï¼šchuxianshenshouï¼Œyunyongshejimoshiï¼Œshixian Bean dedingyiã€zhuceã€huoqu.html.vue"]]);export{V as default};
