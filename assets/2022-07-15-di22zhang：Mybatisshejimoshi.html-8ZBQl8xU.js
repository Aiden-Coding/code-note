import{_ as e,r as c,o,c as l,a as n,b as s,d as t,e as p}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"ã€ç•ªå¤–ã€‘ç¬¬22ç« -mybatis-æ¡†æ¶æºç 10ç§è®¾è®¡æ¨¡å¼åˆ†æ",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ã€ç•ªå¤–ã€‘ç¬¬22ç« -mybatis-æ¡†æ¶æºç 10ç§è®¾è®¡æ¨¡å¼åˆ†æ","aria-hidden":"true"},"#"),s(" ã€ç•ªå¤–ã€‘ç¬¬22ç« ï¼šMybatis æ¡†æ¶æºç 10ç§è®¾è®¡æ¨¡å¼åˆ†æ")],-1),k=n("br",null,null,-1),r={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=p('<blockquote><p>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„</p></blockquote><h2 id="ä¸€ã€å‰è¨€-å°é•‡å·ç å®¶" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‰è¨€-å°é•‡å·ç å®¶" aria-hidden="true">#</a> ä¸€ã€å‰è¨€ï¼šå°é•‡å·ç å®¶</h2><p>æ€»æœ‰ä¸å°‘ç ”å‘ä¼™ä¼´é—®å°å‚…å“¥ï¼šâ€œä¸ºä»€ä¹ˆå­¦è®¾è®¡æ¨¡å¼ã€çœ‹æ¡†æ¶æºç ã€è¡¥æŠ€æœ¯çŸ¥è¯†ï¼Œå°±ä¸€ä¸ªæ™®é€šçš„ä¸šåŠ¡é¡¹ç›®ï¼Œä¼šé€ é£æœºä¸ä¹Ÿæ˜¯å¤©å¤©å†™CRUDå—ï¼Ÿâ€</p><p>ä½ è¯´çš„æ²¡é”™ï¼Œä½†ä½ å¤©å¤©å†™CRUDï¼Œä½ è§‰å¾— <strong>çƒ¦ä¸ï¼Ÿ</strong> <strong>æ…Œä¸ï¼Ÿ</strong> æ˜¯ä¸æ˜¯æ—¢æ‹…å¿ƒè‡ªå·±æ²¡æœ‰å¾—åˆ°æŠ€æœ¯æˆé•¿ï¼Œä¹Ÿå®³æ€•å°†æ¥æ²¡æ³•ç”¨è¿™äº›éƒ½æ˜¯CRUDçš„é¡¹ç›®å»å‚åŠ ï¼›è¿°èŒã€æ™‹å‡ã€ç­”è¾©ï¼Œç”šè‡³å¯èƒ½è¦è¢«è¿«é¢è¯•æ—¶ï¼Œè‡ªå·±æ‰‹é‡Œä¸€ç‚¹å¹²è´§ä¹Ÿæ²¡æœ‰çš„æƒ…å†µã€‚</p><p>æ‰€ä»¥ä½ /æˆ‘ä½œä¸ºä¸€ä¸ª<strong>å°é•‡å·ç å®¶</strong>ï¼Œå½“ç„¶è¦æ‰©å……è‡ªå·±çš„çŸ¥è¯†å‚¨å¤‡ï¼Œå¦åˆ™<code>æ¶æ„ï¼Œæ¶æ„æ€ç»´ä¸æ‡‚</code>ã€<code>è®¾è®¡ï¼Œè®¾è®¡æ¨¡å¼ä¸ä¼š</code>ã€<code>æºç ã€æºç å­¦ä¹ ä¸æ·±</code>ï¼Œæœ€åå°±ç”¨ä¸€å †CRUDå†™ç®€å†å—ï¼Ÿ</p><h2 id="äºŒã€æºç -å­¦è®¾è®¡æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#äºŒã€æºç -å­¦è®¾è®¡æ¨¡å¼" aria-hidden="true">#</a> äºŒã€æºç ï¼šå­¦è®¾è®¡æ¨¡å¼</h2><p>åœ¨ Mybatis ä¸¤ä¸‡å¤šè¡Œçš„æ¡†æ¶æºç å®ç°ä¸­ï¼Œä½¿ç”¨äº†å¤§é‡çš„è®¾è®¡æ¨¡å¼æ¥è§£è€¦å·¥ç¨‹æ¶æ„ä¸­é¢å¯¹å¤æ‚åœºæ™¯çš„è®¾è®¡ï¼Œè¿™äº›æ˜¯è®¾è®¡æ¨¡å¼çš„å·§å¦™ä½¿ç”¨æ‰æ˜¯æ•´ä¸ªæ¡†æ¶çš„ç²¾åï¼Œ<strong>è¿™ä¹Ÿæ˜¯å°å‚…å“¥å–œæ¬¢å·æºç çš„é‡è¦åŸå› </strong>ã€‚ç»è¿‡å°å‚…å“¥çš„æ•´ç†æœ‰å¦‚ä¸‹10ç§è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨ï¼Œå¦‚å›¾æ‰€ç¤º</p><p><img src="https://bugstack.cn/images/article/spring/mybatis-220715-01.png" alt="Mybatis æ¡†æ¶æºç 10ç§è®¾è®¡æ¨¡å¼"></p><p>è®²é“ç†ï¼Œå¦‚æœåªæ˜¯æŠŠè¿™10ç§è®¾è®¡æ¨¡å¼èƒŒä¸‹æ¥ï¼Œç­‰ç€ä¸‹æ¬¡é¢è¯•çš„æ—¶å€™æ‹¿å‡ºæ¥è¯´ä¸€è¯´ï¼Œè™½ç„¶èƒ½æœ‰ç‚¹å¸®åŠ©ï¼Œä¸è¿‡è¿™ç§å­¦ä¹ æ–¹å¼å°±çœŸçš„ç®—æ˜¯æŠŠè·¯èµ°çª„äº†ã€‚å°±åƒä½ æ¯è¯´ä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼Œèƒ½è”æƒ³åˆ°è¿™ä¸ªè®¾è®¡æ¨¡å¼åœ¨Mybatisçš„æ¡†æ¶ä¸­ï¼Œä½“ç°åˆ°å“ªä¸ªæµç¨‹ä¸­çš„æºç å®ç°ä¸Šäº†å—ï¼Ÿè¿™ä¸ªæºç å®ç°çš„æ€è·¯èƒ½ä¸èƒ½ç”¨åˆ°ä½ çš„ä¸šåŠ¡æµç¨‹å¼€å‘é‡Œï¼Ÿ<strong>åˆ«æ€»è¯´ä½ çš„æµç¨‹ç®€å•ï¼Œç”¨ä¸ä¸Šè®¾è®¡æ¨¡å¼ï¼éš¾åˆ°å› ä¸ºæœ‰é’±ã€å¯ŒäºŒä»£ï¼Œå°±ä¸è€ƒè¯•å—ï¼ŸğŸ¤”</strong></p>',9),m={href:"https://gitcode.net/KnowledgePlanet/doc/-/wikis/home",target:"_blank",rel:"noopener noreferrer"},v=n("li",null,[s("å­¦ä¹ æ‰‹å†Œï¼š"),n("code",null,"å…³æ³¨å…¬ä¼—å·ã€bugstackè™«æ´æ ˆã€‘å›å¤ã€Mybatisã€‘")],-1),b={href:"https://gitcode.net/KnowledgePlanet/doc/-/wikis/home",target:"_blank",rel:"noopener noreferrer"},g=p(`<h2 id="ä¸‰ã€ç±»å‹-åˆ›å»ºå‹æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€ç±»å‹-åˆ›å»ºå‹æ¨¡å¼" aria-hidden="true">#</a> ä¸‰ã€ç±»å‹ï¼šåˆ›å»ºå‹æ¨¡å¼</h2><h3 id="_1-å·¥å‚æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_1-å·¥å‚æ¨¡å¼" aria-hidden="true">#</a> 1. å·¥å‚æ¨¡å¼</h3><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.session.SqlSessionFactory</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SqlSessionFactory</span> <span class="token punctuation">{</span>

   <span class="token class-name">SqlSession</span> <span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.session.defaults.DefaultSqlSessionFactory</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultSqlSessionFactory</span> <span class="token keyword">implements</span> <span class="token class-name">SqlSessionFactory</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Configuration</span> configuration<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DefaultSqlSessionFactory</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> configuration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>configuration <span class="token operator">=</span> configuration<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SqlSession</span> <span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Transaction</span> tx <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token class-name">Environment</span> environment <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">TransactionFactory</span> transactionFactory <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getTransactionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            tx <span class="token operator">=</span> transactionFactory<span class="token punctuation">.</span><span class="token function">newTransaction</span><span class="token punctuation">(</span>configuration<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">TransactionIsolationLevel</span><span class="token punctuation">.</span><span class="token constant">READ_COMMITTED</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// åˆ›å»ºæ‰§è¡Œå™¨</span>
            <span class="token keyword">final</span> <span class="token class-name">Executor</span> executor <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">newExecutor</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// åˆ›å»ºDefaultSqlSession</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultSqlSession</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">assert</span> tx <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                tx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> ignore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Error opening session.  Cause: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/images/article/spring/mybatis-220715-02.png" alt="Mybatis å·¥å‚æ¨¡å¼"></p><ul><li><strong>å·¥å‚æ¨¡å¼</strong>ï¼šç®€å•å·¥å‚ï¼Œæ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå…¶åœ¨çˆ¶ç±»ä¸­æä¾›ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ–¹æ³•ï¼Œå…è®¸å­ç±»å†³å®šå®ä¾‹å¯¹è±¡çš„ç±»å‹ã€‚</li><li><strong>åœºæ™¯ä»‹ç»</strong>ï¼š<code>SqlSessionFactory</code> æ˜¯è·å–ä¼šè¯çš„å·¥å‚ï¼Œæ¯æ¬¡æˆ‘ä»¬ä½¿ç”¨ Mybatis æ“ä½œæ•°æ®åº“çš„æ—¶å€™ï¼Œéƒ½ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„ä¼šè¯ã€‚åœ¨ä¼šè¯å·¥å‚çš„å®ç°ä¸­è´Ÿè´£è·å–æ•°æ®æºç¯å¢ƒé…ç½®ä¿¡æ¯ã€æ„å»ºäº‹åŠ¡å·¥å‚ã€åˆ›å»ºæ“ä½œSQLçš„æ‰§è¡Œå™¨ï¼Œå¹¶æœ€ç»ˆè¿”å›ä¼šè¯å®ç°ç±»ã€‚</li><li><strong>åŒç±»è®¾è®¡</strong>ï¼š<code>SqlSessionFactory</code>ã€<code>ObjectFactory</code>ã€<code>MapperProxyFactory</code>ã€<code>DataSourceFactory</code></li></ul><h3 id="_2-å•ä¾‹æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_2-å•ä¾‹æ¨¡å¼" aria-hidden="true">#</a> 2. å•ä¾‹æ¨¡å¼</h3><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.session.Configuration</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Configuration</span> <span class="token punctuation">{</span>

    <span class="token comment">// ç¼“å­˜æœºåˆ¶ï¼Œé»˜è®¤ä¸é…ç½®çš„æƒ…å†µæ˜¯ SESSION</span>
    <span class="token keyword">protected</span> <span class="token class-name">LocalCacheScope</span> localCacheScope <span class="token operator">=</span> <span class="token class-name">LocalCacheScope</span><span class="token punctuation">.</span><span class="token constant">SESSION</span><span class="token punctuation">;</span>

    <span class="token comment">// æ˜ å°„æ³¨å†Œæœº</span>
    <span class="token keyword">protected</span> <span class="token class-name">MapperRegistry</span> mapperRegistry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MapperRegistry</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ˜ å°„çš„è¯­å¥ï¼Œå­˜åœ¨Mapé‡Œ</span>
    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">MappedStatement</span><span class="token punctuation">&gt;</span></span> mappedStatements <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç¼“å­˜,å­˜åœ¨Mapé‡Œ</span>
    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Cache</span><span class="token punctuation">&gt;</span></span> caches <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç»“æœæ˜ å°„ï¼Œå­˜åœ¨Mapé‡Œ</span>
    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ResultMap</span><span class="token punctuation">&gt;</span></span> resultMaps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">KeyGenerator</span><span class="token punctuation">&gt;</span></span> keyGenerators <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ’ä»¶æ‹¦æˆªå™¨é“¾</span>
    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">InterceptorChain</span> interceptorChain <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InterceptorChain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ç±»å‹åˆ«åæ³¨å†Œæœº</span>
    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">TypeAliasRegistry</span> typeAliasRegistry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypeAliasRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">LanguageDriverRegistry</span> languageRegistry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LanguageDriverRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ç±»å‹å¤„ç†å™¨æ³¨å†Œæœº</span>
    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">TypeHandlerRegistry</span> typeHandlerRegistry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypeHandlerRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// å¯¹è±¡å·¥å‚å’Œå¯¹è±¡åŒ…è£…å™¨å·¥å‚</span>
    <span class="token keyword">protected</span> <span class="token class-name">ObjectFactory</span> objectFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultObjectFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">ObjectWrapperFactory</span> objectWrapperFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultObjectWrapperFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> loadedResources <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/images/article/spring/mybatis-220715-03.png" alt="Mybatis å•ä¾‹æ¨¡å¼"></p><ul><li><strong>å•ä¾‹æ¨¡å¼</strong>ï¼šæ˜¯ä¸€ç§åˆ›å»ºå‹æ¨¡å¼ï¼Œè®©ä½ èƒ½å¤Ÿä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®è¯¥å®ä¾‹çš„å…¨å±€èŠ‚ç‚¹ã€‚</li><li><strong>åœºæ™¯ä»‹ç»</strong>ï¼šConfiguration å°±åƒç‹—çš®è†è¯ä¸€æ ·å¤§å•ä¾‹ï¼Œè´¯ç©¿æ•´ä¸ªä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ‰€ä»¥çš„é…ç½®å¯¹è±¡ï¼›æ˜ å°„ã€ç¼“å­˜ã€å…¥å‚ã€å‡ºå‚ã€æ‹¦æˆªå™¨ã€æ³¨å†Œæœºã€å¯¹è±¡å·¥å‚ç­‰ï¼Œéƒ½åœ¨ Configuration é…ç½®é¡¹ä¸­åˆå§‹åŒ–ã€‚å¹¶éšç€ SqlSessionFactoryBuilder æ„å»ºé˜¶æ®µå®Œæˆå®ä¾‹åŒ–æ“ä½œã€‚</li><li><strong>åŒç±»åœºæ™¯</strong>ï¼š<code>ErrorContext</code>ã€<code>LogFactory</code>ã€<code>Configuration</code></li></ul><h3 id="_3-å»ºé€ è€…æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_3-å»ºé€ è€…æ¨¡å¼" aria-hidden="true">#</a> 3. å»ºé€ è€…æ¨¡å¼</h3><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.mapping.ResultMap#Builder</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResultMap</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ResultMapping</span><span class="token punctuation">&gt;</span></span> resultMappings<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> mappedColumns<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">ResultMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Builder</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">ResultMap</span> resultMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResultMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> configuration<span class="token punctuation">,</span> <span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ResultMapping</span><span class="token punctuation">&gt;</span></span> resultMappings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            resultMap<span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
            resultMap<span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
            resultMap<span class="token punctuation">.</span>resultMappings <span class="token operator">=</span> resultMappings<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">ResultMap</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            resultMap<span class="token punctuation">.</span>mappedColumns <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// step-13 æ–°å¢åŠ ï¼Œæ·»åŠ  mappedColumns å­—æ®µ</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ResultMapping</span> resultMapping <span class="token operator">:</span> resultMap<span class="token punctuation">.</span>resultMappings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">final</span> <span class="token class-name">String</span> column <span class="token operator">=</span> resultMapping<span class="token punctuation">.</span><span class="token function">getColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>column <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    resultMap<span class="token punctuation">.</span>mappedColumns<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>column<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token constant">ENGLISH</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> resultMap<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    
    <span class="token comment">// ... get</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/images/article/spring/mybatis-220715-04.png" alt="Mybatis å»ºé€ è€…æ¨¡å¼"></p><ul><li><strong>å»ºé€ è€…æ¨¡å¼</strong>ï¼šä½¿ç”¨å¤šä¸ªç®€å•çš„å¯¹è±¡ä¸€æ­¥ä¸€æ­¥æ„å»ºæˆä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ï¼Œè¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚</li><li><strong>åœºæ™¯ä»‹ç»</strong>ï¼šå…³äºå»ºé€ è€…æ¨¡å¼åœ¨ Mybatis æ¡†æ¶é‡Œçš„ä½¿ç”¨ï¼Œé‚£çœŸæ˜¯çº±çª—æ“¦å±è‚¡ï¼Œç»™ä½ æ¼äº†ä¸€æ‰‹ã€‚åˆ°å¤„éƒ½æ˜¯ XxxxBuilderï¼Œæ‰€æœ‰å…³äº XML æ–‡ä»¶çš„è§£æåˆ°å„ç±»å¯¹è±¡çš„å°è£…ï¼Œéƒ½ä½¿ç”¨å»ºé€ è€…ä»¥åŠå»ºé€ è€…åŠ©æ‰‹æ¥å®Œæˆå¯¹è±¡çš„å°è£…ã€‚å®ƒçš„æ ¸å¿ƒç›®çš„å°±æ˜¯ä¸å¸Œæœ›æŠŠè¿‡å¤šçš„å…³äºå¯¹è±¡çš„å±æ€§è®¾ç½®ï¼Œå†™åˆ°å…¶ä»–ä¸šåŠ¡æµç¨‹ä¸­ï¼Œè€Œæ˜¯ç”¨å»ºé€ è€…çš„æ–¹å¼æä¾›æœ€ä½³çš„è¾¹ç•Œéš”ç¦»ã€‚</li><li><strong>åŒç±»åœºæ™¯</strong>ï¼š<code>SqlSessionFactoryBuilder</code>ã€<code>XMLConfigBuilder</code>ã€<code>XMLMapperBuilder</code>ã€<code>XMLStatementBuilder</code>ã€<code>CacheBuilder</code></li></ul><h2 id="å››ã€ç±»å‹-ç»“æ„å‹æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#å››ã€ç±»å‹-ç»“æ„å‹æ¨¡å¼" aria-hidden="true">#</a> å››ã€ç±»å‹ï¼šç»“æ„å‹æ¨¡å¼</h2><h3 id="_1-é€‚é…å™¨æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_1-é€‚é…å™¨æ¨¡å¼" aria-hidden="true">#</a> 1. é€‚é…å™¨æ¨¡å¼</h3><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.logging.Log</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Log</span> <span class="token punctuation">{</span>

  <span class="token keyword">boolean</span> <span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">boolean</span> <span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">trace</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">warn</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.logging.slf4j.Slf4jImpl</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Slf4jImpl</span> <span class="token keyword">implements</span> <span class="token class-name">Log</span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token class-name">Log</span> log<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token class-name">Slf4jImpl</span><span class="token punctuation">(</span><span class="token class-name">String</span> clazz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>logger <span class="token keyword">instanceof</span> <span class="token class-name">LocationAwareLogger</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// check for slf4j &gt;= 1.6 method signature</span>
        logger<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;log&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Marker</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Throwable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Slf4jLocationAwareLoggerImpl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">LocationAwareLogger</span><span class="token punctuation">)</span> logger<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SecurityException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// fail-back to Slf4jLoggerImpl</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchMethodException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// fail-back to Slf4jLoggerImpl</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Logger is not LocationAwareLogger or slf4j version &lt; 1.6</span>
    log <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Slf4jLoggerImpl</span><span class="token punctuation">(</span>logger<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> log<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> log<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">trace</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">warn</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/images/article/spring/mybatis-220715-05.png" alt="Mybatis é€‚é…å™¨æ¨¡å¼"></p><ul><li><strong>é€‚é…å™¨æ¨¡å¼</strong>ï¼šæ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒèƒ½ä½¿æ¥å£ä¸å…¼å®¹çš„å¯¹è±¡èƒ½å¤Ÿç›¸äº’åˆä½œã€‚</li><li><strong>åœºæ™¯ä»‹ç»</strong>ï¼šæ­£æ˜¯å› ä¸ºæœ‰å¤ªå¤šçš„æ—¥å¿—æ¡†æ¶ï¼ŒåŒ…æ‹¬ï¼šLog4jã€Log4j2ã€Slf4Jç­‰ç­‰ï¼Œè€Œè¿™äº›æ—¥å¿—æ¡†æ¶çš„ä½¿ç”¨æ¥å£åˆéƒ½å„æœ‰å·®å¼‚ï¼Œä¸ºäº†ç»Ÿä¸€è¿™äº›æ—¥å¿—å·¥å…·çš„æ¥å£ï¼ŒMybatis å®šä¹‰äº†ä¸€å¥—ç»Ÿä¸€çš„æ—¥å¿—æ¥å£ï¼Œä¸ºæ‰€æœ‰çš„å…¶ä»–æ—¥å¿—å·¥å…·æ¥å£åšç›¸åº”çš„é€‚é…æ“ä½œã€‚</li><li><strong>åŒç±»åœºæ™¯</strong>ï¼šä¸»è¦é›†ä¸­åœ¨å¯¹æ—¥å¿—çš„é€‚é…ä¸Šï¼ŒLog å’Œ å¯¹åº”çš„å®ç°ç±»ï¼Œä»¥åŠåœ¨ LogFactory å·¥å‚æ–¹æ³•ä¸­è¿›è¡Œä½¿ç”¨ã€‚</li></ul><h3 id="_2-ä»£ç†æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_2-ä»£ç†æ¨¡å¼" aria-hidden="true">#</a> 2. ä»£ç†æ¨¡å¼</h3><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.binding.MapperProxy</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapperProxy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">6424540398559729838L</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">SqlSession</span> sqlSession<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> mapperInterface<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Method</span><span class="token punctuation">,</span> <span class="token class-name">MapperMethod</span><span class="token punctuation">&gt;</span></span> methodCache<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MapperProxy</span><span class="token punctuation">(</span><span class="token class-name">SqlSession</span> sqlSession<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> mapperInterface<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Method</span><span class="token punctuation">,</span> <span class="token class-name">MapperMethod</span><span class="token punctuation">&gt;</span></span> methodCache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sqlSession <span class="token operator">=</span> sqlSession<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mapperInterface <span class="token operator">=</span> mapperInterface<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>methodCache <span class="token operator">=</span> methodCache<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getDeclaringClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token class-name">MapperMethod</span> mapperMethod <span class="token operator">=</span> <span class="token function">cachedMapperMethod</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> mapperMethod<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/images/article/spring/mybatis-220715-06.png" alt="Mybatis ä»£ç†æ¨¡å¼"></p><ul><li><strong>ä»£ç†æ¨¡å¼</strong>ï¼šæ˜¯ä¸€ç§ç»“æ„å‹æ¨¡å¼ï¼Œè®©ä½ èƒ½å¤Ÿæä¾›å¯¹è±¡çš„æ›¿ä»£å“æˆ–å…¶å ä½ç¬¦ã€‚ä»£ç†æ§åˆ¶ç€å¯¹åŸå¯¹è±¡çš„è®¿é—®ï¼Œå¹¶å…è®¸åœ¨å°†è¯·æ±‚æäº¤ç»™å¯¹è±¡å‰è¿›è¡Œä¸€äº›å¤„ç†ã€‚</li><li><strong>åœºæ™¯ä»‹ç»</strong>ï¼šä¸å¹ç‰›çš„è®²ï¼Œæ²¡æœ‰ä»£ç†æ¨¡å¼ï¼Œå°±ä¸ä¼šæœ‰å„ç±»çš„æ¡†æ¶å­˜åœ¨ã€‚å°±åƒ Mybatis ä¸­çš„ MapperProxy æ˜ å°„å™¨ä»£ç†å®ç°ç±»ï¼Œå®ƒæ‰€å®ç°çš„åŠŸèƒ½å°±æ˜¯å¸®åŠ©æˆ‘ä»¬å®Œæˆ DAO æ¥å£çš„å…·ä½“å®ç°ç±»çš„æ–¹æ³•æ“ä½œï¼Œä½ çš„ä»»ä½•ä¸€ä¸ªé…ç½®çš„ DAO æ¥å£æ‰€è°ƒç”¨çš„ CRUD æ–¹æ³•ï¼Œéƒ½ä¼šè¢« MapperProxy æ¥ç®¡ï¼Œè°ƒç”¨åˆ°æ–¹æ³•æ‰§è¡Œå™¨ç­‰ä¸€ç³»åˆ—æ“ä½œï¼Œå¹¶è¿”å›æœ€ç»ˆçš„æ•°æ®åº“æ‰§è¡Œç»“æœã€‚</li><li><strong>åŒç±»åœºæ™¯</strong>ï¼š<code>DriverProxy</code>ã€<code>Plugin</code>ã€<code>Invoker</code>ã€<code>MapperProxy</code></li></ul><h3 id="_3-ç»„åˆæ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_3-ç»„åˆæ¨¡å¼" aria-hidden="true">#</a> 3. ç»„åˆæ¨¡å¼</h3><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.scripting.xmltags.SqlNode</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SqlNode</span> <span class="token punctuation">{</span>

    <span class="token keyword">boolean</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">DynamicContext</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.scripting.xmltags.IfSqlNode</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IfSqlNode</span> <span class="token keyword">implements</span> <span class="token class-name">SqlNode</span><span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">ExpressionEvaluator</span> evaluator<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> test<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">SqlNode</span> contents<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">IfSqlNode</span><span class="token punctuation">(</span><span class="token class-name">SqlNode</span> contents<span class="token punctuation">,</span> <span class="token class-name">String</span> test<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>test <span class="token operator">=</span> test<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>contents <span class="token operator">=</span> contents<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>evaluator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExpressionEvaluator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">DynamicContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œåˆ™applyï¼Œå¹¶è¿”å›true</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>evaluator<span class="token punctuation">.</span><span class="token function">evaluateBoolean</span><span class="token punctuation">(</span>test<span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">getBindings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            contents<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.scripting.xmltags.XMLScriptBuilder</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XMLScriptBuilder</span> <span class="token keyword">extends</span> <span class="token class-name">BaseBuilder</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initNodeHandlerMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 9ç§ï¼Œå®ç°å…¶ä¸­2ç§ trim/where/set/foreach/if/choose/when/otherwise/bind</span>
        nodeHandlerMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;trim&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TrimHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        nodeHandlerMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;if&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IfHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SqlNode</span><span class="token punctuation">&gt;</span></span> <span class="token function">parseDynamicTags</span><span class="token punctuation">(</span><span class="token class-name">Element</span> element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SqlNode</span><span class="token punctuation">&gt;</span></span> contents <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">&gt;</span></span> children <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span> child <span class="token operator">:</span> children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">getNodeType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Node</span><span class="token punctuation">.</span><span class="token constant">TEXT_NODE</span> <span class="token operator">||</span> child<span class="token punctuation">.</span><span class="token function">getNodeType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Node</span><span class="token punctuation">.</span><span class="token constant">CDATA_SECTION_NODE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">getNodeType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Node</span><span class="token punctuation">.</span><span class="token constant">ELEMENT_NODE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> nodeName <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">NodeHandler</span> handler <span class="token operator">=</span> nodeHandlerMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>nodeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Unknown element &quot;</span> <span class="token operator">+</span> nodeName <span class="token operator">+</span> <span class="token string">&quot; in SQL statement.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                handler<span class="token punctuation">.</span><span class="token function">handleNode</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">element</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> contents<span class="token punctuation">)</span><span class="token punctuation">;</span>
                isDynamic <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> contents<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>é…ç½®è¯¦è§</strong>ï¼š<code>resources/mapper/Activity_Mapper.xml</code></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queryActivityById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.mybatis.test.po.Activity<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>activityMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">flushCache</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">useCache</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    SELECT activity_id, activity_name, activity_desc, create_time, update_time
    FROM activity
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>trim</span> <span class="token attr-name">prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>where<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prefixOverrides</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>AND | OR<span class="token punctuation">&quot;</span></span> <span class="token attr-name">suffixOverrides</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>and<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>null != activityId<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            activity_id = #{activityId}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>trim</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/images/article/spring/mybatis-220715-07.png" alt="Mybatis ç»„åˆæ¨¡å¼"></p>`,41),y=n("li",null,[n("strong",null,"ç»„åˆæ¨¡å¼"),s("ï¼šæ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒå°†å¯¹è±¡ç»„åˆæˆæ ‘çŠ¶ç»“æ„ï¼Œå¹¶ä¸”èƒ½ç‹¬ç«‹ä½¿ç”¨å¯¹è±¡ä¸€æ ·ä½¿ç”¨å®ƒä»¬ã€‚")],-1),w=n("strong",null,"åœºæ™¯ä»‹ç»",-1),h={href:"https://bugstack.cn/md/spring/develop-mybatis/2022-06-28-%E7%AC%AC16%E7%AB%A0%EF%BC%9A%E8%A7%A3%E6%9E%90%E5%90%AB%E6%A0%87%E7%AD%BE%E7%9A%84%E5%8A%A8%E6%80%81SQL%E8%AF%AD%E5%8F%A5.html",target:"_blank",rel:"noopener noreferrer"},f=n("li",null,[n("strong",null,"åŒç±»åœºæ™¯"),s("ï¼šä¸»è¦ä½“ç°åœ¨å¯¹å„ç±»SQLæ ‡ç­¾çš„è§£æä¸Šï¼Œä»¥å®ç° SqlNode æ¥å£çš„å„ä¸ªå­ç±»ä¸ºä¸»ã€‚")],-1),S=p(`<h3 id="_4-è£…é¥°å™¨æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_4-è£…é¥°å™¨æ¨¡å¼" aria-hidden="true">#</a> 4. è£…é¥°å™¨æ¨¡å¼</h3><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.session.Configuration</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Executor</span> <span class="token function">newExecutor</span><span class="token punctuation">(</span><span class="token class-name">Transaction</span> transaction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Executor</span> executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleExecutor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// é…ç½®å¼€å¯ç¼“å­˜ï¼Œåˆ›å»º CachingExecutor(é»˜è®¤å°±æ˜¯æœ‰ç¼“å­˜)è£…é¥°è€…æ¨¡å¼</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheEnabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CachingExecutor</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> executor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/images/article/spring/mybatis-220715-08.png" alt="Mybatis è£…é¥°å™¨æ¨¡å¼"></p><ul><li><strong>è£…é¥°å™¨æ¨¡å¼</strong>ï¼šæ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå…è®¸ä½ é€šè¿‡å°†å¯¹è±¡æ”¾å…¥åŒ…å«è¡Œä¸ºçš„ç‰¹æ®Šå°è£…å¯¹è±¡ä¸­æ¥ä¸ºåŸå¯¹è±¡ç»‘å®šæ–°çš„è¡Œä¸ºã€‚</li><li><strong>åœºæ™¯ä»‹ç»</strong>ï¼šMybatis çš„æ‰€æœ‰ SQL æ“ä½œï¼Œéƒ½æ˜¯ç»è¿‡ SqlSession ä¼šè¯è°ƒç”¨ SimpleExecutor ç®€å•å®ç°çš„æ‰§è¡Œå™¨å®Œæˆçš„ï¼Œè€Œä¸€çº§ç¼“å­˜çš„æ“ä½œä¹Ÿæ˜¯åœ¨ç®€å•æ‰§è¡Œå™¨ä¸­å¤„ç†ã€‚é‚£ä¹ˆè¿™é‡ŒäºŒçº§ç¼“å­˜å› ä¸ºæ˜¯åŸºäºä¸€çº§ç¼“å­˜åˆ·æ–°æ“ä½œçš„ï¼Œæ‰€ä»¥åœ¨å®ç°ä¸Šï¼Œé€šè¿‡åˆ›å»ºä¸€ä¸ªç¼“å­˜æ‰§è¡Œå™¨ï¼ŒåŒ…è£…ç®€å•æ‰§è¡Œå™¨çš„å¤„ç†é€»è¾‘ï¼Œå®ç°äºŒçº§ç¼“å­˜æ“ä½œã€‚é‚£ä¹ˆè¿™é‡Œç”¨åˆ°çš„å°±æ˜¯è£…é¥°å™¨æ¨¡å¼ï¼Œä¹Ÿå«ä¿„ç½—æ–¯å¥—å¨ƒæ¨¡å¼ã€‚</li><li><strong>åŒç±»åœºæ™¯</strong>ï¼šä¸»è¦æå‰åœ¨ Cache ç¼“å­˜æ¥å£çš„å®ç°å’Œ CachingExecutor æ‰§è¡Œå™¨ä¸­ã€‚</li></ul><h2 id="äº”ã€ç±»å‹-è¡Œä¸ºå‹æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#äº”ã€ç±»å‹-è¡Œä¸ºå‹æ¨¡å¼" aria-hidden="true">#</a> äº”ã€ç±»å‹ï¼šè¡Œä¸ºå‹æ¨¡å¼</h2><h3 id="_1-æ¨¡æ¿æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_1-æ¨¡æ¿æ¨¡å¼" aria-hidden="true">#</a> 1. æ¨¡æ¿æ¨¡å¼</h3><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.executor.BaseExecutor</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">MappedStatement</span> ms<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span> rowBounds<span class="token punctuation">,</span> <span class="token class-name">ResultHandler</span> resultHandler<span class="token punctuation">,</span> <span class="token class-name">CacheKey</span> key<span class="token punctuation">,</span> <span class="token class-name">BoundSql</span> boundSql<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>closed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Executor was closed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ¸…ç†å±€éƒ¨ç¼“å­˜ï¼ŒæŸ¥è¯¢å †æ ˆä¸º0åˆ™æ¸…ç†ã€‚queryStack é¿å…é€’å½’è°ƒç”¨æ¸…ç†</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>queryStack <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> ms<span class="token punctuation">.</span><span class="token function">isFlushCacheRequired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">clearLocalCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        queryStack<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token comment">// æ ¹æ®cacheKeyä»localCacheä¸­æŸ¥è¯¢æ•°æ®</span>
        list <span class="token operator">=</span> resultHandler <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> localCache<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>list <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            list <span class="token operator">=</span> <span class="token function">queryFromDatabase</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> key<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        queryStack<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>queryStack <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>configuration<span class="token punctuation">.</span><span class="token function">getLocalCacheScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">LocalCacheScope</span><span class="token punctuation">.</span><span class="token constant">STATEMENT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">clearLocalCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> list<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.executor.SimpleExecutor</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">doUpdate</span><span class="token punctuation">(</span><span class="token class-name">MappedStatement</span> ms<span class="token punctuation">,</span> <span class="token class-name">Object</span> parameter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Statement</span> stmt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> ms<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ–°å»ºä¸€ä¸ª StatementHandler</span>
        <span class="token class-name">StatementHandler</span> handler <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">newStatementHandler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> <span class="token class-name">RowBounds</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å‡†å¤‡è¯­å¥</span>
        stmt <span class="token operator">=</span> <span class="token function">prepareStatement</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// StatementHandler.update</span>
        <span class="token keyword">return</span> handler<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token function">closeStatement</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/images/article/spring/mybatis-220715-09.png" alt="Mybatis æ¨¡æ¿æ¨¡å¼"></p><ul><li><strong>æ¨¡æ¿æ¨¡å¼</strong>ï¼šæ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒåœ¨è¶…ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„æ¡†æ¶ï¼Œå…è®¸å­ç±»åœ¨ä¸ä¿®æ”¹ç»“æ„çš„æƒ…å†µä¸‹é‡å†™ç®—æ³•çš„ç‰¹å®šæ­¥éª¤ã€‚</li><li><strong>åœºæ™¯ä»‹ç»</strong>ï¼šåªè¦å­˜åœ¨ä¸€ç³»åˆ—å¯è¢«æ ‡å‡†å®šä¹‰çš„æµç¨‹ï¼Œåœ¨æµç¨‹çš„æ­¥éª¤å¤§éƒ¨åˆ†æ˜¯é€šç”¨é€»è¾‘ï¼Œåªæœ‰ä¸€å°‘éƒ¨åˆ†æ˜¯éœ€è¦å­ç±»å®ç°çš„ï¼Œé‚£ä¹ˆé€šå¸¸ä¼šé‡‡ç”¨æ¨¡æ¿æ¨¡å¼æ¥å®šä¹‰å‡ºè¿™ä¸ªæ ‡å‡†çš„æµç¨‹ã€‚å°±åƒ Mybatis çš„ BaseExecutor å°±æ˜¯ä¸€ä¸ªç”¨äºå®šä¹‰æ¨¡æ¿æ¨¡å¼çš„æŠ½è±¡ç±»ï¼Œåœ¨è¿™ä¸ªç±»ä¸­æŠŠæŸ¥è¯¢ã€ä¿®æ”¹çš„æ“ä½œéƒ½å®šä¹‰å‡ºäº†ä¸€å¥—æ ‡å‡†çš„æµç¨‹ã€‚</li><li><strong>åŒç±»åœºæ™¯</strong>ï¼š<code>BaseExecutor</code>ã€<code>SimpleExecutor</code>ã€<code>BaseTypeHandler</code></li></ul><h3 id="_2-ç­–ç•¥æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_2-ç­–ç•¥æ¨¡å¼" aria-hidden="true">#</a> 2. ç­–ç•¥æ¨¡å¼</h3><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.type.TypeHandler</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TypeHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * è®¾ç½®å‚æ•°
     */</span>
    <span class="token keyword">void</span> <span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span> ps<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token class-name">T</span> parameter<span class="token punctuation">,</span> <span class="token class-name">JdbcType</span> jdbcType<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * è·å–ç»“æœ
     */</span>
    <span class="token class-name">T</span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">,</span> <span class="token class-name">String</span> columnName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * å–å¾—ç»“æœ
     */</span>
    <span class="token class-name">T</span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">,</span> <span class="token keyword">int</span> columnIndex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.type.LongTypeHandler</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LongTypeHandler</span> <span class="token keyword">extends</span> <span class="token class-name">BaseTypeHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">setNonNullParameter</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span> ps<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token class-name">Long</span> parameter<span class="token punctuation">,</span> <span class="token class-name">JdbcType</span> jdbcType<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        ps<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Long</span> <span class="token function">getNullableResult</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">,</span> <span class="token class-name">String</span> columnName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> rs<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span>columnName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">getNullableResult</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">,</span> <span class="token keyword">int</span> columnIndex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> rs<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span>columnIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/images/article/spring/mybatis-220715-10.png" alt="Mybatis ç­–ç•¥æ¨¡å¼"></p><ul><li><strong>ç­–ç•¥æ¨¡å¼</strong>ï¼šæ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒèƒ½å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå¹¶å°†æ¯ç§ç®—æ³•åˆ†åˆ«æ”¾å…¥ç‹¬ç«‹çš„ç±»ä¸­ï¼Œä»¥ä½¿ç®—æ³•çš„å¯¹è±¡èƒ½å¤Ÿäº’ç›¸æ›¿æ¢ã€‚</li><li><strong>åœºæ™¯ä»‹ç»</strong>ï¼šåœ¨ Mybatis å¤„ç† JDBC æ‰§è¡Œåè¿”å›çš„ç»“æœæ—¶ï¼Œéœ€è¦æŒ‰ç…§ä¸åŒçš„ç±»å‹è·å–å¯¹åº”çš„å€¼ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å¤§é‡çš„ if åˆ¤æ–­ã€‚æ‰€ä»¥è¿™é‡ŒåŸºäº TypeHandler æ¥å£å¯¹æ¯ä¸ªå‚æ•°ç±»å‹åˆ†åˆ«åšäº†è‡ªå·±çš„ç­–ç•¥å®ç°ã€‚</li><li><strong>åŒç±»åœºæ™¯</strong>ï¼š<code>PooledDataSource\\UnpooledDataSource</code>ã€<code>BatchExecutor\\ResuseExecutor\\SimpleExector\\CachingExecutor</code>ã€<code>LongTypeHandler\\StringTypeHandler\\DateTypeHandler</code></li></ul><h3 id="_3-è¿­ä»£å™¨æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_3-è¿­ä»£å™¨æ¨¡å¼" aria-hidden="true">#</a> 3. è¿­ä»£å™¨æ¨¡å¼</h3><p><strong>æºç è¯¦è§</strong>ï¼š<code>cn.bugstack.mybatis.reflection.property.PropertyTokenizer</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PropertyTokenizer</span> <span class="token keyword">implements</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PropertyTokenizer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PropertyTokenizer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">PropertyTokenizer</span><span class="token punctuation">(</span><span class="token class-name">String</span> fullname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç­çº§[0].å­¦ç”Ÿ.æˆç»©</span>
        <span class="token comment">// æ‰¾è¿™ä¸ªç‚¹ .</span>
        <span class="token keyword">int</span> delim <span class="token operator">=</span> fullname<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token char">&#39;.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>delim <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            name <span class="token operator">=</span> fullname<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> delim<span class="token punctuation">)</span><span class="token punctuation">;</span>
            children <span class="token operator">=</span> fullname<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>delim <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ‰¾ä¸åˆ°.çš„è¯ï¼Œå–å…¨éƒ¨éƒ¨åˆ†</span>
            name <span class="token operator">=</span> fullname<span class="token punctuation">;</span>
            children <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        indexedName <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token comment">// æŠŠä¸­æ‹¬å·é‡Œçš„æ•°å­—ç»™è§£æå‡ºæ¥</span>
        delim <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token char">&#39;[&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>delim <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            index <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>delim <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            name <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> delim<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

		<span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://bugstack.cn/images/article/spring/mybatis-220715-11.png" alt="Mybatis è¿­ä»£å™¨æ¨¡å¼"></p><ul><li><strong>è¿­ä»£å™¨æ¨¡å¼</strong>ï¼šæ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œè®©ä½ èƒ½åœ¨ä¸æš´éœ²é›†åˆåº•å±‚è¡¨ç°å½¢å¼çš„æƒ…å†µä¸‹éå†é›†åˆä¸­æ‰€æœ‰çš„å…ƒç´ ã€‚</li><li><strong>åœºæ™¯ä»‹ç»</strong>ï¼šPropertyTokenizer æ˜¯ç”¨äº Mybatis æ¡†æ¶ MetaObject åå°„å·¥å…·åŒ…ä¸‹ï¼Œç”¨äºè§£æå¯¹è±¡å…³ç³»çš„è¿­ä»£æ“ä½œã€‚è¿™ä¸ªç±»åœ¨ Mybatis æ¡†æ¶ä¸­ä½¿ç”¨çš„éå¸¸é¢‘ç¹ï¼ŒåŒ…æ‹¬è§£ææ•°æ®æºé…ç½®ä¿¡æ¯å¹¶å¡«å……åˆ°æ•°æ®æºç±»ä¸Šï¼Œä»¥åŠå‚æ•°çš„è§£æã€å¯¹è±¡çš„è®¾ç½®éƒ½ä¼šä½¿ç”¨åˆ°è¿™ä¸ªç±»ã€‚</li><li><strong>åŒç±»åœºæ™¯</strong>ï¼š<code>PropertyTokenizer</code></li></ul><h2 id="å…­ã€æ€»ç»“-å·ç‹-çš„å¿ƒå¾—" tabindex="-1"><a class="header-anchor" href="#å…­ã€æ€»ç»“-å·ç‹-çš„å¿ƒå¾—" aria-hidden="true">#</a> å…­ã€æ€»ç»“ï¼šâ€œå·ç‹â€çš„å¿ƒå¾—</h2><p>ä¸€ä»½æºç çš„æˆä½“ç³»æ‹†è§£æ¸è¿›å¼å­¦ä¹ ï¼Œå¯èƒ½éœ€è¦1~2ä¸ªæœˆçš„æ—¶é—´ï¼Œç›¸æ¯”äºçˆ½æ–‡å’Œç–²äºåº”è¯•è¦èŠ±è´¹æ›´å¤šçš„ç»å†ã€‚ä½†ä½ æ€»ä¼šåœ¨ä¸€ä¸ªå¤§å—æ—¶é—´å­¦ä¹ å®Œåï¼Œä¼šåœ¨è‡ªå·±çš„å¤´è„‘ä¸­æ„å»ºå‡ºä¸€å¥—å®Œæ•´ä½“ç³»å…³äºæ­¤ç±»çŸ¥è¯†çš„æŠ€æœ¯æ¶æ„ï¼Œæ— è®ºä»å“ªé‡Œå…¥å£ä½ éƒ½èƒ½æ¸…æ¥šå„ä¸ªåˆ†æ”¯æµç¨‹çš„èµ°å‘ï¼Œè¿™ä¹Ÿæ˜¯ä½ æˆä¸ºæŠ€æœ¯ä¸“å®¶è·¯ä¸Šçš„æ·±åº¦å­¦ä¹ ã€‚</p>`,27),x={href:"https://bugstack.cn/md/spring/develop-mybatis/2022-03-20-%E7%AC%AC1%E7%AB%A0%EF%BC%9A%E5%BC%80%E7%AF%87%E4%BB%8B%E7%BB%8D%EF%BC%8C%E6%89%8B%E5%86%99Mybatis%E8%83%BD%E7%BB%99%E4%BD%A0%E5%B8%A6%E6%9D%A5%E4%BB%80%E4%B9%88%EF%BC%9F.html",target:"_blank",rel:"noopener noreferrer"},M=n("p",null,[n("img",{src:"https://bugstack.cn/images/article/spring/mybatis-220708-03.png",alt:"ã€Šæ‰‹å†™Mybatisï¼šæ¸è¿›å¼æºç å®è·µã€‹"})],-1);function E(q,L){const a=c("ExternalLinkIcon");return o(),l("div",null,[u,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),k,s("åšå®¢ï¼š"),n("a",r,[s("https://bugstack.cn"),t(a)])]),d,n("p",null,[s("å¥½å•¦ï¼Œä¸æ‰¯æ·¡äº†ï¼Œæ¥ä¸‹æ¥å°å‚…å“¥å°±ä»¥"),n("a",m,[s("ã€Šæ‰‹å†™Mybatisï¼šæ¸è¿›å¼æºç å®è·µã€‹"),t(a)]),s("çš„å­¦ä¹ ï¼Œç»™å¤§å®¶åˆ—ä¸¾å‡ºè¿™10ç§è®¾è®¡æ¨¡å¼ï¼Œåœ¨Mybatisæ¡†æ¶ä¸­éƒ½ä½“ç°åœ¨å“ªé‡Œäº†ï¼")]),n("ul",null,[v,n("li",null,[s("æºç ä»“åº“ï¼š"),n("a",b,[s("https://gitcode.net/KnowledgePlanet/doc/-/wikis/home"),t(a)])])]),g,n("ul",null,[y,n("li",null,[w,s("ï¼šåœ¨ Mybatis XML åŠ¨æ€çš„ SQL é…ç½®ä¸­ï¼Œå…±æä¾›äº†9ç§(trim/where/set/foreach/if/choose/when/otherwise/bind)æ ‡ç­¾çš„ä½¿ç”¨ï¼Œè®©ä½¿ç”¨è€…å¯ä»¥ç»„åˆå‡ºå„ç±»åœºæ™¯çš„ SQL è¯­å¥ã€‚è€Œ SqlNode æ¥å£çš„å®ç°å°±æ˜¯æ¯ä¸€ä¸ªç»„åˆç»“æ„ä¸­çš„è§„åˆ™èŠ‚ç‚¹ï¼Œé€šè¿‡è§„åˆ™èŠ‚ç‚¹çš„ç»„è£…å®Œæˆä¸€é¢—è§„åˆ™æ ‘ç»„åˆæ¨¡å¼çš„ä½¿ç”¨ã€‚"),n("em",null,[s("å…·ä½“ä½¿ç”¨æºç å¯ä»¥é˜…è¯»"),n("a",h,[s("ã€Šæ‰‹å†™Mybatisï¼šæ¸è¿›å¼æºç å®è·µã€‹"),t(a)])])]),f]),S,n("p",null,[s("å¦‚æœä½ ä¹Ÿæƒ³æœ‰è¿™æ ·é…£ç•…æ·‹æ¼“çš„å­¦ä¹ ï¼Œåƒä¸‡åˆ«é”™è¿‡å‚…å“¥ä¸ºä½ ç¼–å†™çš„èµ„æ–™"),n("a",x,[s("ã€Šæ‰‹å†™Mybatisï¼šæ¸è¿›å¼æºç å®è·µã€‹"),t(a)]),s("ç›®å½•å¦‚å›¾æ‰€ç¤ºï¼Œå…±è®¡20ç« ")]),M])}const j=e(i,[["render",E],["__file","2022-07-15-di22zhangï¼šMybatisshejimoshi.html.vue"]]);export{j as default};
