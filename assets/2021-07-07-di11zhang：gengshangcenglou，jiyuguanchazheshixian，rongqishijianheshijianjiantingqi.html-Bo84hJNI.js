import{_ as t,r as p,o as c,c as i,a as n,b as s,d as e,e as l}from"./app-3RcBQnkC.js";const o={},u=n("h1",{id:"ã€Šspring-æ‰‹æ’¸ä¸“æ ã€‹ç¬¬-11-ç« -æ›´ä¸Šå±‚æ¥¼-åŸºäºè§‚å¯Ÿè€…å®ç°-å®¹å™¨äº‹ä»¶å’Œäº‹ä»¶ç›‘å¬å™¨",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ã€Šspring-æ‰‹æ’¸ä¸“æ ã€‹ç¬¬-11-ç« -æ›´ä¸Šå±‚æ¥¼-åŸºäºè§‚å¯Ÿè€…å®ç°-å®¹å™¨äº‹ä»¶å’Œäº‹ä»¶ç›‘å¬å™¨","aria-hidden":"true"},"#"),s(" ã€ŠSpring æ‰‹æ’¸ä¸“æ ã€‹ç¬¬ 11 ç« ï¼šæ›´ä¸Šå±‚æ¥¼ï¼ŒåŸºäºè§‚å¯Ÿè€…å®ç°ï¼Œå®¹å™¨äº‹ä»¶å’Œäº‹ä»¶ç›‘å¬å™¨")],-1),r=n("br",null,null,-1),d={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},k=n("br",null,null,-1),v={href:"https://mp.weixin.qq.com/s/wf5XiY4AjFETLQZxEwcCEQ",target:"_blank",rel:"noopener noreferrer"},m=l(`<blockquote><p>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„</p></blockquote><h2 id="ä¸€ã€å‰è¨€" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‰è¨€" aria-hidden="true">#</a> ä¸€ã€å‰è¨€</h2><p><code>èƒ½è§£è€¦ï¼Œæ˜¯å¤šä¹ˆé‡è¦çš„ä¸€ä»¶äº‹æƒ…ï¼</code></p><p>æ‘”æ¯ä¸ºå·ã€çœ‹æˆ‘çœ¼è‰²è¡Œäº‹ã€è§å—é¢ç«èµ·ï¼Œè¿™æ˜¯åœ¨å˜å“ˆä¹ˆï¼Ÿè¿™å…¶å®æ˜¯åœ¨é€šè¿‡äº‹ç‰©ä¼ æ’­è¿›è¡Œè§£è€¦å¼•çº¿å’Œç‚¸å¼¹ï¼Œä»…ä»…æ˜¯è¿™æ ·çš„ä¸€ä¸ªè§£è€¦ï¼Œå®ƒæ”¾åˆ°äº†å¤šå°‘æ‘å¤«è½æ±‰ï¼ŒåŠ«äº†æ³•åœºï¼Œç¯¡äº†å…µæƒï¼</p><p>è¿™æ ·çš„è§£è€¦åœºæ™¯åœ¨äº’è”ç½‘å¼€å‘çš„è®¾è®¡ä¸­ä½¿ç”¨çš„ä¹Ÿæ˜¯éå¸¸é¢‘ç¹ï¼Œå¦‚ï¼š<code>è¿™é‡Œéœ€è¦ä¸€ä¸ªæ³¨å†Œå®Œæˆäº‹ä»¶æ¨é€æ¶ˆæ¯</code>ã€<code>ç”¨æˆ·ä¸‹å•æˆ‘ä¼šå‘é€ä¸€ä¸ªMQ</code>ã€<code>æ”¶åˆ°æˆ‘çš„æ”¯ä»˜æ¶ˆæ¯å°±å¯ä»¥å‘è´§äº†</code>ç­‰ç­‰ï¼Œéƒ½æ˜¯ä¾é äº‹ä»¶è®¢é˜…å’Œå‘å¸ƒä»¥åŠMQæ¶ˆæ¯è¿™æ ·çš„ç»„ä»¶ï¼Œæ¥å¤„ç†ç³»ç»Ÿä¹‹é—´çš„è°ƒç”¨è§£è€¦ï¼Œæœ€ç»ˆé€šè¿‡è§£è€¦çš„æ–¹å¼æ¥æå‡æ•´ä½“ç³»ç»Ÿæ¶æ„çš„è´Ÿè½½èƒ½åŠ›ã€‚</p><p>å…¶å®è§£è€¦æ€è·¯å¯ä»¥ç†è§£ä¸ºè®¾è®¡æ¨¡å¼ä¸­è§‚å¯Ÿè€…æ¨¡å¼çš„å…·ä½“ä½¿ç”¨æ•ˆæœï¼Œåœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­å½“å¯¹è±¡é—´å­˜åœ¨ä¸€å¯¹å¤šå…³ç³»æ—¶ï¼Œåˆ™ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ƒæ˜¯ä¸€ç§å®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚<em>è¿™è®©æˆ‘æƒ³èµ·äº†æˆ‘æ¯ä¸ªæœˆçš„è½¦ç‰Œæ‘‡å·ï¼Œéƒ½ä¼šæ¨é€ç»™æˆ‘ä¸€æ¡æœ¬æœˆæ²¡ä¸­ç­¾çš„æ¶ˆæ¯ï¼ï¼ï¼</em></p><h2 id="äºŒã€ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#äºŒã€ç›®æ ‡" aria-hidden="true">#</a> äºŒã€ç›®æ ‡</h2><p>åœ¨ Spring ä¸­æœ‰ä¸€ä¸ª Event äº‹ä»¶åŠŸèƒ½ï¼Œå®ƒå¯ä»¥æä¾›äº‹ä»¶çš„å®šä¹‰ã€å‘å¸ƒä»¥åŠç›‘å¬äº‹ä»¶æ¥å®Œæˆä¸€äº›è‡ªå®šä¹‰çš„åŠ¨ä½œã€‚æ¯”å¦‚ä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªæ–°ç”¨æˆ·æ³¨å†Œçš„äº‹ä»¶ï¼Œå½“æœ‰ç”¨æˆ·æ‰§è¡Œæ³¨å†Œå®Œæˆåï¼Œåœ¨äº‹ä»¶ç›‘å¬ä¸­ç»™ç”¨æˆ·å‘é€ä¸€äº›ä¼˜æƒ åˆ¸å’ŒçŸ­ä¿¡æé†’ï¼Œè¿™æ ·çš„æ“ä½œå°±å¯ä»¥æŠŠå±äºåŸºæœ¬åŠŸèƒ½çš„æ³¨å†Œå’Œå¯¹åº”çš„ç­–ç•¥æœåŠ¡åˆ†å¼€ï¼Œé™ä½ç³»ç»Ÿçš„è€¦åˆã€‚ä»¥ååœ¨æ‰©å±•æ³¨å†ŒæœåŠ¡ï¼Œæ¯”å¦‚éœ€è¦æ·»åŠ é£æ§ç­–ç•¥ã€æ·»åŠ å®åè®¤è¯ã€åˆ¤æ–­ç”¨æˆ·å±æ€§ç­‰éƒ½ä¸ä¼šå½±å“åˆ°ä¾èµ–æ³¨å†ŒæˆåŠŸåæ‰§è¡Œçš„åŠ¨ä½œã€‚</p><p>é‚£ä¹ˆåœ¨æœ¬ç« èŠ‚æˆ‘ä»¬éœ€è¦ä»¥è§‚å¯Ÿè€…æ¨¡å¼çš„æ–¹å¼ï¼Œè®¾è®¡å’Œå®ç° Spring Event çš„å®¹å™¨äº‹ä»¶å’Œäº‹ä»¶ç›‘å¬å™¨åŠŸèƒ½ï¼Œæœ€ç»ˆå¯ä»¥è®©æˆ‘ä»¬åœ¨ç°æœ‰å®ç°çš„ Spring æ¡†æ¶ä¸­å¯ä»¥å®šä¹‰ã€ç›‘å¬å’Œå‘å¸ƒè‡ªå·±çš„äº‹ä»¶ä¿¡æ¯ã€‚</p><h2 id="ä¸‰ã€æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€æ–¹æ¡ˆ" aria-hidden="true">#</a> ä¸‰ã€æ–¹æ¡ˆ</h2><p>å…¶å®äº‹ä»¶çš„è®¾è®¡æœ¬èº«å°±æ˜¯ä¸€ç§è§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°ï¼Œå®ƒæ‰€è¦è§£å†³çš„å°±æ˜¯ä¸€ä¸ªå¯¹è±¡çŠ¶æ€æ”¹å˜ç»™å…¶ä»–å¯¹è±¡é€šçŸ¥çš„é—®é¢˜ï¼Œè€Œä¸”è¦è€ƒè™‘åˆ°æ˜“ç”¨å’Œä½è€¦åˆï¼Œä¿è¯é«˜åº¦çš„åä½œã€‚</p><p>åœ¨åŠŸèƒ½å®ç°ä¸Šæˆ‘ä»¬éœ€è¦å®šä¹‰å‡ºäº‹ä»¶ç±»ã€äº‹ä»¶ç›‘å¬ã€äº‹ä»¶å‘å¸ƒï¼Œè€Œè¿™äº›ç±»çš„åŠŸèƒ½éœ€è¦ç»“åˆåˆ° Spring çš„ AbstractApplicationContext#refresh()ï¼Œä»¥ä¾¿äºå¤„ç†äº‹ä»¶åˆå§‹åŒ–å’Œæ³¨å†Œäº‹ä»¶ç›‘å¬å™¨çš„æ“ä½œã€‚æ•´ä½“è®¾è®¡ç»“æ„å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://bugstack.cn/assets/images/spring/spring-11-01.png" alt=""></p><ul><li>åœ¨æ•´ä¸ªåŠŸèƒ½å®ç°è¿‡ç¨‹ä¸­ï¼Œä»ç„¶éœ€è¦åœ¨é¢å‘ç”¨æˆ·çš„åº”ç”¨ä¸Šä¸‹æ–‡ <code>AbstractApplicationContext</code> ä¸­æ·»åŠ ç›¸å…³äº‹ä»¶å†…å®¹ï¼ŒåŒ…æ‹¬ï¼šåˆå§‹åŒ–äº‹ä»¶å‘å¸ƒè€…ã€æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ã€å‘å¸ƒå®¹å™¨åˆ·æ–°å®Œæˆäº‹ä»¶ã€‚</li><li>ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº‹ä»¶ç±»ã€ç›‘å¬ç±»ã€å‘å¸ƒç±»ï¼ŒåŒæ—¶è¿˜éœ€è¦å®Œæˆä¸€ä¸ªå¹¿æ’­å™¨çš„åŠŸèƒ½ï¼Œæ¥æ”¶åˆ°äº‹ä»¶æ¨é€æ—¶è¿›è¡Œåˆ†æå¤„ç†ç¬¦åˆç›‘å¬äº‹ä»¶æ¥å—è€…æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ isAssignableFrom è¿›è¡Œåˆ¤æ–­ã€‚</li><li>isAssignableFrom å’Œ instanceof ç›¸ä¼¼ï¼Œä¸è¿‡ isAssignableFrom æ˜¯ç”¨æ¥åˆ¤æ–­å­ç±»å’Œçˆ¶ç±»çš„å…³ç³»çš„ï¼Œæˆ–è€…æ¥å£çš„å®ç°ç±»å’Œæ¥å£çš„å…³ç³»çš„ï¼Œé»˜è®¤æ‰€æœ‰çš„ç±»çš„ç»ˆæçˆ¶ç±»éƒ½æ˜¯Objectã€‚å¦‚æœA.isAssignableFrom(B)ç»“æœæ˜¯trueï¼Œè¯æ˜Bå¯ä»¥è½¬æ¢æˆä¸ºA,ä¹Ÿå°±æ˜¯Aå¯ä»¥ç”±Bè½¬æ¢è€Œæ¥ã€‚</li></ul><h2 id="å››ã€å®ç°" tabindex="-1"><a class="header-anchor" href="#å››ã€å®ç°" aria-hidden="true">#</a> å››ã€å®ç°</h2><h3 id="_1-å·¥ç¨‹ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1-å·¥ç¨‹ç»“æ„" aria-hidden="true">#</a> 1. å·¥ç¨‹ç»“æ„</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>small<span class="token operator">-</span>spring<span class="token operator">-</span>step<span class="token operator">-</span><span class="token number">10</span>
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework
    â”‚           â”œâ”€â”€ beans
    â”‚           â”‚   â”œâ”€â”€ factory
    â”‚           â”‚   â”‚   â”œâ”€â”€ config
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AutowireCapableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanDefinition</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanFactoryPostProcessor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanPostProcessor</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanReference</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ConfigurableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ <span class="token class-name">SingletonBeanRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractBeanDefinitionReader</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanDefinitionReader</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanDefinitionRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">CglibSubclassingInstantiationStrategy</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DefaultListableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DefaultSingletonBeanRegistry</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DisposableBeanAdapter</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">FactoryBeanRegistrySupport</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">InstantiationStrategy</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ <span class="token class-name">SimpleInstantiationStrategy</span><span class="token punctuation">.</span>java  
    â”‚           â”‚   â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ <span class="token class-name">XmlBeanDefinitionReader</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">Aware</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanClassLoaderAware</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanFactoryAware</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">BeanNameAware</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ConfigurableListableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">DisposableBean</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">FactoryBean</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">HierarchicalBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">InitializingBean</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">ListableBeanFactory</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">BeansException</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">PropertyValue</span><span class="token punctuation">.</span>java
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">PropertyValues</span><span class="token punctuation">.</span>java 
    â”‚           â”œâ”€â”€ context  
    â”‚           â”‚   â”œâ”€â”€ event
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractApplicationEventMulticaster</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationContextEvent</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationEventMulticaster</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ContextClosedEvent</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ContextRefreshedEvent</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">SimpleApplicationEventMulticaster</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractRefreshableApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">AbstractXmlApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationContextAwareProcessor</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”‚   â””â”€â”€ <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationContext</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationContextAware</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationEvent</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationEventPublisher</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ApplicationListener</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ core<span class="token punctuation">.</span>io
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ClassPathResource</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">DefaultResourceLoader</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">FileSystemResource</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">Resource</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â”œâ”€â”€ <span class="token class-name">ResourceLoader</span><span class="token punctuation">.</span>java 
    â”‚           â”‚   â””â”€â”€ <span class="token class-name">UrlResource</span><span class="token punctuation">.</span>java
    â”‚           â””â”€â”€ utils
    â”‚               â””â”€â”€ <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span>java
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test
                â”œâ”€â”€ event
                â”‚   â”œâ”€â”€ <span class="token class-name">ContextClosedEventListener</span><span class="token punctuation">.</span>java
                â”‚   â”œâ”€â”€ <span class="token class-name">ContextRefreshedEventListener</span><span class="token punctuation">.</span>java
                â”‚   â”œâ”€â”€ <span class="token class-name">CustomEvent</span><span class="token punctuation">.</span>java
                â”‚   â””â”€â”€ <span class="token class-name">CustomEventListener</span><span class="token punctuation">.</span>java
                â””â”€â”€ <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å·¥ç¨‹æºç </strong>ï¼š<code>å…¬ä¼—å·ã€Œbugstackè™«æ´æ ˆã€ï¼Œå›å¤ï¼šSpring ä¸“æ ï¼Œè·å–å®Œæ•´æºç </code></p><p>å®¹å™¨äº‹ä»¶å’Œäº‹ä»¶ç›‘å¬å™¨å®ç°ç±»å…³ç³»ï¼Œå¦‚å›¾ 11-2</p><p><img src="https://bugstack.cn/assets/images/spring/spring-11-02.png" alt="å›¾ 10-2"></p><ul><li>ä»¥ä¸Šæ•´ä¸ªç±»å…³ç³»å›¾ä»¥å›´ç»•å®ç° event äº‹ä»¶å®šä¹‰ã€å‘å¸ƒã€ç›‘å¬åŠŸèƒ½å®ç°å’ŒæŠŠäº‹ä»¶çš„ç›¸å…³å†…å®¹ä½¿ç”¨ AbstractApplicationContext#refresh è¿›è¡Œæ³¨å†Œå’Œå¤„ç†æ“ä½œã€‚</li><li>åœ¨å®ç°çš„è¿‡ç¨‹ä¸­ä¸»è¦ä»¥æ‰©å±• spring context åŒ…ä¸ºä¸»ï¼Œäº‹ä»¶çš„å®ç°ä¹Ÿæ˜¯åœ¨è¿™ä¸ªåŒ…ä¸‹è¿›è¡Œæ‰©å±•çš„ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ç›®å‰æ‰€æœ‰çš„å®ç°å†…å®¹ï¼Œä»ç„¶æ˜¯ä»¥IOCä¸ºä¸»ã€‚</li><li>ApplicationContext å®¹å™¨ç»§æ‰¿äº‹ä»¶å‘å¸ƒåŠŸèƒ½æ¥å£ ApplicationEventPublisherï¼Œå¹¶åœ¨å®ç°ç±»ä¸­æä¾›äº‹ä»¶ç›‘å¬åŠŸèƒ½ã€‚</li><li>ApplicationEventMulticaster æ¥å£æ˜¯æ³¨å†Œç›‘å¬å™¨å’Œå‘å¸ƒäº‹ä»¶çš„å¹¿æ’­å™¨ï¼Œæä¾›æ·»åŠ ã€ç§»é™¤å’Œå‘å¸ƒäº‹ä»¶æ–¹æ³•ã€‚</li><li>æœ€åæ˜¯å‘å¸ƒå®¹å™¨å…³é—­äº‹ä»¶ï¼Œè¿™ä¸ªä»ç„¶éœ€è¦æ‰©å±•åˆ° AbstractApplicationContext#close æ–¹æ³•ä¸­ï¼Œç”±æ³¨å†Œåˆ°è™šæ‹Ÿæœºçš„é’©å­å®ç°ã€‚</li></ul><h3 id="_2-å®šä¹‰å’Œå®ç°äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-å®šä¹‰å’Œå®ç°äº‹ä»¶" aria-hidden="true">#</a> 2. å®šä¹‰å’Œå®ç°äº‹ä»¶</h3><p><strong>cn.bugstack.springframework.context.ApplicationEvent</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationEvent</span> <span class="token keyword">extends</span> <span class="token class-name">EventObject</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * Constructs a prototypical Event.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">source</span> The object on which the Event initially occurred.
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IllegalArgumentException</span></span> if source is null.
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">ApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">Object</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä»¥ç»§æ‰¿ java.util.EventObject å®šä¹‰å‡ºå…·å¤‡äº‹ä»¶åŠŸèƒ½çš„æŠ½è±¡ç±» ApplicationEventï¼Œåç»­æ‰€æœ‰äº‹ä»¶çš„ç±»éƒ½éœ€è¦ç»§æ‰¿è¿™ä¸ªç±»ã€‚</li></ul><p><strong>cn.bugstack.springframework.context.event.ApplicationContextEvent</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationContextEvent</span> <span class="token keyword">extends</span> <span class="token class-name">ApplicationEvent</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * Constructs a prototypical Event.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">source</span> The object on which the Event initially occurred.
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IllegalArgumentException</span></span> if source is null.
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">ApplicationContextEvent</span><span class="token punctuation">(</span><span class="token class-name">Object</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Get the <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span><span class="token code-section"><span class="token line"><span class="token code language-java"><span class="token class-name">ApplicationContext</span></span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span> that the event was raised for.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">ApplicationContext</span> <span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span><span class="token punctuation">)</span> <span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>cn.bugstack.springframework.context.event.ContextClosedEvent</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ContextClosedEvent</span> <span class="token keyword">extends</span> <span class="token class-name">ApplicationContextEvent</span><span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * Constructs a prototypical Event.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">source</span> The object on which the Event initially occurred.
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IllegalArgumentException</span></span> if source is null.
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">ContextClosedEvent</span><span class="token punctuation">(</span><span class="token class-name">Object</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>cn.bugstack.springframework.context.event.ContextRefreshedEvent</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ContextRefreshedEvent</span> <span class="token keyword">extends</span> <span class="token class-name">ApplicationContextEvent</span><span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * Constructs a prototypical Event.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">source</span> The object on which the Event initially occurred.
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IllegalArgumentException</span></span> if source is null.
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">ContextRefreshedEvent</span><span class="token punctuation">(</span><span class="token class-name">Object</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ApplicationEvent æ˜¯å®šä¹‰äº‹ä»¶çš„æŠ½è±¡ç±»ï¼Œæ‰€æœ‰çš„äº‹ä»¶åŒ…æ‹¬å…³é—­ã€åˆ·æ–°ï¼Œä»¥åŠç”¨æˆ·è‡ªå·±å®ç°çš„äº‹ä»¶ï¼Œéƒ½éœ€è¦ç»§æ‰¿è¿™ä¸ªç±»ã€‚</li><li>ContextClosedEventã€ContextRefreshedEventï¼Œåˆ†åˆ«æ˜¯ Spring æ¡†æ¶è‡ªå·±å®ç°çš„ä¸¤ä¸ªäº‹ä»¶ç±»ï¼Œå¯ä»¥ç”¨äºç›‘å¬åˆ·æ–°å’Œå…³é—­åŠ¨ä½œã€‚</li></ul><h3 id="_3-äº‹ä»¶å¹¿æ’­å™¨" tabindex="-1"><a class="header-anchor" href="#_3-äº‹ä»¶å¹¿æ’­å™¨" aria-hidden="true">#</a> 3. äº‹ä»¶å¹¿æ’­å™¨</h3><p><strong>cn.bugstack.springframework.context.event.ApplicationEventMulticaster</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApplicationEventMulticaster</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * Add a listener to be notified of all events.
     * <span class="token keyword">@param</span> <span class="token parameter">listener</span> the listener to add
     */</span>
    <span class="token keyword">void</span> <span class="token function">addApplicationListener</span><span class="token punctuation">(</span><span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * Remove a listener from the notification list.
     * <span class="token keyword">@param</span> <span class="token parameter">listener</span> the listener to remove
     */</span>
    <span class="token keyword">void</span> <span class="token function">removeApplicationListener</span><span class="token punctuation">(</span><span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * Multicast the given application event to appropriate listeners.
     * <span class="token keyword">@param</span> <span class="token parameter">event</span> the event to multicast
     */</span>
    <span class="token keyword">void</span> <span class="token function">multicastEvent</span><span class="token punctuation">(</span><span class="token class-name">ApplicationEvent</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨äº‹ä»¶å¹¿æ’­å™¨ä¸­å®šä¹‰äº†æ·»åŠ ç›‘å¬å’Œåˆ é™¤ç›‘å¬çš„æ–¹æ³•ä»¥åŠä¸€ä¸ªå¹¿æ’­äº‹ä»¶çš„æ–¹æ³• <code>multicastEvent</code> æœ€ç»ˆæ¨é€æ—¶é—´æ¶ˆæ¯ä¹Ÿä¼šç»è¿‡è¿™ä¸ªæ¥å£æ–¹æ³•æ¥å¤„ç†è°è¯¥æ¥æ”¶äº‹ä»¶ã€‚</li></ul><p><strong>cn.bugstack.springframework.context.event.AbstractApplicationEventMulticaster</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractApplicationEventMulticaster</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationEventMulticaster</span><span class="token punctuation">,</span> <span class="token class-name">BeanFactoryAware</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationListener</span><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationEvent</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> applicationListeners <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">BeanFactory</span> beanFactory<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addApplicationListener</span><span class="token punctuation">(</span><span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> listener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        applicationListeners<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationEvent</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeApplicationListener</span><span class="token punctuation">(</span><span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> listener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        applicationListeners<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">setBeanFactory</span><span class="token punctuation">(</span><span class="token class-name">BeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory <span class="token operator">=</span> beanFactory<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationListener</span><span class="token punctuation">&gt;</span></span> <span class="token function">getApplicationListeners</span><span class="token punctuation">(</span><span class="token class-name">ApplicationEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationListener</span><span class="token punctuation">&gt;</span></span> allListeners <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationListener</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationEvent</span><span class="token punctuation">&gt;</span></span> listener <span class="token operator">:</span> applicationListeners<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">supportsEvent</span><span class="token punctuation">(</span>listener<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">)</span> allListeners<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> allListeners<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * ç›‘å¬å™¨æ˜¯å¦å¯¹è¯¥äº‹ä»¶æ„Ÿå…´è¶£
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">supportsEvent</span><span class="token punctuation">(</span><span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationEvent</span><span class="token punctuation">&gt;</span></span> applicationListener<span class="token punctuation">,</span> <span class="token class-name">ApplicationEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">ApplicationListener</span><span class="token punctuation">&gt;</span></span> listenerClass <span class="token operator">=</span> applicationListener<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æŒ‰ç…§ CglibSubclassingInstantiationStrategyã€SimpleInstantiationStrategy ä¸åŒçš„å®ä¾‹åŒ–ç±»å‹ï¼Œéœ€è¦åˆ¤æ–­åè·å–ç›®æ ‡ class</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> targetClass <span class="token operator">=</span> <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">isCglibProxyClass</span><span class="token punctuation">(</span>listenerClass<span class="token punctuation">)</span> <span class="token operator">?</span> listenerClass<span class="token punctuation">.</span><span class="token function">getSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> listenerClass<span class="token punctuation">;</span>
        <span class="token class-name">Type</span> genericInterface <span class="token operator">=</span> targetClass<span class="token punctuation">.</span><span class="token function">getGenericInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token class-name">Type</span> actualTypeArgument <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ParameterizedType</span><span class="token punctuation">)</span> genericInterface<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getActualTypeArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> className <span class="token operator">=</span> actualTypeArgument<span class="token punctuation">.</span><span class="token function">getTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> eventClassName<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            eventClassName <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeansException</span><span class="token punctuation">(</span><span class="token string">&quot;wrong event class name: &quot;</span> <span class="token operator">+</span> className<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// åˆ¤å®šæ­¤ eventClassName å¯¹è±¡æ‰€è¡¨ç¤ºçš„ç±»æˆ–æ¥å£ä¸æŒ‡å®šçš„ event.getClass() å‚æ•°æ‰€è¡¨ç¤ºçš„ç±»æˆ–æ¥å£æ˜¯å¦ç›¸åŒï¼Œæˆ–æ˜¯å¦æ˜¯å…¶è¶…ç±»æˆ–è¶…æ¥å£ã€‚</span>
        <span class="token comment">// isAssignableFromæ˜¯ç”¨æ¥åˆ¤æ–­å­ç±»å’Œçˆ¶ç±»çš„å…³ç³»çš„ï¼Œæˆ–è€…æ¥å£çš„å®ç°ç±»å’Œæ¥å£çš„å…³ç³»çš„ï¼Œé»˜è®¤æ‰€æœ‰çš„ç±»çš„ç»ˆæçˆ¶ç±»éƒ½æ˜¯Objectã€‚å¦‚æœA.isAssignableFrom(B)ç»“æœæ˜¯trueï¼Œè¯æ˜Bå¯ä»¥è½¬æ¢æˆä¸ºA,ä¹Ÿå°±æ˜¯Aå¯ä»¥ç”±Bè½¬æ¢è€Œæ¥ã€‚</span>
        <span class="token keyword">return</span> eventClassName<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>AbstractApplicationEventMulticaster æ˜¯å¯¹äº‹ä»¶å¹¿æ’­å™¨çš„å…¬ç”¨æ–¹æ³•æå–ï¼Œåœ¨è¿™ä¸ªç±»ä¸­å¯ä»¥å®ç°ä¸€äº›åŸºæœ¬åŠŸèƒ½ï¼Œé¿å…æ‰€æœ‰ç›´æ¥å®ç°æ¥å£æ”¾è¿˜éœ€è¦å¤„ç†ç»†èŠ‚ã€‚</li><li>é™¤äº†åƒ addApplicationListenerã€removeApplicationListenerï¼Œè¿™æ ·çš„é€šç”¨æ–¹æ³•ï¼Œè¿™é‡Œè¿™ä¸ªç±»ä¸­ä¸»è¦æ˜¯å¯¹ getApplicationListeners å’Œ supportsEvent çš„å¤„ç†ã€‚</li><li>getApplicationListeners æ–¹æ³•ä¸»è¦æ˜¯æ‘˜å–ç¬¦åˆå¹¿æ’­äº‹ä»¶ä¸­çš„ç›‘å¬å¤„ç†å™¨ï¼Œå…·ä½“è¿‡æ»¤åŠ¨ä½œåœ¨ supportsEvent æ–¹æ³•ä¸­ã€‚</li><li>åœ¨ supportsEvent æ–¹æ³•ä¸­ï¼Œä¸»è¦åŒ…æ‹¬å¯¹Cglibã€Simpleä¸åŒå®ä¾‹åŒ–éœ€è¦è·å–ç›®æ ‡Classï¼ŒCglibä»£ç†ç±»éœ€è¦è·å–çˆ¶ç±»çš„Classï¼Œæ™®é€šå®ä¾‹åŒ–çš„ä¸éœ€è¦ã€‚æ¥ä¸‹æ¥å°±æ˜¯é€šè¿‡æå–æ¥å£å’Œå¯¹åº”çš„ ParameterizedType å’Œ eventClassNameï¼Œæ–¹ä¾¿æœ€åç¡®è®¤æ˜¯å¦ä¸ºå­ç±»å’Œçˆ¶ç±»çš„å…³ç³»ï¼Œä»¥æ­¤è¯æ˜æ­¤äº‹ä»¶å½’è¿™ä¸ªç¬¦åˆçš„ç±»å¤„ç†ã€‚<em>å¯ä»¥å‚è€ƒä»£ç ä¸­çš„æ³¨é‡Š</em></li></ul><p><strong>supportsEvent æ–¹æ³•è¿è¡Œæˆªå›¾</strong></p><p><img src="https://bugstack.cn/assets/images/spring/spring-11-03.png" alt=""></p><ul><li>åœ¨ä»£ç è°ƒè¯•ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæœ€ç»ˆ eventClassName å’Œ event.getClass() åœ¨ isAssignableFrom åˆ¤æ–­ä¸‹ä¸º true</li><li>å…³äº CglibSubclassingInstantiationStrategyã€SimpleInstantiationStrategy å¯ä»¥å°è¯•åœ¨ AbstractApplicationContext ç±»ä¸­æ›´æ¢éªŒè¯ã€‚</li></ul><h3 id="_4-äº‹ä»¶å‘å¸ƒè€…çš„å®šä¹‰å’Œå®ç°" tabindex="-1"><a class="header-anchor" href="#_4-äº‹ä»¶å‘å¸ƒè€…çš„å®šä¹‰å’Œå®ç°" aria-hidden="true">#</a> 4. äº‹ä»¶å‘å¸ƒè€…çš„å®šä¹‰å’Œå®ç°</h3><p><strong>cn.bugstack.springframework.context.ApplicationEventPublisher</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApplicationEventPublisher</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * Notify all listeners registered with this application of an application
     * event. Events may be framework events (such as RequestHandledEvent)
     * or application-specific events.
     * <span class="token keyword">@param</span> <span class="token parameter">event</span> the event to publish
     */</span>
    <span class="token keyword">void</span> <span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token class-name">ApplicationEvent</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ApplicationEventPublisher æ˜¯æ•´ä¸ªä¸€ä¸ªäº‹ä»¶çš„å‘å¸ƒæ¥å£ï¼Œæ‰€æœ‰çš„äº‹ä»¶éƒ½éœ€è¦ä»è¿™ä¸ªæ¥å£å‘å¸ƒå‡ºå»ã€‚</li></ul><p><strong>cn.bugstack.springframework.context.support.AbstractApplicationContext</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractApplicationContext</span> <span class="token keyword">extends</span> <span class="token class-name">DefaultResourceLoader</span> <span class="token keyword">implements</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">APPLICATION_EVENT_MULTICASTER_BEAN_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;applicationEventMulticaster&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">ApplicationEventMulticaster</span> applicationEventMulticaster<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>

        <span class="token comment">// 6. åˆå§‹åŒ–äº‹ä»¶å‘å¸ƒè€…</span>
        <span class="token function">initApplicationEventMulticaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 7. æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨</span>
        <span class="token function">registerListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 9. å‘å¸ƒå®¹å™¨åˆ·æ–°å®Œæˆäº‹ä»¶</span>
        <span class="token function">finishRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initApplicationEventMulticaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        applicationEventMulticaster <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleApplicationEventMulticaster</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        beanFactory<span class="token punctuation">.</span><span class="token function">registerSingleton</span><span class="token punctuation">(</span><span class="token constant">APPLICATION_EVENT_MULTICASTER_BEAN_NAME</span><span class="token punctuation">,</span> applicationEventMulticaster<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">registerListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationListener</span><span class="token punctuation">&gt;</span></span> applicationListeners <span class="token operator">=</span> <span class="token function">getBeansOfType</span><span class="token punctuation">(</span><span class="token class-name">ApplicationListener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ApplicationListener</span> listener <span class="token operator">:</span> applicationListeners<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            applicationEventMulticaster<span class="token punctuation">.</span><span class="token function">addApplicationListener</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">finishRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ContextRefreshedEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token class-name">ApplicationEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        applicationEventMulticaster<span class="token punctuation">.</span><span class="token function">multicastEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å‘å¸ƒå®¹å™¨å…³é—­äº‹ä»¶</span>
        <span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ContextClosedEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ‰§è¡Œé”€æ¯å•ä¾‹beançš„é”€æ¯æ–¹æ³•</span>
        <span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">destroySingletons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨æŠ½è±¡åº”ç”¨ä¸Šä¸‹æ–‡ AbstractApplicationContext#refresh ä¸­ï¼Œä¸»è¦æ–°å¢äº† <code>åˆå§‹åŒ–äº‹ä»¶å‘å¸ƒè€…</code>ã€<code>æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨</code>ã€<code>å‘å¸ƒå®¹å™¨åˆ·æ–°å®Œæˆäº‹ä»¶</code>ï¼Œä¸‰ä¸ªæ–¹æ³•ç”¨äºå¤„ç†äº‹ä»¶æ“ä½œã€‚</li><li>åˆå§‹åŒ–äº‹ä»¶å‘å¸ƒè€…(initApplicationEventMulticaster)ï¼Œä¸»è¦ç”¨äºå®ä¾‹åŒ–ä¸€ä¸ª SimpleApplicationEventMulticasterï¼Œè¿™æ˜¯ä¸€ä¸ªäº‹ä»¶å¹¿æ’­å™¨ã€‚</li><li>æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨(registerListeners)ï¼Œé€šè¿‡ getBeansOfType æ–¹æ³•è·å–åˆ°æ‰€æœ‰ä» spring.xml ä¸­åŠ è½½åˆ°çš„äº‹ä»¶é…ç½® Bean å¯¹è±¡ã€‚</li><li>å‘å¸ƒå®¹å™¨åˆ·æ–°å®Œæˆäº‹ä»¶(finishRefresh)ï¼Œå‘å¸ƒäº†ç¬¬ä¸€ä¸ªæœåŠ¡å™¨å¯åŠ¨å®Œæˆåçš„äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶é€šè¿‡ publishEvent å‘å¸ƒå‡ºå»ï¼Œå…¶å®ä¹Ÿå°±æ˜¯è°ƒç”¨äº† applicationEventMulticaster.multicastEvent(event); æ–¹æ³•ã€‚</li><li>æœ€åæ˜¯ä¸€ä¸ª close æ–¹æ³•ä¸­ï¼Œæ–°å¢åŠ äº†å‘å¸ƒä¸€ä¸ªå®¹å™¨å…³é—­äº‹ä»¶ã€‚<code>publishEvent(new ContextClosedEvent(this));</code></li></ul><h2 id="äº”ã€æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#äº”ã€æµ‹è¯•" aria-hidden="true">#</a> äº”ã€æµ‹è¯•</h2><h3 id="_1-åˆ›å»ºä¸€ä¸ªäº‹ä»¶å’Œç›‘å¬å™¨" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºä¸€ä¸ªäº‹ä»¶å’Œç›‘å¬å™¨" aria-hidden="true">#</a> 1. åˆ›å»ºä¸€ä¸ªäº‹ä»¶å’Œç›‘å¬å™¨</h3><p><strong>cn.bugstack.springframework.test.event.CustomEvent</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomEvent</span> <span class="token keyword">extends</span> <span class="token class-name">ApplicationContextEvent</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * Constructs a prototypical Event.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">source</span> The object on which the Event initially occurred.
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IllegalArgumentException</span></span> if source is null.
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span><span class="token class-name">Object</span> source<span class="token punctuation">,</span> <span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...get/set</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ï¼Œåœ¨äº‹ä»¶ç±»çš„æ„é€ å‡½æ•°ä¸­å¯ä»¥æ·»åŠ è‡ªå·±çš„æƒ³è¦çš„å…¥å‚ä¿¡æ¯ã€‚è¿™ä¸ªäº‹ä»¶ç±»æœ€ç»ˆä¼šè¢«å®Œæˆçš„æ‹¿åˆ°ç›‘å¬é‡Œï¼Œæ‰€ä»¥ä½ æ·»åŠ çš„å±æ€§éƒ½ä¼šè¢«è·å¾—åˆ°ã€‚</li></ul><p><strong>cn.bugstack.springframework.test.event.CustomEventListener</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomEventListener</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CustomEvent</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">CustomEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°ï¼š&quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æ¶ˆæ¯;æ—¶é—´ï¼š&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯ï¼š&quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¿™ä¸ªæ˜¯ä¸€ä¸ªç”¨äºç›‘å¬ CustomEvent äº‹ä»¶çš„ç›‘å¬å™¨ï¼Œè¿™é‡Œä½ å¯ä»¥å¤„ç†è‡ªå·±æƒ³è¦çš„æ“ä½œï¼Œæ¯”å¦‚ä¸€äº›ç”¨æˆ·æ³¨å†Œåå‘é€ä¼˜æƒ åˆ¸å’ŒçŸ­ä¿¡é€šçŸ¥ç­‰ã€‚</li><li>å¦å¤–æ˜¯å…³äº <code>ContextRefreshedEventListener implements ApplicationListener&lt;ContextRefreshedEvent&gt;</code>ã€<code>ContextClosedEventListener implements ApplicationListener&lt;ContextClosedEvent&gt;</code> ç›‘å¬å™¨ï¼Œè¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ï¼Œå¯ä»¥å‚è€ƒä¸‹æºç ã€‚</li></ul><h3 id="_2-é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> 2. é…ç½®æ–‡ä»¶</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.springframework.test.event.ContextRefreshedEventListener<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.springframework.test.event.CustomEventListener<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.bugstack.springframework.test.event.ContextClosedEventListener<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨ spring.xml ä¸­é…ç½®äº†ä¸‰ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œç›‘å¬åˆ·æ–°ã€ç›‘æ§è‡ªå®šä¹‰äº‹ä»¶ã€ç›‘å¬å…³é—­äº‹ä»¶ã€‚</li></ul><h3 id="_3-å•å…ƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-å•å…ƒæµ‹è¯•" aria-hidden="true">#</a> 3. å•å…ƒæµ‹è¯•</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApiTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_event</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ClassPathXmlApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:spring.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        applicationContext<span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span>applicationContext<span class="token punctuation">,</span> <span class="token number">1019129009086763L</span><span class="token punctuation">,</span> <span class="token string">&quot;æˆåŠŸäº†ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        applicationContext<span class="token punctuation">.</span><span class="token function">registerShutdownHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>é€šè¿‡ä½¿ç”¨ applicationContext æ–°å¢åŠ çš„å‘å¸ƒäº‹ä»¶æ¥å£æ–¹æ³•ï¼Œå‘å¸ƒä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ CustomEventï¼Œå¹¶é€ä¼ äº†ç›¸åº”çš„å‚æ•°ä¿¡æ¯ã€‚</li></ul><p><strong>æµ‹è¯•ç»“æœ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>åˆ·æ–°äº‹ä»¶ï¼š<span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>event<span class="token punctuation">.</span></span>ContextRefreshedEventListener</span>$$<span class="token class-name">EnhancerByCGLIB</span>$$<span class="token number">440</span>a36f5
æ”¶åˆ°ï¼š<span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>ClassPathXmlApplicationContext</span><span class="token annotation punctuation">@71c7db30</span>æ¶ˆæ¯<span class="token punctuation">;</span>æ—¶é—´ï¼š<span class="token number">22</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">50</span>
æ¶ˆæ¯ï¼š<span class="token number">1019129009086763</span><span class="token operator">:</span>æˆåŠŸäº†ï¼
å…³é—­äº‹ä»¶ï¼š<span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>bugstack<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>event<span class="token punctuation">.</span></span>ContextClosedEventListener</span>$$<span class="token class-name">EnhancerByCGLIB</span>$$f4d4b18d

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä»æµ‹è¯•ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„äº‹ä»¶å’Œç›‘å¬ï¼Œä»¥åŠç›‘å¬ç³»ç»Ÿçš„äº‹ä»¶ä¿¡æ¯ï¼Œéƒ½å¯ä»¥åœ¨æ§åˆ¶å°å®Œæ•´çš„è¾“å‡ºå‡ºæ¥äº†ã€‚ä½ ä¹Ÿå¯ä»¥å°è¯•å¢åŠ ä¸€äº›å…¶ä»–äº‹ä»¶è¡Œä¸ºï¼Œå¹¶è°ƒè¯•ä»£ç å­¦ä¹ è§‚å¯Ÿè€…æ¨¡å¼ã€‚</li></ul><h2 id="å…­ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#å…­ã€æ€»ç»“" aria-hidden="true">#</a> å…­ã€æ€»ç»“</h2><ul><li>åœ¨æ•´ä¸ªæ‰‹å†™ Spring æ¡†æ¶çš„å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥é€æ­¥çœ‹åˆ°å¾ˆå¤šè®¾è®¡æ¨¡å¼çš„ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼šç®€å•å·¥å‚BeanFactoryã€å·¥å‚æ–¹æ³•FactoryBeanã€ç­–ç•¥æ¨¡å¼è®¿é—®èµ„æºï¼Œç°åœ¨åˆå®ç°äº†ä¸€ä¸ªè§‚å¯Ÿè€…æ¨¡å¼çš„å…·ä½“ä½¿ç”¨ã€‚æ‰€ä»¥å­¦ä¹  Spring çš„è¿‡ç¨‹ä¸­ï¼Œè¦æ›´åŠ æ³¨æ„å…³äºè®¾è®¡æ¨¡å¼çš„è¿ç”¨ï¼Œè¿™æ˜¯ä½ èƒ½è¯»æ‡‚ä»£ç çš„æ ¸å¿ƒä¹Ÿæ˜¯å­¦ä¹ çš„é‡ç‚¹ã€‚</li><li>é‚£ä¹ˆæœ¬ç« èŠ‚å…³äºè§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°è¿‡ç¨‹ï¼Œä¸»è¦åŒ…æ‹¬äº†äº‹ä»¶çš„å®šä¹‰ã€äº‹ä»¶çš„ç›‘å¬å’Œå‘å¸ƒäº‹ä»¶ï¼Œå‘å¸ƒå®Œæˆåæ ¹æ®åŒ¹é…ç­–ç•¥ï¼Œç›‘å¬å™¨å°±ä¼šæ”¶åˆ°å±äºè‡ªå·±çš„äº‹ä»¶å†…å®¹ï¼Œå¹¶åšç›¸åº”çš„å¤„ç†åŠ¨ä½œï¼Œè¿™æ ·çš„è§‚å¯Ÿè€…æ¨¡å¼å…¶å®æ—¥å¸¸æˆ‘ä»¬ä¹Ÿç»å¸¸ä½¿ç”¨ï¼Œä¸è¿‡åœ¨ç»“åˆ Spring ä»¥åï¼Œé™¤äº†è®¾è®¡æ¨¡å¼çš„å­¦ä¹ ï¼Œè¿˜å¯ä»¥å­¦åˆ°å¦‚ä½•æŠŠç›¸åº”è§‚å¯Ÿè€…çš„å®ç°å’Œåº”ç”¨ä¸Šä¸‹æ–‡ç»“åˆã€‚</li><li>æ‰€æœ‰åœ¨ Spring å­¦ä¹ åˆ°çš„æŠ€æœ¯ã€è®¾è®¡ã€æ€è·¯éƒ½æ˜¯å¯ä»¥å’Œå®é™…çš„ä¸šåŠ¡å¼€å‘ç»“åˆèµ·æ¥çš„ï¼Œè€Œè¿™äº›çœ‹ä¼¼æ¯”è¾ƒå¤šçš„ä»£ç æ¨¡å—ï¼Œå…¶å®ä¹Ÿæ˜¯æŒ‰ç…§å„è‡ªèŒè´£ä¸€ç‚¹ç‚¹çš„æ‰©å……è¿›å»çš„ã€‚åœ¨è‡ªå·±çš„å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å…ˆåŠ¨æ‰‹å°è¯•å®Œæˆè¿™äº›æ¡†æ¶åŠŸèƒ½ï¼Œåœ¨ä¸€ç‚¹ç‚¹é€šè¿‡è°ƒè¯•çš„æ–¹å¼ä¸ Spring æºç è¿›è¡Œå¯¹ç…§å‚è€ƒï¼Œæœ€ç»ˆä¹Ÿå°±æ…¢æ…¢æŒæ¡è¿™äº›è®¾è®¡å’Œç¼–ç èƒ½åŠ›äº†ã€‚</li></ul><h2 id="ä¸ƒã€ä¼˜ç§€ä½œä¸š" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€ä¼˜ç§€ä½œä¸š" aria-hidden="true">#</a> ä¸ƒã€ä¼˜ç§€ä½œä¸š</h2>`,69),b={href:"https://t.zsxq.com/053BImQ7Q",target:"_blank",rel:"noopener noreferrer"},g={href:"https://t.zsxq.com/05zVRjeea",target:"_blank",rel:"noopener noreferrer"},h={href:"https://t.zsxq.com/063BiaYNb",target:"_blank",rel:"noopener noreferrer"},y={href:"https://t.zsxq.com/06fq7QN7u",target:"_blank",rel:"noopener noreferrer"},f={href:"https://t.zsxq.com/078oU4547",target:"_blank",rel:"noopener noreferrer"},w={href:"https://t.zsxq.com/08cC5bszS",target:"_blank",rel:"noopener noreferrer"},A={href:"https://t.zsxq.com/084TO0b4V",target:"_blank",rel:"noopener noreferrer"},E={href:"https://t.zsxq.com/09QUq9PDs",target:"_blank",rel:"noopener noreferrer"},C=n("li",null,[n("a",{href:"%5B%E6%AD%A2%E6%B0%B4%5D(https://t.zsxq.com/0aprAozce)"},"åœ¨icoå‰©ä¸‹çš„ä¸¤ç« ä¸­æˆ‘ä»¬æ¥åšå¯¹è±¡ä½œç”¨åŸŸçš„å¤„ç†ï¼Œå·¥å‚beanï¼Œå’Œspringäº‹ä»¶åŠŸèƒ½çš„å®ç° @æ­¢æ°´")],-1),x={href:"https://t.zsxq.com/0bi3RPi1V",target:"_blank",rel:"noopener noreferrer"};function j(_,L){const a=p("ExternalLinkIcon");return c(),i("div",null,[u,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),r,s("åšå®¢ï¼š"),n("a",d,[s("https://bugstack.cn"),e(a)]),k,s("åŸæ–‡ï¼š"),n("a",v,[s("https://mp.weixin.qq.com/s/wf5XiY4AjFETLQZxEwcCEQ"),e(a)])]),m,n("ul",null,[n("li",null,[n("a",b,[s("åœ¨é¢å‘ç”¨æˆ·çš„åº”ç”¨ä¸Šä¸‹æ–‡ä¸­è®¾è®¡äº‹ä»¶ By Ray"),e(a)])]),n("li",null,[n("a",g,[s("SpringIOC XMLå¤ä¹  By ç¼–ç¨‹å°èœé¸¡"),e(a)])]),n("li",null,[n("a",h,[s("å½“å®¹å™¨å†…éƒ¨å®Œæˆä¸€äº›æ“ä½œæ—¶ï¼Œæ¯”å¦‚è¯´å®¹å™¨å®Œæˆåˆ·æ–°åéœ€è¦æ‰©å±•ä¸€äº›æ–°çš„åŠŸèƒ½ï¼Œå¹¶æ²¡æœ‰ç•™ç»™å¼€å‘è€…æ›´å¤šçš„æ‰©å±•æ¥å£"),e(a)])]),n("li",null,[n("a",y,[s("é€šè¿‡è¿™ä¸€ç« æˆ‘ä¹Ÿå›é¡¾äº†ä¸€ä¸‹å‰é¢çš„çŸ¥è¯†ï¼Œå‘ç°å‰é¢çš„çŸ¥è¯†æ˜¯å¯ä»¥ä¸²èµ·æ¥çš„"),e(a)])]),n("li",null,[n("a",f,[s("å®¹å™¨äº‹ä»¶å’Œäº‹ä»¶ç›‘å¬å™¨ @liuc"),e(a)])]),n("li",null,[n("a",w,[s("åŸºäºè§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ç° Spring ä¸­çš„äº‹ä»¶æœºåˆ¶ @Homage"),e(a)])]),n("li",null,[n("a",A,[s("é€šè¿‡è§‚å¯Ÿè€…æ¨¡å¼çš„æ–¹å¼ï¼Œè®¾è®¡å’Œå®ç° Spring Event çš„å®¹å™¨äº‹ä»¶å’Œäº‹ä»¶ç›‘å¬å™¨åŠŸèƒ½ @æ°´ä¸­ææœˆ"),e(a)])]),n("li",null,[n("a",E,[s("æ‰‹æ’¸Springä¹‹IOCéƒ¨åˆ†æµç¨‹æ¢³ç† @CCAT"),e(a)])]),C,n("li",null,[n("a",x,[s("AOPï¼Œé¦–å…ˆå¼„æ˜ç™½æ˜¯ä»€ä¹ˆæ„æ€ï¼Œaspect oriented programming @lucien"),e(a)])])])])}const S=t(o,[["render",j],["__file","2021-07-07-di11zhangï¼šgengshangcenglouï¼Œjiyuguanchazheshixianï¼Œrongqishijianheshijianjiantingqi.html.vue"]]);export{S as default};
