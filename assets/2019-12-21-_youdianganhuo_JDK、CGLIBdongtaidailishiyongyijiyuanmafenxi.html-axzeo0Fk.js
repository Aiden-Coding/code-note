import{_ as e,r as p,o as c,c as o,a as n,b as s,d as t,e as l}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"æœ‰ç‚¹å¹²è´§-jdkã€cglibåŠ¨æ€ä»£ç†ä½¿ç”¨ä»¥åŠæºç åˆ†æ",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#æœ‰ç‚¹å¹²è´§-jdkã€cglibåŠ¨æ€ä»£ç†ä½¿ç”¨ä»¥åŠæºç åˆ†æ","aria-hidden":"true"},"#"),s(" æœ‰ç‚¹å¹²è´§ | JDKã€CGLIBåŠ¨æ€ä»£ç†ä½¿ç”¨ä»¥åŠæºç åˆ†æ")],-1),k=n("br",null,null,-1),r={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=n("blockquote",null,[n("p",null,"æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„")],-1),v=n("h2",{id:"å‰è¨€ä»‹ç»",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#å‰è¨€ä»‹ç»","aria-hidden":"true"},"#"),s(" å‰è¨€ä»‹ç»")],-1),m=n("p",null,"åœ¨Javaä¸­åŠ¨æ€ä»£ç†æ˜¯éå¸¸é‡è¦ä¹Ÿæ˜¯éå¸¸æœ‰ç”¨çš„ä¸€ä¸ªæŠ€æœ¯ç‚¹ï¼Œå¦‚æœæ²¡æœ‰åŠ¨æ€ä»£ç†æŠ€æœ¯å‡ ä¹ä¹Ÿå°±ä¸ä¼šæœ‰å„ç§ä¼˜ç§€æ¡†æ¶çš„å‡ºç°ï¼ŒåŒ…æ‹¬Springã€‚ å…¶å®åœ¨åŠ¨æ€ä»£ç†çš„ä½¿ç”¨ä¸­ï¼Œé™¤äº†æˆ‘ä»¬å¹³æ—¶ç”¨çš„Springè¿˜æœ‰å¾ˆå¤šä¸­é—´ä»¶å’ŒæœåŠ¡éƒ½ç”¨äº†åŠ¨æ€ä»£ç†ï¼Œä¾‹å¦‚ï¼›",-1),b=n("li",null,"RPCé€šä¿¡æ¡†æ¶Dubboï¼Œåœ¨é€šä¿¡çš„æ—¶å€™ç”±æœåŠ¡ç«¯æä¾›ä¸€ä¸ªæ¥å£æè¿°ä¿¡æ¯çš„Jarï¼Œè°ƒç”¨ç«¯è¿›è¡Œå¼•ç”¨ï¼Œä¹‹ååœ¨è°ƒç”¨ç«¯å¼•ç”¨åç”Ÿæˆäº†å¯¹åº”çš„ä»£ç†ç±»ï¼Œå½“æ‰§è¡Œæ–¹æ³•è°ƒç”¨çš„æ—¶å€™ï¼Œå®é™…éœ€è¦èµ°åˆ°ä»£ç†ç±»å‘æœåŠ¡æä¾›ç«¯å‘é€è¯·æ±‚ä¿¡æ¯ï¼Œç›´è‡³å†…å®¹å›ä¼ ã€‚",-1),y=n("li",null,"å¦å¤–åœ¨ä½¿ç”¨Mybatisæ—¶å€™å¯ä»¥çŸ¥é“åªéœ€è¦å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œä¸éœ€è¦å®ç°å…·ä½“æ–¹æ³•å°±å¯ä»¥è°ƒç”¨åˆ°Mapperä¸­å®šä¹‰çš„æ•°æ®åº“æ“ä½œä¿¡æ¯äº†ã€‚è¿™æ ·æå¤§çš„ç®€åŒ–äº†ä»£ç çš„å¼€å‘ï¼Œåˆå¢å¼ºäº†æ•ˆç‡ã€‚",-1),g=n("strong",null,"æ¨èä¸ªæ¡ˆä¾‹ï¼Œæ–¹ä¾¿çŸ¥é“ä»£ç†ç±»çš„åº”ç”¨ï¼š",-1),h={href:"https://bugstack.cn/itstack-demo-netty-3/2019/09/03/%E6%89%8B%E5%86%99RPC%E6%A1%86%E6%9E%B6%E7%AC%AC%E4%B8%89%E7%AB%A0-RPC%E4%B8%AD%E9%97%B4%E4%BB%B6.html",target:"_blank",rel:"noopener noreferrer"},w=l(`<h2 id="ä»£ç†æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#ä»£ç†æ–¹å¼" aria-hidden="true">#</a> ä»£ç†æ–¹å¼</h2><p>åŠ¨æ€ä»£ç†å¯ä»¥ä½¿ç”¨Jdkæ–¹å¼ä¹Ÿå¯ä»¥ä½¿ç”¨CGLBï¼Œä»–ä»¬çš„åŒºåˆ«ï¼Œå¦‚ä¸‹ï¼›</p><table><thead><tr><th style="text-align:left;">ç±»å‹</th><th style="text-align:left;">æœºåˆ¶</th><th style="text-align:left;">å›è°ƒæ–¹å¼</th><th style="text-align:left;">é€‚ç”¨åœºæ™¯</th><th style="text-align:left;">æ•ˆç‡</th></tr></thead><tbody><tr><td style="text-align:left;">JDK</td><td style="text-align:left;">å§”æ‰˜æœºåˆ¶ï¼Œä»£ç†ç±»å’Œç›®æ ‡ç±»éƒ½å®ç°äº†åŒæ ·çš„æ¥å£ï¼ŒInvocationHandleræŒæœ‰ç›®æ ‡ç±»ï¼Œä»£ç†ç±»å§”æ‰˜InvocationHandlerå»è°ƒç”¨ç›®æ ‡ç±»çš„åŸå§‹æ–¹æ³•</td><td style="text-align:left;">åå°„</td><td style="text-align:left;">ç›®æ ‡ç±»æ˜¯æ¥å£ç±»</td><td style="text-align:left;">æ•ˆç‡ç“¶é¢ˆåœ¨åå°„è°ƒç”¨ç¨æ…¢</td></tr><tr><td style="text-align:left;">CGLIB</td><td style="text-align:left;">ç»§æ‰¿æœºåˆ¶ï¼Œä»£ç†ç±»ç»§æ‰¿äº†ç›®æ ‡ç±»å¹¶é‡å†™äº†ç›®æ ‡æ–¹æ³•ï¼Œé€šè¿‡å›è°ƒå‡½æ•°MethodInterceptorè°ƒç”¨çˆ¶ç±»æ–¹æ³•æ‰§è¡ŒåŸå§‹é€»è¾‘</td><td style="text-align:left;">é€šè¿‡FastClassæ–¹æ³•ç´¢å¼•è°ƒç”¨</td><td style="text-align:left;">éæ¥å£ç±»ï¼Œéfinalç±»ï¼Œéfinalæ–¹æ³•</td><td style="text-align:left;">ç¬¬ä¸€æ¬¡è°ƒç”¨å› ä¸ºè¦ç”Ÿæˆå¤šä¸ªClasså¯¹è±¡è¾ƒJDKæ–¹å¼æ…¢ï¼Œå¤šæ¬¡è°ƒç”¨å› ä¸ºæœ‰æ–¹æ³•ç´¢å¼•è¾ƒåå°„æ–¹å¼å¿«ï¼Œå¦‚æœæ–¹æ³•è¿‡å¤šswitch caseè¿‡å¤šå…¶æ•ˆç‡è¿˜éœ€æµ‹è¯•</td></tr></tbody></table><h2 id="æ¡ˆä¾‹å·¥ç¨‹" tabindex="-1"><a class="header-anchor" href="#æ¡ˆä¾‹å·¥ç¨‹" aria-hidden="true">#</a> æ¡ˆä¾‹å·¥ç¨‹</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>demo<span class="token operator">-</span>test
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo
    â”‚           â”œâ”€â”€ proxy
    â”‚           â”‚	â””â”€â”€ cglib
    â”‚           â”‚	    â””â”€â”€ <span class="token class-name">CglibProxy</span><span class="token punctuation">.</span>java
    â”‚           â”œâ”€â”€ jdk	
    â”‚           â”‚	â”œâ”€â”€ reflect
    â”‚           â”‚	â”‚   â”œâ”€â”€ <span class="token class-name">JDKInvocationHandler</span><span class="token punctuation">.</span>java
    â”‚           â”‚	â”‚   â””â”€â”€ <span class="token class-name">JDKProxy</span><span class="token punctuation">.</span>java		
    â”‚           â”‚   â””â”€â”€ util
    â”‚           â”‚	    â””â”€â”€ <span class="token class-name">ClassLoaderUtils</span><span class="token punctuation">.</span>java	
    â”‚           â””â”€â”€ service
    â”‚           	â”œâ”€â”€ <span class="token class-name">IUserService</span><span class="token punctuation">.</span>java
    â”‚           	â””â”€â”€ <span class="token class-name">UserService</span><span class="token punctuation">.</span>java	
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test
                â””â”€â”€ <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åŸºç¡€æ¥å£å’Œæ–¹æ³•ä¾¿äºéªŒè¯" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¥å£å’Œæ–¹æ³•ä¾¿äºéªŒè¯" aria-hidden="true">#</a> åŸºç¡€æ¥å£å’Œæ–¹æ³•ä¾¿äºéªŒè¯</h3><blockquote><p>service/IUserService.java</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IUserService</span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> <span class="token function">queryUserNameById</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>service/UserService.java</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token keyword">implements</span> <span class="token class-name">IUserService</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">queryUserNameById</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;hi user &quot;</span> <span class="token operator">+</span> userId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="jdkåŠ¨æ€ä»£ç†" tabindex="-1"><a class="header-anchor" href="#jdkåŠ¨æ€ä»£ç†" aria-hidden="true">#</a> JDKåŠ¨æ€ä»£ç†</h3><blockquote><p>reflect/JDKInvocationHandler.java &amp; ä»£ç†ç±»åå°„è°ƒç”¨</p></blockquote><ul><li>å®ç°InvocationHandler.invokeï¼Œç”¨äºæ–¹æ³•å¢å¼ºï½›ç›‘æ§ã€æ‰§è¡Œå…¶ä»–ä¸šåŠ¡é€»è¾‘ã€è¿œç¨‹è°ƒç”¨ç­‰ï½</li><li>å¦‚æœæœ‰éœ€è¦é¢å¤–çš„å‚æ•°å¯ä»¥æä¾›æ„é€ æ–¹æ³•</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDKInvocationHandler</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;æˆ‘è¢«JDKProxyä»£ç†äº†&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>reflect/JDKProxy.java &amp; å®šä¹‰ä¸€ä¸ªä»£ç†ç±»è·å–çš„æœåŠ¡</p></blockquote><ul><li>Proxy.newProxyInstance æ¥å®é™…ç”Ÿæˆä»£ç†ç±»ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼› <ol><li>Class&lt;?&gt; cl = getProxyClass0(loader, intfs); æŸ¥æ‰¾æˆ–ç”ŸæˆæŒ‡å®šçš„ä»£ç†ç±»</li><li>proxyClassCache.get(loader, interfaces); ä»£ç†ç±»çš„ç¼“å­˜ä¸­è·å–</li><li>subKeyFactory.apply(key, parameter) ç»§ç»­ä¸‹ä¸€å±‚</li><li>byte[] proxyClassFile = ProxyGenerator.generateProxyClass(proxyName, interfaces, accessFlags); ç”Ÿæˆä»£ç†ç±»çš„å­—èŠ‚ç </li></ol></li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDKProxy</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> interfaceClass<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">InvocationHandler</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JDKInvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token class-name">ClassLoaderUtils</span><span class="token punctuation">.</span><span class="token function">getCurrentClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>interfaceClass<span class="token punctuation">}</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ApiTest.test_proxy_jdk() &amp; æ‰§è¡Œè°ƒç”¨å¹¶è¾“å‡ºåå°„ç±»çš„å­—èŠ‚ç </p></blockquote><ul><li>ä»£ç†åè°ƒç”¨æ–¹æ³•éªŒè¯</li><li>é€šè¿‡ä½¿ç”¨ProxyGenerator.generateProxyClassè·å–å®é™…çš„å­—èŠ‚ç ï¼ŒæŸ¥çœ‹ä»£ç†ç±»çš„å†…å®¹</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_proxy_jdk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

	<span class="token class-name">IUserService</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">IUserService</span><span class="token punctuation">)</span> <span class="token class-name">JDKProxy</span><span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token class-name">ClassLoaderUtils</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;org.itstack.demo.service.IUserService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> userName <span class="token operator">=</span> proxy<span class="token punctuation">.</span><span class="token function">queryUserNameById</span><span class="token punctuation">(</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;ProxyUserService&quot;</span><span class="token punctuation">;</span>
	<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token class-name">ProxyGenerator</span><span class="token punctuation">.</span><span class="token function">generateProxyClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">IUserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// è¾“å‡ºç±»å­—èŠ‚ç </span>
	<span class="token class-name">FileOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">&quot;.class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> out<span class="token punctuation">)</span> <span class="token keyword">try</span> <span class="token punctuation">{</span>
			out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è¾“å‡ºç»“æœ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>queryUserNameById
æˆ‘è¢«<span class="token class-name">JDKProxy</span>ä»£ç†äº†
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å°†ç”Ÿæˆçš„ä»£ç†ç±»è¿›è¡Œåç¼–è¯‘jd-gui</strong></p><p>éƒ¨åˆ†å†…å®¹æŠ½å–ï¼Œå¯ä»¥çœ‹åˆ°æ¯”è¾ƒæ ¸å¿ƒçš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨è°ƒç”¨çš„æ—¶å€™èµ°åˆ°äº†è¿™é‡Œ</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token function">queryUserNameById</span><span class="token punctuation">(</span><span class="token class-name">String</span> paramString<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> 
<span class="token punctuation">{</span>
<span class="token keyword">try</span>
<span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>h<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> m3<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> paramString <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Error</span><span class="token operator">|</span><span class="token class-name">RuntimeException</span> localError<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">throw</span> localError<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> localThrowable<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UndeclaredThrowableException</span><span class="token punctuation">(</span>localThrowable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
  

<span class="token keyword">static</span>
<span class="token punctuation">{</span>
<span class="token keyword">try</span>
<span class="token punctuation">{</span>
  m1 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Object&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;equals&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Object&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  m2 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Object&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;toString&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  m0 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Object&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;hashCode&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  m3 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;org.itstack.demo.service.IUserService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;queryUserNameById&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.String&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchMethodException</span> localNoSuchMethodException<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchMethodError</span><span class="token punctuation">(</span>localNoSuchMethodException<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> localClassNotFoundException<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoClassDefFoundError</span><span class="token punctuation">(</span>localClassNotFoundException<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cglibåŠ¨æ€ä»£ç†" tabindex="-1"><a class="header-anchor" href="#cglibåŠ¨æ€ä»£ç†" aria-hidden="true">#</a> CGLIBåŠ¨æ€ä»£ç†</h3><blockquote><p>cglib/CglibProxy.java</p></blockquote><ul><li>æä¾›æ„é€ æ–¹æ³•ï¼Œç”ŸæˆCGLIBçš„ä»£ç†ç±»ï¼Œå›è°ƒthis</li><li>interceptå¯ä»¥è¿›è¡Œæ–¹æ³•çš„å¢å¼ºï¼Œå¤„ç†ç›¸å…³ä¸šåŠ¡é€»è¾‘</li><li>CGLIBæ˜¯é€šè¿‡ASMæ¥æ“ä½œå­—èŠ‚ç ç”Ÿæˆç±»</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CglibProxy</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">newInstall</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Enhancer</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> objects<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> methodProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æˆ‘è¢«CglibProxyä»£ç†äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> methodProxy<span class="token punctuation">.</span><span class="token function">invokeSuper</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> objects<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ApiTest.test_proxy_cglib() &amp; è°ƒç”¨ä»£ç†ç±»</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test_proxy_cglib</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CglibProxy</span> cglibProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CglibProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span> cglibProxy<span class="token punctuation">.</span><span class="token function">newInstall</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> userName <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">queryUserNameById</span><span class="token punctuation">(</span><span class="token string">&quot;10001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è¾“å‡ºç»“æœ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>æˆ‘è¢«<span class="token class-name">CglibProxy</span>ä»£ç†äº†
hi user <span class="token number">10001</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç»¼ä¸Šæ€»ç»“" tabindex="-1"><a class="header-anchor" href="#ç»¼ä¸Šæ€»ç»“" aria-hidden="true">#</a> ç»¼ä¸Šæ€»ç»“</h2><ul><li>åœ¨æˆ‘ä»¬å®é™…ä½¿ç”¨ä¸­ä¸¤ç§æ–¹å¼éƒ½ç”¨æ‰€æœ‰ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä¾ç…§ä¸åŒçš„è¯‰æ±‚è¿›è¡Œé€‰æ‹©</li><li>å¾€å¾€åŠ¨æ€ä»£ç†ä¼šå’Œæ³¨è§£å…±åŒä½¿ç”¨ï¼Œä»£ç†ç±»æ‹¿åˆ°ä»¥åè·å–æ–¹æ³•çš„æ³¨è§£ï¼Œå¹¶åšç›¸åº”çš„ä¸šåŠ¡æ“ä½œ</li><li>æœ‰æ—¶å€™ä½ æ˜¯å¦ä¼šé‡åˆ°å¢åŠ AOPä¸ç”Ÿæ•ˆï¼Œå› ä¸ºæœ‰æ—¶å€™æœ‰äº›ç±»æ˜¯è¢«ä»£ç†æ“ä½œçš„ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œä½ çš„è‡ªå®šä¹‰æ³¨è§£ä¹Ÿå°±æ˜¯åˆ‡é¢</li></ul>`,35);function f(x,j){const a=p("ExternalLinkIcon");return c(),o("div",null,[u,n("p",null,[s("ä½œè€…ï¼šå°å‚…å“¥ "),k,s("åšå®¢ï¼š"),n("a",r,[s("https://bugstack.cn"),t(a)])]),d,v,m,n("ol",null,[b,y,n("li",null,[s("æœ€åä¸çŸ¥é“ä½ è‡ªå·±æ˜¯å¦å°è¯•è¿‡å¼€å‘ä¸€äº›åŸºäºä»£ç†ç±»çš„æ¡†æ¶ï¼Œä»¥æ­¤æ¥ä¼˜åŒ–ä¸šåŠ¡ä»£ç ã€‚ä¹Ÿå°±æ˜¯å°†ä¸šåŠ¡ä»£ç ä¸­éä¸šåŠ¡é€»è¾‘åˆé€šç”¨æ€§çš„åŠŸèƒ½æŠ½ç¦»å‡ºæ¥ï¼Œå¼€å‘ä¸ºç‹¬ç«‹çš„ç»„ä»¶ã€‚"),g,n("a",h,[s("æ‰‹å†™RPCæ¡†æ¶ç¬¬ä¸‰ç« ã€ŠRPCä¸­é—´ä»¶ã€‹"),t(a)])])]),w])}const C=e(i,[["render",f],["__file","2019-12-21-_youdianganhuo_JDKã€CGLIBdongtaidailishiyongyijiyuanmafenxi.html.vue"]]);export{C as default};
