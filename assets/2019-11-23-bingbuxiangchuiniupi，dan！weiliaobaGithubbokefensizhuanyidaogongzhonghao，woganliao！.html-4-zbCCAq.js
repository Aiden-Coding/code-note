import{_ as t,r as p,o as e,c as o,a as n,b as s,d as c,e as l}from"./app-3RcBQnkC.js";const i={},u=n("h1",{id:"并不想吹牛皮-但-为了把github博客粉丝转移到公众号-我干了",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#并不想吹牛皮-但-为了把github博客粉丝转移到公众号-我干了","aria-hidden":"true"},"#"),s(" 并不想吹牛皮，但！为了把Github博客粉丝转移到公众号，我干了！")],-1),r=n("br",null,null,-1),k={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},d=l(`<blockquote><p>沉淀、分享、成长，让自己和他人都能有所收获！😄</p></blockquote><h2 id="_1-前言介绍" tabindex="-1"><a class="header-anchor" href="#_1-前言介绍" aria-hidden="true">#</a> 1. 前言介绍</h2><p>这个！截至到19年11月我已经工作6年了，从业Java但也折腾过C#、搞PHP也弄过中继器、IO板卡，似乎我就是一个很喜欢在技术上折腾的人！与此同时，我也搞了6年的个人小网站，它们的呈现形式多种多样；有用PHP自己捣鼓的技术站用于分享资料、书籍、软件等、有用PHPWIND和DISCUZ的搭建的个人论坛、有用emlog和wordpress搭建的个人博客、也有借用于github+hexo/jekyll的能力组装出的技术博客。但无一例外它们都战死于征战的路上了，亡于；org域名不能备案、PHP服务器瘫痪被清空、http连接被注入恶意内容、定位不准确经常换模式、缺少核心优质内容等等。但！老衲的心依然如春(cun)，因为喜欢干一件事，往往来自于干一了件喜欢的事！</p><p>所以！从19年开始我又继续写博客了，注册了新的域名bugstack.cn，备了案、买了服务器、还喊了新的口号；沉淀、分享、成长，让自己和他人都能有所收获！并且将尘封已久的微信公众号找回；结构上调整、内容上布局、粉丝上求关注。在这期间遇到了更大的牛；小灰、王二哥、纯洁的微笑还有松哥等一群伙伴，从他们那学到很多知识，真的非常感谢！</p><p>那么！这次的产品功能总结一句话就是；将基于Github+Jekyll搭建的静态博客与我并未开发过的微信公众号功能打通，通过在文章短口令码加锁引导用户到公众号内回复密码可解锁内容，以此来获得粉丝关注，当然如果取消关注了则文章继续锁定。</p><p>在多说一句，我理解的产品；其实是使用研发技术力搭建出可以用于承载接收用户在各种设备上所生产的行为数据的一种产品化服务。所以有些产品在做减法，同时也有为丰富的功能做加法，但究其一点我们其实都是在为接收有价值数据服务的。兴衰存亡，皆在核心数据沉淀与运作上！</p><h2 id="_2-流程设计" tabindex="-1"><a class="header-anchor" href="#_2-流程设计" aria-hidden="true">#</a> 2. 流程设计</h2><p>为了使博客粉丝主动关注微信公众号，我们在用户初次浏览文章时增加权限验证，给每一个用户都生成一个唯一码引导用户在公众号内回复解锁文章，以此来与微信openid对应。当用户取消关注时则进行删除openid或标记状态，使得用户无法继续浏览文章。其实为了更好的体验，我参照了大牛的方式内容60%的区域可见，其余内容渐进遮挡，蒙胧胧的感觉还挺美。整体流程图如下； <img src="https://bugstack.cn/assets/images/pic-content/2019/11/other-112601.png" alt="微信公众号：bugstack虫洞栈 &amp; 流程图设计"></p><h2 id="_3-功能实现" tabindex="-1"><a class="header-anchor" href="#_3-功能实现" aria-hidden="true">#</a> 3. 功能实现</h2><p>为了实现本产品功能，我准备了；</p><ol><li>微信公众号；bugstack虫洞栈</li><li>博客；本文使用的是github+jekyll；地址：https://bugstack.cn</li><li>域名；域名申请比较简单，但可能针对不同的服务商还必须备案后才可以使用</li><li>友盟；主要为了获取全局的唯一id值，也可以使用其他具备此功能的产品或者自己实现</li><li>部署环境；Java云服务器、Mysql云数据库、https证书、Jdk1.8、tomcat1.8，云市场比较多按需购买，如果是本地调试可以使用https://natapp.cn，做免费网络穿透映射</li></ol><h3 id="_3-1-前端" tabindex="-1"><a class="header-anchor" href="#_3-1-前端" aria-hidden="true">#</a> 3.1 前端</h3><p>前端主要负责针对发布时设置了look: need的文章，在用户浏览文章检查是否有权限查看全部内容，当用户没有权限时隐藏文章60%内容，并通过页面结尾提醒用户在公众号内回复口令解锁文章。</p><ol><li>找到加锁文章容器ID，文章容器选择器：article.post.container.need，拿到选择器ID针对这类文章进行缩小隐藏处理。</li></ol><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post container need lock<span class="token punctuation">&quot;</span></span> <span class="token attr-name">itemscope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">itemtype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schema.org/BlogPosting<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> 4400px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

        
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-md-9 markdown-body<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>前言介绍<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>前言介绍<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>为什么会有路由层？因为在微服务架构设计中，往往并不会直接将服务暴漏给调用端，而是通过调用路由层进行业务隔离，以达到不同的业务调用对应的服务模块。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>Spring Cloud Zuul<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>使用Jquery把文章所在容器高度缩小，这样会把内容进行压缩</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 文章所在容器的选择器</span>
<span class="token keyword">var</span> articleSelector <span class="token operator">=</span> <span class="token string">&#39;article.post.container.need&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// 找到文章所在的容器</span>
<span class="token keyword">var</span> $article <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>articleSelector<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 文章的实际高度</span>
<span class="token keyword">var</span> article <span class="token operator">=</span> $article<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> height <span class="token operator">=</span> article<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>
<span class="token comment">// 文章隐藏后的高度</span>
<span class="token keyword">var</span> halfHeight <span class="token operator">=</span> height <span class="token operator">*</span> <span class="token number">0.4</span><span class="token punctuation">;</span>
<span class="token comment">// 隐藏缩小</span>
$article<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">&#39;height&#39;</span><span class="token punctuation">,</span> halfHeight <span class="token operator">+</span> <span class="token string">&#39;px&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$article<span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">&#39;lock&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>给文章加一点朦胧感，渐变隐藏</li></ol><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code><span class="token selector">.asb-post-01</span> <span class="token punctuation">{</span>
 <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
 <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
 <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
 <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
 <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
 <span class="token property">z-index</span><span class="token punctuation">:</span> 10000<span class="token punctuation">;</span>
<span class="token property">margin-bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.asb-post-01 .mask</span> <span class="token punctuation">{</span>
 <span class="token property">height</span><span class="token punctuation">:</span> 240px<span class="token punctuation">;</span>
 <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
 <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">-webkit-gradient</span><span class="token punctuation">(</span>linear<span class="token punctuation">,</span> 0 top<span class="token punctuation">,</span> 0 bottom<span class="token punctuation">,</span> <span class="token function">from</span><span class="token punctuation">(</span><span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">to</span><span class="token punctuation">(</span>#fff<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>从UM全局唯一ID中获取token 友盟作为网站数据采集服务，会生成一个针对用户的全局唯一值UM_distinctid，而我们需要就使用这个值部分截取后作为唯一token加锁钥匙</li></ol><div class="language-other line-numbers-mode" data-ext="other"><pre class="language-other"><code>UM_distinctid = 16e9cd64925334-0882eb883c9554-7711b3e-144000-16e9cd6492631c
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token string">&quot;; &quot;</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">;</span>
	<span class="token keyword">var</span> parts <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;; &quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>parts<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> parts<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token string">&#39;UM_distinctid&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>定时轮旋检查是否关注公众号并解锁，可以优化写入全局Jquery值或者记录在cookie，减少轮询检查次数</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 查询后端的结果</span>
<span class="token keyword">var</span> <span class="token function-variable function">_detect</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
	$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token literal-property property">url</span> <span class="token operator">:</span> <span class="token string">&#39;https://bugstack.cn/xx/xx/check&#39;</span><span class="token punctuation">,</span>
		<span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span>
		<span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
		<span class="token literal-property property">data</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">token</span> <span class="token operator">:</span> token
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function-variable function">success</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">==</span> <span class="token string">&#39;refuse&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">_lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token function">_unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function-variable function">error</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">_unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定时任务</span>
<span class="token function">_detect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">_detect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>引导用户关注公众号 现在将token值回显到页面，提醒用户关注公众号回复口令解锁全部文章，以此来得到粉丝的关注。效果如下；</li></ol><p><img src="https://bugstack.cn/assets/images/pic-content/2019/11/other-112602.png" alt="微信公众号：bugstack虫洞栈 &amp; 文章加锁效果"></p><h3 id="_3-2-后端" tabindex="-1"><a class="header-anchor" href="#_3-2-后端" aria-hidden="true">#</a> 3.2 后端</h3><ol><li>本地环境开发需要安装(免费)http://natapp.cn/，做网络穿透便于我们进行测试</li><li>服务度三个主要接口；1同名称的get、post请求，分别用于公众号验验、接收用户行为与回复信息。2给博客提供验证是否解锁接口</li><li>在微信公众号；开发-&gt;基础设置(服务器配置)，修改配置内容并开启服务，此时服务端会收到验证请求信息</li><li>Java服务度采用领域驱动设计微服务方式开发，DDD的开发模式会更加清晰以及易于后续功能的拓展</li><li>(提醒)个人微信号，部分接口权限是没有的，同时如果开启开发者功能配置后，自定义菜单和自定义回复都会失效。而自定义菜单又不开放给个人微信号，所以需要再次配置开启，但是不能修改</li></ol><h4 id="开发环境" tabindex="-1"><a class="header-anchor" href="#开发环境" aria-hidden="true">#</a> 开发环境</h4><ol><li>jdk 1.8、tomcat8、idea2018、Maven3</li><li>Spring Boot 2.1.2.RELEASE</li><li>mysql 5.6</li><li>natapp 网络穿透</li></ol><h4 id="工程代码" tabindex="-1"><a class="header-anchor" href="#工程代码" aria-hidden="true">#</a> 工程代码</h4><blockquote><p>itstack-ark-wx &amp; 领域驱动设计方式设计</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>itstack<span class="token operator">-</span>ark<span class="token operator">-</span>wx
└── src
    ├── main
    │   ├── java
    │   │   └── org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>demo
    │   │       ├── application
    │   │       │	├── <span class="token class-name">UserLockAuthService</span><span class="token punctuation">.</span>java
    │   │       │	├── <span class="token class-name">WxReceiveService</span><span class="token punctuation">.</span>java	
    │   │       │	└── <span class="token class-name">WxValidateService</span><span class="token punctuation">.</span>java	
    │   │       ├── domain
    │   │       │	├── lockauth
    │   │       │	│   ├── repository
    │   │       │	│   │   └── <span class="token class-name">IUserAuthPatrolRepository</span><span class="token punctuation">.</span>java	
    │   │       │	│   └── service
    │   │       │	│       └── <span class="token class-name">UserLockAuthServiceImpl</span><span class="token punctuation">.</span>java		
    │   │       │	├── receive
    │   │       │	│   ├── model
    │   │       │	│   │   ├── <span class="token class-name">BehaviorMatter</span><span class="token punctuation">.</span>java
    │   │       │	│   │   └── <span class="token class-name">MessageTextEntity</span><span class="token punctuation">.</span>java
    │   │       │	│   ├── repository
    │   │       │	│   │   └── <span class="token class-name">IUserAuthGrantRepository</span><span class="token punctuation">.</span>java	
    │   │       │	│   └── service
    │   │       │	│       ├── engine
    │   │       │	│       │   ├── impl	
    │   │       │	│       │   │	└── <span class="token class-name">MsgEngineHandle</span><span class="token punctuation">.</span>java
    │   │       │	│       │   ├── <span class="token class-name">Engine</span><span class="token punctuation">.</span>java	
    │   │       │	│       │   ├── <span class="token class-name">EngineBase</span><span class="token punctuation">.</span>java	
    │   │       │	│       │   └── <span class="token class-name">EngineConfig</span><span class="token punctuation">.</span>java	
    │   │       │	│       ├── logic
    │   │       │	│       │   ├── impl	
    │   │       │	│       │   │	├── <span class="token class-name">AnswerFilter</span><span class="token punctuation">.</span>java
    │   │       │	│       │   │	├── <span class="token class-name">SubscribeFilter</span><span class="token punctuation">.</span>java
    │   │       │	│       │   │	├── <span class="token class-name">UnlockFilter</span><span class="token punctuation">.</span>java
    │   │       │	│       │   │	└── <span class="token class-name">UnsubscribeFilter</span><span class="token punctuation">.</span>java	
    │   │       │	│       │   └── <span class="token class-name">LogicFilter</span><span class="token punctuation">.</span>java	
    │   │       │	│       └── <span class="token class-name">WxReceiveServiceImpl</span><span class="token punctuation">.</span>java	
    │   │       │	└── validate
    │   │       │	    └── service
    │   │       │	        └── <span class="token class-name">WxValidateServiceImpl</span><span class="token punctuation">.</span>java	
    │   │       ├── infrastructure
    │   │       │	├── common
    │   │       │	│   └── <span class="token class-name">Constants</span><span class="token punctuation">.</span>java
    │   │       │	├── dao	
    │   │       │	│   └── <span class="token class-name">UserAuthDao</span><span class="token punctuation">.</span>java	
    │   │       │	├── po
    │   │       │	│   └── <span class="token class-name">UserAuth</span><span class="token punctuation">.</span>java		
    │   │       │	├── repository
    │   │       │	│   ├── <span class="token class-name">UserAuthGrantRepository</span><span class="token punctuation">.</span>java	
    │   │       │	│   └── <span class="token class-name">UserAuthPatrolRepository</span><span class="token punctuation">.</span>java	
    │   │       │	└── util
    │   │       │	    ├── sdk
    │   │       │	    │   └── <span class="token class-name">SignatureUtil</span><span class="token punctuation">.</span>java	
    │   │       │	    └── <span class="token class-name">XmlUtil</span><span class="token punctuation">.</span>java
    │   │       ├── interfaces
    │   │       │	├── <span class="token class-name">BlogController</span><span class="token punctuation">.</span>java
    │   │       │	└── <span class="token class-name">WxPortalController</span><span class="token punctuation">.</span>java
    │   │       └── <span class="token class-name">WxApplication</span><span class="token punctuation">.</span>java
    │   └── resources	
    │       ├── mybatis
    │       └── application<span class="token punctuation">.</span>yml
    └── test
         └── java
             └── org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>ark<span class="token punctuation">.</span>wx<span class="token punctuation">.</span>test
                 └── <span class="token class-name">ApiTest</span><span class="token punctuation">.</span>java

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>itstack-ark-wx &amp; 建表语句</p></blockquote><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span>
    user_auth
    <span class="token punctuation">(</span>
        id <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
        openId <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        token <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
        uuid <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        createTime <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
        updateTime <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
        <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">CONSTRAINT</span> idx_uuid <span class="token keyword">UNIQUE</span> <span class="token punctuation">(</span>uuid<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>讲解部分重点代码块，完整代码下载关注公众号；bugstack虫洞栈 &amp; 回复：itstack-ark-wx</strong></p><p><strong>interfaces接口层</strong></p><blockquote><p>WxPortalController.java &amp; 接收微信公众号验签与行为信息通知</p></blockquote><ul><li><p>微信公众号都是通过服务提供方的一个接口的get/post请求来执行操作的{这样设计真sao但真香}</p></li><li><p>get接口主要是验证签名</p></li><li><p>post接口会收到；关注、取消关注、用户的回复信息</p></li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 微信公众号：bugstack虫洞栈
 * 纯洁版博客：https://bugstack.cn
 * 沉淀、分享、成长，让自己和他人都能有所收获！
 * Create by 付政委 on @2019
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/wx/portal/{appid}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WxPortalController</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">WxPortalController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">WxValidateService</span> wxValidateService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">WxReceiveService</span> wxReceiveService<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 处理微信服务器发来的get请求，进行签名的验证
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
     * appid     微信端AppID
     * signature 微信端发来的签名
     * timestamp 微信端发来的时间戳
     * nonce     微信端发来的随机字符串
     * echostr   微信端发来的验证字符串
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>produces <span class="token operator">=</span> <span class="token string">&quot;text/plain;charset=utf-8&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">validate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> appid<span class="token punctuation">,</span>
                           <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;signature&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> signature<span class="token punctuation">,</span>
                           <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;timestamp&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> timestamp<span class="token punctuation">,</span>
                           <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;nonce&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> nonce<span class="token punctuation">,</span>
                           <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;echostr&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> echostr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;微信公众号验签信息{}开始 [{}, {}, {}, {}]&quot;</span><span class="token punctuation">,</span> appid<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> echostr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isAnyBlank</span><span class="token punctuation">(</span>signature<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> echostr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;请求参数非法，请核实!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">boolean</span> check <span class="token operator">=</span> wxValidateService<span class="token punctuation">.</span><span class="token function">checkSign</span><span class="token punctuation">(</span>signature<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> nonce<span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;微信公众号验签信息{}完成 check：{}&quot;</span><span class="token punctuation">,</span> appid<span class="token punctuation">,</span> check<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>check<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> echostr<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;微信公众号验签信息{}失败 [{}, {}, {}, {}]&quot;</span><span class="token punctuation">,</span> appid<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> echostr<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 此处是处理微信服务器的消息转发的
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>produces <span class="token operator">=</span> <span class="token string">&quot;application/xml; charset=UTF-8&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">post</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> appid<span class="token punctuation">,</span>
                       <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">String</span> requestBody<span class="token punctuation">,</span>
                       <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;signature&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> signature<span class="token punctuation">,</span>
                       <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;timestamp&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> timestamp<span class="token punctuation">,</span>
                       <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> nonce<span class="token punctuation">,</span>
                       <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;openid&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> openid<span class="token punctuation">,</span>
                       <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;encrypt_type&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> encType<span class="token punctuation">,</span>
                       <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;msg_signature&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> msgSignature<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;接收微信公众号信息请求{}开始 {}&quot;</span><span class="token punctuation">,</span> openid<span class="token punctuation">,</span> requestBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">MessageTextEntity</span> message <span class="token operator">=</span> <span class="token class-name">XmlUtil</span><span class="token punctuation">.</span><span class="token function">xmlToBean</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">,</span> <span class="token class-name">MessageTextEntity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BehaviorMatter</span> behaviorMatter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BehaviorMatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            behaviorMatter<span class="token punctuation">.</span><span class="token function">setOpenId</span><span class="token punctuation">(</span>openid<span class="token punctuation">)</span><span class="token punctuation">;</span>
            behaviorMatter<span class="token punctuation">.</span><span class="token function">setFromUserName</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getFromUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            behaviorMatter<span class="token punctuation">.</span><span class="token function">setMsgType</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMsgType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            behaviorMatter<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            behaviorMatter<span class="token punctuation">.</span><span class="token function">setEvent</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            behaviorMatter<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 处理消息</span>
            <span class="token class-name">String</span> result <span class="token operator">=</span> wxReceiveService<span class="token punctuation">.</span><span class="token function">doReceive</span><span class="token punctuation">(</span>behaviorMatter<span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;接收微信公众号信息请求{}完成 {}&quot;</span><span class="token punctuation">,</span> openid<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;接收微信公众号信息请求{}失败 {}&quot;</span><span class="token punctuation">,</span> openid<span class="token punctuation">,</span> requestBody<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>BlogController.java &amp; 博客验权接口，用于判断文章是否解锁</p></blockquote><ul><li>因为我们这个服务部署在二级域名下，因此需要设置跨域访问</li><li>由于我们网站是https加密，那么非https是不能被访问，需要下载安装证书到tomcat服务器</li><li>本接口只返回success和refuse，通过即可解锁</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 微信公众号：bugstack虫洞栈
 * 纯洁版博客：https://bugstack.cn
 * 沉淀、分享、成长，让自己和他人都能有所收获！
 * Create by 付政委 on @2019
 */</span>
<span class="token annotation punctuation">@CrossOrigin</span><span class="token punctuation">(</span><span class="token string">&quot;https://bugstack.cn&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlogController</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">BlogController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserLockAuthService</span> userLockAuthService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;check&quot;</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token string">&quot;application/json;charset=utf-8&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;校验博客浏览用户授权状态{}开始&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">boolean</span> status <span class="token operator">=</span> userLockAuthService<span class="token punctuation">.</span><span class="token function">checkAuth</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;校验博客浏览用户授权状态{}完成&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> status <span class="token operator">?</span> <span class="token string">&quot;success&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;refuse&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;校验博客浏览用户授权状态{}失败&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;refuse&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>application应用层</strong></p><ul><li>本层主要定义逻辑分层，属于非常薄的一层，在一些复杂设计中会有一些服务编排 <ul><li>UserLockAuthService 用户权限验证</li><li>WxReceiveService 接收用户行为消息</li><li>WxValidateService 微信公众号验签</li></ul></li></ul><blockquote><p>UserLockAuthService.java &amp; 定义后由领域层实现</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserLockAuthService</span> <span class="token punctuation">{</span>

    <span class="token keyword">boolean</span> <span class="token function">checkAuth</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>domain领域层</strong></p><ul><li>领域层完成了；权限验证、行为消息处理、公众号验签</li><li>这里最重要的各种行为消息处理，我们设计为决策树工厂模型，定义了逻辑功能和引擎服务，后续只需要按需扩展即可</li></ul><blockquote><p>logic/LogicFilter.java &amp; 定义逻辑模型，impl中有对应的一组的实现类</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">LogicFilter</span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">BehaviorMatter</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>logic/impl/SubscribeFilter.java &amp; 其中一个实现，关注时行为处理</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">&quot;subscribe&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SubscribeFilter</span> <span class="token keyword">implements</span> <span class="token class-name">LogicFilter</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">&quot;您好！\\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;\\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;非常感谢您关注，微信公众号：bugstack虫洞栈  | 也期待您分享给更多小伙伴！\\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;\\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;bugstack虫洞栈，专注于原创技术专题案例，以最易学习编程开发的方式分享技术知识，让萌新、小白、大牛都能有所收获。目前已经完成的专题有；《Netty4.x从入门到实战》、《手写RPC框架》、《用Java实现JVM》、《基于JavaAgent的全链路监控》、《DDD专题案例》，其他更多专题还在排兵布阵中。\\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;\\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;获取专题案例源码回复；netty案例、rpc案例、用Java实现jvm源码、基于JavaAgent的全链路监控案例、DDD落地。\\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;\\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;联系作者：付政委 | monkeycode&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">BehaviorMatter</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> content<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>engine/impl/MsgEngineHandle.java &amp; 引擎路由调用</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">&quot;msgEngineHandle&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MsgEngineHandle</span> <span class="token keyword">extends</span> <span class="token class-name">EngineBase</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${wx.config.originalid:你的Err默认值}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> originalId<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">BehaviorMatter</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">LogicFilter</span> router <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> router<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> resultStr <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>resultStr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//反馈信息[文本]，暂时只有文本后续按需拓展</span>
        <span class="token class-name">MessageTextEntity</span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageTextEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setToUserName</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getOpenId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setFromUserName</span><span class="token punctuation">(</span>originalId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setMsgType</span><span class="token punctuation">(</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>resultStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">XmlUtil</span><span class="token punctuation">.</span><span class="token function">beanToXml</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>infrastructure基础层</strong></p><ul><li>本层主要提供基础服务能力，包括数据库操作、缓存操作、工具包等</li><li>如果你的服务中由redis可以在本层来提供</li><li>在领域驱动设计中数据库不提倡共用，是单独分离，因为此设计中只有用户表还体现的不明显</li></ul><blockquote><p>repository/UserAuthGrantRepository.java &amp; 数据库实现</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span><span class="token punctuation">(</span><span class="token string">&quot;userAuthGrantRepository&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserAuthGrantRepository</span> <span class="token keyword">implements</span> <span class="token class-name">IUserAuthGrantRepository</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserAuthDao</span> userAuthDao<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">grantAuth</span><span class="token punctuation">(</span><span class="token class-name">String</span> openId<span class="token punctuation">,</span> <span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserAuth</span> userAuthReq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userAuthReq<span class="token punctuation">.</span><span class="token function">setOpenId</span><span class="token punctuation">(</span>openId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        userAuthReq<span class="token punctuation">.</span><span class="token function">setToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        userAuthReq<span class="token punctuation">.</span><span class="token function">setUuid</span><span class="token punctuation">(</span>openId <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        userAuthDao<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>userAuthReq<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">revokeAuth</span><span class="token punctuation">(</span><span class="token class-name">String</span> openId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userAuthDao<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>openId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-部署" tabindex="-1"><a class="header-anchor" href="#_3-3-部署" aria-hidden="true">#</a> 3.3 部署</h3><h4 id="_1-工程打包" tabindex="-1"><a class="header-anchor" href="#_1-工程打包" aria-hidden="true">#</a> 1. 工程打包</h4><ol><li><p>springboot配置打包部署成可运行war包</p><blockquote><p>pom.xml</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>war<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>WxApplication.java</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WxApplication</span> <span class="token keyword">extends</span> <span class="token class-name">SpringBootServletInitializer</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token class-name">SpringApplicationBuilder</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">SpringApplicationBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">sources</span><span class="token punctuation">(</span><span class="token class-name">WxApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">WxApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>修改配置application.yml，数据库配置、微信配置</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>server<span class="token operator">:</span>
  port<span class="token operator">:</span> <span class="token number">80</span>

spring<span class="token operator">:</span>
#  datasource<span class="token operator">:</span>
#    username<span class="token operator">:</span> root
#    password<span class="token operator">:</span> <span class="token number">123456</span>
#    url<span class="token operator">:</span> jdbc<span class="token operator">:</span>mysql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">3306</span><span class="token operator">/</span>itstack<span class="token operator">-</span>ark<span class="token operator">-</span>wx<span class="token operator">?</span>useUnicode<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">&amp;</span>characterEncoding<span class="token operator">=</span>utf8
#    driver<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">-</span>name<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>Driver</span>


mybatis<span class="token operator">:</span>
  mapper<span class="token operator">-</span>locations<span class="token operator">:</span> classpath<span class="token operator">:</span><span class="token operator">/</span>mybatis<span class="token operator">/</span>mapper<span class="token comment">/*.xml
  config-location:  classpath:/mybatis/config/mybatis-config.xml

# 微信公众号配置信息
# originalid：原始ID
# appid：个人AppID
# token：开通接口服务自定义设置
wx:
  config:
	originalid: xxxxxxx
	appid: xxxxxxx
	token: xxxxxxx
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h4 id="_2-服务上线" tabindex="-1"><a class="header-anchor" href="#_2-服务上线" aria-hidden="true">#</a> 2. 服务上线</h4><ol><li>申请云服务器，目前提供方比较多，一般可以和域名选择一个服务商</li><li>准备好Linux服务器jdk1.8、tomcat8</li><li>看个人域名访问情况，酌情申请Https，配置RSA</li><li>本地安装XShell、Xftp，方便部署和文件传输</li><li>准备好个人微信公众号，用于配置服务 <img src="https://raw.githubusercontent.com/fuzhengwei/fuzhengwei.github.io/master/assets/images/pic-content/2019/11/other-112603.png" alt=""></li><li>启动服务<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token punctuation">[</span>root<span class="token annotation punctuation">@instance</span><span class="token operator">-</span><span class="token number">39394</span>m67 bin<span class="token punctuation">]</span># <span class="token punctuation">.</span>/startup<span class="token punctuation">.</span>sh

 	 <span class="token punctuation">.</span>   ____          _            __ _ _
  <span class="token operator">/</span>\\\\ <span class="token operator">/</span> ___&#39;_ __ _ <span class="token function">_</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span>_ __  __ _ \\ \\ \\ \\
 <span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span>\\___ <span class="token operator">|</span> <span class="token char">&#39;_ | &#39;</span>_<span class="token operator">|</span> <span class="token operator">|</span> &#39;_ \\<span class="token operator">/</span> _\` <span class="token operator">|</span> \\ \\ \\ \\
  \\\\<span class="token operator">/</span>  ___<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token operator">|</span>_<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span>  <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
   &#39;  <span class="token operator">|</span>____<span class="token operator">|</span> <span class="token punctuation">.</span>__<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_\\__<span class="token punctuation">,</span> <span class="token operator">|</span> <span class="token operator">/</span> <span class="token operator">/</span> <span class="token operator">/</span> <span class="token operator">/</span>
  <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">|</span>_<span class="token operator">|=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">|</span>___<span class="token operator">/=</span><span class="token operator">/</span>_<span class="token operator">/</span>_<span class="token operator">/</span>_<span class="token operator">/</span>
  <span class="token operator">::</span> <span class="token class-name">Spring</span> <span class="token class-name">Boot</span> <span class="token operator">::</span>        <span class="token punctuation">(</span>v2<span class="token punctuation">.</span><span class="token number">1.2</span><span class="token punctuation">.</span><span class="token constant">RELEASE</span><span class="token punctuation">)</span>

 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">57.131</span>  <span class="token constant">INFO</span> <span class="token number">22052</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ost<span class="token operator">-</span>startStop<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>ark<span class="token punctuation">.</span>wx<span class="token punctuation">.</span></span>WxApplication</span>         <span class="token operator">:</span> <span class="token class-name">Starting</span> <span class="token class-name">WxApplication</span> v1<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token constant">SNAPSHOT</span> on instance<span class="token operator">-</span><span class="token number">39394</span>m67 <span class="token keyword">with</span> <span class="token class-name">PID</span> <span class="token number">22052</span> <span class="token punctuation">(</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>java<span class="token operator">/</span>apache<span class="token operator">-</span>tomcat<span class="token operator">-</span><span class="token number">8.5</span><span class="token number">.37</span><span class="token operator">/</span>webapps<span class="token operator">/</span>itstack<span class="token operator">-</span>ark<span class="token operator">-</span>wx<span class="token operator">/</span><span class="token constant">WEB</span><span class="token operator">-</span><span class="token constant">INF</span><span class="token operator">/</span>classes started by root in <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>java<span class="token operator">/</span>apache<span class="token operator">-</span>tomcat<span class="token operator">-</span><span class="token number">8.5</span><span class="token number">.37</span><span class="token operator">/</span>bin<span class="token punctuation">)</span>
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">57.158</span>  <span class="token constant">INFO</span> <span class="token number">22052</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ost<span class="token operator">-</span>startStop<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>ark<span class="token punctuation">.</span>wx<span class="token punctuation">.</span></span>WxApplication</span>         <span class="token operator">:</span> <span class="token class-name">No</span> active profile set<span class="token punctuation">,</span> falling back <span class="token keyword">to</span> <span class="token keyword">default</span> profiles<span class="token operator">:</span> <span class="token keyword">default</span>
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">59.137</span>  <span class="token constant">INFO</span> <span class="token number">22052</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ost<span class="token operator">-</span>startStop<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>web<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span>ContextLoader</span>            <span class="token operator">:</span> <span class="token class-name">Root</span> <span class="token class-name">WebApplicationContext</span><span class="token operator">:</span> initialization completed in <span class="token number">1890</span> ms
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">01.050</span>  <span class="token constant">INFO</span> <span class="token number">22052</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ost<span class="token operator">-</span>startStop<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>s<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>ThreadPoolTaskExecutor</span>  <span class="token operator">:</span> <span class="token class-name">Initializing</span> <span class="token class-name">ExecutorService</span> &#39;applicationTaskExecutor&#39;
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">01.336</span>  <span class="token constant">WARN</span> <span class="token number">22052</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ost<span class="token operator">-</span>startStop<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> ion$<span class="token class-name">DefaultTemplateResolverConfiguration</span> <span class="token operator">:</span> <span class="token class-name">Cannot</span> find template location<span class="token operator">:</span> classpath<span class="token operator">:</span><span class="token operator">/</span>templates<span class="token operator">/</span> <span class="token punctuation">(</span>please add some templates or check your <span class="token class-name">Thymeleaf</span> configuration<span class="token punctuation">)</span>
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">01.677</span>  <span class="token constant">INFO</span> <span class="token number">22052</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ost<span class="token operator">-</span>startStop<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>itstack<span class="token punctuation">.</span>ark<span class="token punctuation">.</span>wx<span class="token punctuation">.</span></span>WxApplication</span>         <span class="token operator">:</span> <span class="token class-name">Started</span> <span class="token class-name">WxApplication</span> in <span class="token number">5.873</span> seconds <span class="token punctuation">(</span><span class="token constant">JVM</span> running <span class="token keyword">for</span> <span class="token number">10.311</span><span class="token punctuation">)</span>
 <span class="token number">23</span><span class="token operator">-</span><span class="token class-name">Nov</span><span class="token operator">-</span><span class="token number">2019</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">01.718</span> <span class="token constant">INFO</span> <span class="token punctuation">[</span>localhost<span class="token operator">-</span>startStop<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>startup<span class="token punctuation">.</span></span>HostConfig</span><span class="token punctuation">.</span>deployWAR <span class="token class-name">Deployment</span> of web application archive <span class="token punctuation">[</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>java<span class="token operator">/</span>apache<span class="token operator">-</span>tomcat<span class="token operator">-</span><span class="token number">8.5</span><span class="token number">.37</span><span class="token operator">/</span>webapps<span class="token operator">/</span>itstack<span class="token operator">-</span>ark<span class="token operator">-</span>wx<span class="token punctuation">.</span>war<span class="token punctuation">]</span> has finished in <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">226</span><span class="token punctuation">]</span> ms
 <span class="token number">23</span><span class="token operator">-</span><span class="token class-name">Nov</span><span class="token operator">-</span><span class="token number">2019</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">01.720</span> <span class="token constant">INFO</span> <span class="token punctuation">[</span>localhost<span class="token operator">-</span>startStop<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>startup<span class="token punctuation">.</span></span>HostConfig</span><span class="token punctuation">.</span>deployDirectory <span class="token class-name">Deploying</span> web application directory <span class="token punctuation">[</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>java<span class="token operator">/</span>apache<span class="token operator">-</span>tomcat<span class="token operator">-</span><span class="token number">8.5</span><span class="token number">.37</span><span class="token operator">/</span>webapps<span class="token operator">/</span><span class="token constant">ROOT</span><span class="token punctuation">]</span>
 <span class="token number">23</span><span class="token operator">-</span><span class="token class-name">Nov</span><span class="token operator">-</span><span class="token number">2019</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">01.746</span> <span class="token constant">INFO</span> <span class="token punctuation">[</span>localhost<span class="token operator">-</span>startStop<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>startup<span class="token punctuation">.</span></span>HostConfig</span><span class="token punctuation">.</span>deployDirectory <span class="token class-name">Deployment</span> of web application directory <span class="token punctuation">[</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>java<span class="token operator">/</span>apache<span class="token operator">-</span>tomcat<span class="token operator">-</span><span class="token number">8.5</span><span class="token number">.37</span><span class="token operator">/</span>webapps<span class="token operator">/</span><span class="token constant">ROOT</span><span class="token punctuation">]</span> has finished in <span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> ms
 <span class="token number">23</span><span class="token operator">-</span><span class="token class-name">Nov</span><span class="token operator">-</span><span class="token number">2019</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">01.753</span> <span class="token constant">INFO</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>coyote<span class="token punctuation">.</span></span>AbstractProtocol</span><span class="token punctuation">.</span>start <span class="token class-name">Starting</span> <span class="token class-name">ProtocolHandler</span> <span class="token punctuation">[</span><span class="token string">&quot;http-nio-80&quot;</span><span class="token punctuation">]</span>
 <span class="token number">23</span><span class="token operator">-</span><span class="token class-name">Nov</span><span class="token operator">-</span><span class="token number">2019</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">01.764</span> <span class="token constant">INFO</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>coyote<span class="token punctuation">.</span></span>AbstractProtocol</span><span class="token punctuation">.</span>start <span class="token class-name">Starting</span> <span class="token class-name">ProtocolHandler</span> <span class="token punctuation">[</span><span class="token string">&quot;ajp-nio-8009&quot;</span><span class="token punctuation">]</span>
 <span class="token number">23</span><span class="token operator">-</span><span class="token class-name">Nov</span><span class="token operator">-</span><span class="token number">2019</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">01.766</span> <span class="token constant">INFO</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>startup<span class="token punctuation">.</span></span>Catalina</span><span class="token punctuation">.</span>start <span class="token class-name">Server</span> startup in <span class="token number">9326</span> ms
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">13.039</span>  <span class="token constant">INFO</span> <span class="token number">22052</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>p<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">80</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>DispatcherServlet</span>        <span class="token operator">:</span> <span class="token class-name">Initializing</span> <span class="token class-name">Servlet</span> &#39;dispatcherServlet&#39;
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">13.059</span>  <span class="token constant">INFO</span> <span class="token number">22052</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>p<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">80</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>DispatcherServlet</span>        <span class="token operator">:</span> <span class="token class-name">Completed</span> initialization in <span class="token number">20</span> ms
 <span class="token number">2019</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">13.172</span>  <span class="token constant">INFO</span> <span class="token number">22052</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>p<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">80</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>i<span class="token punctuation">.</span>ark<span class="token punctuation">.</span>wx<span class="token punctuation">.</span>interfaces<span class="token punctuation">.</span></span>BlogController</span>     <span class="token operator">:</span> 校验博客浏览用户授权状态<span class="token constant">UDHIUS</span>开始
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h4 id="_3-功能验证" tabindex="-1"><a class="header-anchor" href="#_3-功能验证" aria-hidden="true">#</a> 3. 功能验证</h4><ol><li><p>验证连接；https://bugstack.cn/itstack-demo-ddd/2019/10/16/DDD%E4%B8%93%E9%A2%98%E6%A1%88%E4%BE%8B%E4%BA%8C-%E9%A2%86%E5%9F%9F%E5%B1%82%E5%86%B3%E7%AD%96%E8%A7%84%E5%88%99%E6%A0%91%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1.html</p></li><li><p>引导提示； <img src="https://raw.githubusercontent.com/fuzhengwei/fuzhengwei.github.io/master/assets/images/pic-content/2019/11/other-112604.png" alt=""></p></li><li><p>文章解锁； <img src="https://raw.githubusercontent.com/fuzhengwei/fuzhengwei.github.io/master/assets/images/pic-content/2019/11/other-112605.png" alt=""></p></li></ol><h2 id="_4-综上总结" tabindex="-1"><a class="header-anchor" href="#_4-综上总结" aria-hidden="true">#</a> 4. 综上总结</h2><ol><li>还是很感激那些前途的探路人，为原创研发贡献力量</li><li>我博客；https://bugstack.cn，可以尝试验证或者克隆对应的代码仓库</li><li>利用了11月24日周六给自己加个通宵班完成所有代码的开发和服务申请到部署，从最开始拿到想法到最终实现还是经历了很多坎坎坷坷</li><li>这里面还有很多可以优化的点以及一些拓展的功能，后续会陆续完善，如果由小伙伴有好的点子欢迎随时交流</li><li>源码贡献给所有研发，微信公众号内回复；<strong>itstack-ark-wx</strong>，即可获得一份基于领域驱动设计开发的微信公众号与博客打通工程(Star&amp;Frok)</li><li>夜深人静咣咣敲代码我也会怀疑，我是谁，我在哪，我在干什么！哎，这就是；喜欢干一份工作，往往来自于干了一件喜欢的工作</li></ol>`,68);function v(m,b){const a=p("ExternalLinkIcon");return e(),o("div",null,[u,n("p",null,[s("作者：小傅哥 "),r,s("博客："),n("a",k,[s("https://bugstack.cn"),c(a)])]),d])}const h=t(i,[["render",v],["__file","2019-11-23-bingbuxiangchuiniupi，dan！weiliaobaGithubbokefensizhuanyidaogongzhonghao，woganliao！.html.vue"]]);export{h as default};
