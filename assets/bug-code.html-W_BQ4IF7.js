import{_ as a,r as n,o as r,c as s,a as e,b as t,d as l,e as i}from"./app-3RcBQnkC.js";const c={},d=e("h1",{id:"bug-code-——-收集实际开发中所遇到的异常进行模拟复现",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#bug-code-——-收集实际开发中所遇到的异常进行模拟复现","aria-hidden":"true"},"#"),t(" Bug-Code —— 收集实际开发中所遇到的异常进行模拟复现")],-1),h=e("br",null,null,-1),u={href:"https://bugstack.cn",target:"_blank",rel:"noopener noreferrer"},_=e("br",null,null,-1),b={href:"https://t.zsxq.com/05zj2niYR",target:"_blank",rel:"noopener noreferrer"},g=e("blockquote",null,[e("p",null,"沉淀、分享、成长，让自己和他人都能有所收获！😄")],-1),k=e("iframe",{id:"B-Video",src:"//player.bilibili.com/player.html?aid=816712453&bvid=BV1RG4y1n7Ep&cid=863241955&page=1",scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",width:"100%",height:"480"}," ",-1),p=e("h2",{id:"一、前言",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#一、前言","aria-hidden":"true"},"#"),t(" 一、前言")],-1),f=e("p",null,"看到星球VIP群，读者伙伴分享的面试真实场景问题和讨论，发现很多没经过太多编码的研发伙伴，可能并没有看到过这样的异常，所以理解起来也有些困难。那么为了让大家更好的吸收这些实战经验，小傅哥特此创建这样一个 Bug-Code 仓库，用于给星球读者积累一些工作中常见的异常复现，积累编程经验。",-1),m=e("strong",null,"工程仓库",-1),B={href:"https://gitcode.net/KnowledgePlanet/CodeTutorial/Bug-Code",target:"_blank",rel:"noopener noreferrer"},C=e("strong",null,"加入项目",-1),T={href:"https://t.zsxq.com/jAi2nUf",target:"_blank",rel:"noopener noreferrer"},v=e("code",null,"公众号：bugstack虫洞栈 回复：星球 可以获得加入优惠券",-1),y=e("h2",{id:"二、异常问题",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#二、异常问题","aria-hidden":"true"},"#"),t(" 二、异常问题")],-1),j=e("h3",{id:"_1-transaction-rolled-back-because-it-has-been-marked-as-rollback-only",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#_1-transaction-rolled-back-because-it-has-been-marked-as-rollback-only","aria-hidden":"true"},"#"),t(" 1. Transaction rolled back because it has been marked as rollback-only")],-1),x=i('<li><p>问题：rollback-only</p></li><li><p>异常：线程执行某个定时任务，在事务提交时抛出了异常。看到rollback-only字样，这个是什么原因引起的。写代码要注意什么能避免产生这一种情况。</p></li><li><p>测试：用数据库表防重做插入测试，触发异常；</p><ul><li><ol><li>两个方法都加了事务注解，两个方法都会受到到事务管理的拦截器增强，并且事务传播的方式都是 REQUIRED，当已经存在事务的时候就加入事务，没有就创建事务。这里A和B都受事务控制，并且是处于同一个事务的。</li></ol></li><li><ol start="2"><li>A调用B，A中抓了B的异常，当B发生异常的时候，B的操作应该回滚，但是A吃了异常，A方法中没有产生异常，所以A的操作又应该提交，二者是相互矛盾的。</li></ol></li><li><ol start="3"><li>Spring的事务关联拦截器在抓到B的异常后就会标记rollback-only为true，当A执行完准备提交后，发现rollback-only为true，也会回滚，并抛出异常告诉调用者。</li></ol></li></ul></li>',3),w={href:"https://gitcode.net/KnowledgePlanet/CodeTutorial/Bug-Code/-/blob/master/src/test/java/cn/bugstack/guide/test/RollbackOnlyTest.java",target:"_blank",rel:"noopener noreferrer"},A=e("h3",{id:"_2-transaction-rolled-back-because-it-has-been-marked-as-rollback-only",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#_2-transaction-rolled-back-because-it-has-been-marked-as-rollback-only","aria-hidden":"true"},"#"),t(" 2. Transaction rolled back because it has been marked as rollback-only")],-1),P=e("li",null,"问题：死锁",-1),K=e("li",null,"异常：Deadlock found when trying to get lock; try restarting transaction",-1),R=e("li",null,"测试：多线程模拟并发下，一个事务未提交完成，又来一个事务。",-1),V={href:"https://gitcode.net/KnowledgePlanet/CodeTutorial/Bug-Code/-/blob/master/src/test/java/cn/bugstack/guide/test/DeadlockTest.java",target:"_blank",rel:"noopener noreferrer"},z=e("h3",{id:"_3-spring-线程安全处理",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#_3-spring-线程安全处理","aria-hidden":"true"},"#"),t(" 3. Spring 线程安全处理")],-1),E=e("li",null,"问题：串号",-1),q=e("li",null,"异常：在一个单例的 OrderService 中，使用多线程调用，对一个属性设置值后再获取，那么会出现 OrderNo 串号的问题。",-1),L=e("li",null,"测试：分别使用普通的单例方式和加入 ThreadLocal 根据线程获取单号",-1),N={href:"https://gitcode.net/KnowledgePlanet/CodeTutorial/Bug-Code/-/blob/master/src/test/java/cn/bugstack/guide/test/ThreadLocalTest.java",target:"_blank",rel:"noopener noreferrer"};function D(I,O){const o=n("ExternalLinkIcon");return r(),s("div",null,[d,e("p",null,[t("作者：小傅哥 "),h,t("博客："),e("a",u,[t("https://bugstack.cn"),l(o)]),_,t("星球："),e("a",b,[t("https://t.zsxq.com/05zj2niYR"),l(o)])]),g,k,p,f,e("ul",null,[e("li",null,[m,t("："),e("a",B,[t("https://gitcode.net/KnowledgePlanet/CodeTutorial/Bug-Code"),l(o)])]),e("li",null,[C,t("："),e("a",T,[t("https://t.zsxq.com/jAi2nUf"),l(o)]),t(" - 加入后在星球置顶消息可以申请加入项目组，"),v])]),y,j,e("ul",null,[x,e("li",null,[e("p",null,[t("复现："),e("a",w,[t("https://gitcode.net/KnowledgePlanet/CodeTutorial/Bug-Code/-/blob/master/src/test/java/cn/bugstack/guide/test/RollbackOnlyTest.java"),l(o)])])])]),A,e("ul",null,[P,K,R,e("li",null,[t("复现："),e("a",V,[t("https://gitcode.net/KnowledgePlanet/CodeTutorial/Bug-Code/-/blob/master/src/test/java/cn/bugstack/guide/test/DeadlockTest.java"),l(o)])])]),z,e("ul",null,[E,q,L,e("li",null,[t("复现："),e("a",N,[t("https://gitcode.net/KnowledgePlanet/CodeTutorial/Bug-Code/-/blob/master/src/test/java/cn/bugstack/guide/test/ThreadLocalTest.java"),l(o)])])])])}const U=a(c,[["render",D],["__file","bug-code.html.vue"]]);export{U as default};
